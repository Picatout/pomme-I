ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 1.
Hexadecimal [24-Bits]



                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019,2022,2023,2024  
                                      3 ; This file is part of p1Basic 
                                      4 ;
                                      5 ;     p1Basic is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     p1Basic is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with p1Basic.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 
                                     19 
                                     20     .module PROC_TABLE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 2.
Hexadecimal [24-Bits]



                                     21     .include "../config.inc"
                                      1 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                      2 ;;  system configuration parameters 
                                      3 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                      4 
                           000000     5 DEBUG=0 ; set to 1 to embed debug support code.
                                      6 
                           000080     7 STACK_SIZE==128 ; at end of RAM 
                           000080     8 PAD_SIZE==BLOCK_SIZE ; 128 bytes below stack 
                           000080     9 TIB_SIZE==128 ; below pad 
                           000100    10 PAGE0_SIZE==256 ; reserved for system variables 
                           001580    11 FREE_RAM==RAM_SIZE-STACK_SIZE-PAD_SIZE-TIB_SIZE-PAGE0_SIZE ; 5504
                           004000    12 SYS_SIZE=0x4000 ; flash reserved for system 16KB 
                                     13 ; file system in flash memory to save BASIC programs 
                           00C000    14 FS_BASE==0xC000 ; file system base address 49152 
                           00C000    15 FS_SIZE==0xC000 ; file system size 49152 bytes  48KB 
                                     16 
                           000030    17 APP_DATA_ORG=0x30
                                     18 
                           000001    19 HSI=1 ; set this to 1 if using internal high speed oscillator  
                           000001    20 .if HSI 
                           000000    21 HSE=0
                           000000    22 .else
                                     23 HSE=1  
                                     24 .endif 
                                     25 
                           000010    26 FMSTR=16 ; master clock frequency in Mhz 
                                     27 
                                     28 ; boards list
                                     29 ; set selected board to 1  
                           000000    30 NUCLEO_8S208RB=0
                                     31 ; use this to ensure 
                                     32 ; only one is selected 
                           000000    33 .if NUCLEO_8S208RB 
                                     34 NUCLEO_8S207K8=0
                           000001    35 .else 
                           000001    36 NUCLEO_8S207K8=1
                                     37 .endif 
                                     38 
                                     39 ; NUCLEO-8S208RB config.
                           000000    40 .if NUCLEO_8S208RB 
                                     41     .include "inc/stm8s208.inc" 
                                     42     .include "inc/nucleo_8s208.inc"
                                     43 .endif  
                                     44 
                                     45 ; NUCLEO-8S207K8 config. 
                           000001    46 .if NUCLEO_8S207K8 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 3.
Hexadecimal [24-Bits]



                                     47     .include "inc/stm8s207.inc" 
                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019,2022 
                                      3 ; This file is part of MONA 
                                      4 ;
                                      5 ;     MONA is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     MONA is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     19 ; 2022/11/14
                                     20 ; STM8S207K8 µC registers map
                                     21 ; sdas source file
                                     22 ; author: Jacques Deschênes, copyright 2018,2019,2022
                                     23 ; licence: GPLv3
                                     24 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     25 
                                     26 ;;;;;;;;;;;
                                     27 ; bits
                                     28 ;;;;;;;;;;;;
                           000000    29  BIT0 = 0
                           000001    30  BIT1 = 1
                           000002    31  BIT2 = 2
                           000003    32  BIT3 = 3
                           000004    33  BIT4 = 4
                           000005    34  BIT5 = 5
                           000006    35  BIT6 = 6
                           000007    36  BIT7 = 7
                                     37  	
                                     38 ;;;;;;;;;;;;
                                     39 ; bits masks
                                     40 ;;;;;;;;;;;;
                           000001    41  B0_MASK = (1<<0)
                           000002    42  B1_MASK = (1<<1)
                           000004    43  B2_MASK = (1<<2)
                           000008    44  B3_MASK = (1<<3)
                           000010    45  B4_MASK = (1<<4)
                           000020    46  B5_MASK = (1<<5)
                           000040    47  B6_MASK = (1<<6)
                           000080    48  B7_MASK = (1<<7)
                                     49 
                                     50 ; HSI oscillator frequency 16Mhz
                           F42400    51  FHSI = 16000000
                                     52 ; LSI oscillator frequency 128Khz
                           01F400    53  FLSI = 128000 
                                     54 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 4.
Hexadecimal [24-Bits]



                                     55 ; controller memory regions
                           001800    56  RAM_SIZE = (0x1800) ; 6KB 
                           000400    57  EEPROM_SIZE = (0x400) ; 1KB
                                     58 ; STM8S207K8 have 64K flash
                           010000    59  FLASH_SIZE = (0x10000)
                                     60 ; erase block size 
                           000080    61 BLOCK_SIZE=128 ; bytes 
                                     62 
                           000000    63  RAM_BASE = (0)
                           0017FF    64  RAM_END = (RAM_BASE+RAM_SIZE-1)
                           004000    65  EEPROM_BASE = (0x4000)
                           0043FF    66  EEPROM_END = (EEPROM_BASE+EEPROM_SIZE-1)
                           005000    67  SFR_BASE = (0x5000)
                           0057FF    68  SFR_END = (0x57FF)
                           006000    69  BOOT_ROM_BASE = (0x6000)
                           007FFF    70  BOOT_ROM_END = (0x7fff)
                           008000    71  FLASH_BASE = (0x8000)
                           017FFF    72  FLASH_END = (FLASH_BASE+FLASH_SIZE-1)
                           004800    73  OPTION_BASE = (0x4800)
                           000080    74  OPTION_SIZE = (0x80)
                           00487F    75  OPTION_END = (OPTION_BASE+OPTION_SIZE-1)
                           0048CD    76  DEVID_BASE = (0x48CD)
                           0048D8    77  DEVID_END = (0x48D8)
                           007F00    78  DEBUG_BASE = (0X7F00)
                           007FFF    79  DEBUG_END = (0X7FFF)
                                     80 
                                     81 ; options bytes
                                     82 ; this one can be programmed only from SWIM  (ICP)
                           004800    83  OPT0  = (0x4800)
                                     84 ; these can be programmed at runtime (IAP)
                           004801    85  OPT1  = (0x4801)
                           004802    86  NOPT1  = (0x4802)
                           004803    87  OPT2  = (0x4803)
                           004804    88  NOPT2  = (0x4804)
                           004805    89  OPT3  = (0x4805)
                           004806    90  NOPT3  = (0x4806)
                           004807    91  OPT4  = (0x4807)
                           004808    92  NOPT4  = (0x4808)
                           004809    93  OPT5  = (0x4809)
                           00480A    94  NOPT5  = (0x480A)
                           00480B    95  OPT6  = (0x480B)
                           00480C    96  NOPT6 = (0x480C)
                           00480D    97  OPT7 = (0x480D)
                           00480E    98  NOPT7 = (0x480E)
                           00487E    99  OPTBL  = (0x487E)
                           00487F   100  NOPTBL  = (0x487F)
                                    101 ; option registers usage
                                    102 ; read out protection, value 0xAA enable ROP
                           004800   103  ROP = OPT0  
                                    104 ; user boot code, {0..0x3e} 512 bytes row
                           004801   105  UBC = OPT1
                           004802   106  NUBC = NOPT1
                                    107 ; alternate function register
                           004803   108  AFR = OPT2
                           004804   109  NAFR = NOPT2
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 5.
Hexadecimal [24-Bits]



                                    110 ; miscelinous options
                           004805   111  WDGOPT = OPT3
                           004806   112  NWDGOPT = NOPT3
                                    113 ; clock options
                           004807   114  CLKOPT = OPT4
                           004808   115  NCLKOPT = NOPT4
                                    116 ; HSE clock startup delay
                           004809   117  HSECNT = OPT5
                           00480A   118  NHSECNT = NOPT5
                                    119 ; flash wait state
                           00480D   120 FLASH_WS = OPT7
                           00480E   121 NFLASH_WS = NOPT7
                                    122 
                                    123 ; watchdog options bits
                           000003   124   WDGOPT_LSIEN   =  BIT3
                           000002   125   WDGOPT_IWDG_HW =  BIT2
                           000001   126   WDGOPT_WWDG_HW =  BIT1
                           000000   127   WDGOPT_WWDG_HALT = BIT0
                                    128 ; NWDGOPT bits
                           FFFFFFFC   129   NWDGOPT_LSIEN    = ~BIT3
                           FFFFFFFD   130   NWDGOPT_IWDG_HW  = ~BIT2
                           FFFFFFFE   131   NWDGOPT_WWDG_HW  = ~BIT1
                           FFFFFFFF   132   NWDGOPT_WWDG_HALT = ~BIT0
                                    133 
                                    134 ; CLKOPT bits
                           000003   135  CLKOPT_EXT_CLK  = BIT3
                           000002   136  CLKOPT_CKAWUSEL = BIT2
                           000001   137  CLKOPT_PRS_C1   = BIT1
                           000000   138  CLKOPT_PRS_C0   = BIT0
                                    139 
                                    140 ; AFR option, remapable functions
                           000007   141  AFR7_BEEP    = BIT7
                           000006   142  AFR6_I2C     = BIT6
                           000005   143  AFR5_TIM1    = BIT5
                           000004   144  AFR4_TIM1    = BIT4
                           000003   145  AFR3_TIM1    = BIT3
                           000002   146  AFR2_CCO     = BIT2
                           000001   147  AFR1_TIM2    = BIT1
                           000000   148  AFR0_ADC     = BIT0
                                    149 
                                    150 ; device ID = (read only)
                           0048CD   151  DEVID_XL  = (0x48CD)
                           0048CE   152  DEVID_XH  = (0x48CE)
                           0048CF   153  DEVID_YL  = (0x48CF)
                           0048D0   154  DEVID_YH  = (0x48D0)
                           0048D1   155  DEVID_WAF  = (0x48D1)
                           0048D2   156  DEVID_LOT0  = (0x48D2)
                           0048D3   157  DEVID_LOT1  = (0x48D3)
                           0048D4   158  DEVID_LOT2  = (0x48D4)
                           0048D5   159  DEVID_LOT3  = (0x48D5)
                           0048D6   160  DEVID_LOT4  = (0x48D6)
                           0048D7   161  DEVID_LOT5  = (0x48D7)
                           0048D8   162  DEVID_LOT6  = (0x48D8)
                                    163 
                                    164 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 6.
Hexadecimal [24-Bits]



                           005000   165 GPIO_BASE = (0x5000)
                           000005   166 GPIO_SIZE = (5)
                                    167 ; PORTS SFR OFFSET
                           000000   168 PA = 0
                           000005   169 PB = 5
                           00000A   170 PC = 10
                           00000F   171 PD = 15
                           000014   172 PE = 20
                           000019   173 PF = 25
                           00001E   174 PG = 30
                           000023   175 PH = 35 
                           000028   176 PI = 40 
                                    177 
                                    178 ; GPIO
                                    179 ; gpio register offset to base
                           000000   180  GPIO_ODR = 0
                           000001   181  GPIO_IDR = 1
                           000002   182  GPIO_DDR = 2
                           000003   183  GPIO_CR1 = 3
                           000004   184  GPIO_CR2 = 4
                           005000   185  GPIO_BASE=(0X5000)
                                    186  
                                    187 ; port A
                           005000   188  PA_BASE = (0X5000)
                           005000   189  PA_ODR  = (0x5000)
                           005001   190  PA_IDR  = (0x5001)
                           005002   191  PA_DDR  = (0x5002)
                           005003   192  PA_CR1  = (0x5003)
                           005004   193  PA_CR2  = (0x5004)
                                    194 ; port B
                           005005   195  PB_BASE = (0X5005)
                           005005   196  PB_ODR  = (0x5005)
                           005006   197  PB_IDR  = (0x5006)
                           005007   198  PB_DDR  = (0x5007)
                           005008   199  PB_CR1  = (0x5008)
                           005009   200  PB_CR2  = (0x5009)
                                    201 ; port C
                           00500A   202  PC_BASE = (0X500A)
                           00500A   203  PC_ODR  = (0x500A)
                           00500B   204  PC_IDR  = (0x500B)
                           00500C   205  PC_DDR  = (0x500C)
                           00500D   206  PC_CR1  = (0x500D)
                           00500E   207  PC_CR2  = (0x500E)
                                    208 ; port D
                           00500F   209  PD_BASE = (0X500F)
                           00500F   210  PD_ODR  = (0x500F)
                           005010   211  PD_IDR  = (0x5010)
                           005011   212  PD_DDR  = (0x5011)
                           005012   213  PD_CR1  = (0x5012)
                           005013   214  PD_CR2  = (0x5013)
                                    215 ; port E
                           005014   216  PE_BASE = (0X5014)
                           005014   217  PE_ODR  = (0x5014)
                           005015   218  PE_IDR  = (0x5015)
                           005016   219  PE_DDR  = (0x5016)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 7.
Hexadecimal [24-Bits]



                           005017   220  PE_CR1  = (0x5017)
                           005018   221  PE_CR2  = (0x5018)
                                    222 ; port F
                           005019   223  PF_BASE = (0X5019)
                           005019   224  PF_ODR  = (0x5019)
                           00501A   225  PF_IDR  = (0x501A)
                           00501B   226  PF_DDR  = (0x501B)
                           00501C   227  PF_CR1  = (0x501C)
                           00501D   228  PF_CR2  = (0x501D)
                                    229 ; port G
                           00501E   230  PG_BASE = (0X501E)
                           00501E   231  PG_ODR  = (0x501E)
                           00501F   232  PG_IDR  = (0x501F)
                           005020   233  PG_DDR  = (0x5020)
                           005021   234  PG_CR1  = (0x5021)
                           005022   235  PG_CR2  = (0x5022)
                                    236 ; port H not present on LQFP48/LQFP64 package
                           005023   237  PH_BASE = (0X5023)
                           005023   238  PH_ODR  = (0x5023)
                           005024   239  PH_IDR  = (0x5024)
                           005025   240  PH_DDR  = (0x5025)
                           005026   241  PH_CR1  = (0x5026)
                           005027   242  PH_CR2  = (0x5027)
                                    243 ; port I ; only bit 0 on LQFP64 package, not present on LQFP48
                           005028   244  PI_BASE = (0X5028)
                           005028   245  PI_ODR  = (0x5028)
                           005029   246  PI_IDR  = (0x5029)
                           00502A   247  PI_DDR  = (0x502a)
                           00502B   248  PI_CR1  = (0x502b)
                           00502C   249  PI_CR2  = (0x502c)
                                    250 
                                    251 ; input modes CR1
                           000000   252  INPUT_FLOAT = (0) ; no pullup resistor
                           000001   253  INPUT_PULLUP = (1)
                                    254 ; output mode CR1
                           000000   255  OUTPUT_OD = (0) ; open drain
                           000001   256  OUTPUT_PP = (1) ; push pull
                                    257 ; input modes CR2
                           000000   258  INPUT_DI = (0)
                           000001   259  INPUT_EI = (1)
                                    260 ; output speed CR2
                           000000   261  OUTPUT_SLOW = (0)
                           000001   262  OUTPUT_FAST = (1)
                                    263 
                                    264 
                                    265 ; Flash memory
                           000080   266  BLOCK_SIZE=128 
                           00505A   267  FLASH_CR1  = (0x505A)
                           00505B   268  FLASH_CR2  = (0x505B)
                           00505C   269  FLASH_NCR2  = (0x505C)
                           00505D   270  FLASH_FPR  = (0x505D)
                           00505E   271  FLASH_NFPR  = (0x505E)
                           00505F   272  FLASH_IAPSR  = (0x505F)
                           005062   273  FLASH_PUKR  = (0x5062)
                           005064   274  FLASH_DUKR  = (0x5064)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 8.
Hexadecimal [24-Bits]



                                    275 ; data memory unlock keys
                           0000AE   276  FLASH_DUKR_KEY1 = (0xae)
                           000056   277  FLASH_DUKR_KEY2 = (0x56)
                                    278 ; flash memory unlock keys
                           000056   279  FLASH_PUKR_KEY1 = (0x56)
                           0000AE   280  FLASH_PUKR_KEY2 = (0xae)
                                    281 ; FLASH_CR1 bits
                           000003   282  FLASH_CR1_HALT = BIT3
                           000002   283  FLASH_CR1_AHALT = BIT2
                           000001   284  FLASH_CR1_IE = BIT1
                           000000   285  FLASH_CR1_FIX = BIT0
                                    286 ; FLASH_CR2 bits
                           000007   287  FLASH_CR2_OPT = BIT7
                           000006   288  FLASH_CR2_WPRG = BIT6
                           000005   289  FLASH_CR2_ERASE = BIT5
                           000004   290  FLASH_CR2_FPRG = BIT4
                           000000   291  FLASH_CR2_PRG = BIT0
                                    292 ; FLASH_FPR bits
                           000005   293  FLASH_FPR_WPB5 = BIT5
                           000004   294  FLASH_FPR_WPB4 = BIT4
                           000003   295  FLASH_FPR_WPB3 = BIT3
                           000002   296  FLASH_FPR_WPB2 = BIT2
                           000001   297  FLASH_FPR_WPB1 = BIT1
                           000000   298  FLASH_FPR_WPB0 = BIT0
                                    299 ; FLASH_NFPR bits
                           000005   300  FLASH_NFPR_NWPB5 = BIT5
                           000004   301  FLASH_NFPR_NWPB4 = BIT4
                           000003   302  FLASH_NFPR_NWPB3 = BIT3
                           000002   303  FLASH_NFPR_NWPB2 = BIT2
                           000001   304  FLASH_NFPR_NWPB1 = BIT1
                           000000   305  FLASH_NFPR_NWPB0 = BIT0
                                    306 ; FLASH_IAPSR bits
                           000006   307  FLASH_IAPSR_HVOFF = BIT6
                           000003   308  FLASH_IAPSR_DUL = BIT3
                           000002   309  FLASH_IAPSR_EOP = BIT2
                           000001   310  FLASH_IAPSR_PUL = BIT1
                           000000   311  FLASH_IAPSR_WR_PG_DIS = BIT0
                                    312 
                                    313 ; Interrupt control
                           0050A0   314  EXTI_CR1  = (0x50A0)
                           0050A1   315  EXTI_CR2  = (0x50A1)
                                    316 
                                    317 ; Reset Status
                           0050B3   318  RST_SR  = (0x50B3)
                                    319 
                                    320 ; Clock Registers
                           0050C0   321  CLK_ICKR  = (0x50c0)
                           0050C1   322  CLK_ECKR  = (0x50c1)
                           0050C3   323  CLK_CMSR  = (0x50C3)
                           0050C4   324  CLK_SWR  = (0x50C4)
                           0050C5   325  CLK_SWCR  = (0x50C5)
                           0050C6   326  CLK_CKDIVR  = (0x50C6)
                           0050C7   327  CLK_PCKENR1  = (0x50C7)
                           0050C8   328  CLK_CSSR  = (0x50C8)
                           0050C9   329  CLK_CCOR  = (0x50C9)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 9.
Hexadecimal [24-Bits]



                           0050CA   330  CLK_PCKENR2  = (0x50CA)
                           0050CC   331  CLK_HSITRIMR  = (0x50CC)
                           0050CD   332  CLK_SWIMCCR  = (0x50CD)
                                    333 
                                    334 ; Peripherals clock gating
                                    335 ; CLK_PCKENR1 
                           000007   336  CLK_PCKENR1_TIM1 = (7)
                           000006   337  CLK_PCKENR1_TIM3 = (6)
                           000005   338  CLK_PCKENR1_TIM2 = (5)
                           000004   339  CLK_PCKENR1_TIM4 = (4)
                           000003   340  CLK_PCKENR1_UART3 = (3)
                           000002   341  CLK_PCKENR1_UART1 = (2)
                           000001   342  CLK_PCKENR1_SPI = (1)
                           000000   343  CLK_PCKENR1_I2C = (0)
                                    344 ; CLK_PCKENR2
                           000007   345  CLK_PCKENR2_CAN = (7)
                           000003   346  CLK_PCKENR2_ADC = (3)
                           000002   347  CLK_PCKENR2_AWU = (2)
                                    348 
                                    349 ; Clock bits
                           000005   350  CLK_ICKR_REGAH = (5)
                           000004   351  CLK_ICKR_LSIRDY = (4)
                           000003   352  CLK_ICKR_LSIEN = (3)
                           000002   353  CLK_ICKR_FHW = (2)
                           000001   354  CLK_ICKR_HSIRDY = (1)
                           000000   355  CLK_ICKR_HSIEN = (0)
                                    356 
                           000001   357  CLK_ECKR_HSERDY = (1)
                           000000   358  CLK_ECKR_HSEEN = (0)
                                    359 ; clock source
                           0000E1   360  CLK_SWR_HSI = 0xE1
                           0000D2   361  CLK_SWR_LSI = 0xD2
                           0000B4   362  CLK_SWR_HSE = 0xB4
                                    363 
                           000003   364  CLK_SWCR_SWIF = (3)
                           000002   365  CLK_SWCR_SWIEN = (2)
                           000001   366  CLK_SWCR_SWEN = (1)
                           000000   367  CLK_SWCR_SWBSY = (0)
                                    368 
                           000004   369  CLK_CKDIVR_HSIDIV1 = (4)
                           000003   370  CLK_CKDIVR_HSIDIV0 = (3)
                           000002   371  CLK_CKDIVR_CPUDIV2 = (2)
                           000001   372  CLK_CKDIVR_CPUDIV1 = (1)
                           000000   373  CLK_CKDIVR_CPUDIV0 = (0)
                                    374 
                                    375 ; Watchdog
                           0050D1   376  WWDG_CR  = (0x50D1)
                           0050D2   377  WWDG_WR  = (0x50D2)
                           0050E0   378  IWDG_KR  = (0x50E0)
                           0050E1   379  IWDG_PR  = (0x50E1)
                           0050E2   380  IWDG_RLR  = (0x50E2)
                           0000CC   381  IWDG_KEY_ENABLE = 0xCC  ; enable IWDG key 
                           0000AA   382  IWDG_KEY_REFRESH = 0xAA ; refresh counter key 
                           000055   383  IWDG_KEY_ACCESS = 0x55 ; write register key 
                                    384  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 10.
Hexadecimal [24-Bits]



                           0050F0   385  AWU_CSR  = (0x50F0)
                           0050F1   386  AWU_APR  = (0x50F1)
                           0050F2   387  AWU_TBR  = (0x50F2)
                           000004   388  AWU_CSR_AWUEN = 4
                                    389 
                                    390 
                                    391 
                                    392 ; Beeper
                                    393 ; beeper output is alternate function AFR7 on PD4
                                    394 ; connected to CN9-6
                           0050F3   395  BEEP_CSR  = (0x50F3)
                           00000F   396  BEEP_PORT = PD
                           000004   397  BEEP_BIT = 4
                           000010   398  BEEP_MASK = B4_MASK
                                    399 
                                    400 ; SPI
                           005200   401  SPI_CR1  = (0x5200)
                           005201   402  SPI_CR2  = (0x5201)
                           005202   403  SPI_ICR  = (0x5202)
                           005203   404  SPI_SR  = (0x5203)
                           005204   405  SPI_DR  = (0x5204)
                           005205   406  SPI_CRCPR  = (0x5205)
                           005206   407  SPI_RXCRCR  = (0x5206)
                           005207   408  SPI_TXCRCR  = (0x5207)
                                    409 
                                    410 ; SPI_CR1 bit fields 
                           000000   411   SPI_CR1_CPHA=0
                           000001   412   SPI_CR1_CPOL=1
                           000002   413   SPI_CR1_MSTR=2
                           000003   414   SPI_CR1_BR=3
                           000006   415   SPI_CR1_SPE=6
                           000007   416   SPI_CR1_LSBFIRST=7
                                    417   
                                    418 ; SPI_CR2 bit fields 
                           000000   419   SPI_CR2_SSI=0
                           000001   420   SPI_CR2_SSM=1
                           000002   421   SPI_CR2_RXONLY=2
                           000004   422   SPI_CR2_CRCNEXT=4
                           000005   423   SPI_CR2_CRCEN=5
                           000006   424   SPI_CR2_BDOE=6
                           000007   425   SPI_CR2_BDM=7  
                                    426 
                                    427 ; SPI_SR bit fields 
                           000000   428   SPI_SR_RXNE=0
                           000001   429   SPI_SR_TXE=1
                           000003   430   SPI_SR_WKUP=3
                           000004   431   SPI_SR_CRCERR=4
                           000005   432   SPI_SR_MODF=5
                           000006   433   SPI_SR_OVR=6
                           000007   434   SPI_SR_BSY=7
                                    435 
                                    436 ; I2C
                           005210   437  I2C_BASE_ADDR = 0x5210 
                           005210   438  I2C_CR1  = (0x5210)
                           005211   439  I2C_CR2  = (0x5211)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 11.
Hexadecimal [24-Bits]



                           005212   440  I2C_FREQR  = (0x5212)
                           005213   441  I2C_OARL  = (0x5213)
                           005214   442  I2C_OARH  = (0x5214)
                           005216   443  I2C_DR  = (0x5216)
                           005217   444  I2C_SR1  = (0x5217)
                           005218   445  I2C_SR2  = (0x5218)
                           005219   446  I2C_SR3  = (0x5219)
                           00521A   447  I2C_ITR  = (0x521A)
                           00521B   448  I2C_CCRL  = (0x521B)
                           00521C   449  I2C_CCRH  = (0x521C)
                           00521D   450  I2C_TRISER  = (0x521D)
                           00521E   451  I2C_PECR  = (0x521E)
                                    452 
                           000007   453  I2C_CR1_NOSTRETCH = (7)
                           000006   454  I2C_CR1_ENGC = (6)
                           000000   455  I2C_CR1_PE = (0)
                                    456 
                           000007   457  I2C_CR2_SWRST = (7)
                           000003   458  I2C_CR2_POS = (3)
                           000002   459  I2C_CR2_ACK = (2)
                           000001   460  I2C_CR2_STOP = (1)
                           000000   461  I2C_CR2_START = (0)
                                    462 
                           000000   463  I2C_OARL_ADD0 = (0)
                                    464 
                           000009   465  I2C_OAR_ADDR_7BIT = ((I2C_OARL & 0xFE) >> 1)
                           000813   466  I2C_OAR_ADDR_10BIT = (((I2C_OARH & 0x06) << 9) | (I2C_OARL & 0xFF))
                                    467 
                           000007   468  I2C_OARH_ADDMODE = (7)
                           000006   469  I2C_OARH_ADDCONF = (6)
                           000002   470  I2C_OARH_ADD9 = (2)
                           000001   471  I2C_OARH_ADD8 = (1)
                                    472 
                           000007   473  I2C_SR1_TXE = (7)
                           000006   474  I2C_SR1_RXNE = (6)
                           000004   475  I2C_SR1_STOPF = (4)
                           000003   476  I2C_SR1_ADD10 = (3)
                           000002   477  I2C_SR1_BTF = (2)
                           000001   478  I2C_SR1_ADDR = (1)
                           000000   479  I2C_SR1_SB = (0)
                                    480 
                           000005   481  I2C_SR2_WUFH = (5)
                           000003   482  I2C_SR2_OVR = (3)
                           000002   483  I2C_SR2_AF = (2)
                           000001   484  I2C_SR2_ARLO = (1)
                           000000   485  I2C_SR2_BERR = (0)
                                    486 
                           000007   487  I2C_SR3_DUALF = (7)
                           000004   488  I2C_SR3_GENCALL = (4)
                           000002   489  I2C_SR3_TRA = (2)
                           000001   490  I2C_SR3_BUSY = (1)
                           000000   491  I2C_SR3_MSL = (0)
                                    492 
                           000002   493  I2C_ITR_ITBUFEN = (2)
                           000001   494  I2C_ITR_ITEVTEN = (1)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 12.
Hexadecimal [24-Bits]



                           000000   495  I2C_ITR_ITERREN = (0)
                                    496 
                           000007   497  I2C_CCRH_FAST = 7 
                           000006   498  I2C_CCRH_DUTY = 6 
                                    499  
                                    500 ; Precalculated values, all in KHz
                           000080   501  I2C_CCRH_16MHZ_FAST_400 = 0x80
                           00000D   502  I2C_CCRL_16MHZ_FAST_400 = 0x0D
                                    503 ;
                                    504 ; Fast I2C mode max rise time = 300ns
                                    505 ; I2C_FREQR = 16 = (MHz) => tMASTER = 1/16 = 62.5 ns
                                    506 ; TRISER = = (300/62.5) + 1 = floor(4.8) + 1 = 5.
                                    507 
                           000005   508  I2C_TRISER_16MHZ_FAST_400 = 0x05
                                    509 
                           0000C0   510  I2C_CCRH_16MHZ_FAST_320 = 0xC0
                           000002   511  I2C_CCRL_16MHZ_FAST_320 = 0x02
                           000005   512  I2C_TRISER_16MHZ_FAST_320 = 0x05
                                    513 
                           000080   514  I2C_CCRH_16MHZ_FAST_200 = 0x80
                           00001A   515  I2C_CCRL_16MHZ_FAST_200 = 0x1A
                           000005   516  I2C_TRISER_16MHZ_FAST_200 = 0x05
                                    517 
                           000000   518  I2C_CCRH_16MHZ_STD_100 = 0x00
                           000050   519  I2C_CCRL_16MHZ_STD_100 = 0x50
                                    520 ;
                                    521 ; Standard I2C mode max rise time = 1000ns
                                    522 ; I2C_FREQR = 16 = (MHz) => tMASTER = 1/16 = 62.5 ns
                                    523 ; TRISER = = (1000/62.5) + 1 = floor(16) + 1 = 17.
                                    524 
                           000011   525  I2C_TRISER_16MHZ_STD_100 = 0x11
                                    526 
                           000000   527  I2C_CCRH_16MHZ_STD_50 = 0x00
                           0000A0   528  I2C_CCRL_16MHZ_STD_50 = 0xA0
                           000011   529  I2C_TRISER_16MHZ_STD_50 = 0x11
                                    530 
                           000001   531  I2C_CCRH_16MHZ_STD_20 = 0x01
                           000090   532  I2C_CCRL_16MHZ_STD_20 = 0x90
                           000011   533  I2C_TRISER_16MHZ_STD_20 = 0x11;
                                    534 
                           000001   535  I2C_READ = 1
                           000000   536  I2C_WRITE = 0
                                    537 
                                    538 ; baudrate constant for brr_value table access
                                    539 ; to be used by uart_init 
                           000000   540 B2400=0
                           000001   541 B4800=1
                           000002   542 B9600=2
                           000003   543 B19200=3
                           000004   544 B38400=4
                           000005   545 B57600=5
                           000006   546 B115200=6
                           000007   547 B230400=7
                           000008   548 B460800=8
                           000009   549 B921600=9
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 13.
Hexadecimal [24-Bits]



                                    550 
                                    551 ; UART registers offset from
                                    552 ; base address 
                           000000   553 OFS_UART_SR=0
                           000001   554 OFS_UART_DR=1
                           000002   555 OFS_UART_BRR1=2
                           000003   556 OFS_UART_BRR2=3
                           000004   557 OFS_UART_CR1=4
                           000005   558 OFS_UART_CR2=5
                           000006   559 OFS_UART_CR3=6
                           000007   560 OFS_UART_CR4=7
                           000008   561 OFS_UART_CR5=8
                           000009   562 OFS_UART_CR6=9
                           000009   563 OFS_UART_GTR=9
                           00000A   564 OFS_UART_PSCR=10
                                    565 
                                    566 ; uart identifier
                           000000   567  UART1 = 0 
                           000001   568  UART2 = 1
                           000002   569  UART3 = 2
                                    570 
                                    571 ; pins used by uart 
                           000005   572 UART1_TX_PIN=BIT5
                           000004   573 UART1_RX_PIN=BIT4
                           000005   574 UART3_TX_PIN=BIT5
                           000006   575 UART3_RX_PIN=BIT6
                                    576 ; uart port base address 
                           000000   577 UART1_PORT=PA 
                           00000F   578 UART3_PORT=PD
                                    579 
                                    580 ; UART1 
                           005230   581  UART1_BASE  = (0x5230)
                           005230   582  UART1_SR    = (0x5230)
                           005231   583  UART1_DR    = (0x5231)
                           005232   584  UART1_BRR1  = (0x5232)
                           005233   585  UART1_BRR2  = (0x5233)
                           005234   586  UART1_CR1   = (0x5234)
                           005235   587  UART1_CR2   = (0x5235)
                           005236   588  UART1_CR3   = (0x5236)
                           005237   589  UART1_CR4   = (0x5237)
                           005238   590  UART1_CR5   = (0x5238)
                           005239   591  UART1_GTR   = (0x5239)
                           00523A   592  UART1_PSCR  = (0x523A)
                                    593 
                                    594 ; UART3
                           005240   595  UART3_BASE  = (0x5240)
                           005240   596  UART3_SR    = (0x5240)
                           005241   597  UART3_DR    = (0x5241)
                           005242   598  UART3_BRR1  = (0x5242)
                           005243   599  UART3_BRR2  = (0x5243)
                           005244   600  UART3_CR1   = (0x5244)
                           005245   601  UART3_CR2   = (0x5245)
                           005246   602  UART3_CR3   = (0x5246)
                           005247   603  UART3_CR4   = (0x5247)
                           005249   604  UART3_CR6   = (0x5249)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 14.
Hexadecimal [24-Bits]



                                    605 
                                    606 ; UART Status Register bits
                           000007   607  UART_SR_TXE = (7)
                           000006   608  UART_SR_TC = (6)
                           000005   609  UART_SR_RXNE = (5)
                           000004   610  UART_SR_IDLE = (4)
                           000003   611  UART_SR_OR = (3)
                           000002   612  UART_SR_NF = (2)
                           000001   613  UART_SR_FE = (1)
                           000000   614  UART_SR_PE = (0)
                                    615 
                                    616 ; Uart Control Register bits
                           000007   617  UART_CR1_R8 = (7)
                           000006   618  UART_CR1_T8 = (6)
                           000005   619  UART_CR1_UARTD = (5)
                           000004   620  UART_CR1_M = (4)
                           000003   621  UART_CR1_WAKE = (3)
                           000002   622  UART_CR1_PCEN = (2)
                           000001   623  UART_CR1_PS = (1)
                           000000   624  UART_CR1_PIEN = (0)
                                    625 
                           000007   626  UART_CR2_TIEN = (7)
                           000006   627  UART_CR2_TCIEN = (6)
                           000005   628  UART_CR2_RIEN = (5)
                           000004   629  UART_CR2_ILIEN = (4)
                           000003   630  UART_CR2_TEN = (3)
                           000002   631  UART_CR2_REN = (2)
                           000001   632  UART_CR2_RWU = (1)
                           000000   633  UART_CR2_SBK = (0)
                                    634 
                           000006   635  UART_CR3_LINEN = (6)
                           000005   636  UART_CR3_STOP1 = (5)
                           000004   637  UART_CR3_STOP0 = (4)
                           000003   638  UART_CR3_CLKEN = (3)
                           000002   639  UART_CR3_CPOL = (2)
                           000001   640  UART_CR3_CPHA = (1)
                           000000   641  UART_CR3_LBCL = (0)
                                    642 
                           000006   643  UART_CR4_LBDIEN = (6)
                           000005   644  UART_CR4_LBDL = (5)
                           000004   645  UART_CR4_LBDF = (4)
                           000003   646  UART_CR4_ADD3 = (3)
                           000002   647  UART_CR4_ADD2 = (2)
                           000001   648  UART_CR4_ADD1 = (1)
                           000000   649  UART_CR4_ADD0 = (0)
                                    650 
                           000005   651  UART_CR5_SCEN = (5)
                           000004   652  UART_CR5_NACK = (4)
                           000003   653  UART_CR5_HDSEL = (3)
                           000002   654  UART_CR5_IRLP = (2)
                           000001   655  UART_CR5_IREN = (1)
                                    656 ; LIN mode config register
                           000007   657  UART_CR6_LDUM = (7)
                           000005   658  UART_CR6_LSLV = (5)
                           000004   659  UART_CR6_LASE = (4)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 15.
Hexadecimal [24-Bits]



                           000002   660  UART_CR6_LHDIEN = (2) 
                           000001   661  UART_CR6_LHDF = (1)
                           000000   662  UART_CR6_LSF = (0)
                                    663 
                                    664 ; TIMERS
                                    665 ; Timer 1 - 16-bit timer with complementary PWM outputs
                           005250   666  TIM1_CR1  = (0x5250)
                           005251   667  TIM1_CR2  = (0x5251)
                           005252   668  TIM1_SMCR  = (0x5252)
                           005253   669  TIM1_ETR  = (0x5253)
                           005254   670  TIM1_IER  = (0x5254)
                           005255   671  TIM1_SR1  = (0x5255)
                           005256   672  TIM1_SR2  = (0x5256)
                           005257   673  TIM1_EGR  = (0x5257)
                           005258   674  TIM1_CCMR1  = (0x5258)
                           005259   675  TIM1_CCMR2  = (0x5259)
                           00525A   676  TIM1_CCMR3  = (0x525A)
                           00525B   677  TIM1_CCMR4  = (0x525B)
                           00525C   678  TIM1_CCER1  = (0x525C)
                           00525D   679  TIM1_CCER2  = (0x525D)
                           00525E   680  TIM1_CNTRH  = (0x525E)
                           00525F   681  TIM1_CNTRL  = (0x525F)
                           005260   682  TIM1_PSCRH  = (0x5260)
                           005261   683  TIM1_PSCRL  = (0x5261)
                           005262   684  TIM1_ARRH  = (0x5262)
                           005263   685  TIM1_ARRL  = (0x5263)
                           005264   686  TIM1_RCR  = (0x5264)
                           005265   687  TIM1_CCR1H  = (0x5265)
                           005266   688  TIM1_CCR1L  = (0x5266)
                           005267   689  TIM1_CCR2H  = (0x5267)
                           005268   690  TIM1_CCR2L  = (0x5268)
                           005269   691  TIM1_CCR3H  = (0x5269)
                           00526A   692  TIM1_CCR3L  = (0x526A)
                           00526B   693  TIM1_CCR4H  = (0x526B)
                           00526C   694  TIM1_CCR4L  = (0x526C)
                           00526D   695  TIM1_BKR  = (0x526D)
                           00526E   696  TIM1_DTR  = (0x526E)
                           00526F   697  TIM1_OISR  = (0x526F)
                                    698 
                                    699 ; Timer Control Register bits
                           000007   700  TIM_CR1_ARPE = (7)
                           000006   701  TIM_CR1_CMSH = (6)
                           000005   702  TIM_CR1_CMSL = (5)
                           000004   703  TIM_CR1_DIR = (4)
                           000003   704  TIM_CR1_OPM = (3)
                           000002   705  TIM_CR1_URS = (2)
                           000001   706  TIM_CR1_UDIS = (1)
                           000000   707  TIM_CR1_CEN = (0)
                                    708 
                           000006   709  TIM1_CR2_MMS2 = (6)
                           000005   710  TIM1_CR2_MMS1 = (5)
                           000004   711  TIM1_CR2_MMS0 = (4)
                           000002   712  TIM1_CR2_COMS = (2)
                           000000   713  TIM1_CR2_CCPC = (0)
                                    714 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 16.
Hexadecimal [24-Bits]



                                    715 ; Timer Slave Mode Control bits
                           000007   716  TIM1_SMCR_MSM = (7)
                           000006   717  TIM1_SMCR_TS2 = (6)
                           000005   718  TIM1_SMCR_TS1 = (5)
                           000004   719  TIM1_SMCR_TS0 = (4)
                           000002   720  TIM1_SMCR_SMS2 = (2)
                           000001   721  TIM1_SMCR_SMS1 = (1)
                           000000   722  TIM1_SMCR_SMS0 = (0)
                                    723 
                                    724 ; Timer External Trigger Enable bits
                           000007   725  TIM1_ETR_ETP = (7)
                           000006   726  TIM1_ETR_ECE = (6)
                           000005   727  TIM1_ETR_ETPS1 = (5)
                           000004   728  TIM1_ETR_ETPS0 = (4)
                           000003   729  TIM1_ETR_ETF3 = (3)
                           000002   730  TIM1_ETR_ETF2 = (2)
                           000001   731  TIM1_ETR_ETF1 = (1)
                           000000   732  TIM1_ETR_ETF0 = (0)
                                    733 
                                    734 ; Timer Interrupt Enable bits
                           000007   735  TIM1_IER_BIE = (7)
                           000006   736  TIM1_IER_TIE = (6)
                           000005   737  TIM1_IER_COMIE = (5)
                           000004   738  TIM1_IER_CC4IE = (4)
                           000003   739  TIM1_IER_CC3IE = (3)
                           000002   740  TIM1_IER_CC2IE = (2)
                           000001   741  TIM1_IER_CC1IE = (1)
                           000000   742  TIM1_IER_UIE = (0)
                                    743 
                                    744 ; Timer Status Register bits
                           000007   745  TIM1_SR1_BIF = (7)
                           000006   746  TIM1_SR1_TIF = (6)
                           000005   747  TIM1_SR1_COMIF = (5)
                           000004   748  TIM1_SR1_CC4IF = (4)
                           000003   749  TIM1_SR1_CC3IF = (3)
                           000002   750  TIM1_SR1_CC2IF = (2)
                           000001   751  TIM1_SR1_CC1IF = (1)
                           000000   752  TIM1_SR1_UIF = (0)
                                    753 
                           000004   754  TIM1_SR2_CC4OF = (4)
                           000003   755  TIM1_SR2_CC3OF = (3)
                           000002   756  TIM1_SR2_CC2OF = (2)
                           000001   757  TIM1_SR2_CC1OF = (1)
                                    758 
                                    759 ; Timer Event Generation Register bits
                           000007   760  TIM1_EGR_BG = (7)
                           000006   761  TIM1_EGR_TG = (6)
                           000005   762  TIM1_EGR_COMG = (5)
                           000004   763  TIM1_EGR_CC4G = (4)
                           000003   764  TIM1_EGR_CC3G = (3)
                           000002   765  TIM1_EGR_CC2G = (2)
                           000001   766  TIM1_EGR_CC1G = (1)
                           000000   767  TIM1_EGR_UG = (0)
                                    768 
                                    769 ; Capture/Compare Mode Register 1 - channel configured in output
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 17.
Hexadecimal [24-Bits]



                           000007   770  TIM1_CCMR1_OC1CE = (7)
                           000006   771  TIM1_CCMR1_OC1M2 = (6)
                           000005   772  TIM1_CCMR1_OC1M1 = (5)
                           000004   773  TIM1_CCMR1_OC1M0 = (4)
                           000003   774  TIM1_CCMR1_OC1PE = (3)
                           000002   775  TIM1_CCMR1_OC1FE = (2)
                           000001   776  TIM1_CCMR1_CC1S1 = (1)
                           000000   777  TIM1_CCMR1_CC1S0 = (0)
                                    778 
                                    779 ; Capture/Compare Mode Register 1 - channel configured in input
                           000007   780  TIM1_CCMR1_IC1F3 = (7)
                           000006   781  TIM1_CCMR1_IC1F2 = (6)
                           000005   782  TIM1_CCMR1_IC1F1 = (5)
                           000004   783  TIM1_CCMR1_IC1F0 = (4)
                           000003   784  TIM1_CCMR1_IC1PSC1 = (3)
                           000002   785  TIM1_CCMR1_IC1PSC0 = (2)
                                    786 ;  TIM1_CCMR1_CC1S1 = (1)
                           000000   787  TIM1_CCMR1_CC1S0 = (0)
                                    788 
                                    789 ; Capture/Compare Mode Register 2 - channel configured in output
                           000007   790  TIM1_CCMR2_OC2CE = (7)
                           000006   791  TIM1_CCMR2_OC2M2 = (6)
                           000005   792  TIM1_CCMR2_OC2M1 = (5)
                           000004   793  TIM1_CCMR2_OC2M0 = (4)
                           000003   794  TIM1_CCMR2_OC2PE = (3)
                           000002   795  TIM1_CCMR2_OC2FE = (2)
                           000001   796  TIM1_CCMR2_CC2S1 = (1)
                           000000   797  TIM1_CCMR2_CC2S0 = (0)
                                    798 
                                    799 ; Capture/Compare Mode Register 2 - channel configured in input
                           000007   800  TIM1_CCMR2_IC2F3 = (7)
                           000006   801  TIM1_CCMR2_IC2F2 = (6)
                           000005   802  TIM1_CCMR2_IC2F1 = (5)
                           000004   803  TIM1_CCMR2_IC2F0 = (4)
                           000003   804  TIM1_CCMR2_IC2PSC1 = (3)
                           000002   805  TIM1_CCMR2_IC2PSC0 = (2)
                                    806 ;  TIM1_CCMR2_CC2S1 = (1)
                           000000   807  TIM1_CCMR2_CC2S0 = (0)
                                    808 
                                    809 ; Capture/Compare Mode Register 3 - channel configured in output
                           000007   810  TIM1_CCMR3_OC3CE = (7)
                           000006   811  TIM1_CCMR3_OC3M2 = (6)
                           000005   812  TIM1_CCMR3_OC3M1 = (5)
                           000004   813  TIM1_CCMR3_OC3M0 = (4)
                           000003   814  TIM1_CCMR3_OC3PE = (3)
                           000002   815  TIM1_CCMR3_OC3FE = (2)
                           000001   816  TIM1_CCMR3_CC3S1 = (1)
                           000000   817  TIM1_CCMR3_CC3S0 = (0)
                                    818 
                                    819 ; Capture/Compare Mode Register 3 - channel configured in input
                           000007   820  TIM1_CCMR3_IC3F3 = (7)
                           000006   821  TIM1_CCMR3_IC3F2 = (6)
                           000005   822  TIM1_CCMR3_IC3F1 = (5)
                           000004   823  TIM1_CCMR3_IC3F0 = (4)
                           000003   824  TIM1_CCMR3_IC3PSC1 = (3)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 18.
Hexadecimal [24-Bits]



                           000002   825  TIM1_CCMR3_IC3PSC0 = (2)
                                    826 ;  TIM1_CCMR3_CC3S1 = (1)
                           000000   827  TIM1_CCMR3_CC3S0 = (0)
                                    828 
                                    829 ; Capture/Compare Mode Register 4 - channel configured in output
                           000007   830  TIM1_CCMR4_OC4CE = (7)
                           000006   831  TIM1_CCMR4_OC4M2 = (6)
                           000005   832  TIM1_CCMR4_OC4M1 = (5)
                           000004   833  TIM1_CCMR4_OC4M0 = (4)
                           000003   834  TIM1_CCMR4_OC4PE = (3)
                           000002   835  TIM1_CCMR4_OC4FE = (2)
                           000001   836  TIM1_CCMR4_CC4S1 = (1)
                           000000   837  TIM1_CCMR4_CC4S0 = (0)
                                    838 
                                    839 ; Capture/Compare Mode Register 4 - channel configured in input
                           000007   840  TIM1_CCMR4_IC4F3 = (7)
                           000006   841  TIM1_CCMR4_IC4F2 = (6)
                           000005   842  TIM1_CCMR4_IC4F1 = (5)
                           000004   843  TIM1_CCMR4_IC4F0 = (4)
                           000003   844  TIM1_CCMR4_IC4PSC1 = (3)
                           000002   845  TIM1_CCMR4_IC4PSC0 = (2)
                                    846 ;  TIM1_CCMR4_CC4S1 = (1)
                           000000   847  TIM1_CCMR4_CC4S0 = (0)
                                    848 
                                    849 ; Timer 2 - 16-bit timer
                           005300   850  TIM2_CR1  = (0x5300)
                           005301   851  TIM2_IER  = (0x5301)
                           005302   852  TIM2_SR1  = (0x5302)
                           005303   853  TIM2_SR2  = (0x5303)
                           005304   854  TIM2_EGR  = (0x5304)
                           005305   855  TIM2_CCMR1  = (0x5305)
                           005306   856  TIM2_CCMR2  = (0x5306)
                           005307   857  TIM2_CCMR3  = (0x5307)
                           005308   858  TIM2_CCER1  = (0x5308)
                           005309   859  TIM2_CCER2  = (0x5309)
                           00530A   860  TIM2_CNTRH  = (0x530A)
                           00530B   861  TIM2_CNTRL  = (0x530B)
                           00530C   862  TIM2_PSCR  = (0x530C)
                           00530D   863  TIM2_ARRH  = (0x530D)
                           00530E   864  TIM2_ARRL  = (0x530E)
                           00530F   865  TIM2_CCR1H  = (0x530F)
                           005310   866  TIM2_CCR1L  = (0x5310)
                           005311   867  TIM2_CCR2H  = (0x5311)
                           005312   868  TIM2_CCR2L  = (0x5312)
                           005313   869  TIM2_CCR3H  = (0x5313)
                           005314   870  TIM2_CCR3L  = (0x5314)
                                    871 
                                    872 ; TIM2_CR1 bitfields
                           000000   873  TIM2_CR1_CEN=(0) ; Counter enable
                           000001   874  TIM2_CR1_UDIS=(1) ; Update disable
                           000002   875  TIM2_CR1_URS=(2) ; Update request source
                           000003   876  TIM2_CR1_OPM=(3) ; One-pulse mode
                           000007   877  TIM2_CR1_ARPE=(7) ; Auto-reload preload enable
                                    878 
                                    879 ; TIMER2_CCMR bitfields 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 19.
Hexadecimal [24-Bits]



                           000000   880  TIM2_CCMR_CCS=(0) ; input/output select
                           000003   881  TIM2_CCMR_OCPE=(3) ; preload enable
                           000004   882  TIM2_CCMR_OCM=(4)  ; output compare mode 
                                    883 
                                    884 ; TIMER2_CCER1 bitfields
                           000000   885  TIM2_CCER1_CC1E=(0)
                           000001   886  TIM2_CCER1_CC1P=(1)
                           000004   887  TIM2_CCER1_CC2E=(4)
                           000005   888  TIM2_CCER1_CC2P=(5)
                                    889 
                                    890 ; TIMER2_EGR bitfields
                           000000   891  TIM2_EGR_UG=(0) ; update generation
                           000001   892  TIM2_EGR_CC1G=(1) ; Capture/compare 1 generation
                           000002   893  TIM2_EGR_CC2G=(2) ; Capture/compare 2 generation
                           000003   894  TIM2_EGR_CC3G=(3) ; Capture/compare 3 generation
                           000006   895  TIM2_EGR_TG=(6); Trigger generation
                                    896 
                                    897 ; Timer 3
                           005320   898  TIM3_CR1  = (0x5320)
                           005321   899  TIM3_IER  = (0x5321)
                           005322   900  TIM3_SR1  = (0x5322)
                           005323   901  TIM3_SR2  = (0x5323)
                           005324   902  TIM3_EGR  = (0x5324)
                           005325   903  TIM3_CCMR1  = (0x5325)
                           005326   904  TIM3_CCMR2  = (0x5326)
                           005327   905  TIM3_CCER1  = (0x5327)
                           005328   906  TIM3_CNTRH  = (0x5328)
                           005329   907  TIM3_CNTRL  = (0x5329)
                           00532A   908  TIM3_PSCR  = (0x532A)
                           00532B   909  TIM3_ARRH  = (0x532B)
                           00532C   910  TIM3_ARRL  = (0x532C)
                           00532D   911  TIM3_CCR1H  = (0x532D)
                           00532E   912  TIM3_CCR1L  = (0x532E)
                           00532F   913  TIM3_CCR2H  = (0x532F)
                           005330   914  TIM3_CCR2L  = (0x5330)
                                    915 
                                    916 ; TIM3_CR1  fields
                           000000   917  TIM3_CR1_CEN = (0)
                           000001   918  TIM3_CR1_UDIS = (1)
                           000002   919  TIM3_CR1_URS = (2)
                           000003   920  TIM3_CR1_OPM = (3)
                           000007   921  TIM3_CR1_ARPE = (7)
                                    922 ; TIM3_CCR2  fields
                           000000   923  TIM3_CCMR2_CC2S_POS = (0)
                           000003   924  TIM3_CCMR2_OC2PE_POS = (3)
                           000004   925  TIM3_CCMR2_OC2M_POS = (4)  
                                    926 ; TIM3_CCER1 fields
                           000000   927  TIM3_CCER1_CC1E = (0)
                           000001   928  TIM3_CCER1_CC1P = (1)
                           000004   929  TIM3_CCER1_CC2E = (4)
                           000005   930  TIM3_CCER1_CC2P = (5)
                                    931 ; TIM3_CCER2 fields
                           000000   932  TIM3_CCER2_CC3E = (0)
                           000001   933  TIM3_CCER2_CC3P = (1)
                                    934 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 20.
Hexadecimal [24-Bits]



                                    935 ; Timer 4
                           005340   936  TIM4_CR1  = (0x5340)
                           005341   937  TIM4_IER  = (0x5341)
                           005342   938  TIM4_SR  = (0x5342)
                           005343   939  TIM4_EGR  = (0x5343)
                           005344   940  TIM4_CNTR  = (0x5344)
                           005345   941  TIM4_PSCR  = (0x5345)
                           005346   942  TIM4_ARR  = (0x5346)
                                    943 
                                    944 ; Timer 4 bitmasks
                                    945 
                           000007   946  TIM4_CR1_ARPE = (7)
                           000003   947  TIM4_CR1_OPM = (3)
                           000002   948  TIM4_CR1_URS = (2)
                           000001   949  TIM4_CR1_UDIS = (1)
                           000000   950  TIM4_CR1_CEN = (0)
                                    951 
                           000000   952  TIM4_IER_UIE = (0)
                                    953 
                           000000   954  TIM4_SR_UIF = (0)
                                    955 
                           000000   956  TIM4_EGR_UG = (0)
                                    957 
                           000002   958  TIM4_PSCR_PSC2 = (2)
                           000001   959  TIM4_PSCR_PSC1 = (1)
                           000000   960  TIM4_PSCR_PSC0 = (0)
                                    961 
                           000000   962  TIM4_PSCR_1 = 0
                           000001   963  TIM4_PSCR_2 = 1
                           000002   964  TIM4_PSCR_4 = 2
                           000003   965  TIM4_PSCR_8 = 3
                           000004   966  TIM4_PSCR_16 = 4
                           000005   967  TIM4_PSCR_32 = 5
                           000006   968  TIM4_PSCR_64 = 6
                           000007   969  TIM4_PSCR_128 = 7
                                    970 
                                    971 ; ADC2
                           005400   972  ADC_CSR  = (0x5400)
                           005401   973  ADC_CR1  = (0x5401)
                           005402   974  ADC_CR2  = (0x5402)
                           005403   975  ADC_CR3  = (0x5403)
                           005404   976  ADC_DRH  = (0x5404)
                           005405   977  ADC_DRL  = (0x5405)
                           005406   978  ADC_TDRH  = (0x5406)
                           005407   979  ADC_TDRL  = (0x5407)
                                    980  
                                    981 ; ADC bitmasks
                                    982 
                           000007   983  ADC_CSR_EOC = (7)
                           000006   984  ADC_CSR_AWD = (6)
                           000005   985  ADC_CSR_EOCIE = (5)
                           000004   986  ADC_CSR_AWDIE = (4)
                           000003   987  ADC_CSR_CH3 = (3)
                           000002   988  ADC_CSR_CH2 = (2)
                           000001   989  ADC_CSR_CH1 = (1)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 21.
Hexadecimal [24-Bits]



                           000000   990  ADC_CSR_CH0 = (0)
                                    991 
                           000006   992  ADC_CR1_SPSEL2 = (6)
                           000005   993  ADC_CR1_SPSEL1 = (5)
                           000004   994  ADC_CR1_SPSEL0 = (4)
                           000001   995  ADC_CR1_CONT = (1)
                           000000   996  ADC_CR1_ADON = (0)
                                    997 
                           000006   998  ADC_CR2_EXTTRIG = (6)
                           000005   999  ADC_CR2_EXTSEL1 = (5)
                           000004  1000  ADC_CR2_EXTSEL0 = (4)
                           000003  1001  ADC_CR2_ALIGN = (3)
                           000001  1002  ADC_CR2_SCAN = (1)
                                   1003 
                           000007  1004  ADC_CR3_DBUF = (7)
                           000006  1005  ADC_CR3_DRH = (6)
                                   1006 
                                   1007 ; beCAN
                           005420  1008  CAN_MCR = (0x5420)
                           005421  1009  CAN_MSR = (0x5421)
                           005422  1010  CAN_TSR = (0x5422)
                           005423  1011  CAN_TPR = (0x5423)
                           005424  1012  CAN_RFR = (0x5424)
                           005425  1013  CAN_IER = (0x5425)
                           005426  1014  CAN_DGR = (0x5426)
                           005427  1015  CAN_FPSR = (0x5427)
                           005428  1016  CAN_P0 = (0x5428)
                           005429  1017  CAN_P1 = (0x5429)
                           00542A  1018  CAN_P2 = (0x542A)
                           00542B  1019  CAN_P3 = (0x542B)
                           00542C  1020  CAN_P4 = (0x542C)
                           00542D  1021  CAN_P5 = (0x542D)
                           00542E  1022  CAN_P6 = (0x542E)
                           00542F  1023  CAN_P7 = (0x542F)
                           005430  1024  CAN_P8 = (0x5430)
                           005431  1025  CAN_P9 = (0x5431)
                           005432  1026  CAN_PA = (0x5432)
                           005433  1027  CAN_PB = (0x5433)
                           005434  1028  CAN_PC = (0x5434)
                           005435  1029  CAN_PD = (0x5435)
                           005436  1030  CAN_PE = (0x5436)
                           005437  1031  CAN_PF = (0x5437)
                                   1032 
                                   1033 
                                   1034 ; CPU
                           007F00  1035  CPU_A  = (0x7F00)
                           007F01  1036  CPU_PCE  = (0x7F01)
                           007F02  1037  CPU_PCH  = (0x7F02)
                           007F03  1038  CPU_PCL  = (0x7F03)
                           007F04  1039  CPU_XH  = (0x7F04)
                           007F05  1040  CPU_XL  = (0x7F05)
                           007F06  1041  CPU_YH  = (0x7F06)
                           007F07  1042  CPU_YL  = (0x7F07)
                           007F08  1043  CPU_SPH  = (0x7F08)
                           007F09  1044  CPU_SPL   = (0x7F09)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 22.
Hexadecimal [24-Bits]



                           007F0A  1045  CPU_CCR   = (0x7F0A)
                                   1046 
                                   1047 ; global configuration register
                           007F60  1048  CFG_GCR   = (0x7F60)
                           000001  1049  CFG_GCR_AL = 1
                           000000  1050  CFG_GCR_SWIM = 0
                                   1051 
                                   1052 ; interrupt software priority 
                           007F70  1053  ITC_SPR1   = (0x7F70) ; (0..3) 0->resreved,AWU..EXT0 
                           007F71  1054  ITC_SPR2   = (0x7F71) ; (4..7) EXT1..EXT4 RX 
                           007F72  1055  ITC_SPR3   = (0x7F72) ; (8..11) beCAN RX..TIM1 UPDT/OVR  
                           007F73  1056  ITC_SPR4   = (0x7F73) ; (12..15) TIM1 CAP/CMP .. TIM3 UPDT/OVR 
                           007F74  1057  ITC_SPR5   = (0x7F74) ; (16..19) TIM3 CAP/CMP..I2C  
                           007F75  1058  ITC_SPR6   = (0x7F75) ; (20..23) UART3 TX..TIM4 CAP/OVR 
                           007F76  1059  ITC_SPR7   = (0x7F76) ; (24..29) FLASH WR..
                           007F77  1060  ITC_SPR8   = (0x7F77) ; (30..32) ..
                                   1061 
                           000001  1062 ITC_SPR_LEVEL1=1 
                           000000  1063 ITC_SPR_LEVEL2=0
                           000003  1064 ITC_SPR_LEVEL3=3 
                                   1065 
                                   1066 ; SWIM, control and status register
                           007F80  1067  SWIM_CSR   = (0x7F80)
                                   1068 ; debug registers
                           007F90  1069  DM_BK1RE   = (0x7F90)
                           007F91  1070  DM_BK1RH   = (0x7F91)
                           007F92  1071  DM_BK1RL   = (0x7F92)
                           007F93  1072  DM_BK2RE   = (0x7F93)
                           007F94  1073  DM_BK2RH   = (0x7F94)
                           007F95  1074  DM_BK2RL   = (0x7F95)
                           007F96  1075  DM_CR1   = (0x7F96)
                           007F97  1076  DM_CR2   = (0x7F97)
                           007F98  1077  DM_CSR1   = (0x7F98)
                           007F99  1078  DM_CSR2   = (0x7F99)
                           007F9A  1079  DM_ENFCTR   = (0x7F9A)
                                   1080 
                                   1081 ; Interrupt Numbers
                           000000  1082  INT_TLI = 0
                           000001  1083  INT_AWU = 1
                           000002  1084  INT_CLK = 2
                           000003  1085  INT_EXTI0 = 3
                           000004  1086  INT_EXTI1 = 4
                           000005  1087  INT_EXTI2 = 5
                           000006  1088  INT_EXTI3 = 6
                           000007  1089  INT_EXTI4 = 7
                           000008  1090  INT_CAN_RX = 8
                           000009  1091  INT_CAN_TX = 9
                           00000A  1092  INT_SPI = 10
                           00000B  1093  INT_TIM1_OVF = 11
                           00000C  1094  INT_TIM1_CCM = 12
                           00000D  1095  INT_TIM2_OVF = 13
                           00000E  1096  INT_TIM2_CCM = 14
                           00000F  1097  INT_TIM3_OVF = 15
                           000010  1098  INT_TIM3_CCM = 16
                           000011  1099  INT_UART1_TX_COMPLETED = 17
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 23.
Hexadecimal [24-Bits]



                           000012  1100  INT_AUART1_RX_FULL = 18
                           000013  1101  INT_I2C = 19
                           000014  1102  INT_UART3_TX_COMPLETED = 20
                           000015  1103  INT_UART3_RX_FULL = 21
                           000016  1104  INT_ADC2 = 22
                           000017  1105  INT_TIM4_OVF = 23
                           000018  1106  INT_FLASH = 24
                                   1107 
                                   1108 ; Interrupt Vectors
                           008000  1109  INT_VECTOR_RESET = 0x8000
                           008004  1110  INT_VECTOR_TRAP = 0x8004
                           008008  1111  INT_VECTOR_TLI = 0x8008
                           00800C  1112  INT_VECTOR_AWU = 0x800C
                           008010  1113  INT_VECTOR_CLK = 0x8010
                           008014  1114  INT_VECTOR_EXTI0 = 0x8014
                           008018  1115  INT_VECTOR_EXTI1 = 0x8018
                           00801C  1116  INT_VECTOR_EXTI2 = 0x801C
                           008020  1117  INT_VECTOR_EXTI3 = 0x8020
                           008024  1118  INT_VECTOR_EXTI4 = 0x8024
                           008028  1119  INT_VECTOR_CAN_RX = 0x8028
                           00802C  1120  INT_VECTOR_CAN_TX = 0x802c
                           008030  1121  INT_VECTOR_SPI = 0x8030
                           008034  1122  INT_VECTOR_TIM1_OVF = 0x8034
                           008038  1123  INT_VECTOR_TIM1_CCM = 0x8038
                           00803C  1124  INT_VECTOR_TIM2_OVF = 0x803C
                           008040  1125  INT_VECTOR_TIM2_CCM = 0x8040
                           008044  1126  INT_VECTOR_TIM3_OVF = 0x8044
                           008048  1127  INT_VECTOR_TIM3_CCM = 0x8048
                           00804C  1128  INT_VECTOR_UART1_TX_COMPLETED = 0x804c
                           008050  1129  INT_VECTOR_UART1_RX_FULL = 0x8050
                           008054  1130  INT_VECTOR_I2C = 0x8054
                           008058  1131  INT_VECTOR_UART3_TX_COMPLETED = 0x8058
                           00805C  1132  INT_VECTOR_UART3_RX_FULL = 0x805C
                           008060  1133  INT_VECTOR_ADC2 = 0x8060
                           008064  1134  INT_VECTOR_TIM4_OVF = 0x8064
                           008068  1135  INT_VECTOR_FLASH = 0x8068
                                   1136 
                                   1137 ; Condition code register bits
                           000007  1138 CC_V = 7  ; overflow flag 
                           000005  1139 CC_I1= 5  ; interrupt bit 1
                           000004  1140 CC_H = 4  ; half carry 
                           000003  1141 CC_I0 = 3 ; interrupt bit 0
                           000002  1142 CC_N = 2 ;  negative flag 
                           000001  1143 CC_Z = 1 ;  zero flag  
                           000000  1144 CC_C = 0 ; carry bit 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 24.
Hexadecimal [24-Bits]



                                     48     .include "inc/nucleo_8s207.inc"
                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019 
                                      3 ; This file is part of MONA 
                                      4 ;
                                      5 ;     MONA is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     MONA is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     19 ; NUCLEO-8S208RB board specific definitions
                                     20 ; Date: 2019/10/29
                                     21 ; author: Jacques Deschênes, copyright 2018,2019
                                     22 ; licence: GPLv3
                                     23 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     24 
                                     25 ; mcu on board is stm8s207k8
                                     26 
                                     27 ; crystal on board is 8Mhz
                                     28 ; st-link crystal 
                           7A1200    29 FHSE = 8000000
                                     30 
                                     31 ; LD3 is user LED
                                     32 ; connected to PC5 via Q2
                           00500A    33 LED_PORT = PC_BASE ;port C
                           000005    34 LED_BIT = 5
                           000020    35 LED_MASK = (1<<LED_BIT) ;bit 5 mask
                                     36 
                                     37 ; user interface UART via STLINK (T_VCP)
                                     38 
                           000002    39 UART=UART3 
                                     40 ; port used by  UART3 
                           00500A    41 UART_PORT_ODR=PC_ODR 
                           00500C    42 UART_PORT_DDR=PC_DDR 
                           00500B    43 UART_PORT_IDR=PC_IDR 
                           00500D    44 UART_PORT_CR1=PC_CR1 
                           00500E    45 UART_PORT_CR2=PC_CR2 
                                     46 
                                     47 ; clock enable bit 
                           000003    48 UART_PCKEN=CLK_PCKENR1_UART3 
                                     49 
                                     50 ; uart3 registers 
                           005240    51 UART_SR=UART3_SR
                           005241    52 UART_DR=UART3_DR
                           005242    53 UART_BRR1=UART3_BRR1
                           005243    54 UART_BRR2=UART3_BRR2
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 25.
Hexadecimal [24-Bits]



                           005244    55 UART_CR1=UART3_CR1
                           005245    56 UART_CR2=UART3_CR2
                                     57 
                                     58 ; TX, RX pin
                           000005    59 UART_TX_PIN=UART3_TX_PIN 
                           000006    60 UART_RX_PIN=UART3_RX_PIN 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 26.
Hexadecimal [24-Bits]



                                     49 .endif 
                                     50 
                                     51 ; all boards includes 
                                     52 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 27.
Hexadecimal [24-Bits]



                                     53 	.include "inc/ascii.inc"
                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019 
                                      3 ; This file is part of MONA 
                                      4 ;
                                      5 ;     MONA is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     MONA is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with MONA.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 
                                     19 ;-------------------------------------------------------
                                     20 ;     ASCII control  values
                                     21 ;     CTRL_x   are VT100 keyboard values  
                                     22 ; REF: https://en.wikipedia.org/wiki/ASCII    
                                     23 ;-------------------------------------------------------
                           000001    24 		CTRL_A = 1
                           000001    25 		SOH=CTRL_A  ; start of heading 
                           000002    26 		CTRL_B = 2
                           000002    27 		STX=CTRL_B  ; start of text 
                           000003    28 		CTRL_C = 3
                           000003    29 		ETX=CTRL_C  ; end of text 
                           000004    30 		CTRL_D = 4
                           000004    31 		EOT=CTRL_D  ; end of transmission 
                           000005    32 		CTRL_E = 5
                           000005    33 		ENQ=CTRL_E  ; enquery 
                           000006    34 		CTRL_F = 6
                           000006    35 		ACK=CTRL_F  ; acknowledge
                           000007    36 		CTRL_G = 7
                           000007    37         BELL = 7    ; vt100 terminal generate a sound.
                           000008    38 		CTRL_H = 8  
                           000008    39 		BS = 8     ; back space 
                           000009    40         CTRL_I = 9
                           000009    41     	TAB = 9     ; horizontal tabulation
                           00000A    42         CTRL_J = 10 
                           00000A    43 		LF = 10     ; line feed
                           00000B    44 		CTRL_K = 11
                           00000B    45         VT = 11     ; vertical tabulation 
                           00000C    46 		CTRL_L = 12
                           00000C    47         FF = 12      ; new page
                           00000D    48 		CTRL_M = 13
                           00000D    49 		CR = 13      ; carriage return 
                           00000E    50 		CTRL_N = 14
                           00000E    51 		SO=CTRL_N    ; shift out 
                           00000F    52 		CTRL_O = 15
                           00000F    53 		SI=CTRL_O    ; shift in 
                           000010    54 		CTRL_P = 16
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 28.
Hexadecimal [24-Bits]



                           000010    55 		DLE=CTRL_P   ; data link escape 
                           000011    56 		CTRL_Q = 17
                           000011    57 		DC1=CTRL_Q   ; device control 1 
                           000011    58 		XON=DC1 
                           000012    59 		CTRL_R = 18
                           000012    60 		DC2=CTRL_R   ; device control 2 
                           000013    61 		CTRL_S = 19
                           000013    62 		DC3=CTRL_S   ; device control 3
                           000013    63 		XOFF=DC3 
                           000014    64 		CTRL_T = 20
                           000014    65 		DC4=CTRL_T   ; device control 4 
                           000015    66 		CTRL_U = 21
                           000015    67 		NAK=CTRL_U   ; negative acknowledge
                           000016    68 		CTRL_V = 22
                           000016    69 		SYN=CTRL_V   ; synchronous idle 
                           000017    70 		CTRL_W = 23
                           000017    71 		ETB=CTRL_W   ; end of transmission block
                           000018    72 		CTRL_X = 24
                           000018    73 		CAN=CTRL_X   ; cancel 
                           000019    74 		CTRL_Y = 25
                           000019    75 		EM=CTRL_Y    ; end of medium
                           00001A    76 		CTRL_Z = 26
                           00001A    77 		SUB=CTRL_Z   ; substitute 
                           00001A    78 		EOF=SUB      ; end of text file in MSDOS 
                           00001B    79 		ESC = 27     ; escape 
                           00001C    80 		FS=28        ; file separator 
                           00001D    81 		GS=29        ; group separator 
                           00001E    82 		RS=30		 ; record separator 
                           00001F    83 		US=31 		 ; unit separator 
                           000020    84 		SPACE = 32
                           00002C    85 		COMMA = 44
                           00003A    86 		COLON = 58 
                           00003B    87 		SEMIC = 59  
                           000023    88 		SHARP = 35
                           000027    89 		TICK = 39
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 29.
Hexadecimal [24-Bits]



                                     54 	.include "inc/gen_macros.inc" 
                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019 
                                      3 ; This file is part of STM8_NUCLEO 
                                      4 ;
                                      5 ;     STM8_NUCLEO is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     STM8_NUCLEO is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with STM8_NUCLEO.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 ;--------------------------------------
                                     19 ;   console Input/Output module
                                     20 ;   DATE: 2019-12-11
                                     21 ;    
                                     22 ;   General usage macros.   
                                     23 ;
                                     24 ;--------------------------------------
                                     25 
                                     26     ; reserve space on stack
                                     27     ; for local variables
                                     28     .macro _vars n 
                                     29     sub sp,#n 
                                     30     .endm 
                                     31     
                                     32     ; free space on stack
                                     33     .macro _drop n 
                                     34     addw sp,#n 
                                     35     .endm
                                     36 
                                     37     ; declare ARG_OFS for arguments 
                                     38     ; displacement on stack. This 
                                     39     ; value depend on local variables 
                                     40     ; size.
                                     41     .macro _argofs n 
                                     42     ARG_OFS=2+n 
                                     43     .endm 
                                     44 
                                     45     ; declare a function argument 
                                     46     ; position relative to stack pointer 
                                     47     ; _argofs must be called before it.
                                     48     .macro _arg name ofs 
                                     49     name=ARG_OFS+ofs 
                                     50     .endm 
                                     51 
                                     52     ; software reset 
                                     53     .macro _swreset
                                     54     mov WWDG_CR,#0X80
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 30.
Hexadecimal [24-Bits]



                                     55     .endm 
                                     56 
                                     57     ; increment zero page variable 
                                     58     .macro _incz v 
                                     59     .byte 0x3c, v 
                                     60     .endm 
                                     61 
                                     62     ; decrement zero page variable 
                                     63     .macro _decz v 
                                     64     .byte 0x3a,v 
                                     65     .endm 
                                     66 
                                     67     ; clear zero page variable 
                                     68     .macro _clrz v 
                                     69     .byte 0x3f, v 
                                     70     .endm 
                                     71 
                                     72     ; load A zero page variable 
                                     73     .macro _ldaz v 
                                     74     .byte 0xb6,v 
                                     75     .endm 
                                     76 
                                     77     ; store A zero page variable 
                                     78     .macro _straz v 
                                     79     .byte 0xb7,v 
                                     80     .endm 
                                     81 
                                     82     ; tnz zero page variable 
                                     83     .macro _tnz v 
                                     84     .byte 0x3d,v 
                                     85     .endm 
                                     86 
                                     87     ; load x from variable in zero page 
                                     88     .macro _ldxz v 
                                     89     .byte 0xbe,v 
                                     90     .endm 
                                     91 
                                     92     ; load y from variable in zero page 
                                     93     .macro _ldyz v 
                                     94     .byte 0x90,0xbe,v 
                                     95     .endm 
                                     96 
                                     97     ; store x in zero page variable 
                                     98     .macro _strxz v 
                                     99     .byte 0xbf,v 
                                    100     .endm 
                                    101 
                                    102     ; store y in zero page variable 
                                    103     .macro _stryz v 
                                    104     .byte 0x90,0xbf,v 
                                    105     .endm 
                                    106 
                                    107     ;  increment 16 bits variable
                                    108     ;  use 10 bytes  
                                    109     .macro _incwz  v 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 31.
Hexadecimal [24-Bits]



                                    110         _incz v+1   ; 1 cy, 2 bytes 
                                    111         jrne .+4  ; 1|2 cy, 2 bytes 
                                    112         _incz v     ; 1 cy, 2 bytes  
                                    113     .endm ; 3 cy 
                                    114 
                                    115     ; xor op with zero page variable 
                                    116     .macro _xorz v 
                                    117     .byte 0xb8,v 
                                    118     .endm 
                                    119     
                                    120     ; move memory to memory in 0 page 
                                    121     .macro _movzz a1, a2 
                                    122     .byte 0x45,a2,a1 
                                    123     .endm 
                                    124 
                                    125     ; check point 
                                    126     ; for debugging help 
                                    127     ; display a character 
                                    128     .macro _cp ch 
                                    129     ld a,#ch 
                                    130     call uart_putc 
                                    131     .endm 
                                    132     
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 32.
Hexadecimal [24-Bits]



                                     55 	.include "app_macros.inc" 
                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019 
                                      3 ; This file is part of STM8_NUCLEO 
                                      4 ;
                                      5 ;     STM8_NUCLEO is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     STM8_NUCLEO is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with STM8_NUCLEO.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 ;--------------------------------------
                           000004    19         TAB_WIDTH=4 ; default tabulation width 
                           0000FF    20         EOF=0xff ; end of file marker 
                           00000F    21         NLEN_MASK=0xf  ; mask to extract name len 
                                     22 
                                     23 
                           0017FF    24 	STACK_EMPTY=RAM_SIZE-1  
                                     25 
                                     26 
                                     27     ; boolean bit in 'flags' variable 
                           000000    28     FRUN=0 ; program running 
                           000001    29 	FOPT=1 ; run time optimization flag  
                           000003    30 	FSLEEP=3 ; halt resulting from  SLEEP 
                           000004    31 	FSTOP=4 ; STOP command flag 
                           000005    32 	FCOMP=5  ; compiling flags 
                           000006    33     FAUTO=6 ; auto line numbering . 
                           000007    34     FTRACE=7 ; trace flag 
                                     35 
                           000003    36     LINE_HEADER_SIZE=3 ; line number 2 bytes and line length 1 byte 
                           000004    37     FIRST_DATA_ITEM=LINE_HEADER_SIZE+1 ; skip over DATA_IDX token.
                                     38 
                           007FFF    39 	MAX_LINENO=0x7fff; BASIC maximum line number 
                                     40 
                           000008    41 	RX_QUEUE_SIZE=8 
                                     42 
                           00F424    43     TIM2_CLK_FREQ=62500
                                     44 
                           000002    45     ADR_SIZE=2  ; bytes 
                           000002    46     NAME_SIZE=2 ; bytes 
                                     47     
                                     48 
                           000001    49     STDOUT=1 ; output to uart
                           000003    50     BUFOUT=3 ; buffered output  
                                     51 
                           000001    52     TOS=1 ; offset of top of stack parameter on stack 
                                     53 
                           0000F0    54     TYPE_MASK=0xf0 ; mask to extract data type, i.e. DIM variable symbol  or CONST symbol 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 33.
Hexadecimal [24-Bits]



                           000010    55     TYPE_DVAR=(1<<4); DIM variable type 
                           000020    56     TYPE_CONST=(2<<4); CONST data 
                           00000F    57     NLEN_MASK=0xf  ; mask to extract name len 
                           0000FF    58     NONE_IDX = 255 ; not a token 
                                     59 
                                     60     
                                     61 ;--------------------------------------
                                     62 ;   assembler flags 
                                     63 ;-------------------------------------
                                     64 ;    MATH_OVF=0 ; if 1 the stop on math overflow 
                                     65 
                                     66     ; assume 16 Mhz Fcpu 
                                     67      .macro _usec_dly n 
                                     68     ldw x,#(16*n-2)/4 ; 2 cy 
                                     69     decw x  ; 1 cy 
                                     70     nop     ; 1 cy 
                                     71     jrne .-2 ; 2 cy 
                                     72     .endm 
                                     73     
                                     74     ; load X register with 
                                     75     ; entry point of dictionary
                                     76     ; before calling 'search_dict'
                                     77     .macro _ldx_dict dict_name
                                     78         ldw x,#dict_name+2
                                     79     .endm 
                                     80 
                                     81     ; reset BASIC pointer
                                     82     ; to beginning of last token
                                     83     ; extracted except if it was end of line 
                                     84     .macro _unget_token
                                     85         decw y
                                     86     .endm
                                     87 
                                     88     ; extract 16 bits address from BASIC code  
                                     89     .macro _get_addr
                                     90         ldw x,y     ; 1 cy 
                                     91         ldw x,(x)   ; 2 cy 
                                     92         addw y,#2   ; 2 cy 
                                     93     .endm           ; 5 cy 
                                     94 
                                     95     ; alias for _get_addr 
                                     96     .macro _get_word 
                                     97         _get_addr
                                     98     .endm ; 5 cy 
                                     99 
                                    100     ; extract character from BASIC code 
                                    101     .macro _get_char 
                                    102         ld a,(y)    ; 1 cy 
                                    103         incw y      ; 1 cy 
                                    104     .endm           ; 2 cy 
                                    105     
                                    106     ; extract next token 
                                    107     .macro _next_token 
                                    108         _get_char 
                                    109     .endm  ; 2 cy 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 34.
Hexadecimal [24-Bits]



                                    110 
                                    111     ; extract next command token id 
                                    112     .macro _next_cmd     
                                    113         _get_char       ; 2 cy 
                                    114     .endm               ; 2 cy 
                                    115 
                                    116     ; get code address in x
                                    117     .macro _code_addr 
                                    118         clrw x   ; 1 cy 
                                    119         ld xl,a  ; 1 cy 
                                    120         sllw x   ; 2 cy 
                                    121         ldw x,(code_addr,x) ; 2 cy 
                                    122     .endm        ; 6 cy 
                                    123 
                                    124     ; call subroutine from index in a 
                                    125     .macro _call_code
                                    126         _code_addr  ; 6 cy  
                                    127         call (x)    ; 4 cy 
                                    128     .endm  ; 10 cy 
                                    129 
                                    130     ; jump to bytecode routine 
                                    131     ; routine must jump back to 
                                    132     ; interp_loop 
                                    133     .macro _jp_code 
                                    134         _code_addr 
                                    135         jp (x)
                                    136     .endm  ; 8 cycles 
                                    137 
                                    138     ; jump back to interp_loop 
                                    139     .macro _next 
                                    140         jp interp_loop 
                                    141     .endm ; 2 cycles 
                                    142     
                                    143 ;------------------------------------
                                    144 ;  board user LED control macros 
                                    145 ;------------------------------------
                                    146 
                                    147     .macro _led_on 
                                    148         bset LED_PORT,#LED_BIT 
                                    149     .endm 
                                    150 
                                    151     .macro _led_off 
                                    152         bres LED_PORT,#LED_BIT 
                                    153     .endm 
                                    154 
                                    155     .macro _led_toggle 
                                    156         bcpl LED_PORT,#LED_BIT 
                                    157     .endm 
                                    158 
                                    159 
                                    160 ;------------------------------------
                                    161 ;   BASIC pending_stack macros 
                                    162 ;-------------------------------------
                                    163     ; reset pending stack 
                                    164     .macro _rst_pending 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 35.
Hexadecimal [24-Bits]



                                    165     ldw x,#pending_stack+PENDING_STACK_SIZE
                                    166     _strxz psp 
                                    167     .endm 
                                    168 
                                    169     ; fetch TOS 
                                    170     .macro _last_pending 
                                    171     ld a,[psp]
                                    172     .endm 
                                    173 
                                    174     ; push operation token
                                    175     ; input:
                                    176     ;    A   token  
                                    177     .macro _push_op  
                                    178     _decz psp+1
                                    179     ld [psp],a 
                                    180     .endm 
                                    181 
                                    182     ; pop pending operation
                                    183     ; output:
                                    184     ;    A   token  
                                    185     .macro _pop_op 
                                    186     ld a,[psp]
                                    187     _incz psp+1 
                                    188     .endm 
                                    189 
                                    190     ; check for stack full 
                                    191     ; output:
                                    192     ;   A    ==0 -> stack full 
                                    193     .macro _pending_full 
                                    194     ld a,#pending_stack 
                                    195     sub a,psp+1 
                                    196     .endm 
                                    197 
                                    198     ; check for stack_empty
                                    199     ; output:
                                    200     ;   A   == 0 -> stack empty     
                                    201     .macro _pending_empty 
                                    202     _ldaz psp+1 
                                    203     sub a,#pending_stack+PENDING_STACK_SIZE
                                    204     .endm 
                                    205 
                                    206     ; compare a with last pushed op 
                                    207     .macro _cp_op 
                                    208     cp a,[psp]
                                    209     .endm 
                                    210 
                                    211     ; drop last pushed op  
                                    212     .macro _drop_op 
                                    213     _incz psp+1 
                                    214     .endm 
                                    215     
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 36.
Hexadecimal [24-Bits]



                                     56     .include "arithm16_macros.inc" 
                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019,2020,2021,2022  
                                      3 ; This file is part of stm8_tbi 
                                      4 ;
                                      5 ;     stm8_tbi is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     stm8_tbi is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with stm8_tbi.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 
                                     19 
                                     20 
                                     21 
                           000002    22 	INT_SIZE==2 ; 2's complement 16 bits integers {-32767...32767} 
                           000002    23 	CELL_SIZE==INT_SIZE 
                                     24 
                                     25 
                                     26     ; store int16 from X to stack 
                                     27     .macro _i16_store  i 
                                     28     ldw (i,sp),x 
                                     29     .endm 
                                     30 
                                     31     ; fetch int16 from stack to X 
                                     32     .macro _i16_fetch i 
                                     33     ldw x,(i,sp)
                                     34     .endm 
                                     35 
                                     36     ; pop int16 from top of stack 
                                     37     .macro _i16_pop 
                                     38     popw x 
                                     39     .endm 
                                     40 
                                     41     ; push int16 on stack 
                                     42     .macro _i16_push 
                                     43     pushw X
                                     44     .endm 
                                     45 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 37.
Hexadecimal [24-Bits]



                                     57 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 38.
Hexadecimal [24-Bits]



                                     22 
                                     23     .area CODE 
                                     24 
                                     25 
                                     26 
                                     27 
                                     28 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     29 ;;  table of code routines 
                                     30 ;; used by virtual machine 
                                     31 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     32 
                                     33 	.macro _code_entry proc_address,token_name    
                                     34 	.word proc_address
                                     35 	token_name =TOK_IDX 
                                     36 	TOK_IDX=TOK_IDX+1 
                                     37 	.endm 
                                     38 
                           000000    39 	TOK_IDX=0
      000000                         40 code_addr:
                                     41 ; command end marker  
      000000                         42 	_code_entry next_line, EOL_IDX  ; $0 
      000000 0B 02                    1 	.word next_line
                           000000     2 	EOL_IDX =TOK_IDX 
                           000001     3 	TOK_IDX=TOK_IDX+1 
      000002                         43 	_code_entry do_nothing, COLON_IDX   ; $1 ':'
      000002 0A EA                    1 	.word do_nothing
                           000001     2 	COLON_IDX =TOK_IDX 
                           000002     3 	TOK_IDX=TOK_IDX+1 
                           000001    44     CMD_END = TOK_IDX-1 
                                     45 ; caractères délimiteurs 
      000004                         46     _code_entry syntax_error, COMMA_IDX ; $2  ',' 
      000004 09 81                    1 	.word syntax_error
                           000002     2 	COMMA_IDX =TOK_IDX 
                           000003     3 	TOK_IDX=TOK_IDX+1 
      000006                         47 	_code_entry syntax_error,SCOL_IDX  ; $3 ';' 
      000006 09 81                    1 	.word syntax_error
                           000003     2 	SCOL_IDX =TOK_IDX 
                           000004     3 	TOK_IDX=TOK_IDX+1 
      000008                         48 	_code_entry syntax_error, LPAREN_IDX ; $4 '(' 
      000008 09 81                    1 	.word syntax_error
                           000004     2 	LPAREN_IDX =TOK_IDX 
                           000005     3 	TOK_IDX=TOK_IDX+1 
      00000A                         49 	_code_entry syntax_error, RPAREN_IDX ; $5 ')' 
      00000A 09 81                    1 	.word syntax_error
                           000005     2 	RPAREN_IDX =TOK_IDX 
                           000006     3 	TOK_IDX=TOK_IDX+1 
      00000C                         50 	_code_entry syntax_error, QUOTE_IDX  ; $6 '"' 
      00000C 09 81                    1 	.word syntax_error
                           000006     2 	QUOTE_IDX =TOK_IDX 
                           000007     3 	TOK_IDX=TOK_IDX+1 
                           000006    51     DELIM_LAST=TOK_IDX-1 
                                     52 ; literal values 
      00000E                         53     _code_entry syntax_error,LITC_IDX ; 8 bit literal 
      00000E 09 81                    1 	.word syntax_error
                           000007     2 	LITC_IDX =TOK_IDX 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 39.
Hexadecimal [24-Bits]



                           000008     3 	TOK_IDX=TOK_IDX+1 
      000010                         54     _code_entry syntax_error,LITW_IDX  ; 16 bits literal 
      000010 09 81                    1 	.word syntax_error
                           000008     2 	LITW_IDX =TOK_IDX 
                           000009     3 	TOK_IDX=TOK_IDX+1 
                           000008    55     LIT_LAST=TOK_IDX-1 
                                     56 ; variable identifiers  
      000012                         57 	_code_entry kword_let2,VAR_IDX    ; $9 integer variable  
      000012 0E 04                    1 	.word kword_let2
                           000009     2 	VAR_IDX =TOK_IDX 
                           00000A     3 	TOK_IDX=TOK_IDX+1 
      000014                         58 	_code_entry let_string2,STR_VAR_IDX  ; string variable 
      000014 0E 28                    1 	.word let_string2
                           00000A     2 	STR_VAR_IDX =TOK_IDX 
                           00000B     3 	TOK_IDX=TOK_IDX+1 
                           00000A    59     SYMB_LAST=TOK_IDX-1 
                                     60 ; arithmetic operators      
      000016                         61 	_code_entry syntax_error, ADD_IDX   ; $D 
      000016 09 81                    1 	.word syntax_error
                           00000B     2 	ADD_IDX =TOK_IDX 
                           00000C     3 	TOK_IDX=TOK_IDX+1 
      000018                         62 	_code_entry syntax_error, SUB_IDX   ; $E
      000018 09 81                    1 	.word syntax_error
                           00000C     2 	SUB_IDX =TOK_IDX 
                           00000D     3 	TOK_IDX=TOK_IDX+1 
      00001A                         63 	_code_entry syntax_error, DIV_IDX   ; $10 
      00001A 09 81                    1 	.word syntax_error
                           00000D     2 	DIV_IDX =TOK_IDX 
                           00000E     3 	TOK_IDX=TOK_IDX+1 
      00001C                         64 	_code_entry syntax_error, MOD_IDX   ; $11
      00001C 09 81                    1 	.word syntax_error
                           00000E     2 	MOD_IDX =TOK_IDX 
                           00000F     3 	TOK_IDX=TOK_IDX+1 
      00001E                         65 	_code_entry syntax_error, MULT_IDX  ; $12 
      00001E 09 81                    1 	.word syntax_error
                           00000F     2 	MULT_IDX =TOK_IDX 
                           000010     3 	TOK_IDX=TOK_IDX+1 
                           00000F    66     OP_ARITHM_LAST=TOK_IDX-1 
                                     67 ; relational operators
      000020                         68 	_code_entry syntax_error,REL_LE_IDX  ; 
      000020 09 81                    1 	.word syntax_error
                           000010     2 	REL_LE_IDX =TOK_IDX 
                           000011     3 	TOK_IDX=TOK_IDX+1 
      000022                         69 	_code_entry syntax_error,REL_EQU_IDX ; 
      000022 09 81                    1 	.word syntax_error
                           000011     2 	REL_EQU_IDX =TOK_IDX 
                           000012     3 	TOK_IDX=TOK_IDX+1 
      000024                         70 	_code_entry syntax_error,REL_GE_IDX  ;  
      000024 09 81                    1 	.word syntax_error
                           000012     2 	REL_GE_IDX =TOK_IDX 
                           000013     3 	TOK_IDX=TOK_IDX+1 
      000026                         71 	_code_entry syntax_error,REL_LT_IDX  ;  
      000026 09 81                    1 	.word syntax_error
                           000013     2 	REL_LT_IDX =TOK_IDX 
                           000014     3 	TOK_IDX=TOK_IDX+1 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 40.
Hexadecimal [24-Bits]



      000028                         72 	_code_entry syntax_error,REL_GT_IDX  ;  
      000028 09 81                    1 	.word syntax_error
                           000014     2 	REL_GT_IDX =TOK_IDX 
                           000015     3 	TOK_IDX=TOK_IDX+1 
      00002A                         73 	_code_entry syntax_error,REL_NE_IDX  ; 
      00002A 09 81                    1 	.word syntax_error
                           000015     2 	REL_NE_IDX =TOK_IDX 
                           000016     3 	TOK_IDX=TOK_IDX+1 
                           000015    74     OP_REL_LAST=TOK_IDX-1 
                                     75 ; boolean operators 
      00002C                         76     _code_entry syntax_error, NOT_IDX    ; $19
      00002C 09 81                    1 	.word syntax_error
                           000016     2 	NOT_IDX =TOK_IDX 
                           000017     3 	TOK_IDX=TOK_IDX+1 
      00002E                         77     _code_entry syntax_error, AND_IDX    ; $1A 
      00002E 09 81                    1 	.word syntax_error
                           000017     2 	AND_IDX =TOK_IDX 
                           000018     3 	TOK_IDX=TOK_IDX+1 
      000030                         78     _code_entry syntax_error, OR_IDX     ; $1B 
      000030 09 81                    1 	.word syntax_error
                           000018     2 	OR_IDX =TOK_IDX 
                           000019     3 	TOK_IDX=TOK_IDX+1 
                           000018    79     BOOL_OP_LAST=TOK_IDX-1 
                                     80 ; keywords 
      000032                         81     _code_entry kword_dim, DIM_IDX       ; $1F 
      000032 10 54                    1 	.word kword_dim
                           000019     2 	DIM_IDX =TOK_IDX 
                           00001A     3 	TOK_IDX=TOK_IDX+1 
      000034                         82     _code_entry kword_end, END_IDX       ; $21 
      000034 16 2D                    1 	.word kword_end
                           00001A     2 	END_IDX =TOK_IDX 
                           00001B     3 	TOK_IDX=TOK_IDX+1 
      000036                         83     _code_entry kword_for, FOR_IDX       ; $22
      000036 14 D8                    1 	.word kword_for
                           00001B     2 	FOR_IDX =TOK_IDX 
                           00001C     3 	TOK_IDX=TOK_IDX+1 
      000038                         84     _code_entry kword_next, NEXT_IDX     ; $27 
      000038 15 2C                    1 	.word kword_next
                           00001C     2 	NEXT_IDX =TOK_IDX 
                           00001D     3 	TOK_IDX=TOK_IDX+1 
      00003A                         85     _code_entry kword_gosub, GOSUB_IDX   ; $23 
      00003A 15 A3                    1 	.word kword_gosub
                           00001D     2 	GOSUB_IDX =TOK_IDX 
                           00001E     3 	TOK_IDX=TOK_IDX+1 
      00003C                         86     _code_entry kword_return, RET_IDX    ; $2A
      00003C 15 C3                    1 	.word kword_return
                           00001E     2 	RET_IDX =TOK_IDX 
                           00001F     3 	TOK_IDX=TOK_IDX+1 
      00003E                         87     _code_entry kword_goto, GOTO_IDX     ; $24 
      00003E 15 84                    1 	.word kword_goto
                           00001F     2 	GOTO_IDX =TOK_IDX 
                           000020     3 	TOK_IDX=TOK_IDX+1 
      000040                         88     _code_entry kword_if, IF_IDX         ; $25 
      000040 13 F4                    1 	.word kword_if
                           000020     2 	IF_IDX =TOK_IDX 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 41.
Hexadecimal [24-Bits]



                           000021     3 	TOK_IDX=TOK_IDX+1 
      000042                         89     _code_entry syntax_error,THEN_IDX 
      000042 09 81                    1 	.word syntax_error
                           000021     2 	THEN_IDX =TOK_IDX 
                           000022     3 	TOK_IDX=TOK_IDX+1 
      000044                         90     _code_entry kword_let, LET_IDX       ; $26 
      000044 0D F3                    1 	.word kword_let
                           000022     2 	LET_IDX =TOK_IDX 
                           000023     3 	TOK_IDX=TOK_IDX+1 
      000046                         91 	_code_entry kword_remark, REM_IDX    ; $29 
      000046 0A F5                    1 	.word kword_remark
                           000023     2 	REM_IDX =TOK_IDX 
                           000024     3 	TOK_IDX=TOK_IDX+1 
      000048                         92     _code_entry syntax_error, STEP_IDX   ; $2B 
      000048 09 81                    1 	.word syntax_error
                           000024     2 	STEP_IDX =TOK_IDX 
                           000025     3 	TOK_IDX=TOK_IDX+1 
      00004A                         93     _code_entry kword_stop, STOP_IDX     ; $2C
      00004A 16 57                    1 	.word kword_stop
                           000025     2 	STOP_IDX =TOK_IDX 
                           000026     3 	TOK_IDX=TOK_IDX+1 
      00004C                         94     _code_entry kword_con, CON_IDX 
      00004C 16 A2                    1 	.word kword_con
                           000026     2 	CON_IDX =TOK_IDX 
                           000027     3 	TOK_IDX=TOK_IDX+1 
      00004E                         95     _code_entry syntax_error, TO_IDX     ; $2D
      00004E 09 81                    1 	.word syntax_error
                           000027     2 	TO_IDX =TOK_IDX 
                           000028     3 	TOK_IDX=TOK_IDX+1 
                           000027    96     KWORD_LAST=TOK_IDX-1 
                                     97 ; functions
      000050                         98 	_code_entry func_abs, ABS_IDX         ; $41
      000050 18 7C                    1 	.word func_abs
                           000028     2 	ABS_IDX =TOK_IDX 
                           000029     3 	TOK_IDX=TOK_IDX+1 
      000052                         99     _code_entry func_peek, PEEK_IDX         ; $4D 
      000052 13 E5                    1 	.word func_peek
                           000029     2 	PEEK_IDX =TOK_IDX 
                           00002A     3 	TOK_IDX=TOK_IDX+1 
      000054                        100     _code_entry func_random, RND_IDX        ; $50
      000054 18 8C                    1 	.word func_random
                           00002A     2 	RND_IDX =TOK_IDX 
                           00002B     3 	TOK_IDX=TOK_IDX+1 
      000056                        101     _code_entry func_sign, SGN_IDX 
      000056 18 AD                    1 	.word func_sign
                           00002B     2 	SGN_IDX =TOK_IDX 
                           00002C     3 	TOK_IDX=TOK_IDX+1 
      000058                        102     _code_entry func_len, LEN_IDX  
      000058 18 C5                    1 	.word func_len
                           00002C     2 	LEN_IDX =TOK_IDX 
                           00002D     3 	TOK_IDX=TOK_IDX+1 
      00005A                        103     _code_entry func_ticks, TICKS_IDX 
      00005A 18 68                    1 	.word func_ticks
                           00002D     2 	TICKS_IDX =TOK_IDX 
                           00002E     3 	TOK_IDX=TOK_IDX+1 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 42.
Hexadecimal [24-Bits]



      00005C                        104     _code_entry func_char, CHAR_IDX
      00005C 18 6B                    1 	.word func_char
                           00002E     2 	CHAR_IDX =TOK_IDX 
                           00002F     3 	TOK_IDX=TOK_IDX+1 
      00005E                        105     _code_entry func_key, KEY_IDX  
      00005E 13 C6                    1 	.word func_key
                           00002F     2 	KEY_IDX =TOK_IDX 
                           000030     3 	TOK_IDX=TOK_IDX+1 
      000060                        106     _code_entry func_chat,CHAT_IDX
      000060 1B 34                    1 	.word func_chat
                           000030     2 	CHAT_IDX =TOK_IDX 
                           000031     3 	TOK_IDX=TOK_IDX+1 
      000062                        107     _code_entry func_cpos,CPOS_IDX   
      000062 1B 59                    1 	.word func_cpos
                           000031     2 	CPOS_IDX =TOK_IDX 
                           000032     3 	TOK_IDX=TOK_IDX+1 
                           000031   108     FUNC_LAST=TOK_IDX-1                     
                                    109 ; commands 
      000064                        110     _code_entry cmd_sleep,SLEEP_IDX 
      000064 18 55                    1 	.word cmd_sleep
                           000032     2 	SLEEP_IDX =TOK_IDX 
                           000033     3 	TOK_IDX=TOK_IDX+1 
      000066                        111     _code_entry cmd_tone,TONE_IDX 
      000066 16 39                    1 	.word cmd_tone
                           000033     2 	TONE_IDX =TOK_IDX 
                           000034     3 	TOK_IDX=TOK_IDX+1 
      000068                        112     _code_entry cmd_tab, TAB_IDX 
      000068 19 B4                    1 	.word cmd_tab
                           000034     2 	TAB_IDX =TOK_IDX 
                           000035     3 	TOK_IDX=TOK_IDX+1 
      00006A                        113     _code_entry cmd_auto, AUTO_IDX 
      00006A 19 E0                    1 	.word cmd_auto
                           000035     2 	AUTO_IDX =TOK_IDX 
                           000036     3 	TOK_IDX=TOK_IDX+1 
      00006C                        114     _code_entry cmd_himem, HIMEM_IDX 
      00006C 1A 9D                    1 	.word cmd_himem
                           000036     2 	HIMEM_IDX =TOK_IDX 
                           000037     3 	TOK_IDX=TOK_IDX+1 
      00006E                        115     _code_entry cmd_lomem, LOMEM_IDX 
      00006E 1A BE                    1 	.word cmd_lomem
                           000037     2 	LOMEM_IDX =TOK_IDX 
                           000038     3 	TOK_IDX=TOK_IDX+1 
      000070                        116     _code_entry cmd_del, DEL_IDX 
      000070 1A 2C                    1 	.word cmd_del
                           000038     2 	DEL_IDX =TOK_IDX 
                           000039     3 	TOK_IDX=TOK_IDX+1 
      000072                        117     _code_entry cmd_clear, CLR_IDX 
      000072 1A 1D                    1 	.word cmd_clear
                           000039     2 	CLR_IDX =TOK_IDX 
                           00003A     3 	TOK_IDX=TOK_IDX+1 
      000074                        118     _code_entry cmd_input, INPUT_IDX    ; $6F
      000074 13 35                    1 	.word cmd_input
                           00003A     2 	INPUT_IDX =TOK_IDX 
                           00003B     3 	TOK_IDX=TOK_IDX+1 
      000076                        119     _code_entry cmd_list, LIST_IDX          ; $72
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 43.
Hexadecimal [24-Bits]



      000076 11 7C                    1 	.word cmd_list
                           00003B     2 	LIST_IDX =TOK_IDX 
                           00003C     3 	TOK_IDX=TOK_IDX+1 
      000078                        120     _code_entry cmd_new, NEW_IDX            ; $73
      000078 16 BA                    1 	.word cmd_new
                           00003C     2 	NEW_IDX =TOK_IDX 
                           00003D     3 	TOK_IDX=TOK_IDX+1 
      00007A                        121     _code_entry cmd_call, CALL_IDX          
      00007A 19 BF                    1 	.word cmd_call
                           00003D     2 	CALL_IDX =TOK_IDX 
                           00003E     3 	TOK_IDX=TOK_IDX+1 
      00007C                        122     _code_entry cmd_poke, POKE_IDX          ; $76
      00007C 13 D1                    1 	.word cmd_poke
                           00003E     2 	POKE_IDX =TOK_IDX 
                           00003F     3 	TOK_IDX=TOK_IDX+1 
      00007E                        123    	_code_entry cmd_print, PRINT_IDX        ; $77
      00007E 12 1B                    1 	.word cmd_print
                           00003F     2 	PRINT_IDX =TOK_IDX 
                           000040     3 	TOK_IDX=TOK_IDX+1 
      000080                        124     _code_entry cmd_run, RUN_IDX            ; $7A
      000080 15 DC                    1 	.word cmd_run
                           000040     2 	RUN_IDX =TOK_IDX 
                           000041     3 	TOK_IDX=TOK_IDX+1 
      000082                        125     _code_entry cmd_words, WORDS_IDX        ; $85
      000082 18 FA                    1 	.word cmd_words
                           000041     2 	WORDS_IDX =TOK_IDX 
                           000042     3 	TOK_IDX=TOK_IDX+1 
      000084                        126     _code_entry cmd_bye, BYE_IDX 
      000084 18 44                    1 	.word cmd_bye
                           000042     2 	BYE_IDX =TOK_IDX 
                           000043     3 	TOK_IDX=TOK_IDX+1 
      000086                        127     _code_entry cmd_save, SAVE_IDX 
      000086 17 06                    1 	.word cmd_save
                           000043     2 	SAVE_IDX =TOK_IDX 
                           000044     3 	TOK_IDX=TOK_IDX+1 
      000088                        128     _code_entry cmd_load,LOAD_IDX 
      000088 17 99                    1 	.word cmd_load
                           000044     2 	LOAD_IDX =TOK_IDX 
                           000045     3 	TOK_IDX=TOK_IDX+1 
      00008A                        129     _code_entry cmd_dir, DIR_IDX 
      00008A 17 DD                    1 	.word cmd_dir
                           000045     2 	DIR_IDX =TOK_IDX 
                           000046     3 	TOK_IDX=TOK_IDX+1 
      00008C                        130     _code_entry cmd_erase, ERASE_IDX 
      00008C 16 C5                    1 	.word cmd_erase
                           000046     2 	ERASE_IDX =TOK_IDX 
                           000047     3 	TOK_IDX=TOK_IDX+1 
      00008E                        131     _code_entry cmd_randomize, RNDMIZE_IDX
      00008E 18 A4                    1 	.word cmd_randomize
                           000047     2 	RNDMIZE_IDX =TOK_IDX 
                           000048     3 	TOK_IDX=TOK_IDX+1 
      000090                        132     _code_entry cmd_cls, CLS_IDX 
      000090 1B 08                    1 	.word cmd_cls
                           000048     2 	CLS_IDX =TOK_IDX 
                           000049     3 	TOK_IDX=TOK_IDX+1 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 44.
Hexadecimal [24-Bits]



      000092                        133     _code_entry cmd_locate,LOCATE_IDX
      000092 1B 1C                    1 	.word cmd_locate
                           000049     2 	LOCATE_IDX =TOK_IDX 
                           00004A     3 	TOK_IDX=TOK_IDX+1 
      000094                        134     _code_entry cmd_renum,RENUM_IDX 
      000094 1B 5D                    1 	.word cmd_renum
                           00004A     2 	RENUM_IDX =TOK_IDX 
                           00004B     3 	TOK_IDX=TOK_IDX+1 
      000096                        135     _code_entry kword_do, DO_IDX 
      000096 1C 7F                    1 	.word kword_do
                           00004B     2 	DO_IDX =TOK_IDX 
                           00004C     3 	TOK_IDX=TOK_IDX+1 
      000098                        136     _code_entry kword_until, UNTIL_IDX
      000098 1C 87                    1 	.word kword_until
                           00004C     2 	UNTIL_IDX =TOK_IDX 
                           00004D     3 	TOK_IDX=TOK_IDX+1 
      00009A                        137     _code_entry func_muldiv, MULDIV_IDX  
      00009A 0C 15                    1 	.word func_muldiv
                           00004D     2 	MULDIV_IDX =TOK_IDX 
                           00004E     3 	TOK_IDX=TOK_IDX+1 
                           00004D   138     CMD_LAST=TOK_IDX-1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 45.
Hexadecimal [24-Bits]



                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019,2020,2021,2022  
                                      3 ; This file is part of stm8_tbi 
                                      4 ;
                                      5 ;     stm8_tbi is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     stm8_tbi is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with stm8_tbi.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 
                                     19 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     20 ;;   compile BASIC source code to byte code
                                     21 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     22 
                                     23 	.area CODE 
                                     24 
                                     25 ;-------------------------------------
                                     26 ; search text area for a line#
                                     27 ; input:
                                     28 ;   A           0 search from lomem  
                                     29 ;			    1 search from line.addr 
                                     30 ;	X 			line# to search 
                                     31 ; output:
                                     32 ;   A           0 not found | other found 
                                     33 ;   X 			addr of line | 
                                     34 ;				inssert address if not found  
                                     35 ; use: 
                                     36 ;   Y  
                                     37 ;-------------------------------------
                           000001    38 	LL=1 ; line length 
                           000002    39 	LB=2 ; line length low byte 
                           000002    40 	VSIZE=2 
      00009C                         41 search_lineno::
      00009C 90 89            [ 2]   42 	pushw y 
      00009E                         43 	_vars VSIZE
      00009E 52 02            [ 2]    1     sub sp,#VSIZE 
      0000A0 0F 01            [ 1]   44 	clr (LL,sp)
      0000A2 90 CE 00 37      [ 2]   45 	ldw y,lomem
      0000A6 4D               [ 1]   46 	tnz a 
      0000A7 27 04            [ 1]   47 	jreq 2$
      0000A9 90 CE 00 33      [ 2]   48 	ldw y,line.addr  
      0000AD                         49 2$: 
      0000AD 90 C3 00 3B      [ 2]   50 	cpw y,progend 
      0000B1 2A 10            [ 1]   51 	jrpl 8$ 
      0000B3 90 F3            [ 1]   52 	cpw x,(y)
      0000B5 27 0F            [ 1]   53 	jreq 9$
      0000B7 2B 0A            [ 1]   54 	jrmi 8$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 46.
Hexadecimal [24-Bits]



      0000B9 90 E6 02         [ 1]   55 	ld a,(2,y)
      0000BC 6B 02            [ 1]   56 	ld (LB,sp),a 
      0000BE 72 F9 01         [ 2]   57 	addw y,(LL,sp)
      0000C1 20 EA            [ 2]   58 	jra 2$ 
      0000C3                         59 8$: ; not found 
      0000C3 4F               [ 1]   60 	clr a 
      0000C4 20 02            [ 2]   61 	jra 10$
      0000C6                         62 9$: ; found 
      0000C6 A6 FF            [ 1]   63 	ld a,#-1 
      0000C8                         64 10$:
      0000C8 93               [ 1]   65 	ldw x,y   
      0000C9                         66 	_drop VSIZE
      0000C9 5B 02            [ 2]    1     addw sp,#VSIZE 
      0000CB 90 85            [ 2]   67 	popw y 
      0000CD 81               [ 4]   68 	ret 
                                     69 
                                     70 
                                     71 ;-------------------------------------
                                     72 ; delete line at addr
                                     73 ; input:
                                     74 ;   X 		addr of line i.e DEST for move 
                                     75 ;-------------------------------------
                           000001    76 	LLEN=1
                           000003    77 	SRC=3
                           000004    78 	VSIZE=4
      0000CE                         79 del_line: 
      0000CE 90 89            [ 2]   80 	pushw y 
      0000D0                         81 	_vars VSIZE 
      0000D0 52 04            [ 2]    1     sub sp,#VSIZE 
      0000D2 E6 02            [ 1]   82 	ld a,(2,x) ; line length
      0000D4 6B 02            [ 1]   83 	ld (LLEN+1,sp),a 
      0000D6 0F 01            [ 1]   84 	clr (LLEN,sp)
      0000D8 90 93            [ 1]   85 	ldw y,x  
      0000DA 72 F9 01         [ 2]   86 	addw y,(LLEN,sp) ;SRC  
      0000DD 17 03            [ 2]   87 	ldw (SRC,sp),y  ;save source 
      0000DF 90 CE 00 3B      [ 2]   88 	ldw y,progend 
      0000E3 72 F2 03         [ 2]   89 	subw y,(SRC,sp) ; y=count 
      0000E6 90 CF 00 00      [ 2]   90 	ldw acc16,y 
      0000EA 16 03            [ 2]   91 	ldw y,(SRC,sp)    ; source
      0000EC CD 00 00         [ 4]   92 	call move
      0000EF 90 CE 00 3B      [ 2]   93 	ldw y,progend  
      0000F3 72 F2 01         [ 2]   94 	subw y,(LLEN,sp)
      0000F6 90 CF 00 3B      [ 2]   95 	ldw progend,y
      0000FA 90 CF 00 3D      [ 2]   96 	ldw dvar_bgn,y 
      0000FE 90 CF 00 3F      [ 2]   97 	ldw dvar_end,y   
      000102                         98 	_drop VSIZE     
      000102 5B 04            [ 2]    1     addw sp,#VSIZE 
      000104 90 85            [ 2]   99 	popw y 
      000106 81               [ 4]  100 	ret 
                                    101 
                                    102 ;---------------------------------------------
                                    103 ; open a gap in text area to 
                                    104 ; move new line in this gap
                                    105 ; input:
                                    106 ;    X 			addr gap start 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 47.
Hexadecimal [24-Bits]



                                    107 ;    Y 			gap length 
                                    108 ; output:
                                    109 ;    X 			addr gap start 
                                    110 ;--------------------------------------------
                           000001   111 	DEST=1
                           000003   112 	SRC=3
                           000005   113 	LEN=5
                           000006   114 	VSIZE=6 
      000107                        115 open_gap:
      000107 C3 00 3B         [ 2]  116 	cpw x,progend 
      00010A 24 2F            [ 1]  117 	jruge 9$
      00010C                        118 	_vars VSIZE
      00010C 52 06            [ 2]    1     sub sp,#VSIZE 
      00010E 1F 03            [ 2]  119 	ldw (SRC,sp),x 
      000110 17 05            [ 2]  120 	ldw (LEN,sp),y 
      000112 90 CF 00 00      [ 2]  121 	ldw acc16,y 
      000116 90 93            [ 1]  122 	ldw y,x ; SRC
      000118 72 BB 00 00      [ 2]  123 	addw x,acc16  
      00011C 1F 01            [ 2]  124 	ldw (DEST,sp),x 
                                    125 ;compute size to move 	
      00011E                        126 	_ldxz progend  
      00011E BE 3B                    1     .byte 0xbe,progend 
      000120 72 F0 03         [ 2]  127 	subw x,(SRC,sp)
      000123 CF 00 00         [ 2]  128 	ldw acc16,x ; size to move
      000126 1E 01            [ 2]  129 	ldw x,(DEST,sp) 
      000128 CD 00 00         [ 4]  130 	call move
      00012B                        131 	_ldxz progend 
      00012B BE 3B                    1     .byte 0xbe,progend 
      00012D 72 FB 05         [ 2]  132 	addw x,(LEN,sp)
      000130 CF 00 3B         [ 2]  133 	ldw progend,x
      000133 CF 00 3D         [ 2]  134 	ldw dvar_bgn,x 
      000136 CF 00 3F         [ 2]  135 	ldw dvar_end,x 
      000139                        136 	_drop VSIZE
      000139 5B 06            [ 2]    1     addw sp,#VSIZE 
      00013B 81               [ 4]  137 9$:	ret 
                                    138 
                                    139 ;--------------------------------------------
                                    140 ; insert line in pad into program area 
                                    141 ; first search for already existing 
                                    142 ; replace existing 
                                    143 ; if new line empty delete existing one. 
                                    144 ; input:
                                    145 ;   ptr16		pointer to tokenized line  
                                    146 ; output:
                                    147 ;   none
                                    148 ;---------------------------------------------
                           000001   149 	DEST=1  ; text area insertion address 
                           000003   150 	SRC=3   ; str to insert address 
                           000005   151 	LINENO=5 ; line number 
                           000007   152 	LLEN=7 ; line length 
                           000008   153 	VSIZE=8  
      00013C                        154 insert_line:
      00013C 90 89            [ 2]  155 	pushw y 
      00013E                        156 	_vars VSIZE 
      00013E 52 08            [ 2]    1     sub sp,#VSIZE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 48.
Hexadecimal [24-Bits]



      000140 72 CE 00 00      [ 5]  157 	ldw x,[ptr16]
      000144 1F 05            [ 2]  158 	ldw (LINENO,sp),x 
      000146 0F 07            [ 1]  159 	clr (LLEN,sp)
      000148                        160 	_ldxz ptr16 
      000148 BE 00                    1     .byte 0xbe,ptr16 
      00014A E6 02            [ 1]  161 	ld a,(2,x)
      00014C 6B 08            [ 1]  162 	ld (LLEN+1,sp),a 
      00014E 4F               [ 1]  163 	clr a 
      00014F 1E 05            [ 2]  164 	ldw x,(LINENO,sp)
      000151 CD 00 9C         [ 4]  165 	call search_lineno
      000154 1F 01            [ 2]  166 	ldw (DEST,sp),x 
      000156 4D               [ 1]  167 	tnz a 
      000157 27 03            [ 1]  168 	jreq 1$ ; not found 
      000159 CD 00 CE         [ 4]  169 	call del_line 
      00015C A6 04            [ 1]  170 1$: ld a,#4 
      00015E 11 08            [ 1]  171 	cp a,(LLEN+1,sp)
      000160 27 3D            [ 1]  172 	jreq 9$
                                    173 ; check for space 
      000162                        174 	_ldxz progend  
      000162 BE 3B                    1     .byte 0xbe,progend 
      000164 72 FB 07         [ 2]  175 	addw x,(LLEN,sp)
      000167 A3 00 00         [ 2]  176 	cpw x,#tib   
      00016A 25 08            [ 1]  177 	jrult 3$
      00016C AE 09 02         [ 2]  178 	ldw x,#err_mem_full 
      00016F CC 09 83         [ 2]  179 	jp tb_error 
      000172 20 2B            [ 2]  180 	jra 9$  
      000174                        181 3$: ; create gap to insert line 
      000174 1E 01            [ 2]  182 	ldw x,(DEST,sp) 
      000176 16 07            [ 2]  183 	ldw y,(LLEN,sp)
      000178 CD 01 07         [ 4]  184 	call open_gap 
                                    185 ; move new line in gap 
      00017B 1E 07            [ 2]  186 	ldw x,(LLEN,sp)
      00017D CF 00 00         [ 2]  187 	ldw acc16,x 
      000180 90 AE 00 00      [ 2]  188 	ldw y,#pad ;SRC 
      000184 1E 01            [ 2]  189 	ldw x,(DEST,sp) ; dest address 
      000186 CD 00 00         [ 4]  190 	call move
      000189 1E 01            [ 2]  191 	ldw x,(DEST,sp)
      00018B C3 00 3B         [ 2]  192 	cpw x,progend 
      00018E 25 0F            [ 1]  193 	jrult 9$ 
      000190 1E 07            [ 2]  194 	ldw x,(LLEN,sp)
      000192 72 BB 00 3B      [ 2]  195 	addw x,progend 
      000196 CF 00 3B         [ 2]  196 	ldw progend,x 
      000199 CF 00 3D         [ 2]  197 	ldw dvar_bgn,x 
      00019C CF 00 3F         [ 2]  198 	ldw dvar_end,x 
      00019F                        199 9$:	
      00019F                        200 	_drop VSIZE
      00019F 5B 08            [ 2]    1     addw sp,#VSIZE 
      0001A1 90 85            [ 2]  201 	popw y 
      0001A3 81               [ 4]  202 	ret
                                    203 
                                    204 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    205 ;; compiler routines        ;;
                                    206 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    207 ;------------------------------------
                                    208 ; parse quoted string 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 49.
Hexadecimal [24-Bits]



                                    209 ; input:
                                    210 ;   Y 	pointer to tib 
                                    211 ;   X   pointer to output buffer 
                                    212 ; output:
                                    213 ;	buffer   parsed string
                                    214 ;------------------------------------
                           000001   215 	PREV = 1
                           000002   216 	CURR =2
                           000002   217 	VSIZE=2
      0001A4                        218 parse_quote: 
      0001A4                        219 	_vars VSIZE
      0001A4 52 02            [ 2]    1     sub sp,#VSIZE 
      0001A6                        220 	_push_op  
      0001A6                          1     _decz psp+1
      0001A6 3A 4B                    1     .byte 0x3a,psp+1 
      0001A8 72 C7 00 4A      [ 4]    2     ld [psp],a 
      0001AC 4F               [ 1]  221 	clr a
      0001AD 6B 01            [ 1]  222 1$:	ld (PREV,sp),a 
      0001AF                        223 2$:	
      0001AF 91 D6 30         [ 4]  224 	ld a,([in.w],y)
      0001B2 27 28            [ 1]  225 	jreq 6$
      0001B4                        226 	_incz in 
      0001B4 3C 31                    1     .byte 0x3c, in 
      0001B6 6B 02            [ 1]  227 	ld (CURR,sp),a 
      0001B8 A6 5C            [ 1]  228 	ld a,#'\
      0001BA 11 01            [ 1]  229 	cp a, (PREV,sp)
      0001BC 26 0A            [ 1]  230 	jrne 3$
      0001BE 0F 01            [ 1]  231 	clr (PREV,sp)
      0001C0 7B 02            [ 1]  232 	ld a,(CURR,sp)
      0001C2 AD 22            [ 4]  233 	callr convert_escape
      0001C4 F7               [ 1]  234 	ld (x),a 
      0001C5 5C               [ 1]  235 	incw x 
      0001C6 20 E7            [ 2]  236 	jra 2$
      0001C8                        237 3$:
      0001C8 7B 02            [ 1]  238 	ld a,(CURR,sp)
      0001CA A1 5C            [ 1]  239 	cp a,#'\'
      0001CC 27 DF            [ 1]  240 	jreq 1$
      0001CE A1 22            [ 1]  241 	cp a,#'"
      0001D0 27 04            [ 1]  242 	jreq 5$ 
      0001D2 F7               [ 1]  243 	ld (x),a 
      0001D3 5C               [ 1]  244 	incw x 
      0001D4 20 D9            [ 2]  245 	jra 2$
      0001D6                        246 5$: _pop_op 	
      0001D6 72 C6 00 4A      [ 4]    1     ld a,[psp]
      0001DA                          2     _incz psp+1 
      0001DA 3C 4B                    1     .byte 0x3c, psp+1 
      0001DC                        247 6$: 
      0001DC 7F               [ 1]  248 	clr (x)
      0001DD 5C               [ 1]  249 	incw x 
      0001DE 90 93            [ 1]  250 	ldw y,x 
      0001E0 5F               [ 1]  251 	clrw x 
      0001E1 A6 06            [ 1]  252 	ld a,#QUOTE_IDX  
      0001E3                        253 	_drop VSIZE
      0001E3 5B 02            [ 2]    1     addw sp,#VSIZE 
      0001E5 81               [ 4]  254 	ret 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 50.
Hexadecimal [24-Bits]



                                    255 
                                    256 ;---------------------------------------
                                    257 ; called by parse_quote
                                    258 ; subtitute escaped character 
                                    259 ; by their ASCII value .
                                    260 ; input:
                                    261 ;   A  character following '\'
                                    262 ; output:
                                    263 ;   A  substitued char or same if not valid.
                                    264 ;---------------------------------------
      0001E6                        265 convert_escape:
      0001E6 89               [ 2]  266 	pushw x 
      0001E7 AE 01 FB         [ 2]  267 	ldw x,#escaped 
      0001EA F1               [ 1]  268 1$:	cp a,(x)
      0001EB 27 06            [ 1]  269 	jreq 2$
      0001ED 7D               [ 1]  270 	tnz (x)
      0001EE 27 09            [ 1]  271 	jreq 3$
      0001F0 5C               [ 1]  272 	incw x 
      0001F1 20 F7            [ 2]  273 	jra 1$
      0001F3 1D 01 FB         [ 2]  274 2$: subw x,#escaped 
      0001F6 9F               [ 1]  275 	ld a,xl 
      0001F7 AB 07            [ 1]  276 	add a,#7
      0001F9 85               [ 2]  277 3$:	popw x 
      0001FA 81               [ 4]  278 	ret 
                                    279 
      0001FB 61 62 74 6E 76 66 72   280 escaped:: .asciz "abtnvfr"
             00
                                    281 
                                    282 ;-------------------------
                                    283 ; integer parser 
                                    284 ; input:
                                    285 ;   X      *output buffer (&pad[n])
                                    286 ;   Y 		point to tib 
                                    287 ;   in.w    offset in tib 
                                    288 ;   A 	    first digit|'$' 
                                    289 ; output:  
                                    290 ;   X 		int16   
                                    291 ;   acc16   int16 
                                    292 ;   in.w    updated 
                                    293 ;   Y       pad[n] 
                                    294 ;-------------------------
      000203                        295 parse_integer: ; { -- n }
      000203 89               [ 2]  296 	pushw x 
      000204 72 B9 00 30      [ 2]  297 	addw y,in.w
      000208 90 5A            [ 2]  298 	decw y   
      00020A CD 0B 67         [ 4]  299 	call atoi16 
      00020D 72 A2 00 00      [ 2]  300 	subw y,#tib 
      000211 90 CF 00 30      [ 2]  301 	ldw in.w,y
      000215 90 85            [ 2]  302 	popw y  
      000217 81               [ 4]  303 	ret
                                    304 
                                    305 ;-------------------------------------
                                    306 ; input:
                                    307 ;   X  int16  
                                    308 ;   Y    pad[n]
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 51.
Hexadecimal [24-Bits]



                                    309 ; output:
                                    310 ;    pad   LITW_IDX,word  
                                    311 ;    y     &pad[n+3]
                                    312 ;------------------------------------
      000218                        313 compile_integer:
      000218 A6 08            [ 1]  314 	ld a,#LITW_IDX 
      00021A 90 F7            [ 1]  315 	ld (y),a
      00021C 90 5C            [ 1]  316 	incw y 
      00021E 90 FF            [ 2]  317 	LDW (Y),x 
      000220 72 A9 00 02      [ 2]  318 	addw y,#2
      000224 81               [ 4]  319 	ret
                                    320 
                                    321 ;---------------------------
                                    322 ;  when lexical unit begin 
                                    323 ;  with a letter a symbol 
                                    324 ;  is expected.
                                    325 ; input:
                                    326 ;   A   first character of symbol 
                                    327 ;	X   point to output buffer 
                                    328 ;   [in.w],Y   point to input text 
                                    329 ; output:
                                    330 ;   A   string length 
                                    331 ;   [in.w],Y   point after lexical unit 
                                    332 ;---------------------------
                           000001   333 	FIRST_CHAR=1
                           000002   334 	VSIZE=2 
      000225                        335 parse_symbol:
      000225                        336 	_vars VSIZE 
      000225 52 02            [ 2]    1     sub sp,#VSIZE 
      000227 1C 00 01         [ 2]  337 	addw x,#1 ; keep space for token identifier
      00022A 1F 01            [ 2]  338 	ldw (FIRST_CHAR,sp),x  
      00022C                        339 symb_loop: 
      00022C CD 00 00         [ 4]  340 	call to_upper 
      00022F F7               [ 1]  341 	ld (x), a 
      000230 5C               [ 1]  342 	incw x
      000231 91 D6 30         [ 4]  343 	ld a,([in.w],y)
      000234                        344 	_incz in 
      000234 3C 31                    1     .byte 0x3c, in 
      000236 A1 24            [ 1]  345 	cp a,#'$ 
      000238 27 05            [ 1]  346 	jreq 2$ ; string variable: LETTER+'$'  
      00023A CD 00 00         [ 4]  347 	call is_digit ;
      00023D 24 04            [ 1]  348 	jrnc 3$ ; integer variable LETTER+DIGIT 
      00023F                        349 2$:
      00023F F7               [ 1]  350 	ld (x),a 
      000240 5C               [ 1]  351 	incw x 
      000241 20 07            [ 2]  352 	jra 4$
      000243                        353 3$:
      000243 CD 00 00         [ 4]  354 	call is_alpha  
      000246 25 E4            [ 1]  355 	jrc symb_loop 
      000248                        356 	_decz in
      000248 3A 31                    1     .byte 0x3a,in 
      00024A                        357 4$:
      00024A 7F               [ 1]  358 	clr (x)
      00024B 72 F0 01         [ 2]  359 	subw x,(FIRST_CHAR,sp)
      00024E 9F               [ 1]  360 	ld a,xl
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 52.
Hexadecimal [24-Bits]



      00024F                        361 	_drop VSIZE 
      00024F 5B 02            [ 2]    1     addw sp,#VSIZE 
      000251 81               [ 4]  362 	ret 
                                    363 
                                    364 ;---------------------------------
                                    365 ; some syntax checking 
                                    366 ; can be done at compile time
                                    367 ; matching '(' and ')' 
                                    368 ; FOR TO STEP must be on same line 
                                    369 ; same for IF THEN 
                                    370 ;--------------------------------
      000252                        371 check_syntax:
      000252 A1 05            [ 1]  372 	cp a,#RPAREN_IDX
      000254 26 0D            [ 1]  373 	jrne 0$
      000256                        374 	_pop_op 
      000256 72 C6 00 4A      [ 4]    1     ld a,[psp]
      00025A                          2     _incz psp+1 
      00025A 3C 4B                    1     .byte 0x3c, psp+1 
      00025C A1 04            [ 1]  375 	cp a,#LPAREN_IDX 
      00025E 27 48            [ 1]  376 	jreq 9$ 
      000260 CC 09 81         [ 2]  377 	jp syntax_error 
      000263                        378 0$: 
      000263 A1 20            [ 1]  379 	cp a,#IF_IDX 
      000265 27 42            [ 1]  380 	jreq push_it 
      000267 A1 1B            [ 1]  381 	cp a,#FOR_IDX 
      000269 27 3E            [ 1]  382 	jreq push_it 
      00026B A1 21            [ 1]  383 	cp a,#THEN_IDX 
      00026D 26 0D            [ 1]  384 	jrne 1$
      00026F                        385 	_pop_op 
      00026F 72 C6 00 4A      [ 4]    1     ld a,[psp]
      000273                          2     _incz psp+1 
      000273 3C 4B                    1     .byte 0x3c, psp+1 
      000275 A1 20            [ 1]  386 	cp a,#IF_IDX 
      000277 27 2F            [ 1]  387 	jreq 9$ 
      000279 CC 09 81         [ 2]  388 	jp syntax_error 
      00027C                        389 1$: 
      00027C A1 27            [ 1]  390 	cp a,#TO_IDX 
      00027E 26 17            [ 1]  391 	jrne 3$ 
      000280                        392 	_pop_op 
      000280 72 C6 00 4A      [ 4]    1     ld a,[psp]
      000284                          2     _incz psp+1 
      000284 3C 4B                    1     .byte 0x3c, psp+1 
      000286 A1 1B            [ 1]  393 	cp a,#FOR_IDX 
      000288 27 03            [ 1]  394 	jreq 2$ 
      00028A CC 09 81         [ 2]  395 	jp syntax_error 
      00028D A6 27            [ 1]  396 2$: ld a,#TO_IDX 
      00028F                        397 	_push_op 
      00028F                          1     _decz psp+1
      00028F 3A 4B                    1     .byte 0x3a,psp+1 
      000291 72 C7 00 4A      [ 4]    2     ld [psp],a 
      000295 20 11            [ 2]  398 	jra 9$ 
      000297 A1 24            [ 1]  399 3$: cp a,#STEP_IDX 
      000299 26 0D            [ 1]  400 	jrne 9$ 
      00029B                        401 	_pop_op 
      00029B 72 C6 00 4A      [ 4]    1     ld a,[psp]
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 53.
Hexadecimal [24-Bits]



      00029F                          2     _incz psp+1 
      00029F 3C 4B                    1     .byte 0x3c, psp+1 
      0002A1 A1 27            [ 1]  402 	cp a,#TO_IDX 
      0002A3 27 03            [ 1]  403 	jreq 9$ 
      0002A5 CC 09 81         [ 2]  404 	jp syntax_error 
      0002A8                        405 9$:	
      0002A8 81               [ 4]  406 	ret 
      0002A9                        407 push_it:
      0002A9                        408 	_push_op 
      0002A9                          1     _decz psp+1
      0002A9 3A 4B                    1     .byte 0x3a,psp+1 
      0002AB 72 C7 00 4A      [ 4]    2     ld [psp],a 
      0002AF 81               [ 4]  409 	ret 
                                    410 
                                    411 ;---------------------------
                                    412 ;  token begin with a letter,
                                    413 ;  is keyword or variable. 	
                                    414 ; input:
                                    415 ;   X 		point to pad 
                                    416 ;   Y 		point to text
                                    417 ;   A 	    first letter  
                                    418 ; output:
                                    419 ;   Y		point in pad after token  
                                    420 ;   A 		token identifier
                                    421 ;   pad 	keyword|var_name  
                                    422 ;--------------------------  
                           000001   423 	TOK_POS=1
                           000003   424 	NLEN=TOK_POS+2
                           000003   425 	VSIZE=NLEN 
      0002B0                        426 parse_keyword:
      0002B0                        427 	_vars VSIZE 
      0002B0 52 03            [ 2]    1     sub sp,#VSIZE 
      0002B2 0F 03            [ 1]  428 	clr (NLEN,sp)
      0002B4 1F 01            [ 2]  429 	ldw (TOK_POS,sp),x  ; where TOK_IDX should be put 
      0002B6 CD 02 25         [ 4]  430 	call parse_symbol
      0002B9 6B 03            [ 1]  431 	ld (NLEN,sp),a 
      0002BB A1 01            [ 1]  432 	cp a,#1
      0002BD 27 30            [ 1]  433 	jreq 3$  
                                    434  ; check in dictionary, if not found must be variable name.
      0002BF                        435 	_ldx_dict kword_dict ; dictionary entry point
      0002BF AE 1E 96         [ 2]    1         ldw x,#kword_dict+2
      0002C2 16 01            [ 2]  436 	ldw y,(TOK_POS,sp) ; name to search for
      0002C4 72 A9 00 01      [ 2]  437 	addw y,#1 ; name first character 
      0002C8 CD 0B AF         [ 4]  438 	call search_dict
      0002CB A1 FF            [ 1]  439 	cp a,#NONE_IDX 
      0002CD 26 2C            [ 1]  440 	jrne 6$
                                    441 ; not in dictionary
                                    442 ; either LETTER+'$' || LETTER+DIGIT 
      0002CF A6 02            [ 1]  443 	ld a,#2 
      0002D1 11 03            [ 1]  444 	cp a,(NLEN,sp)
      0002D3 27 03            [ 1]  445 	jreq 1$ 
      0002D5 CC 09 81         [ 2]  446     jp syntax_error 	
      0002D8                        447 1$: ; 2 letters variables 
      0002D8 16 01            [ 2]  448 	ldw y,(TOK_POS,sp)
      0002DA 93               [ 1]  449 	ldw x,y 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 54.
Hexadecimal [24-Bits]



      0002DB 1C 00 02         [ 2]  450 	addw x,#2 
      0002DE F6               [ 1]  451 	ld a,(x)
      0002DF A1 24            [ 1]  452 	cp a,#'$ 
      0002E1 26 04            [ 1]  453 	jrne 2$ 
      0002E3 A6 0A            [ 1]  454 	ld a,#STR_VAR_IDX
      0002E5 20 0C            [ 2]  455 	jra 5$
      0002E7 CD 00 00         [ 4]  456 2$:	call is_digit 
      0002EA 25 05            [ 1]  457 	jrc 4$ ; LETTER+DIGIT 
      0002EC CC 09 81         [ 2]  458 	jp syntax_error 
      0002EF                        459 3$:
                                    460 ; one letter symbol is integer variable name 
                                    461 ; tokenize as: VAR_IDX,LETTER,NUL  
      0002EF 16 01            [ 2]  462 	ldw y,(TOK_POS,sp)
      0002F1                        463 4$:	
      0002F1 A6 09            [ 1]  464 	ld a,#VAR_IDX 
      0002F3                        465 5$:
      0002F3 90 F7            [ 1]  466 	ld (y),a
      0002F5 72 A9 00 03      [ 2]  467 	addw y,#3
      0002F9 20 09            [ 2]  468 	jra 9$
      0002FB                        469 6$:	; word in dictionary 
      0002FB 16 01            [ 2]  470 	ldw y,(TOK_POS,sp)
      0002FD 90 F7            [ 1]  471 	ld (y),a ; compile token 
      0002FF 90 5C            [ 1]  472 	incw y
      000301 CD 02 52         [ 4]  473 	call check_syntax  
      000304                        474 9$:	_drop VSIZE 
      000304 5B 03            [ 2]    1     addw sp,#VSIZE 
      000306 81               [ 4]  475 	ret  	
                                    476 
                                    477 ;------------------------------------
                                    478 ; skip character c in text starting from 'in'
                                    479 ; input:
                                    480 ;	 y 		point to text buffer
                                    481 ;    a 		character to skip
                                    482 ; output:  
                                    483 ;	'in' ajusted to new position
                                    484 ;------------------------------------
                           000001   485 	C = 1 ; local var
      000307                        486 skip:
      000307 88               [ 1]  487 	push a
      000308 91 D6 30         [ 4]  488 1$:	ld a,([in.w],y)
      00030B 27 08            [ 1]  489 	jreq 2$
      00030D 11 01            [ 1]  490 	cp a,(C,sp)
      00030F 26 04            [ 1]  491 	jrne 2$
      000311                        492 	_incz in
      000311 3C 31                    1     .byte 0x3c, in 
      000313 20 F3            [ 2]  493 	jra 1$
      000315                        494 2$: _drop 1 
      000315 5B 01            [ 2]    1     addw sp,#1 
      000317 81               [ 4]  495 	ret
                                    496 	
                                    497 
                                    498 ;------------------------------------
                                    499 ; scan text for next lexeme
                                    500 ; compile its TOKEN_IDX and value
                                    501 ; in output buffer.  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 55.
Hexadecimal [24-Bits]



                                    502 ; update input and output pointers 
                                    503 ; input: 
                                    504 ;	X 		pointer to buffer where 
                                    505 ;	        token idx and value are compiled 
                                    506 ; use:
                                    507 ;	Y       pointer to text in tib 
                                    508 ;   in.w    offset in tib, i.e. tib[in.w]
                                    509 ; output:
                                    510 ;   A       token index  
                                    511 ;   Y       updated position in output buffer   
                                    512 ;------------------------------------
                                    513 	; use to check special character 
                                    514 	.macro _case c t  
                                    515 	ld a,#c 
                                    516 	cp a,(TCHAR,sp) 
                                    517 	jrne t
                                    518 	.endm 
                                    519 	
                                    520 ; local variables 
                           000001   521 	TCHAR=1 ; parsed character 
                           000002   522 	ATTRIB=2 ; token value  
                           000002   523 	VSIZE=2
      000318                        524 parse_lexeme:
      000318                        525 	_vars VSIZE
      000318 52 02            [ 2]    1     sub sp,#VSIZE 
      00031A 90 AE 00 00      [ 2]  526 	ldw y,#tib    	
      00031E A6 20            [ 1]  527 	ld a,#SPACE
      000320 CD 03 07         [ 4]  528 	call skip
      000323 91 D6 30         [ 4]  529 	ld a,([in.w],y)
      000326 26 05            [ 1]  530 	jrne 1$
      000328 90 93            [ 1]  531 	ldw y,x 
      00032A CC 04 AD         [ 2]  532 	jp token_exit ; end of line 
      00032D                        533 1$:	_incz in 
      00032D 3C 31                    1     .byte 0x3c, in 
      00032F 6B 01            [ 1]  534 	ld (TCHAR,sp),a ; first char of lexeme 
                                    535 ; check for quoted string
      000331                        536 str_tst:  	
      000331                        537 	_case '"' nbr_tst
      000331 A6 22            [ 1]    1 	ld a,#'"' 
      000333 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000335 26 0C            [ 1]    3 	jrne nbr_tst
      000337 A6 06            [ 1]  538 	ld a,#QUOTE_IDX
      000339 88               [ 1]  539 	push a 
      00033A F7               [ 1]  540 	ld (x),a ; compile TOKEN INDEX 
      00033B 5C               [ 1]  541 	incw x 
      00033C CD 01 A4         [ 4]  542 	call parse_quote ; compile quoted string 
      00033F 84               [ 1]  543 	pop a 
      000340 CC 04 AD         [ 2]  544 	jp token_exit
      000343                        545 nbr_tst:
                                    546 ; check for hexadecimal number 
      000343                        547 	_case '$' digit_test 
      000343 A6 24            [ 1]    1 	ld a,#'$' 
      000345 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000347 26 02            [ 1]    3 	jrne digit_test
      000349 20 07            [ 2]  548 	jra integer 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 56.
Hexadecimal [24-Bits]



                                    549 ; check for decimal number 	
      00034B                        550 digit_test: 
      00034B 7B 01            [ 1]  551 	ld a,(TCHAR,sp)
      00034D CD 00 00         [ 4]  552 	call is_digit
      000350 24 09            [ 1]  553 	jrnc other_tests
      000352                        554 integer: 
      000352 CD 02 03         [ 4]  555 	call parse_integer 
      000355 CD 02 18         [ 4]  556 	call compile_integer
      000358 CC 04 AD         [ 2]  557 	jp token_exit 
      00035B                        558 other_tests: 
      00035B                        559 	_case '(' bkslsh_tst 
      00035B A6 28            [ 1]    1 	ld a,#'(' 
      00035D 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      00035F 26 0B            [ 1]    3 	jrne bkslsh_tst
      000361 A6 04            [ 1]  560 	ld a,#LPAREN_IDX 
      000363                        561 	_push_op 
      000363                          1     _decz psp+1
      000363 3A 4B                    1     .byte 0x3a,psp+1 
      000365 72 C7 00 4A      [ 4]    2     ld [psp],a 
      000369 CC 04 A9         [ 2]  562 	jp token_char   	
      00036C                        563 bkslsh_tst: ; character token 
      00036C                        564 	_case '\',rparnt_tst
      00036C A6 5C            [ 1]    1 	ld a,#'\' 
      00036E 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000370 26 12            [ 1]    3 	jrne rparnt_tst
      000372 A6 07            [ 1]  565 	ld a,#LITC_IDX 
      000374 F7               [ 1]  566 	ld (x),a 
      000375 88               [ 1]  567 	push a 
      000376 5C               [ 1]  568 	incw x 
      000377 91 D6 30         [ 4]  569 	ld a,([in.w],y)
      00037A                        570 	_incz in  
      00037A 3C 31                    1     .byte 0x3c, in 
      00037C F7               [ 1]  571 	ld (x),a 
      00037D 5C               [ 1]  572 	incw x
      00037E 90 93            [ 1]  573 	ldw y,x 
      000380 84               [ 1]  574 	pop a 	 
      000381 CC 04 AD         [ 2]  575 	jp token_exit
      000384                        576 rparnt_tst:		
      000384                        577 	_case ')' colon_tst 
      000384 A6 29            [ 1]    1 	ld a,#')' 
      000386 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000388 26 0A            [ 1]    3 	jrne colon_tst
      00038A A6 05            [ 1]  578 	ld a,#RPAREN_IDX  
      00038C CD 02 52         [ 4]  579 	call check_syntax 
      00038F A6 05            [ 1]  580 	ld a,#RPAREN_IDX
      000391 CC 04 A9         [ 2]  581 	jp token_char
      000394                        582 colon_tst:
      000394                        583 	_case ':' comma_tst 
      000394 A6 3A            [ 1]    1 	ld a,#':' 
      000396 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000398 26 05            [ 1]    3 	jrne comma_tst
      00039A A6 01            [ 1]  584 	ld a,#COLON_IDX  
      00039C CC 04 A9         [ 2]  585 	jp token_char  
      00039F                        586 comma_tst:
      00039F                        587 	_case COMMA semic_tst 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 57.
Hexadecimal [24-Bits]



      00039F A6 2C            [ 1]    1 	ld a,#COMMA 
      0003A1 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      0003A3 26 05            [ 1]    3 	jrne semic_tst
      0003A5 A6 02            [ 1]  588 	ld a,#COMMA_IDX 
      0003A7 CC 04 A9         [ 2]  589 	jp token_char
      0003AA                        590 semic_tst:
      0003AA                        591 	_case SEMIC dash_tst
      0003AA A6 3B            [ 1]    1 	ld a,#SEMIC 
      0003AC 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      0003AE 26 05            [ 1]    3 	jrne dash_tst
      0003B0 A6 03            [ 1]  592 	ld a,#SCOL_IDX  
      0003B2 CC 04 A9         [ 2]  593 	jp token_char 	
      0003B5                        594 dash_tst: 	
      0003B5                        595 	_case '-' sharp_tst 
      0003B5 A6 2D            [ 1]    1 	ld a,#'-' 
      0003B7 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      0003B9 26 05            [ 1]    3 	jrne sharp_tst
      0003BB A6 0C            [ 1]  596 	ld a,#SUB_IDX  
      0003BD CC 04 A9         [ 2]  597 	jp token_char 
      0003C0                        598 sharp_tst:
      0003C0                        599 	_case '#' qmark_tst 
      0003C0 A6 23            [ 1]    1 	ld a,#'#' 
      0003C2 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      0003C4 26 05            [ 1]    3 	jrne qmark_tst
      0003C6 A6 15            [ 1]  600 	ld a,#REL_NE_IDX  
      0003C8 CC 04 A9         [ 2]  601 	jp token_char
      0003CB                        602 qmark_tst:
      0003CB                        603 	_case '?' tick_tst 
      0003CB A6 3F            [ 1]    1 	ld a,#'?' 
      0003CD 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      0003CF 26 09            [ 1]    3 	jrne tick_tst
      0003D1 A6 3F            [ 1]  604 	ld a,#PRINT_IDX   
      0003D3 F7               [ 1]  605 	ld (x),a 
      0003D4 5C               [ 1]  606 	incw x 
      0003D5 90 93            [ 1]  607 	ldw y,x 
      0003D7 CC 04 AD         [ 2]  608 	jp token_exit
      0003DA                        609 tick_tst: ; comment 
      0003DA                        610 	_case TICK plus_tst 
      0003DA A6 27            [ 1]    1 	ld a,#TICK 
      0003DC 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      0003DE 26 2F            [ 1]    3 	jrne plus_tst
      0003E0 A6 23            [ 1]  611 	ld a,#REM_IDX 
      0003E2 F7               [ 1]  612 	ld (x),a 
      0003E3 5C               [ 1]  613 	incw x
      0003E4                        614 copy_comment:
      0003E4 90 AE 00 00      [ 2]  615 	ldw y,#tib 
      0003E8 72 B9 00 30      [ 2]  616 	addw y,in.w
      0003EC 90 89            [ 2]  617 	pushw y 
      0003EE CD 00 00         [ 4]  618 	call strcpy
      0003F1 72 F2 01         [ 2]  619 	subw y,(1,sp)
      0003F4 90 5C            [ 1]  620 	incw y ; strlen+1
      0003F6 90 89            [ 2]  621 	pushw y  
      0003F8 72 FB 01         [ 2]  622 	addw x,(1,sp) 
      0003FB 90 93            [ 1]  623 	ldw y,x 
      0003FD 85               [ 2]  624 	popw x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 58.
Hexadecimal [24-Bits]



      0003FE 72 FB 01         [ 2]  625 	addw x,(1,sp)
      000401 5A               [ 2]  626 	decw x 
      000402 1D 00 00         [ 2]  627 	subw x,#tib 
      000405 CF 00 30         [ 2]  628 	ldw in.w,x 
      000408                        629 	_drop 2 
      000408 5B 02            [ 2]    1     addw sp,#2 
      00040A A6 23            [ 1]  630 	ld a,#REM_IDX
      00040C CC 04 AD         [ 2]  631 	jp token_exit 
      00040F                        632 plus_tst:
      00040F                        633 	_case '+' star_tst 
      00040F A6 2B            [ 1]    1 	ld a,#'+' 
      000411 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000413 26 05            [ 1]    3 	jrne star_tst
      000415 A6 0B            [ 1]  634 	ld a,#ADD_IDX  
      000417 CC 04 A9         [ 2]  635 	jp token_char 
      00041A                        636 star_tst:
      00041A                        637 	_case '*' slash_tst 
      00041A A6 2A            [ 1]    1 	ld a,#'*' 
      00041C 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      00041E 26 05            [ 1]    3 	jrne slash_tst
      000420 A6 0F            [ 1]  638 	ld a,#MULT_IDX  
      000422 CC 04 A9         [ 2]  639 	jp token_char 
      000425                        640 slash_tst: 
      000425                        641 	_case '/' prcnt_tst 
      000425 A6 2F            [ 1]    1 	ld a,#'/' 
      000427 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000429 26 05            [ 1]    3 	jrne prcnt_tst
      00042B A6 0D            [ 1]  642 	ld a,#DIV_IDX  
      00042D CC 04 A9         [ 2]  643 	jp token_char 
      000430                        644 prcnt_tst:
      000430                        645 	_case '%' eql_tst 
      000430 A6 25            [ 1]    1 	ld a,#'%' 
      000432 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000434 26 05            [ 1]    3 	jrne eql_tst
      000436 A6 0E            [ 1]  646 	ld a,#MOD_IDX 
      000438 CC 04 A9         [ 2]  647 	jp token_char  
                                    648 ; 1 or 2 character tokens 	
      00043B                        649 eql_tst:
      00043B                        650 	_case '=' gt_tst 		
      00043B A6 3D            [ 1]    1 	ld a,#'=' 
      00043D 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      00043F 26 05            [ 1]    3 	jrne gt_tst
      000441 A6 11            [ 1]  651 	ld a,#REL_EQU_IDX 
      000443 CC 04 A9         [ 2]  652 	jp token_char 
      000446                        653 gt_tst:
      000446                        654 	_case '>' lt_tst 
      000446 A6 3E            [ 1]    1 	ld a,#'>' 
      000448 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      00044A 26 21            [ 1]    3 	jrne lt_tst
      00044C A6 14            [ 1]  655 	ld a,#REL_GT_IDX 
      00044E 6B 02            [ 1]  656 	ld (ATTRIB,sp),a 
      000450 91 D6 30         [ 4]  657 	ld a,([in.w],y)
      000453                        658 	_incz in 
      000453 3C 31                    1     .byte 0x3c, in 
      000455 A1 3D            [ 1]  659 	cp a,#'=
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 59.
Hexadecimal [24-Bits]



      000457 26 04            [ 1]  660 	jrne 1$
      000459 A6 12            [ 1]  661 	ld a,#REL_GE_IDX  
      00045B 20 4C            [ 2]  662 	jra token_char  
      00045D A1 3C            [ 1]  663 1$: cp a,#'<
      00045F 26 04            [ 1]  664 	jrne 2$
      000461 A6 15            [ 1]  665 	ld a,#REL_NE_IDX  
      000463 20 44            [ 2]  666 	jra token_char 
      000465 72 5A 00 31      [ 1]  667 2$: dec in
      000469 7B 02            [ 1]  668 	ld a,(ATTRIB,sp)
      00046B 20 3C            [ 2]  669 	jra token_char 	 
      00046D                        670 lt_tst:
      00046D                        671 	_case '<' other
      00046D A6 3C            [ 1]    1 	ld a,#'<' 
      00046F 11 01            [ 1]    2 	cp a,(TCHAR,sp) 
      000471 26 21            [ 1]    3 	jrne other
      000473 A6 13            [ 1]  672 	ld a,#REL_LT_IDX  
      000475 6B 02            [ 1]  673 	ld (ATTRIB,sp),a 
      000477 91 D6 30         [ 4]  674 	ld a,([in.w],y)
      00047A                        675 	_incz in 
      00047A 3C 31                    1     .byte 0x3c, in 
      00047C A1 3D            [ 1]  676 	cp a,#'=
      00047E 26 04            [ 1]  677 	jrne 1$
      000480 A6 10            [ 1]  678 	ld a,#REL_LE_IDX 
      000482 20 25            [ 2]  679 	jra token_char 
      000484 A1 3E            [ 1]  680 1$: cp a,#'>
      000486 26 04            [ 1]  681 	jrne 2$
      000488 A6 15            [ 1]  682 	ld a,#REL_NE_IDX  
      00048A 20 1D            [ 2]  683 	jra token_char 
      00048C 72 5A 00 31      [ 1]  684 2$: dec in 
      000490 7B 02            [ 1]  685 	ld a,(ATTRIB,sp)
      000492 20 15            [ 2]  686 	jra token_char 	
      000494                        687 other: ; not a special character 	 
      000494 7B 01            [ 1]  688 	ld a,(TCHAR,sp)
      000496 CD 00 00         [ 4]  689 	call is_alpha 
      000499 25 03            [ 1]  690 	jrc 30$ 
      00049B CC 09 81         [ 2]  691 	jp syntax_error 
      00049E                        692 30$: 
      00049E CD 02 B0         [ 4]  693 	call parse_keyword
      0004A1 A1 23            [ 1]  694 	cp a,#REM_IDX  
      0004A3 26 08            [ 1]  695 	jrne token_exit   
      0004A5 93               [ 1]  696 	ldw x,y 
      0004A6 CC 03 E4         [ 2]  697 	jp copy_comment
      0004A9                        698 token_char:
      0004A9 F7               [ 1]  699 	ld (x),a 
      0004AA 5C               [ 1]  700 	incw x
      0004AB 90 93            [ 1]  701 	ldw y,x 
      0004AD                        702 token_exit:
      0004AD                        703 	_drop VSIZE 
      0004AD 5B 02            [ 2]    1     addw sp,#VSIZE 
      0004AF 81               [ 4]  704 	ret
                                    705 
                                    706 
                                    707 ;-----------------------------------
                                    708 ; create token list fromm text line 
                                    709 ; save this list in pad buffer 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 60.
Hexadecimal [24-Bits]



                                    710 ;  compiled line format: 
                                    711 ;    line_no  2 bytes {0...32767}
                                    712 ;    line length    1 byte  
                                    713 ;    tokens list  variable length 
                                    714 ;   
                                    715 ; input:
                                    716 ;   none
                                    717 ; used variables:
                                    718 ;   in.w  		 3|count, i.e. index in buffer
                                    719 ;   count        length of line | 0  
                                    720 ;   basicptr    
                                    721 ;   pad buffer   compiled BASIC line  
                                    722 ;
                                    723 ; If there is a line number copy pad 
                                    724 ; in program space. 
                                    725 ;-----------------------------------
                           000001   726 	XSAVE=1
                           000002   727 	VSIZE=2
      0004B0                        728 compile::
      0004B0                        729 	_vars VSIZE 
      0004B0 52 02            [ 2]    1     sub sp,#VSIZE 
      0004B2 55 00 37 00 35   [ 1]  730 	mov basicptr,lomem
      0004B7 72 1A 00 43      [ 1]  731 	bset flags,#FCOMP 
      0004BB                        732 	_rst_pending
      0004BB AE 00 5C         [ 2]    1     ldw x,#pending_stack+PENDING_STACK_SIZE
      0004BE                          2     _strxz psp 
      0004BE BF 4A                    1     .byte 0xbf,psp 
      0004C0 4F               [ 1]  733 	clr a 
      0004C1 5F               [ 1]  734 	clrw x
      0004C2 CF 00 00         [ 2]  735 	ldw pad,x ; line# in destination buffer 
      0004C5 C7 00 02         [ 1]  736 	ld pad+2,a ; line length  
      0004C8                        737 	_clrz in.w 
      0004C8 3F 30                    1     .byte 0x3f, in.w 
      0004CA                        738 	_clrz in  ; offset in input text buffer 
      0004CA 3F 31                    1     .byte 0x3f, in 
      0004CC C6 00 00         [ 1]  739 	ld a,tib 
      0004CF CD 00 00         [ 4]  740 	call is_digit
      0004D2 24 1B            [ 1]  741 	jrnc 1$ 
      0004D4                        742 	_incz in 
      0004D4 3C 31                    1     .byte 0x3c, in 
      0004D6 AE 00 03         [ 2]  743 	ldw x,#pad+3
      0004D9 90 AE 00 00      [ 2]  744 	ldw y,#tib   
      0004DD CD 02 03         [ 4]  745 	call parse_integer 
      0004E0 A3 00 01         [ 2]  746 	cpw x,#1
      0004E3 2F 05            [ 1]  747 	jrslt 0$
      0004E5 CF 00 00         [ 2]  748 	ldw pad,x 
      0004E8 20 05            [ 2]  749 	jra 1$ 
      0004EA A6 01            [ 1]  750 0$:	ld a,#ERR_SYNTAX 
      0004EC CC 09 83         [ 2]  751 	jp tb_error
      0004EF                        752 1$:	 
      0004EF 90 AE 00 03      [ 2]  753 	ldw y,#pad+3 
      0004F3 90 A3 00 00      [ 2]  754 2$:	cpw y,#stack_full 
      0004F7 25 05            [ 1]  755 	jrult 3$
      0004F9 A6 0A            [ 1]  756 	ld a,#ERR_MEM_FULL 
      0004FB CC 09 83         [ 2]  757 	jp tb_error 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 61.
Hexadecimal [24-Bits]



      0004FE                        758 3$:	
      0004FE 93               [ 1]  759 	ldw x,y 
      0004FF CD 03 18         [ 4]  760 	call parse_lexeme 
      000502 4D               [ 1]  761 	tnz a 
      000503 26 EE            [ 1]  762 	jrne 2$ 
                                    763 ; compilation completed  
      000505                        764 	_pending_empty 
      000505                          1     _ldaz psp+1 
      000505 B6 4B                    1     .byte 0xb6,psp+1 
      000507 A0 5C            [ 1]    2     sub a,#pending_stack+PENDING_STACK_SIZE
      000509 27 0D            [ 1]  765 	jreq 4$
      00050B                        766 	_pop_op 
      00050B 72 C6 00 4A      [ 4]    1     ld a,[psp]
      00050F                          2     _incz psp+1 
      00050F 3C 4B                    1     .byte 0x3c, psp+1 
      000511 A1 27            [ 1]  767 	cp a,#TO_IDX 
      000513 27 03            [ 1]  768 	jreq 4$ 
      000515 CC 09 81         [ 2]  769 	jp syntax_error 
      000518                        770 4$:
      000518 90 7F            [ 1]  771 	clr (y)
      00051A 90 5C            [ 1]  772 	incw y 
      00051C 72 A2 00 00      [ 2]  773 	subw y,#pad ; compiled line length 
      000520 90 9F            [ 1]  774     ld a,yl
      000522 AE 00 00         [ 2]  775 	ldw x,#pad 
      000525                        776 	_strxz ptr16 
      000525 BF 00                    1     .byte 0xbf,ptr16 
      000527 E7 02            [ 1]  777 	ld (2,x),a 
      000529 FE               [ 2]  778 	ldw x,(x)  ; line# 
      00052A 27 08            [ 1]  779 	jreq 10$
      00052C CD 01 3C         [ 4]  780 	call insert_line ; in program space 
      00052F                        781 	_clrz  count
      00052F 3F 32                    1     .byte 0x3f, count 
      000531 4F               [ 1]  782 	clr  a ; not immediate command  
      000532 20 0F            [ 2]  783 	jra  11$ 
      000534                        784 10$: ; line# is zero 
                                    785 ; for immediate execution from pad buffer.
      000534                        786 	_ldxz ptr16  
      000534 BE 00                    1     .byte 0xbe,ptr16 
      000536 E6 02            [ 1]  787 	ld a,(2,x)
      000538                        788 	_straz count
      000538 B7 32                    1     .byte 0xb7,count 
      00053A                        789 	_strxz line.addr
      00053A BF 33                    1     .byte 0xbf,line.addr 
      00053C 1C 00 03         [ 2]  790 	addw x,#LINE_HEADER_SIZE
      00053F                        791 	_strxz basicptr
      00053F BF 35                    1     .byte 0xbf,basicptr 
      000541 90 93            [ 1]  792 	ldw y,x
      000543                        793 11$:
      000543                        794 	_drop VSIZE 
      000543 5B 02            [ 2]    1     addw sp,#VSIZE 
      000545 72 1B 00 43      [ 1]  795 	bres flags,#FCOMP 
      000549 81               [ 4]  796 	ret 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 62.
Hexadecimal [24-Bits]



                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2023,2024  
                                      3 ; This file is part of pomme-I 
                                      4 ;
                                      5 ;     pomme-I is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     pomme-I is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with pomme-I.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 
                                     19 ;---------------------------------------
                                     20 ;  decompiler
                                     21 ;  decompile bytecode to text source
                                     22 ;  used by command LIST
                                     23 ;---------------------------------------
                                     24 
                                     25     .module DECOMPILER 
                                     26 
                                     27     .area CODE 
                                     28 
                                     29 ;--------------------------
                                     30 ;  align text in buffer 
                                     31 ;  by  padding left  
                                     32 ;  with  SPACE 
                                     33 ; input:
                                     34 ;   X      str*
                                     35 ;   A      width  
                                     36 ; output:
                                     37 ;   A      strlen
                                     38 ;   X      ajusted
                                     39 ;--------------------------
                           000001    40 	WIDTH=1 ; column width 
                           000002    41 	SLEN=2  ; string length 
                           000002    42 	VSIZE=2 
      00054A                         43 right_align::
      00054A                         44 	_vars VSIZE 
      00054A 52 02            [ 2]    1     sub sp,#VSIZE 
      00054C 6B 01            [ 1]   45 	ld (WIDTH,sp),a 
      00054E CD 00 00         [ 4]   46 	call strlen 
      000551 6B 02            [ 1]   47 0$:	ld (SLEN,sp),a  
      000553 11 01            [ 1]   48 	cp a,(WIDTH,sp) 
      000555 2A 09            [ 1]   49 	jrpl 1$
      000557 5A               [ 2]   50 	decw x
      000558 A6 20            [ 1]   51 	ld a,#SPACE 
      00055A F7               [ 1]   52 	ld (x),a  
      00055B 7B 02            [ 1]   53 	ld a,(SLEN,sp)
      00055D 4C               [ 1]   54 	inc a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 63.
Hexadecimal [24-Bits]



      00055E 20 F1            [ 2]   55 	jra 0$ 
      000560 7B 02            [ 1]   56 1$: ld a,(SLEN,sp)	
      000562                         57 	_drop VSIZE 
      000562 5B 02            [ 2]    1     addw sp,#VSIZE 
      000564 81               [ 4]   58 	ret 
                                     59 
                                     60 ;--------------------------
                                     61 ; print quoted string 
                                     62 ; converting control character
                                     63 ; to backslash sequence
                                     64 ; input:
                                     65 ;   X        char *
                                     66 ;-----------------------------
      000565                         67 prt_quote:
      000565 A6 22            [ 1]   68 	ld a,#'"
      000567 CD 00 00         [ 4]   69 	call putc 
      00056A 90 89            [ 2]   70 	pushw y 
      00056C CD 0B 31         [ 4]   71 	call skip_string 
      00056F 85               [ 2]   72 	popw x  
      000570 F6               [ 1]   73 1$:	ld a,(x)
      000571 5C               [ 1]   74 	incw x 
      000572 72 5A 00 32      [ 1]   75 	dec count 
      000576 4D               [ 1]   76 	tnz a 
      000577 27 2E            [ 1]   77 	jreq 9$ 
      000579 A1 20            [ 1]   78 	cp a,#SPACE 
      00057B 25 0C            [ 1]   79 	jrult 3$
      00057D CD 00 00         [ 4]   80 	call putc 
      000580 A1 5C            [ 1]   81 	cp a,#'\ 
      000582 26 EC            [ 1]   82 	jrne 1$ 
      000584                         83 2$:
      000584 CD 00 00         [ 4]   84 	call putc 
      000587 20 E7            [ 2]   85 	jra 1$
      000589 88               [ 1]   86 3$: push a 
      00058A A6 5C            [ 1]   87 	ld a,#'\
      00058C CD 00 00         [ 4]   88 	call putc  
      00058F 84               [ 1]   89 	pop a 
      000590 A0 07            [ 1]   90 	sub a,#7
      000592                         91 	_straz acc8 
      000592 B7 00                    1     .byte 0xb7,acc8 
      000594 72 5F 00 00      [ 1]   92 	clr acc16
      000598 89               [ 2]   93 	pushw x
      000599 AE 01 FB         [ 2]   94 	ldw x,#escaped 
      00059C 72 BB 00 00      [ 2]   95 	addw x,acc16 
      0005A0 F6               [ 1]   96 	ld a,(x)
      0005A1 CD 00 00         [ 4]   97 	call putc 
      0005A4 85               [ 2]   98 	popw x
      0005A5 20 C9            [ 2]   99 	jra 1$
      0005A7                        100 9$:
      0005A7 A6 22            [ 1]  101 	ld a,#'"
      0005A9 CD 00 00         [ 4]  102 	call putc  
      0005AC 81               [ 4]  103 	ret
                                    104 
                                    105 ;--------------------------
                                    106 ; print variable name  
                                    107 ; input:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 64.
Hexadecimal [24-Bits]



                                    108 ;   X    variable name
                                    109 ; output:
                                    110 ;   none 
                                    111 ;--------------------------
      0005AD                        112 prt_var_name:
      0005AD 9E               [ 1]  113 	ld a,xh 
      0005AE A4 7F            [ 1]  114 	and a,#0x7f 
      0005B0 CD 00 00         [ 4]  115 	call putc 
      0005B3 9F               [ 1]  116 	ld a,xl 
      0005B4 CD 00 00         [ 4]  117 	call putc 
      0005B7 81               [ 4]  118 	ret 
                                    119 
                                    120 ;----------------------------------
                                    121 ; search name in dictionary
                                    122 ; from its token index  
                                    123 ; input:
                                    124 ;   a       	token index   
                                    125 ; output:
                                    126 ;   A           token index | 0 
                                    127 ;   X 			*name  | 0 
                                    128 ;--------------------------------
                           000001   129 	TOKEN=1  ; TOK_IDX 
                           000002   130 	NFIELD=TOKEN+1 ; NAME FIELD 
                           000004   131 	SKIP=NFIELD+2 
                           000005   132 	VSIZE=SKIP+1 
      0005B8                        133 tok_to_name:
      0005B8                        134 	_vars VSIZE 
      0005B8 52 05            [ 2]    1     sub sp,#VSIZE 
      0005BA 0F 04            [ 1]  135 	clr (SKIP,sp) 
      0005BC 6B 01            [ 1]  136 	ld (TOKEN,sp),a 
      0005BE AE 1F 13         [ 2]  137 	ldw x, #all_words+2 ; name field 	
      0005C1 1F 02            [ 2]  138 1$:	ldw (NFIELD,sp),x
      0005C3 F6               [ 1]  139 	ld a,(x)
      0005C4 AB 02            [ 1]  140 	add a,#2 
      0005C6 6B 05            [ 1]  141 	ld (SKIP+1,sp),a 
      0005C8 72 FB 04         [ 2]  142 	addw x,(SKIP,sp)
      0005CB F6               [ 1]  143 	ld a,(x) ; TOK_IDX     
      0005CC 11 01            [ 1]  144 	cp a,(TOKEN,sp)
      0005CE 27 0B            [ 1]  145 	jreq 2$
      0005D0 1E 02            [ 2]  146 	ldw x,(NFIELD,sp) ; name field 
      0005D2 1D 00 02         [ 2]  147 	subw x,#2 ; link field 
      0005D5 FE               [ 2]  148 	ldw x,(x) 
      0005D6 26 E9            [ 1]  149 	jrne 1$
      0005D8 4F               [ 1]  150 	clr a 
      0005D9 20 03            [ 2]  151 	jra 9$
      0005DB 1E 02            [ 2]  152 2$: ldw x,(NFIELD,sp)
      0005DD 5C               [ 1]  153 	incw x 
      0005DE                        154 9$:	_drop VSIZE
      0005DE 5B 05            [ 2]    1     addw sp,#VSIZE 
      0005E0 81               [ 4]  155 	ret
                                    156 
                                    157 ;------------------------------------
                                    158 ; check if token need space 
                                    159 ; before or after it 
                                    160 ; input:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 65.
Hexadecimal [24-Bits]



                                    161 ;   A     token index 
                                    162 ; output:
                                    163 ;   C     set need space 
                                    164 ;------------------------------------
      0005E1                        165 need_space:
      0005E1 A1 07            [ 1]  166 	cp a,#DELIM_LAST+1 
      0005E3 2B 0A            [ 1]  167 	jrmi 9$ 
      0005E5 A1 0B            [ 1]  168 	cp a,#SYMB_LAST+1 
      0005E7 2B 04            [ 1]  169 	jrmi 8$ 
      0005E9 A1 16            [ 1]  170 	cp a,#OP_REL_LAST+1 
      0005EB 2B 02            [ 1]  171 	jrmi 9$ 
      0005ED 99               [ 1]  172 8$: scf
      0005EE 81               [ 4]  173 	ret 
      0005EF 98               [ 1]  174 9$:	rcf 
      0005F0 81               [ 4]  175 	ret 
                                    176 
                                    177 ;-------------------------------------
                                    178 ; decompile tokens list 
                                    179 ; to original text line 
                                    180 ; input:
                                    181 ;   A      0 don't align line number 
                                    182 ;          !0 align it. 
                                    183 ;   line.addr start of line 
                                    184 ;   Y,basicptr  at first token 
                                    185 ;   count     stop position.
                                    186 ;------------------------------------
                           000001   187 	PSTR=1     ;  1 word 
                           000003   188 	ALIGN=3
                           000004   189 	LAST_BC=4
                           000005   190 	PREV_BC=5
                           000005   191 	VSIZE=5
      0005F1                        192 decompile::
      0005F1 3B 00 00         [ 1]  193 	push base 
      0005F4 35 0A 00 00      [ 1]  194 	mov base,#10
      0005F8                        195 	_vars VSIZE
      0005F8 52 05            [ 2]    1     sub sp,#VSIZE 
      0005FA 0F 04            [ 1]  196 	clr (LAST_BC,sp)
      0005FC 6B 03            [ 1]  197 	ld (ALIGN,sp),a 
      0005FE                        198 	_ldxz line.addr
      0005FE BE 33                    1     .byte 0xbe,line.addr 
      000600 FE               [ 2]  199 	ldw x,(x)
      000601 4F               [ 1]  200 	clr a ; unsigned conversion  
      000602 CD 00 00         [ 4]  201 	call itoa
      000605 0D 03            [ 1]  202 	tnz (ALIGN,sp)
      000607 27 05            [ 1]  203 	jreq 1$  
      000609 A6 05            [ 1]  204 	ld a,#5 
      00060B CD 05 4A         [ 4]  205 	call right_align 
      00060E CD 00 00         [ 4]  206 1$:	call puts 
      000611 CD 00 00         [ 4]  207 	call space
      000614                        208 	_ldyz basicptr 
      000614 90 BE 35                 1     .byte 0x90,0xbe,basicptr 
      000617                        209 decomp_loop:
      000617 7B 04            [ 1]  210 	ld a,(LAST_BC,sp)
      000619 6B 05            [ 1]  211 	ld (PREV_BC,sp),a 
      00061B                        212 	_ldaz count 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 66.
Hexadecimal [24-Bits]



      00061B B6 32                    1     .byte 0xb6,count 
      00061D 26 03            [ 1]  213 	jrne 0$
      00061F CC 06 D0         [ 2]  214 	jp decomp_exit 
      000622                        215 0$:	
      000622 72 5A 00 32      [ 1]  216 	dec count 
      000626                        217 	_next_token
      000626                          1         _get_char 
      000626 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000628 90 5C            [ 1]    2         incw y      ; 1 cy 
      00062A 4D               [ 1]  218 	tnz a 
      00062B 26 03            [ 1]  219 	jrne 1$
      00062D CC 06 D0         [ 2]  220 	jp decomp_exit   
      000630                        221 1$:	
      000630 6B 04            [ 1]  222 	ld (LAST_BC,sp),a 
      000632 A1 06            [ 1]  223 	cp a,#QUOTE_IDX 
      000634 26 03            [ 1]  224 	jrne 2$
      000636 CC 06 CA         [ 2]  225 	jp quoted_string 
      000639 A1 09            [ 1]  226 2$:	cp a,#VAR_IDX 
      00063B 26 03            [ 1]  227 	jrne 3$
      00063D CC 06 8B         [ 2]  228 	jp variable 
      000640 A1 23            [ 1]  229 3$:	cp a,#REM_IDX 
      000642 26 03            [ 1]  230 	jrne 4$
      000644 CC 06 BE         [ 2]  231 	jp comment 
      000647                        232 4$:	
      000647 A1 0A            [ 1]  233 	cp a,#STR_VAR_IDX 
      000649 26 03            [ 1]  234 	jrne 5$
      00064B CC 06 8B         [ 2]  235 	jp variable 
      00064E A1 07            [ 1]  236 5$:	cp a,#LITC_IDX 
      000650 26 10            [ 1]  237 	jrne 6$ 
      000652 A6 5C            [ 1]  238 	ld a,#'\ 
      000654 CD 00 00         [ 4]  239 	call putc 
      000657                        240 	_get_char 
      000657 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000659 90 5C            [ 1]    2         incw y      ; 1 cy 
      00065B                        241 	_decz count 
      00065B 3A 32                    1     .byte 0x3a,count 
      00065D CD 00 00         [ 4]  242 	call putc 
      000660 20 1C            [ 2]  243 	jra prt_space 
      000662 A1 08            [ 1]  244 6$:	cp a,#LITW_IDX 
      000664 26 02            [ 1]  245 	jrne 7$
      000666 20 3E            [ 2]  246 	jra lit_word
      000668                        247 7$:	
                                    248 ; print command,function or operator 	 
      000668 CD 05 B8         [ 4]  249 	call tok_to_name 
      00066B 4D               [ 1]  250 	tnz a 
      00066C 26 03            [ 1]  251 	jrne 9$
      00066E CC 06 D0         [ 2]  252 	jp decomp_exit
      000671                        253 9$:	
      000671 CD 00 00         [ 4]  254 	call puts
      000674 7B 04            [ 1]  255 	ld a,(LAST_BC,sp)
      000676 CD 05 E1         [ 4]  256 	call need_space 
      000679 25 03            [ 1]  257 	jrc prt_space
      00067B CC 06 17         [ 2]  258     jp decomp_loop 
      00067E                        259 prt_space:	
      00067E 90 F6            [ 1]  260 	ld a,(y)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 67.
Hexadecimal [24-Bits]



      000680 CD 05 E1         [ 4]  261 	call need_space 
      000683 24 03            [ 1]  262 	jrnc 1$ 
      000685 CD 00 00         [ 4]  263 	call space 
      000688 CC 06 17         [ 2]  264 1$:	jp decomp_loop
                                    265 ; print variable name 	
      00068B                        266 variable: ; VAR_IDX 
      00068B 90 F6            [ 1]  267 	ld a,(y)
      00068D A4 7F            [ 1]  268 	and a,#127 
      00068F CD 00 00         [ 4]  269 	call putc 
      000692 90 E6 01         [ 1]  270 	ld a,(1,y) 
      000695 CD 00 00         [ 4]  271 	call putc 
      000698 72 5A 00 32      [ 1]  272 	dec count 
      00069C 72 5A 00 32      [ 1]  273 	dec count   
      0006A0 72 A9 00 02      [ 2]  274 	addw y,#2
      0006A4 20 D8            [ 2]  275 	jra prt_space
                                    276 ; print literal integer  
      0006A6                        277 lit_word: ; LITW_IDX 
      0006A6                        278 	_get_word
      0006A6                          1         _get_addr
      0006A6 93               [ 1]    1         ldw x,y     ; 1 cy 
      0006A7 FE               [ 2]    2         ldw x,(x)   ; 2 cy 
      0006A8 72 A9 00 02      [ 2]    3         addw y,#2   ; 2 cy 
      0006AC CD 00 00         [ 4]  279 	call print_int
      0006AF 90 F6            [ 1]  280 	ld a,(y)
      0006B1 CD 05 E1         [ 4]  281 	call need_space
      0006B4 25 05            [ 1]  282 	jrc 1$ 
      0006B6 A6 08            [ 1]  283 	ld a,#BS 
      0006B8 CD 00 00         [ 4]  284 	call putc 
      0006BB CC 06 17         [ 2]  285 1$:	jp decomp_loop  	
                                    286 ; print comment	
      0006BE                        287 comment: ; REM_IDX 
      0006BE A6 27            [ 1]  288 	ld a,#''
      0006C0 CD 00 00         [ 4]  289 	call putc
      0006C3 93               [ 1]  290 	ldw x,y
      0006C4 CD 00 00         [ 4]  291 	call puts 
      0006C7 CC 06 D0         [ 2]  292 	jp decomp_exit 
                                    293 ; print quoted string 	
      0006CA                        294 quoted_string:	
      0006CA CD 05 65         [ 4]  295 	call prt_quote  
      0006CD CC 06 17         [ 2]  296 	jp decomp_loop 
                                    297 ; print \letter 	
                           000000   298 .if 0
                                    299 letter: 
                                    300 	ld a,#'\ 
                                    301 	call putc 
                                    302 	_get_char 
                                    303 	dec count   
                                    304 	call putc  
                                    305 	jp prt_space 
                                    306 .endif 
      0006D0                        307 decomp_exit: 
      0006D0 CD 00 00         [ 4]  308 	call new_line 
      0006D3                        309 	_drop VSIZE 
      0006D3 5B 05            [ 2]    1     addw sp,#VSIZE 
      0006D5 32 00 00         [ 1]  310 	pop base 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 68.
Hexadecimal [24-Bits]



      0006D8 81               [ 4]  311 	ret 
                                    312 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 69.
Hexadecimal [24-Bits]



                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2023  
                                      3 ; This file is part of pomme-1 
                                      4 ;
                                      5 ;     pomme-1 is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     pomme-1 is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with pomme-1.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 
                                     19 
                                     20 ;----------------------------------
                                     21 ;    file system 
                                     22 ; file header:
                                     23 ;   sign field:  2 bytes .ascii "PB" 
                                     24 ;   program size: 1 word 
                                     25 ;   file name: 12 bytes 
                                     26 ;      name is 11 charaters maximum to be zero terminated  
                                     27 ;   data: n bytes 
                                     28 ;  
                                     29 ;   file sector is 256 bytes, this is 
                                     30 ;   minimum allocation unit.   
                                     31 ;----------------------------------
                                     32 
                                     33     .module FILES
                                     34 
                                     35 	.area CODE 
                                     36 
                                     37 
                                     38 ;---------------------------------
                                     39 ;  files.asm macros 
                                     40 ;---------------------------------
                                     41 
                                     42 
                           005042    43 SIGNATURE="PB" 
                           005858    44 ERASED="XX" ; erased file, replace signature. 
                           000000    45 FILE_SIGN_FIELD = 0 ; signature offset 2 bytes 
                           000002    46 FILE_SIZE_FIELD = 2 ; size offset 2 bytes 
                           000004    47 FILE_NAME_FIELD = 4 ; file name 12 byte 
                           000010    48 FILE_HEADER_SIZE = 16 ; bytes 
                           000010    49 FILE_DATA= FILE_HEADER_SIZE ; data offset 
                           000100    50 FSECTOR_SIZE=256 ; file sector size  
                           00000C    51 FNAME_MAX_LEN=12 
                                     52 
                                     53 
                                     54 ;-------------------------------
                                     55 ; search a BASIC file in spi eeprom  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 70.
Hexadecimal [24-Bits]



                                     56 ; 
                                     57 ; The file name is identified 
                                     58 ; input:
                                     59 ;    x      *fname 
                                     60 ;    farptr   start address in file system 
                                     61 ; output: 
                                     62 ;    A        0 not found | 1 found
                                     63 ;    farptr   file address in eeprom   
                                     64 ;-------------------------------
                           000001    65 	FNAME=1 
                           000003    66 	YSAVE=FNAME+2 
                           000004    67 	VSIZE=YSAVE+1 
      0006D9                         68 search_file:
      0006D9                         69 	_vars VSIZE
      0006D9 52 04            [ 2]    1     sub sp,#VSIZE 
      0006DB 17 03            [ 2]   70 	ldw (YSAVE,sp),y  
      0006DD 1F 01            [ 2]   71 	ldw (FNAME,sp),x
      0006DF CD 08 36         [ 4]   72 	call first_file  
      0006E2 27 1B            [ 1]   73 1$: jreq 7$  
      0006E4 AE 00 60         [ 2]   74     ldw x,#file_header+FILE_NAME_FIELD
      0006E7 16 01            [ 2]   75 	ldw y,(FNAME,sp)
      0006E9 CD 00 00         [ 4]   76 	call strcmp 
      0006EC 27 0D            [ 1]   77 	jreq 4$ 
      0006EE AE 00 5C         [ 2]   78 	ldw x,#file_header 
      0006F1 CD 08 7D         [ 4]   79 	call skip_to_next
      0006F4 CD 08 3B         [ 4]   80 	call next_file 
      0006F7 27 06            [ 1]   81 	jreq 7$
      0006F9 20 E7            [ 2]   82 	jra 1$   
      0006FB                         83 4$: ; file found  
      0006FB A6 01            [ 1]   84 	ld a,#1 
      0006FD 20 01            [ 2]   85 	jra 8$  
      0006FF                         86 7$: ; not found 
      0006FF 4F               [ 1]   87 	clr a 
      000700                         88 8$:	
      000700 16 03            [ 2]   89 	ldw y,(YSAVE,sp)
      000702                         90 	_drop VSIZE 
      000702 5B 04            [ 2]    1     addw sp,#VSIZE 
      000704 81               [ 4]   91 	ret 
                                     92 
                                     93 ;-----------------------------------
                                     94 ; erase program file
                                     95 ; replace signature by "XX. 
                                     96 ; input:
                                     97 ;   farptr    file address in eeprom  
                                     98 ;-----------------------------------
      000705                         99 erase_file:
      000705 A6 58            [ 1]  100 	ld a,#'X 
      000707 AE 00 5C         [ 2]  101 	ldw x,#file_header
      00070A F7               [ 1]  102 	ld (x),a 
      00070B E7 01            [ 1]  103 	ld (1,x),a
      00070D A6 02            [ 1]  104 	ld a,#2 
      00070F CD 00 00         [ 4]  105 	call eeprom_write 
      000712 81               [ 4]  106 	ret 
                                    107 
                                    108 ;--------------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 71.
Hexadecimal [24-Bits]



                                    109 ; reclaim erased file space that 
                                    110 ; fit size 
                                    111 ; input:
                                    112 ;    X     minimum size to reclaim 
                                    113 ; output:
                                    114 ;    A     0 no fit | 1 fit found 
                                    115 ;    farptr   fit address 
                                    116 ;--------------------------------------
                           000001   117 	NEED=1
                           000003   118 	SMALL_FIT=NEED+2
                           000005   119 	YSAVE=SMALL_FIT+2 
                           000006   120 	VSIZE=YSAVE+1
      000713                        121 reclaim_space:
      000713                        122 	_vars VSIZE 
      000713 52 06            [ 2]    1     sub sp,#VSIZE 
      000715 17 05            [ 2]  123 	ldw (YSAVE,sp),y 
      000717 1F 01            [ 2]  124 	ldw (NEED,sp),x 
      000719 AE FF FF         [ 2]  125 	ldw x,#-1 
      00071C 1F 03            [ 2]  126 	ldw (SMALL_FIT,sp),x 
      00071E                        127 	_clrz farptr  
      00071E 3F 00                    1     .byte 0x3f, farptr 
      000720 5F               [ 1]  128 	clrw x
      000721                        129 	_strxz ptr16 
      000721 BF 00                    1     .byte 0xbf,ptr16 
      000723                        130 1$:	
      000723 CD 00 00         [ 4]  131 	call addr_to_page
      000726 A3 02 00         [ 2]  132 	cpw x,#512 
      000729 2A 29            [ 1]  133 	jrpl 7$ ; to end  
      00072B AE 00 10         [ 2]  134 	ldw x,#FILE_HEADER_SIZE
      00072E 90 AE 00 5C      [ 2]  135 	ldw y,#file_header
      000732 CD 00 00         [ 4]  136 	call eeprom_read 
      000735 AE 00 5C         [ 2]  137 	ldw x,#file_header  
      000738 FE               [ 2]  138 	ldw x,(x)
      000739 A3 58 58         [ 2]  139 	cpw x,#ERASED 
      00073C 27 05            [ 1]  140 	jreq 4$ 
      00073E CD 08 7D         [ 4]  141 3$:	call skip_to_next
      000741 20 E0            [ 2]  142 	jra 1$ 
      000743                        143 4$: ; check size 
      000743 AE 00 5C         [ 2]  144 	ldw x,#file_header  
      000746 EE 02            [ 2]  145 	ldw x,(FILE_SIZE_FIELD,x)
      000748 13 01            [ 2]  146 	cpw x,(NEED,sp)
      00074A 25 F2            [ 1]  147 	jrult 3$ 
      00074C 13 03            [ 2]  148 	cpw x,(SMALL_FIT,sp)
      00074E 22 EE            [ 1]  149 	jrugt 3$ 
      000750 1F 03            [ 2]  150 	ldw (SMALL_FIT,sp),x  
      000752 20 EA            [ 2]  151 	jra 3$ 
      000754                        152 7$: ; to end of file system 
      000754 4F               [ 1]  153 	clr a 
      000755 1E 03            [ 2]  154 	ldw x,(SMALL_FIT,sp)
      000757 A3 FF FF         [ 2]  155 	cpw x,#-1
      00075A 27 02            [ 1]  156 	jreq 9$ 
      00075C A6 01            [ 1]  157 	ld a,#1
      00075E                        158 9$:	
      00075E 16 05            [ 2]  159 	ldw y,(YSAVE,sp)
      000760                        160 	_drop VSIZE  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 72.
Hexadecimal [24-Bits]



      000760 5B 06            [ 2]    1     addw sp,#VSIZE 
      000762 81               [ 4]  161 	ret 
                                    162 
                                    163 ;--------------------------
                                    164 ; load file in RAM 
                                    165 ; input:
                                    166 ;   farptr   file address 
                                    167 ;   file_header   file header data 
                                    168 ;--------------------------
                           000001   169 	FSIZE=1
                           000003   170 	YSAVE=FSIZE+2
                           000004   171 	VSIZE=YSAVE+1
      000763                        172 load_file:
      000763                        173 	_vars VSIZE 
      000763 52 04            [ 2]    1     sub sp,#VSIZE 
      000765 17 03            [ 2]  174 	ldw (YSAVE,sp),y
      000767 AE 00 10         [ 2]  175 	ldw x,#FILE_HEADER_SIZE 
      00076A CD 08 87         [ 4]  176 	call incr_farptr 	
      00076D AE 00 5C         [ 2]  177 	ldw x,#file_header  
      000770 EE 02            [ 2]  178 	ldw x,(FILE_SIZE_FIELD,x)
      000772 1F 01            [ 2]  179 	ldw (FSIZE,sp),x 
      000774 90 CE 00 37      [ 2]  180 	ldw y,lomem 
      000778 CD 00 00         [ 4]  181 	call eeprom_read 
      00077B CE 00 37         [ 2]  182 	ldw x,lomem 
      00077E 72 FB 01         [ 2]  183 	addw x,(FSIZE,sp)
      000781                        184 	_strxz progend 
      000781 BF 3B                    1     .byte 0xbf,progend 
      000783                        185 	_strxz dvar_bgn
      000783 BF 3D                    1     .byte 0xbf,dvar_bgn 
      000785                        186 	_strxz dvar_end 
      000785 BF 3F                    1     .byte 0xbf,dvar_end 
      000787                        187 9$:
      000787 16 03            [ 2]  188 	ldw y,(YSAVE,sp)
      000789                        189 	_drop VSIZE 
      000789 5B 04            [ 2]    1     addw sp,#VSIZE 
      00078B 81               [ 4]  190 	ret 
                                    191 
                                    192 ;--------------------------------------
                                    193 ; save program file 
                                    194 ; input:
                                    195 ;    farptr     address in eeprom 
                                    196 ;    X          file name 
                                    197 ;--------------------------------------
                           000001   198 	TO_WRITE=1
                           000003   199 	DONE=TO_WRITE+2
                           000005   200 	FNAME=DONE+2 
                           000005   201 	XSAVE=FNAME
                           000007   202 	YSAVE=XSAVE+2 
                           000008   203 	VSIZE=YSAVE+1
      00078C                        204 save_file:
      00078C                        205 	_vars VSIZE 
      00078C 52 08            [ 2]    1     sub sp,#VSIZE 
      00078E 17 07            [ 2]  206 	ldw (YSAVE,sp),y 
      000790 1F 05            [ 2]  207 	ldw (FNAME,sp),x 
      000792 AE 00 5C         [ 2]  208 	ldw x,#file_header
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 73.
Hexadecimal [24-Bits]



      000795 A6 50            [ 1]  209 	ld a,#'P 
      000797 F7               [ 1]  210 	ld (x),a 
      000798 A6 42            [ 1]  211 	ld a,#'B 
      00079A E7 01            [ 1]  212 	ld (1,x),a
      00079C 90 CE 00 3B      [ 2]  213 	ldw y,progend 
      0007A0 72 B2 00 37      [ 2]  214 	subw y,lomem
      0007A4 EF 02            [ 2]  215 	ldw (FILE_SIZE_FIELD,X),y
      0007A6 17 01            [ 2]  216 	ldw (TO_WRITE,sp),y 
      0007A8 1C 00 04         [ 2]  217 	addw x,#FILE_NAME_FIELD 
      0007AB 16 05            [ 2]  218 	ldw y,(FNAME,sp)
      0007AD CD 00 00         [ 4]  219 	call strcpy 
      0007B0 A6 10            [ 1]  220 	ld a,#FILE_HEADER_SIZE
      0007B2 AE 00 5C         [ 2]  221 	ldw x,#file_header
      0007B5 6F 0F            [ 1]  222 	clr (FILE_HEADER_SIZE-1,x) ; in case name is longer that FNAME_MAX_LEN
      0007B7 CD 00 00         [ 4]  223 	call eeprom_write 
      0007BA AE 00 10         [ 2]  224 	ldw x,#FILE_HEADER_SIZE 
      0007BD CD 08 87         [ 4]  225 	call incr_farptr
      0007C0 CE 00 37         [ 2]  226 	ldw x,lomem 
      0007C3 1F 05            [ 2]  227 	ldw (XSAVE,sp),x 
      0007C5 AE 00 F0         [ 2]  228 	ldw x,#FSECTOR_SIZE-FILE_HEADER_SIZE 
      0007C8                        229 1$: 
      0007C8 13 01            [ 2]  230 	cpw x,(TO_WRITE,sp)
      0007CA 23 02            [ 2]  231 	jrule 2$ 
      0007CC 1E 01            [ 2]  232 	ldw x,(TO_WRITE,sp)
      0007CE 1F 03            [ 2]  233 2$: ldw (DONE,sp),x
      0007D0 9F               [ 1]  234 	ld a,xl 
      0007D1 1E 05            [ 2]  235 	ldw x,(XSAVE,sp)
      0007D3 CD 00 00         [ 4]  236 	call eeprom_write 
      0007D6 1E 03            [ 2]  237 	ldw x,(DONE,sp)
      0007D8 CD 08 87         [ 4]  238 	call incr_farptr
      0007DB 1E 01            [ 2]  239 	ldw x,(TO_WRITE,sp)
      0007DD 72 F0 03         [ 2]  240 	subw x,(DONE,sp)
      0007E0 1F 01            [ 2]  241 	ldw (TO_WRITE,sp),x 
      0007E2 27 0C            [ 1]  242 	jreq 9$ 
      0007E4 1E 05            [ 2]  243 	ldw x,(XSAVE,sp)
      0007E6 72 FB 03         [ 2]  244 	addw x,(DONE,sp)
      0007E9 1F 05            [ 2]  245 	ldw (XSAVE,sp),x 
      0007EB AE 01 00         [ 2]  246 	ldw x,#FSECTOR_SIZE
      0007EE 20 D8            [ 2]  247 	jra 1$ 
      0007F0                        248 9$:
      0007F0 16 07            [ 2]  249 	ldw y,(YSAVE,sp)
      0007F2                        250 	_drop VSIZE 
      0007F2 5B 08            [ 2]    1     addw sp,#VSIZE 
      0007F4 81               [ 4]  251 	ret 
                                    252 
                                    253 ;---------------------------
                                    254 ; search free page in eeprom 
                                    255 ; output:
                                    256 ;    A     0 no free | 1 free 
                                    257 ;    farptr  address free 
                                    258 ;---------------------------
      0007F5                        259 search_free:
      0007F5                        260 	_clrz farptr 
      0007F5 3F 00                    1     .byte 0x3f, farptr 
      0007F7 5F               [ 1]  261 	clrw x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 74.
Hexadecimal [24-Bits]



      0007F8                        262 	_strxz ptr16 
      0007F8 BF 00                    1     .byte 0xbf,ptr16 
      0007FA 90 AE 00 5C      [ 2]  263 1$:	ldw y,#file_header 
      0007FE AE 00 10         [ 2]  264 	ldw x,#FILE_HEADER_SIZE 
      000801 CD 00 00         [ 4]  265 	call eeprom_read 
      000804 AE 00 5C         [ 2]  266 	ldw x,#file_header
      000807 FE               [ 2]  267 	ldw x,(x)
      000808                        268 	_strxz acc16
      000808 BF 00                    1     .byte 0xbf,acc16 
      00080A AE FF FF         [ 2]  269 	ldw x,#-1 
      00080D C3 00 00         [ 2]  270 	cpw x,acc16 
      000810 27 21            [ 1]  271 	jreq 6$   ; erased page, take it 
      000812 AE 50 42         [ 2]  272 	ldw x,#SIGNATURE
      000815 C3 00 00         [ 2]  273 	cpw x,acc16 
      000818 27 08            [ 1]  274 	jreq 4$ 
      00081A AE 58 58         [ 2]  275 	ldw x,#ERASED
      00081D C3 00 00         [ 2]  276 	cpw x,acc16  
      000820 26 11            [ 1]  277 	jrne 6$ ; no "PB" or "XX" take it 
      000822                        278 4$: ; try next 
      000822 AE 00 5C         [ 2]  279 	ldw x,#file_header 
      000825 CD 08 7D         [ 4]  280 	call skip_to_next 
      000828 CD 00 00         [ 4]  281 	call addr_to_page 
      00082B A3 02 00         [ 2]  282 	cpw x,#512 
      00082E 2B CA            [ 1]  283 	jrmi 1$
      000830 4F               [ 1]  284 	clr a  
      000831 20 02            [ 2]  285 	jra 9$ 
      000833                        286 6$: ; found free 
      000833 A6 01            [ 1]  287 	ld a,#1
      000835                        288 9$:	
      000835 81               [ 4]  289 	ret 
                                    290 
                                    291 
                                    292 ;---------------------------------------
                                    293 ;  search first file 
                                    294 ;  input: 
                                    295 ;    none 
                                    296 ;  output:
                                    297 ;     A     0 none | 1 found 
                                    298 ;  farptr   file address 
                                    299 ;   pad     file header 
                                    300 ;-----------------------------------------
      000836                        301 first_file:
      000836                        302 	_clrz farptr 
      000836 3F 00                    1     .byte 0x3f, farptr 
      000838 5F               [ 1]  303 	clrw x 
      000839                        304 	_strxz ptr16 
      000839 BF 00                    1     .byte 0xbf,ptr16 
                                    305 ; search next file 
      00083B                        306 next_file: 
      00083B 90 89            [ 2]  307 	pushw y 
      00083D                        308 1$:	
      00083D CD 00 00         [ 4]  309 	call addr_to_page
      000840 A3 02 00         [ 2]  310 	cpw x,#512
      000843 2A 30            [ 1]  311 	jrpl 4$ 
      000845 AE 00 10         [ 2]  312 	ldw x,#FILE_HEADER_SIZE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 75.
Hexadecimal [24-Bits]



      000848 90 AE 00 5C      [ 2]  313 	ldw y,#file_header  
      00084C CD 00 00         [ 4]  314 	call eeprom_read 
      00084F AE 00 5C         [ 2]  315 	ldw x,#file_header
      000852 FE               [ 2]  316 	ldw x,(x) ; signature 
      000853                        317 	_strxz acc16 
      000853 BF 00                    1     .byte 0xbf,acc16 
      000855 AE 50 42         [ 2]  318 	ldw x,#SIGNATURE  
      000858 C3 00 00         [ 2]  319 	cpw x,acc16 
      00085B 27 1B            [ 1]  320 	jreq 8$  
      00085D AE FF FF         [ 2]  321 	ldw x,#-1 
      000860 C3 00 00         [ 2]  322 	cpw x,acc16 
      000863 27 10            [ 1]  323 	jreq 4$ ; end of files 	
      000865 AE 58 58         [ 2]  324 	ldw x,#ERASED 
      000868 C3 00 00         [ 2]  325 	cpw x,acc16 
      00086B 26 08            [ 1]  326 	jrne 4$ 
      00086D                        327 2$:
      00086D AE 00 5C         [ 2]  328 	ldw x,#file_header 
      000870 CD 08 7D         [ 4]  329 	call skip_to_next 
      000873 20 C8            [ 2]  330 	jra 1$ 
      000875                        331 4$: ; no more file 
      000875 4F               [ 1]  332 	clr a
      000876 20 02            [ 2]  333 	jra 9$  
      000878 A6 01            [ 1]  334 8$: ld a,#1 
      00087A                        335 9$: 	
      00087A 90 85            [ 2]  336 	popw y 
      00087C 81               [ 4]  337 	ret 
                                    338 
                                    339 ;----------------------------
                                    340 ;  skip to next program
                                    341 ;  in file system  
                                    342 ; input:
                                    343 ;     X       address of buffer containing file HEADER data 
                                    344 ;    farptr   actual program address in eeprom 
                                    345 ; output:
                                    346 ;    farptr   updated to next sector after program   
                                    347 ;----------------------------
      00087D                        348 skip_to_next:
      00087D EE 02            [ 2]  349 	ldw x,(FILE_SIZE_FIELD,x)
      00087F 1C 00 10         [ 2]  350 	addw x,#FILE_HEADER_SIZE 
      000882 1C 00 FF         [ 2]  351 	addw x,#FSECTOR_SIZE-1 
      000885 4F               [ 1]  352 	clr a 
      000886 97               [ 1]  353 	ld xl,a 
                                    354 
                                    355 ;----------------------
                                    356 ; input: 
                                    357 ;    X     increment 
                                    358 ; output:
                                    359 ;   farptr += X 
                                    360 ;---------------------
      000887                        361 incr_farptr:
      000887 72 BB 00 00      [ 2]  362 	addw x,ptr16 
      00088B                        363 	_strxz ptr16  
      00088B BF 00                    1     .byte 0xbf,ptr16 
      00088D 4F               [ 1]  364 	clr a 
      00088E C9 00 00         [ 1]  365 	adc a,farptr 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 76.
Hexadecimal [24-Bits]



      000891                        366 	_straz farptr 
      000891 B7 00                    1     .byte 0xb7,farptr 
      000893 81               [ 4]  367 	ret 
                                    368 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 77.
Hexadecimal [24-Bits]



                                      1 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                      2 ;;   pomme BASIC error messages 
                                      3 ;;   addresses indexed table 
                                      4 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                      5 
                                      6 
                                      7 	; macro to create err_msg table 
                                      8 	.macro _err_entry msg_addr, error_code 
                                      9 	.word msg_addr  
                                     10 	error_code==ERR_IDX 
                                     11 	ERR_IDX=ERR_IDX+1
                                     12 	.endm 
                                     13 
                           000000    14 	ERR_IDX=0
                                     15 
                                     16 ; array of pointers to 
                                     17 ; error_messages strings table.	
      000894                         18 err_msg_idx:  
                                     19 
      000894                         20 	_err_entry 0,ERR_NONE 
      000894 00 00                    1 	.word 0  
                           000000     2 	ERR_NONE==ERR_IDX 
                           000001     3 	ERR_IDX=ERR_IDX+1
      000896                         21 	_err_entry err_syntax,ERR_SYNTAX 
      000896 08 BA                    1 	.word err_syntax  
                           000001     2 	ERR_SYNTAX==ERR_IDX 
                           000002     3 	ERR_IDX=ERR_IDX+1
      000898                         22 	_err_entry err_gt32767,ERR_GT32767 
      000898 08 C1                    1 	.word err_gt32767  
                           000002     2 	ERR_GT32767==ERR_IDX 
                           000003     3 	ERR_IDX=ERR_IDX+1
      00089A                         23 	_err_entry err_gt255,ERR_GT255 
      00089A 08 C8                    1 	.word err_gt255  
                           000003     2 	ERR_GT255==ERR_IDX 
                           000004     3 	ERR_IDX=ERR_IDX+1
      00089C                         24 	_err_entry err_bad_branch,ERR_BAD_BRANCH 
      00089C 08 CD                    1 	.word err_bad_branch  
                           000004     2 	ERR_BAD_BRANCH==ERR_IDX 
                           000005     3 	ERR_IDX=ERR_IDX+1
      00089E                         25 	_err_entry err_bad_return,ERR_BAD_RETURN 
      00089E 08 D8                    1 	.word err_bad_return  
                           000005     2 	ERR_BAD_RETURN==ERR_IDX 
                           000006     3 	ERR_IDX=ERR_IDX+1
      0008A0                         26 	_err_entry err_bad_next,ERR_BAD_NEXT 
      0008A0 08 E3                    1 	.word err_bad_next  
                           000006     2 	ERR_BAD_NEXT==ERR_IDX 
                           000007     3 	ERR_IDX=ERR_IDX+1
      0008A2                         27 	_err_entry err_gt8_gosub,ERR_GOSUBS 
      0008A2 08 EC                    1 	.word err_gt8_gosub  
                           000007     2 	ERR_GOSUBS==ERR_IDX 
                           000008     3 	ERR_IDX=ERR_IDX+1
      0008A4                         28 	_err_entry err_gt8_fors, ERR_FORS 
      0008A4 08 F6                    1 	.word err_gt8_fors  
                           000008     2 	ERR_FORS==ERR_IDX 
                           000009     3 	ERR_IDX=ERR_IDX+1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 78.
Hexadecimal [24-Bits]



      0008A6                         29 	_err_entry err_end, ERR_END 
      0008A6 08 FE                    1 	.word err_end  
                           000009     2 	ERR_END==ERR_IDX 
                           00000A     3 	ERR_IDX=ERR_IDX+1
      0008A8                         30 	_err_entry err_mem_full, ERR_MEM_FULL
      0008A8 09 02                    1 	.word err_mem_full  
                           00000A     2 	ERR_MEM_FULL==ERR_IDX 
                           00000B     3 	ERR_IDX=ERR_IDX+1
      0008AA                         31 	_err_entry err_too_long, ERR_TOO_LONG 
      0008AA 09 0B                    1 	.word err_too_long  
                           00000B     2 	ERR_TOO_LONG==ERR_IDX 
                           00000C     3 	ERR_IDX=ERR_IDX+1
      0008AC                         32 	_err_entry err_dim, ERR_DIM 
      0008AC 09 14                    1 	.word err_dim  
                           00000C     2 	ERR_DIM==ERR_IDX 
                           00000D     3 	ERR_IDX=ERR_IDX+1
      0008AE                         33 	_err_entry err_range, ERR_RANGE 
      0008AE 09 18                    1 	.word err_range  
                           00000D     2 	ERR_RANGE==ERR_IDX 
                           00000E     3 	ERR_IDX=ERR_IDX+1
      0008B0                         34 	_err_entry err_str_ovfl, ERR_STR_OVFL 
      0008B0 09 1E                    1 	.word err_str_ovfl  
                           00000E     2 	ERR_STR_OVFL==ERR_IDX 
                           00000F     3 	ERR_IDX=ERR_IDX+1
      0008B2                         35 	_err_entry err_string, ERR_STRING 
      0008B2 09 27                    1 	.word err_string  
                           00000F     2 	ERR_STRING==ERR_IDX 
                           000010     3 	ERR_IDX=ERR_IDX+1
      0008B4                         36 	_err_entry err_retype, ERR_RETYPE 
      0008B4 09 2E                    1 	.word err_retype  
                           000010     2 	ERR_RETYPE==ERR_IDX 
                           000011     3 	ERR_IDX=ERR_IDX+1
      0008B6                         37 	_err_entry err_prog_only, ERR_PROG_ONLY  
      0008B6 09 3A                    1 	.word err_prog_only  
                           000011     2 	ERR_PROG_ONLY==ERR_IDX 
                           000012     3 	ERR_IDX=ERR_IDX+1
      0008B8                         38 	_err_entry err_div0, ERR_DIV0 
      0008B8 09 47                    1 	.word err_div0  
                           000012     2 	ERR_DIV0==ERR_IDX 
                           000013     3 	ERR_IDX=ERR_IDX+1
                                     39 
                                     40 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                     41 ; error messages strings table 
                                     42 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      0008BA                         43 error_messages: 
                                     44 
      0008BA 53 59 4E 54 41 58 00    45 err_syntax: .asciz "SYNTAX"
      0008C1 3E 33 32 37 36 37 00    46 err_gt32767: .asciz ">32767" 
      0008C8 3E 32 35 35 00          47 err_gt255: .asciz ">255" 
      0008CD 42 41 44 20 42 52 41    48 err_bad_branch: .asciz "BAD BRANCH" 
             4E 43 48 00
      0008D8 42 41 44 20 52 45 54    49 err_bad_return: .asciz "BAD RETURN" 
             55 52 4E 00
      0008E3 42 41 44 20 4E 45 58    50 err_bad_next: .asciz "BAD NEXT" 
             54 00
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 79.
Hexadecimal [24-Bits]



      0008EC 3E 38 20 47 4F 53 55    51 err_gt8_gosub: .asciz ">8 GOSUBS"  
             42 53 00
      0008F6 3E 38 20 46 4F 52 53    52 err_gt8_fors: .asciz ">8 FORS" 
             00
      0008FE 45 4E 44 00             53 err_end: .asciz "END" 
      000902 4D 45 4D 20 46 55 4C    54 err_mem_full: .asciz "MEM FULL" 
             4C 00
      00090B 54 4F 4F 20 4C 4F 4E    55 err_too_long: .asciz "TOO LONG" 
             47 00
      000914 44 49 4D 00             56 err_dim: .asciz "DIM" 
      000918 52 41 4E 47 45 00       57 err_range: .asciz "RANGE"
      00091E 53 54 52 20 4F 56 46    58 err_str_ovfl: .asciz "STR OVFL" 
             4C 00
      000927 53 54 52 49 4E 47 00    59 err_string: .asciz "STRING" 
      00092E 52 45 54 59 50 45 20    60 err_retype: .asciz "RETYPE LINE" 
             4C 49 4E 45 00
      00093A 50 52 4F 47 52 41 4D    61 err_prog_only: .asciz "PROGRAM ONLY" 
             20 4F 4E 4C 59 00
      000947 44 49 56 20 42 59 20    62 err_div0: .asciz "DIV BY 0" 
             30 00
                                     63 
                                     64 ;-------------------------------------
      000950 0A 72 75 6E 20 74 69    65 rt_msg: .asciz "\nrun time error, "
             6D 65 20 65 72 72 6F
             72 2C 20 00
      000962 0A 63 6F 6D 70 69 6C    66 comp_msg: .asciz "\ncompile error, "
             65 20 65 72 72 6F 72
             2C 20 00
      000973 2A 2A 2A 20 00          67 err_stars: .asciz "*** " 
      000978 20 45 52 52 4F 52 20    68 err_err: .asciz " ERROR \n" 
             0A 00
                                     69 
      000981                         70 syntax_error::
      000981 A6 01            [ 1]   71 	ld a,#ERR_SYNTAX 
      000983                         72 tb_error::
      000983 72 0A 00 43 19   [ 2]   73 	btjt flags,#FCOMP,1$
      000988 88               [ 1]   74 	push a 
      000989 AE 09 50         [ 2]   75 	ldw x, #rt_msg 
      00098C CD 00 00         [ 4]   76 	call puts
      00098F 84               [ 1]   77 0$:	pop a 
      000990 AD 35            [ 4]   78 	callr print_err_msg
      000992 72 B2 00 33      [ 2]   79 	subw y, line.addr 
      000996 90 9F            [ 1]   80 	ld a,yl 
      000998 A0 03            [ 1]   81 	sub a,#LINE_HEADER_SIZE 
      00099A                         82 	_ldxz line.addr 
      00099A BE 33                    1     .byte 0xbe,line.addr 
      00099C CD 12 0D         [ 4]   83 	call prt_basic_line
      00099F 20 1F            [ 2]   84 	jra 6$
      0009A1                         85 1$:	
      0009A1 88               [ 1]   86 	push a 
      0009A2 AE 09 62         [ 2]   87 	ldw x,#comp_msg
      0009A5 CD 00 00         [ 4]   88 	call puts 
      0009A8 84               [ 1]   89 	pop a 
      0009A9 AD 1C            [ 4]   90 	callr print_err_msg
      0009AB AE 00 00         [ 2]   91 	ldw x,#tib
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 80.
Hexadecimal [24-Bits]



      0009AE CD 00 00         [ 4]   92 	call puts 
      0009B1 A6 0D            [ 1]   93 	ld a,#CR 
      0009B3 CD 00 00         [ 4]   94 	call putc
      0009B6                         95 	_ldxz in.w
      0009B6 BE 30                    1     .byte 0xbe,in.w 
      0009B8 CD 00 00         [ 4]   96 	call spaces
      0009BB A6 5E            [ 1]   97 	ld a,#'^
      0009BD CD 00 00         [ 4]   98 	call putc 
      0009C0                         99 6$:
      0009C0 AE 17 FF         [ 2]  100 	ldw x,#STACK_EMPTY 
      0009C3 94               [ 1]  101     ldw sp,x
      0009C4 CC 0A B2         [ 2]  102 	jp warm_start 
                                    103 	
                                    104 ;------------------------
                                    105 ; print error message 
                                    106 ; input:
                                    107 ;    A   error code 
                                    108 ; output:
                                    109 ;	 none 
                                    110 ;------------------------
      0009C7                        111 print_err_msg:
      0009C7 88               [ 1]  112 	push a 
      0009C8 AE 09 73         [ 2]  113 	ldw x,#err_stars 
      0009CB CD 00 00         [ 4]  114 	call puts
      0009CE 84               [ 1]  115 	pop a 
      0009CF 5F               [ 1]  116 	clrw x 
      0009D0 97               [ 1]  117 	ld xl,a 
      0009D1 58               [ 2]  118 	sllw x 
      0009D2 1C 08 94         [ 2]  119 	addw x,#err_msg_idx 
      0009D5 FE               [ 2]  120 	ldw x,(x)
      0009D6 CD 00 00         [ 4]  121 	call puts 
      0009D9 AE 09 78         [ 2]  122 	ldw x,#err_err 
      0009DC CD 00 00         [ 4]  123 	call puts 
      0009DF 81               [ 4]  124 	ret 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 81.
Hexadecimal [24-Bits]



                                      1 ;;
                                      2 ; Copyright Jacques Deschênes 2019,2022,2023  
                                      3 ; This file is part of p1Basic 
                                      4 ;
                                      5 ;     p1Basic is free software: you can redistribute it and/or modify
                                      6 ;     it under the terms of the GNU General Public License as published by
                                      7 ;     the Free Software Foundation, either version 3 of the License, or
                                      8 ;     (at your option) any later version.
                                      9 ;
                                     10 ;     p1Basic is distributed in the hope that it will be useful,
                                     11 ;     but WITHOUT ANY WARRANTY; without even the implied warranty of
                                     12 ;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                                     13 ;     GNU General Public License for more details.
                                     14 ;
                                     15 ;     You should have received a copy of the GNU General Public License
                                     16 ;     along with p1Basic.  If not, see <http://www.gnu.org/licenses/>.
                                     17 ;;
                                     18 
                                     19 ;--------------------------------------
                                     20 ;   Implementation of Tiny BASIC
                                     21 ;   REF: https://en.wikipedia.org/wiki/Li-Chen_Wang#Palo_Alto_Tiny_BASIC
                                     22 ;   Palo Alto BASIC is 4th version of TinyBasic
                                     23 ;   DATE: 2019-12-17
                                     24 ;
                                     25 ;--------------------------------------------------
                                     26 ;     implementation information
                                     27 ;
                                     28 ; *  integer are 16 bits two's complement  
                                     29 ;
                                     30 ; *  register Y is used as basicptr    
                                     31 ; 
                                     32 ;    IMPORTANT: when a routine use Y it must preserve 
                                     33 ;               its content and restore it at exit.
                                     34 ;               This hold only when BASIC is running  
                                     35 ;               
                                     36 ; *  BASIC function return their value registers 
                                     37 ;    A character 
                                     38 ;	 X integer || address 
                                     39 ; 
                                     40 ;  * variables return their value in X 
                                     41 ;
                                     42 ;--------------------------------------------------- 
                                     43 
                                     44 
                                     45     .module P1_BASIC 
                                     46 
                                     47 	.area CODE 
                                     48 
                                     49 
                                     50 
                                     51 ;---------------------------------------
                                     52 ;   BASIC configuration parameters
                                     53 ;---------------------------------------
                           001500    54 MAX_CODE_SIZE=5376 ; 42*BLOCK_SIZE multiple of BLOCK_SIZE=128 bytes  
                           000080    55 MIN_VAR_SIZE=BLOCK_SIZE ; FREE_RAM-MAX_CODE_SIZE 128 bytes 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 82.
Hexadecimal [24-Bits]



                           000010    56 PENDING_STACK_SIZE= 16 ; pending operation stack 
                                     57 
                                     58 ;--------------------------------------
                                     59     .area APP_DATA (ABS)
      000030                         60 	.org APP_DATA_ORG 
                                     61 ;--------------------------------------	
                                     62 
                                     63 ; keep the following 3 variables in this order 
      000030                         64 in.w::  .blkb 1 ; used by compiler 
      000031                         65 in::    .blkb 1 ; low byte of in.w 
      000032                         66 count:: .blkb 1 ; current BASIC line length and tib text length  
      000033                         67 line.addr:: .blkw 1 ; BASIC line start at this address. 
      000035                         68 basicptr::  .blkw 1  ; BASIC interperter program pointer.
                                     69 ;data_line:: .blkw 1  ; data line address 
                                     70 ;data_ptr:  .blkw 1  ; point to DATA in line 
      000037                         71 lomem:: .blkw 1 ; tokenized BASIC area beginning address 
      000039                         72 himem:: .blkw 1 ; tokenized BASIC area end before this address 
      00003B                         73 progend:: .blkw 1 ; address end of BASIC program 
      00003D                         74 dvar_bgn:: .blkw 1 ; DIM variables start address 
      00003F                         75 dvar_end:: .blkw 1 ; DIM variables end address 
      000041                         76 heap_free:: .blkw 1 ; free RAM growing down from tib 
      000043                         77 flags:: .blkb 1 ; various boolean flags
      000044                         78 auto_line: .blkw 1 ; automatic line number  
      000046                         79 auto_step: .blkw 1 ; automatic lein number increment 
                                     80 ; chain_level: .blkb 1 ; increment for each CHAIN command 
      000048                         81 for_nest: .blkb 1 ; nesting level of FOR...NEXT , maximum 8 
      000049                         82 gosub_nest: .blkb 1 ; nesting level of GOSUB, maximum 8 
                                     83 ; pending stack is used by compiler to check syntax, like matching pair 
      00004A                         84 psp: .blkw 1 ; pending_stack pointer 
      00004C                         85 pending_stack: .blkb PENDING_STACK_SIZE ; pending operations stack 
      00005C                         86 file_header: .blkb FILE_HEADER_SIZE ; buffer to hold file header structure 
                                     87 
                                     88 ;------------------------------
                                     89 	.area APP_DATA
      000100                         90 	.org 0x100 
                                     91 ;-------------------------------
                                     92 ; BASIC programs compiled here
      000100                         93 free_ram: 
                                     94 
                                     95 
                                     96 	.area CODE 
                                     97 
                                     98 ;-----------------------
                                     99 ;  display POMME BASIC  
                                    100 ;  information 
                                    101 ;-----------------------
                           000001   102 	PB_MAJOR=1
                           000000   103 	PB_MINOR=0
                           00000F   104 	PB_REV=15
                                    105 		
      0009E0 70 6F 6D 6D 65 20 42   106 app_name: .asciz "pomme BASIC\n"
             41 53 49 43 0A 00
      0009ED 43 6F 70 79 72 69 67   107 pb_copyright: .asciz "Copyright, Jacques Deschenes 2023\n"
             68 74 2C 20 4A 61 63
             71 75 65 73 20 44 65
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 83.
Hexadecimal [24-Bits]



             73 63 68 65 6E 65 73
             20 32 30 32 33 0A 00
                                    108 
      000A10                        109 print_app_info:
      000A10 3B 00 00         [ 1]  110 	push base 
      000A13 35 0A 00 00      [ 1]  111 	mov base, #10 
                                    112 ; push app_info()
                                    113 ; parameters on stack 
      000A17 4B 0F            [ 1]  114 	push #PB_REV 
      000A19 4B 00            [ 1]  115 	push #PB_MINOR 
      000A1B 4B 01            [ 1]  116 	push #PB_MAJOR  
      000A1D AE 09 E0         [ 2]  117 	ldw x,#app_name  
      000A20 90 AE 09 ED      [ 2]  118 	ldw y,#pb_copyright 
      000A24 CD 00 00         [ 4]  119 	call app_info
      000A27                        120 	_drop 3
      000A27 5B 03            [ 2]    1     addw sp,#3 
      000A29 32 00 00         [ 1]  121 	pop base 
      000A2C 81               [ 4]  122 	ret
                                    123 
                                    124 ;------------------------------
                                    125 ;  les variables ne sont pas 
                                    126 ;  réinitialisées.
                                    127 ;-----------------------------
      000A2D                        128 warm_init:
      000A2D AE 00 00         [ 2]  129 	ldw x,#uart_putc 
      000A30 CF 00 00         [ 2]  130 	ldw out,x ; standard output   
      000A33                        131 	_clrz flags 
      000A33 3F 43                    1     .byte 0x3f, flags 
      000A35 35 0A 00 00      [ 1]  132 	mov base,#10 
      000A39                        133 	_rst_pending 
      000A39 AE 00 5C         [ 2]    1     ldw x,#pending_stack+PENDING_STACK_SIZE
      000A3C                          2     _strxz psp 
      000A3C BF 4A                    1     .byte 0xbf,psp 
      000A3E 81               [ 4]  134 	ret 
                                    135 
                                    136 ;---------------------------
                                    137 ; reset BASIC system variables 
                                    138 ; and clear BASIC program 
                                    139 ; variables  
                                    140 ;---------------------------
      000A3F                        141 reset_basic:
      000A3F 89               [ 2]  142 	pushw x 
      000A40 AE 01 00         [ 2]  143 	ldw x,#free_ram 
      000A43                        144 	_strxz lomem
      000A43 BF 37                    1     .byte 0xbf,lomem 
      000A45                        145 	_strxz progend  
      000A45 BF 3B                    1     .byte 0xbf,progend 
      000A47                        146 	_strxz dvar_bgn 
      000A47 BF 3D                    1     .byte 0xbf,dvar_bgn 
      000A49                        147 	_strxz dvar_end
      000A49 BF 3F                    1     .byte 0xbf,dvar_end 
      000A4B AE 00 00         [ 2]  148 	ldw x,#tib 
      000A4E                        149 	_strxz himem 
      000A4E BF 39                    1     .byte 0xbf,himem 
      000A50                        150 	_strxz heap_free 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 84.
Hexadecimal [24-Bits]



      000A50 BF 41                    1     .byte 0xbf,heap_free 
      000A52                        151 	_clrz flags
      000A52 3F 43                    1     .byte 0x3f, flags 
      000A54 5F               [ 1]  152 	clrw x 
      000A55                        153 	_strxz for_nest 
      000A55 BF 48                    1     .byte 0xbf,for_nest 
      000A57                        154 	_strxz psp 
      000A57 BF 4A                    1     .byte 0xbf,psp 
      000A59 A6 0A            [ 1]  155 	ld a,#10 
      000A5B                        156 	_straz auto_line 
      000A5B B7 44                    1     .byte 0xb7,auto_line 
      000A5D                        157 	_straz auto_step  
      000A5D B7 46                    1     .byte 0xb7,auto_step 
      000A5F 85               [ 2]  158 	popw x
      000A60 81               [ 4]  159 	ret 
                                    160 
      000A61                        161 P1BASIC:: 
                                    162 ; enable SPI for file system 
      000A61 CD 00 00         [ 4]  163 	call spi_enable 
                                    164 ; reset hardware stack 
      000A64 AE 17 FF         [ 2]  165     ldw x,#STACK_EMPTY 
      000A67 94               [ 1]  166     ldw sp,x 
      000A68 CD 0A 3F         [ 4]  167 	call reset_basic
                                    168 ; initialize operation pending stack 	
      000A6B                        169 	_rst_pending 
      000A6B AE 00 5C         [ 2]    1     ldw x,#pending_stack+PENDING_STACK_SIZE
      000A6E                          2     _strxz psp 
      000A6E BF 4A                    1     .byte 0xbf,psp 
      000A70 CD 0A 10         [ 4]  170 	call print_app_info ; display BASIC information
      000A73 CD 1A EC         [ 4]  171 	call free 
                                    172 ; set ctrl_c_vector
      000A76 AE 0A 98         [ 2]  173 	ldw x,#ctrl_c_stop 
      000A79                        174 	_strxz ctrl_c_vector 
      000A79 BF 00                    1     .byte 0xbf,ctrl_c_vector 
                                    175 ; RND function seed 
                                    176 ; must be initialized 
                                    177 ; to value other than 0.
                                    178 ; take values from ROM space 
      000A7B CE 60 00         [ 2]  179 	ldw x,0x6000
      000A7E FE               [ 2]  180 	ldw x,(x)
      000A7F CF 00 00         [ 2]  181 	ldw seedy,x  
      000A82 CE 60 06         [ 2]  182 	ldw x,0x6006 
      000A85 FE               [ 2]  183 	ldw x,(x)
      000A86 CF 00 00         [ 2]  184 	ldw seedx,x  
      000A89 20 27            [ 2]  185 	jra warm_start 
                                    186 
      000A8B 0A 53 54 4F 50 50 45   187 ctrl_c_msg: .asciz "\nSTOPPED AT " 	
             44 20 41 54 20 00
                                    188 ;-------------------------------
                                    189 ; while a program is running 
                                    190 ; CTRL+C end program
                                    191 ;--------------------------- 
      000A98                        192 ctrl_c_stop: 
      000A98 AE 0A 8B         [ 2]  193 	ldw x,#ctrl_c_msg 
      000A9B CD 00 00         [ 4]  194 	call puts 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 85.
Hexadecimal [24-Bits]



      000A9E CE 00 33         [ 2]  195 	ldw x,line.addr 
      000AA1 FE               [ 2]  196 	ldw x,(x)
      000AA2 CD 00 00         [ 4]  197 	call print_int
      000AA5 CD 00 00         [ 4]  198 	call new_line 
      000AA8 AE 17 FF         [ 2]  199 	ldw x,#STACK_EMPTY 
      000AAB 94               [ 1]  200 	ldw sp,x
      000AAC 72 11 00 43      [ 1]  201 	bres flags,#FRUN
      000AB0 20 03            [ 2]  202 	jra cmd_line 
      000AB2                        203 warm_start:
      000AB2 CD 0A 2D         [ 4]  204 	call warm_init
                                    205 ;----------------------------
                                    206 ;   BASIC interpreter
                                    207 ;----------------------------
      000AB5                        208 cmd_line: ; user interface 
      000AB5 A6 0D            [ 1]  209 	ld a,#CR 
      000AB7 CD 00 00         [ 4]  210 	call putc 
      000ABA A6 3E            [ 1]  211 	ld a,#'> 
      000ABC CD 00 00         [ 4]  212 	call putc
      000ABF 4B 00            [ 1]  213 	push #0 
      000AC1 72 0D 00 43 17   [ 2]  214 	btjf flags,#FAUTO,1$ 
      000AC6                        215 	_ldxz auto_line 
      000AC6 BE 44                    1     .byte 0xbe,auto_line 
      000AC8 CD 00 00         [ 4]  216 	call itoa
      000ACB 6B 01            [ 1]  217 	ld (1,sp),a  
      000ACD 90 93            [ 1]  218 	ldw y,x 
      000ACF AE 00 00         [ 2]  219 	ldw x,#tib 
      000AD2 CD 00 00         [ 4]  220 	call strcpy 
      000AD5                        221 	_ldxz auto_line 
      000AD5 BE 44                    1     .byte 0xbe,auto_line 
      000AD7 72 BB 00 46      [ 2]  222 	addw x,auto_step 
      000ADB                        223 	_strxz auto_line
      000ADB BF 44                    1     .byte 0xbf,auto_line 
      000ADD 84               [ 1]  224 1$: pop a 
      000ADE CD 00 00         [ 4]  225 	call readln
      000AE1 4D               [ 1]  226 	tnz a 
      000AE2 27 D1            [ 1]  227 	jreq cmd_line
      000AE4 CD 04 B0         [ 4]  228 	call compile
      000AE7 4D               [ 1]  229 	tnz a 
      000AE8 27 CB            [ 1]  230 	jreq cmd_line ; not direct command
                                    231 
                                    232 ;; direct command 
                                    233 ;; interpret 
                                    234 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    235 ;; This is the interpreter loop
                                    236 ;; for each BASIC code line.
                                    237 ;; 10 cycles  
                                    238 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
      000AEA                        239 do_nothing: 
      000AEA                        240 interp_loop:   
      000AEA                        241     _next_cmd ; command bytecode, 2 cy  
      000AEA                          1         _get_char       ; 2 cy 
      000AEA 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000AEC 90 5C            [ 1]    2         incw y      ; 1 cy 
      000AEE                        242 	_jp_code ; 8 cy + 2 cy for jump back to interp_loop  
      000AEE                          1         _code_addr 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 86.
Hexadecimal [24-Bits]



      000AEE 5F               [ 1]    1         clrw x   ; 1 cy 
      000AEF 97               [ 1]    2         ld xl,a  ; 1 cy 
      000AF0 58               [ 2]    3         sllw x   ; 2 cy 
      000AF1 DE 00 00         [ 2]    4         ldw x,(code_addr,x) ; 2 cy 
      000AF4 FC               [ 2]    2         jp (x)
                                    243 
                                    244 ;---------------------
                                    245 ; BASIC: REM | ' 
                                    246 ; skip comment to end of line 
                                    247 ;---------------------- 
      000AF5                        248 kword_remark::
      000AF5 90 CE 00 33      [ 2]  249 	ldw y,line.addr 
      000AF9 90 E6 02         [ 1]  250 	ld a,(2,y) ; line length 
      000AFC                        251 	_straz in  
      000AFC B7 31                    1     .byte 0xb7,in 
      000AFE 72 B9 00 30      [ 2]  252 	addw y,in.w   
                                    253 
                                    254 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    255 ; move basicptr to first token 
                                    256 ; of next line 
                                    257 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      000B02                        258 next_line:
      000B02 72 01 00 43 AE   [ 2]  259 	btjf flags,#FRUN,cmd_line
      000B07 90 C3 00 3B      [ 2]  260 	cpw y,progend
      000B0B 2B 05            [ 1]  261 	jrmi 1$
      000B0D                        262 0$:
      000B0D A6 09            [ 1]  263 	ld a,#ERR_END 
      000B0F CC 09 83         [ 2]  264 	jp tb_error 
                                    265 ;	jp kword_end 
      000B12                        266 1$:	
      000B12                        267 	_stryz line.addr 
      000B12 90 BF 33                 1     .byte 0x90,0xbf,line.addr 
      000B15 72 A9 00 03      [ 2]  268 	addw y,#LINE_HEADER_SIZE
      000B19 72 0F 00 43 03   [ 2]  269 	btjf flags,#FTRACE,2$
      000B1E CD 0B 24         [ 4]  270 	call prt_line_no 
      000B21                        271 2$:	
      000B21                        272   _next 
      000B21 CC 0A EA         [ 2]    1         jp interp_loop 
                                    273 
                                    274 
                                    275 
                                    276 ;------------------------
                                    277 ; when TRACE is active 
                                    278 ; print line number to 
                                    279 ; be executed by VM
                                    280 ;------------------------
      000B24                        281 prt_line_no:
      000B24 72 CE 00 33      [ 5]  282 	ldw x,[line.addr] 
      000B28 CD 00 00         [ 4]  283 	call print_int 
      000B2B A6 0D            [ 1]  284 	ld a,#CR 
      000B2D CD 00 00         [ 4]  285 	call putc 
      000B30 81               [ 4]  286 	ret 
                                    287 
                                    288 
                                    289 ;-------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 87.
Hexadecimal [24-Bits]



                                    290 ;  skip .asciz in BASIC line 
                                    291 ;  name 
                                    292 ;  input:
                                    293 ;     x		* string 
                                    294 ;  output:
                                    295 ;     none 
                                    296 ;-------------------------
      000B31                        297 skip_string:
      000B31 90 F6            [ 1]  298 	ld a,(y)
      000B33 27 06            [ 1]  299 	jreq 8$
      000B35 90 5C            [ 1]  300 1$:	incw y
      000B37 90 F6            [ 1]  301 	ld a,(y)
      000B39 26 FA            [ 1]  302 	jrne 1$  
      000B3B 90 5C            [ 1]  303 8$: incw y
      000B3D 81               [ 4]  304 	ret 
                                    305 
                                    306 ;-------------------------------
                                    307 ; called when an intger token 
                                    308 ; is expected. can be LIT_IDX 
                                    309 ; or LITW_IDX 
                                    310 ; program fail if not integer 
                                    311 ;------------------------------
      000B3E                        312 expect_integer:
      000B3E                        313 	_next_token 
      000B3E                          1         _get_char 
      000B3E 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000B40 90 5C            [ 1]    2         incw y      ; 1 cy 
      000B42 A1 08            [ 1]  314 	cp a,#LITW_IDX 
      000B44 27 03            [ 1]  315 	jreq 0$
      000B46 CC 09 81         [ 2]  316 	jp syntax_error
      000B49                        317 0$:	_get_word 
      000B49                          1         _get_addr
      000B49 93               [ 1]    1         ldw x,y     ; 1 cy 
      000B4A FE               [ 2]    2         ldw x,(x)   ; 2 cy 
      000B4B 72 A9 00 02      [ 2]    3         addw y,#2   ; 2 cy 
      000B4F 81               [ 4]  318 	ret 
                                    319 
                                    320 
                                    321 ;--------------------------
                                    322 ; input:
                                    323 ;   A      character 
                                    324 ; output:
                                    325 ;   A      digit 
                                    326 ;   Cflag   1 ok, 0 failed 
                                    327 ; use:
                                    328 ;   base
                                    329 ;------------------------------   
      000B50                        330 char_to_digit:
      000B50 A0 30            [ 1]  331 	sub a,#'0
      000B52 2B 11            [ 1]  332 	jrmi 9$ 
      000B54 A1 0A            [ 1]  333 	cp a,#10
      000B56 2B 0B            [ 1]  334 	jrmi 5$
      000B58 A1 11            [ 1]  335 	cp a,#17 
      000B5A 2B 09            [ 1]  336 	jrmi 9$   
      000B5C A0 07            [ 1]  337 	sub a,#7 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 88.
Hexadecimal [24-Bits]



      000B5E C1 00 00         [ 1]  338 	cp a,base 
      000B61 2A 02            [ 1]  339 	jrpl 9$	 
      000B63 99               [ 1]  340 5$: scf ; ok 
      000B64 81               [ 4]  341 	ret 
      000B65 98               [ 1]  342 9$: rcf ; failed 
      000B66 81               [ 4]  343 	ret 
                                    344 
                                    345 ;------------------------------------
                                    346 ; convert pad content in integer
                                    347 ; input:
                                    348 ;    Y		* .asciz to convert
                                    349 ; output:
                                    350 ;    X        int16_t
                                    351 ;    Y        * .asciz after integer  
                                    352 ;    acc16    int16_t 
                                    353 ; use:
                                    354 ;   base 
                                    355 ;------------------------------------
                                    356 	; local variables
                           000001   357 	N=1 ; INT_SIZE  
                           000003   358 	DIGIT=N+INT_SIZE 
                           000005   359 	SIGN=DIGIT+INT_SIZE ; 1 byte, 
                           000005   360 	VSIZE=SIGN   
      000B67                        361 atoi16::
      000B67                        362 	_vars VSIZE
      000B67 52 05            [ 2]    1     sub sp,#VSIZE 
                                    363 ; conversion made on stack 
      000B69 35 0A 00 00      [ 1]  364 	mov base, #10 ; defaul conversion base 
      000B6D 0F 03            [ 1]  365 	clr (DIGIT,sp)
      000B6F 5F               [ 1]  366 	clrw x 
      000B70                        367 	_i16_store N   
      000B70 1F 01            [ 2]    1     ldw (N,sp),x 
      000B72 0F 05            [ 1]  368 	clr (SIGN,sp)
      000B74 90 F6            [ 1]  369 	ld a,(y)
      000B76 27 2B            [ 1]  370 	jreq 9$  ; completed if 0
      000B78 A1 2D            [ 1]  371 	cp a,#'-
      000B7A 26 04            [ 1]  372 	jrne 1$ 
      000B7C 03 05            [ 1]  373 	cpl (SIGN,sp)
      000B7E 20 08            [ 2]  374 	jra 2$
      000B80                        375 1$:  
      000B80 A1 24            [ 1]  376 	cp a,#'$ 
      000B82 26 0A            [ 1]  377 	jrne 3$ 
      000B84 35 10 00 00      [ 1]  378 	mov base,#16 ; hexadecimal base 
      000B88 90 5C            [ 1]  379 2$:	incw y
      000B8A 90 F6            [ 1]  380 	ld a,(y)
      000B8C 27 15            [ 1]  381 	jreq 9$ 
      000B8E                        382 3$:	; char to digit 
      000B8E CD 0B 50         [ 4]  383 	call char_to_digit
      000B91 24 10            [ 1]  384 	jrnc 9$
      000B93 6B 04            [ 1]  385 	ld (DIGIT+1,sp),a 
      000B95                        386 	_i16_fetch N  ; X=N 
      000B95 1E 01            [ 2]    1     ldw x,(N,sp)
      000B97                        387 	_ldaz base   
      000B97 B6 00                    1     .byte 0xb6,base 
      000B99 CD 00 00         [ 4]  388 	call umul16_8      
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 89.
Hexadecimal [24-Bits]



      000B9C 72 FB 03         [ 2]  389 	addw x,(DIGIT,sp)
      000B9F                        390 	_i16_store N  
      000B9F 1F 01            [ 2]    1     ldw (N,sp),x 
      000BA1 20 E5            [ 2]  391 	jra 2$
      000BA3                        392 9$:	_i16_fetch N
      000BA3 1E 01            [ 2]    1     ldw x,(N,sp)
      000BA5 0D 05            [ 1]  393 	tnz (SIGN,sp)
      000BA7 27 01            [ 1]  394     jreq 10$
      000BA9 50               [ 2]  395     negw x
      000BAA                        396 10$:
      000BAA                        397 	_strxz acc16  
      000BAA BF 00                    1     .byte 0xbf,acc16 
      000BAC                        398 	_drop VSIZE
      000BAC 5B 05            [ 2]    1     addw sp,#VSIZE 
      000BAE 81               [ 4]  399 	ret
                                    400 
                                    401 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    402 ;;   pomme BASIC  operators,
                                    403 ;;   commands and functions 
                                    404 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    405 
                                    406 ;---------------------------------
                                    407 ; dictionary search 
                                    408 ; input:
                                    409 ;	X 		dictionary entry point, name field  
                                    410 ;   y		.asciz name to search 
                                    411 ; output:
                                    412 ;  A		TOKEN_IDX  
                                    413 ;---------------------------------
                           000001   414 	NLEN=1 ; cmd length 
                           000003   415 	XSAVE=NLEN+2
                           000005   416 	YSAVE=XSAVE+2
                           000006   417 	VSIZE=YSAVE+1
      000BAF                        418 search_dict::
      000BAF                        419 	_vars VSIZE 
      000BAF 52 06            [ 2]    1     sub sp,#VSIZE 
      000BB1 0F 01            [ 1]  420 	clr (NLEN,sp)
      000BB3 17 05            [ 2]  421 	ldw (YSAVE,sp),y 
      000BB5                        422 search_next:
      000BB5 1F 03            [ 2]  423 	ldw (XSAVE,sp),x 
                                    424 ; get name length in dictionary	
      000BB7 F6               [ 1]  425 	ld a,(x)
      000BB8 6B 02            [ 1]  426 	ld (NLEN+1,sp),a  
      000BBA 16 05            [ 2]  427 	ldw y,(YSAVE,sp) ; name pointer 
      000BBC 5C               [ 1]  428 	incw x 
      000BBD CD 00 00         [ 4]  429 	call strcmp 
      000BC0 27 0C            [ 1]  430 	jreq str_match 
      000BC2                        431 no_match:
      000BC2 1E 03            [ 2]  432 	ldw x,(XSAVE,sp) 
      000BC4 1D 00 02         [ 2]  433 	subw x,#2 ; move X to link field
      000BC7 A6 FF            [ 1]  434 	ld a,#NONE_IDX   
      000BC9 FE               [ 2]  435 	ldw x,(x) ; next word link 
      000BCA 27 0B            [ 1]  436 	jreq search_exit  ; not found  
                                    437 ;try next 
      000BCC 20 E7            [ 2]  438 	jra search_next
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 90.
Hexadecimal [24-Bits]



      000BCE                        439 str_match:
      000BCE 1E 03            [ 2]  440 	ldw x,(XSAVE,sp)
      000BD0 72 FB 01         [ 2]  441 	addw x,(NLEN,sp)
                                    442 ; move x to token field 	
      000BD3 1C 00 02         [ 2]  443 	addw x,#2 ; to skip length byte and 0 at end  
      000BD6 F6               [ 1]  444 	ld a,(x) ; token index
      000BD7                        445 search_exit: 
      000BD7                        446 	_drop VSIZE 
      000BD7 5B 06            [ 2]    1     addw sp,#VSIZE 
      000BD9 81               [ 4]  447 	ret 
                                    448 
                                    449 
                                    450 ;---------------------
                                    451 ; check if next token
                                    452 ;  is of expected type 
                                    453 ; input:
                                    454 ;   A 		 expected token attribute
                                    455 ;  ouput:
                                    456 ;   none     if fail call syntax_error 
                                    457 ;--------------------
      000BDA                        458 expect:
      000BDA 88               [ 1]  459 	push a 
      000BDB                        460 	_next_token 
      000BDB                          1         _get_char 
      000BDB 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000BDD 90 5C            [ 1]    2         incw y      ; 1 cy 
      000BDF 11 01            [ 1]  461 	cp a,(1,sp)
      000BE1 27 03            [ 1]  462 	jreq 1$
      000BE3 CC 09 81         [ 2]  463 	jp syntax_error
      000BE6 84               [ 1]  464 1$: pop a 
      000BE7 81               [ 4]  465 	ret 
                                    466 
                                    467 ;;;;;;;;;;;;;;;;;;;;;;;;;;
                                    468 ; parse arguments list 
                                    469 ; between ()
                                    470 ;;;;;;;;;;;;;;;;;;;;;;;;;;
      000BE8                        471 func_args:
      000BE8                        472 	_next_token 
      000BE8                          1         _get_char 
      000BE8 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000BEA 90 5C            [ 1]    2         incw y      ; 1 cy 
      000BEC A1 04            [ 1]  473 	cp a,#LPAREN_IDX 
      000BEE 27 03            [ 1]  474 	jreq arg_list 
      000BF0 CC 09 81         [ 2]  475 	jp syntax_error 
                                    476 
                                    477 ; expected to continue in arg_list 
                                    478 ; caller must check for RPAREN_IDX 
                                    479 
                                    480 ;-------------------------------
                                    481 ; parse embedded BASIC routines 
                                    482 ; arguments list.
                                    483 ; arg_list::=  expr[','expr]*
                                    484 ; all arguments are of int24_t type
                                    485 ; and pushed on stack 
                                    486 ; input:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 91.
Hexadecimal [24-Bits]



                                    487 ;   none
                                    488 ; output:
                                    489 ;   stack{n}   arguments pushed on stack
                                    490 ;   A  	number of arguments pushed on stack  
                                    491 ;--------------------------------
                           000004   492 	ARGN=4 
                           000002   493 	ARG_SIZE=INT_SIZE 
      000BF3                        494 arg_list:
      000BF3 4B 00            [ 1]  495 	push #0 ; arguments counter
      000BF5 90 7D            [ 1]  496 	tnz (y)
      000BF7 27 1A            [ 1]  497 	jreq 7$ 
      000BF9                        498 1$:	 
      000BF9 84               [ 1]  499 	pop a 
      000BFA 85               [ 2]  500 	popw x 
      000BFB 52 02            [ 2]  501 	sub sp, #ARG_SIZE
      000BFD 89               [ 2]  502 	pushw x 
      000BFE 4C               [ 1]  503 	inc a 
      000BFF 88               [ 1]  504 	push a
      000C00 CD 0C E2         [ 4]  505 	call expression 
      000C03                        506 	_i16_store ARGN   
      000C03 1F 04            [ 2]    1     ldw (ARGN,sp),x 
      000C05                        507 	_next_token 
      000C05                          1         _get_char 
      000C05 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000C07 90 5C            [ 1]    2         incw y      ; 1 cy 
      000C09 A1 02            [ 1]  508 	cp a,#COMMA_IDX 
      000C0B 27 EC            [ 1]  509 	jreq 1$ 
      000C0D A1 05            [ 1]  510 	cp a,#RPAREN_IDX 
      000C0F 27 02            [ 1]  511 	jreq 7$ 
      000C11                        512 	_unget_token 
      000C11 90 5A            [ 2]    1         decw y
      000C13                        513 7$:	
      000C13 84               [ 1]  514 	pop a
      000C14 81               [ 4]  515 	ret  
                                    516 
                                    517 ;--------------------------------
                                    518 ;   BASIC commnands 
                                    519 ;--------------------------------
                                    520 
                                    521 ;----------------------------------
                                    522 ; BASIC: MULDIV(expr1,expr2,expr3)
                                    523 ; return expr1*expr2/expr3 
                                    524 ; product result is int32_t and 
                                    525 ; divisiont is int32_t/int16_t
                                    526 ;----------------------------------
                           000001   527 	ARG3=1
                           000003   528 	ARG2=ARG3+2
                           000005   529 	ARG1=ARG2+2
                           000007   530 	YSAVE=ARG1+2
                           000008   531 	VSIZE=YSAVE+1  
      000C15                        532 func_muldiv:
      000C15 90 89            [ 2]  533 	pushw y 
      000C17 CD 0B E8         [ 4]  534 	call func_args 
      000C1A 17 07            [ 2]  535 	ldw (YSAVE,sp),y 
      000C1C A1 03            [ 1]  536 	cp a,#3 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 92.
Hexadecimal [24-Bits]



      000C1E 27 03            [ 1]  537 	jreq 1$
      000C20 CC 09 81         [ 2]  538 	jp syntax_error
      000C23                        539 1$: 
      000C23 1E 05            [ 2]  540 	ldw x,(ARG1,sp) ; expr1
      000C25 16 03            [ 2]  541 	ldw y,(ARG2,sp) ; expr2
      000C27 CD 00 00         [ 4]  542 	call multiply 
      000C2A 1F 03            [ 2]  543 	ldw (ARG2,sp),x  ;int32_t 15..0
      000C2C 1E 01            [ 2]  544 	ldw x,(ARG3,sp)  ; divisor 
      000C2E 17 01            [ 2]  545 	ldw (ARG3,sp),y  ;int32_t 31..16
      000C30 CD 00 00         [ 4]  546 	call div32_16 ; int32_t/expr3 
      000C33 16 07            [ 2]  547 	ldw y,(YSAVE,sp)
      000C35                        548 	_drop VSIZE
      000C35 5B 08            [ 2]    1     addw sp,#VSIZE 
      000C37 81               [ 4]  549 	ret 
                                    550 
                                    551 ;--------------------------------
                                    552 ;  arithmetic and relational 
                                    553 ;  routines
                                    554 ;  operators precedence
                                    555 ;  highest to lowest
                                    556 ;  operators on same row have 
                                    557 ;  same precedence and are executed
                                    558 ;  from left to right.
                                    559 ;	'*','/','%'
                                    560 ;   '-','+'
                                    561 ;   '=','>','<','>=','<=','<>','><'
                                    562 ;   '<>' and '><' are equivalent for not equal.
                                    563 ;--------------------------------
                                    564 
                                    565 
                                    566 
                                    567 ;***********************************
                                    568 ;   expression parse,execute 
                                    569 ;***********************************
                                    570 
                                    571 ;-----------------------------------
                                    572 ; factor ::= ['+'|'-'|e]  var | @ |
                                    573 ;			 integer | function |
                                    574 ;			 '('expression')' 
                                    575 ; output:
                                    576 ;     X     factor value 
                                    577 ; ---------------------------------
                           000001   578 	NEG=1
                           000001   579 	VSIZE=1
      000C38                        580 factor:
      000C38                        581 	_vars VSIZE 
      000C38 52 01            [ 2]    1     sub sp,#VSIZE 
      000C3A 0F 01            [ 1]  582 	clr (NEG,sp)
      000C3C                        583 	_next_token
      000C3C                          1         _get_char 
      000C3C 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000C3E 90 5C            [ 1]    2         incw y      ; 1 cy 
      000C40 A1 01            [ 1]  584 	cp a,#CMD_END
      000C42 22 03            [ 1]  585 	jrugt 1$ 
      000C44 CC 09 81         [ 2]  586 	jp syntax_error
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 93.
Hexadecimal [24-Bits]



      000C47                        587 1$:
      000C47 A1 0B            [ 1]  588 	cp a,#ADD_IDX 
      000C49 27 06            [ 1]  589 	jreq 2$
      000C4B A1 0C            [ 1]  590 	cp a,#SUB_IDX 
      000C4D 26 06            [ 1]  591 	jrne 4$ 
      000C4F 03 01            [ 1]  592 	cpl (NEG,sp)
      000C51                        593 2$:	
      000C51                        594 	_next_token
      000C51                          1         _get_char 
      000C51 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000C53 90 5C            [ 1]    2         incw y      ; 1 cy 
      000C55                        595 4$:
      000C55 A1 08            [ 1]  596 	cp a,#LITW_IDX 
      000C57 26 08            [ 1]  597 	jrne 5$
      000C59                        598 	_get_word 
      000C59                          1         _get_addr
      000C59 93               [ 1]    1         ldw x,y     ; 1 cy 
      000C5A FE               [ 2]    2         ldw x,(x)   ; 2 cy 
      000C5B 72 A9 00 02      [ 2]    3         addw y,#2   ; 2 cy 
      000C5F 20 30            [ 2]  599 	jra 18$
      000C61                        600 5$: 
      000C61 A1 07            [ 1]  601 	cp a,#LITC_IDX 
      000C63 26 08            [ 1]  602 	jrne 6$
      000C65                        603 	_get_char 
      000C65 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000C67 90 5C            [ 1]    2         incw y      ; 1 cy 
      000C69 5F               [ 1]  604 	clrw x 
      000C6A 97               [ 1]  605 	ld xl,a
      000C6B 20 24            [ 2]  606 	jra 18$  	
      000C6D                        607 6$:
      000C6D A1 09            [ 1]  608 	cp a,#VAR_IDX 
      000C6F 26 09            [ 1]  609 	jrne 8$
      000C71 CD 0F 84         [ 4]  610 	call get_var_adr 
      000C74 CD 0F E3         [ 4]  611 	call get_array_adr 
      000C77 FE               [ 2]  612 	ldw x,(x)
      000C78 20 17            [ 2]  613 	jra 18$ 	
      000C7A                        614 8$:
      000C7A A1 04            [ 1]  615 	cp a,#LPAREN_IDX
      000C7C 26 0C            [ 1]  616 	jrne 10$
      000C7E CD 0C E2         [ 4]  617 	call expression
      000C81                        618 	_i16_push
      000C81 89               [ 2]    1     pushw X
      000C82 A6 05            [ 1]  619 	ld a,#RPAREN_IDX 
      000C84 CD 0B DA         [ 4]  620 	call expect
      000C87                        621 	_i16_pop 
      000C87 85               [ 2]    1     popw x 
      000C88 20 07            [ 2]  622 	jra 18$ 
      000C8A                        623 10$: ; must be a function 
      000C8A                        624 	_call_code
      000C8A                          1         _code_addr  ; 6 cy  
      000C8A 5F               [ 1]    1         clrw x   ; 1 cy 
      000C8B 97               [ 1]    2         ld xl,a  ; 1 cy 
      000C8C 58               [ 2]    3         sllw x   ; 2 cy 
      000C8D DE 00 00         [ 2]    4         ldw x,(code_addr,x) ; 2 cy 
      000C90 FD               [ 4]    2         call (x)    ; 4 cy 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 94.
Hexadecimal [24-Bits]



      000C91                        625 18$: 
      000C91 0D 01            [ 1]  626 	tnz (NEG,sp)
      000C93 27 01            [ 1]  627 	jreq 20$
      000C95 50               [ 2]  628 	negw x   
      000C96                        629 20$:
      000C96                        630 	_drop VSIZE
      000C96 5B 01            [ 2]    1     addw sp,#VSIZE 
      000C98 81               [ 4]  631 	ret
                                    632 
                                    633 
                                    634 ;-----------------------------------
                                    635 ; term ::= factor ['*'|'/'|'%' factor]* 
                                    636 ; output:
                                    637 ;   X    	term  value 
                                    638 ;-----------------------------------
                           000001   639 	N1=1 ; left operand   
                           000003   640 	YSAVE=N1+INT_SIZE   
                           000005   641 	MULOP=YSAVE+ADR_SIZE
                           000005   642 	VSIZE=INT_SIZE+ADR_SIZE+1    
      000C99                        643 term:
      000C99                        644 	_vars VSIZE
      000C99 52 05            [ 2]    1     sub sp,#VSIZE 
                                    645 ; first factor 	
      000C9B CD 0C 38         [ 4]  646 	call factor
      000C9E                        647 	_i16_store N1 ; left operand 
      000C9E 1F 01            [ 2]    1     ldw (N1,sp),x 
      000CA0                        648 term01:	 ; check for  operator '*'|'/'|'%' 
      000CA0                        649 	_next_token
      000CA0                          1         _get_char 
      000CA0 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000CA2 90 5C            [ 1]    2         incw y      ; 1 cy 
      000CA4 6B 05            [ 1]  650 	ld (MULOP,sp),a
      000CA6 A1 0D            [ 1]  651 	cp a,#DIV_IDX 
      000CA8 2B 04            [ 1]  652 	jrmi 0$ 
      000CAA A1 0F            [ 1]  653 	cp a,#MULT_IDX
      000CAC 23 04            [ 2]  654 	jrule 1$ 
      000CAE                        655 0$:	_unget_token
      000CAE 90 5A            [ 2]    1         decw y
      000CB0 20 2B            [ 2]  656 	jra term_exit 
      000CB2                        657 1$:	; got *|/|%
                                    658 ;second factor
      000CB2 CD 0C 38         [ 4]  659 	call factor
      000CB5 17 03            [ 2]  660 	ldw (YSAVE,sp),y ; save y 
      000CB7 16 01            [ 2]  661 	ldw y,(N1,sp)
                                    662 ; select operation 	
      000CB9 7B 05            [ 1]  663 	ld a,(MULOP,sp) 
      000CBB A1 0F            [ 1]  664 	cp a,#MULT_IDX 
      000CBD 26 09            [ 1]  665 	jrne 3$
                                    666 ; '*' operator
      000CBF CD 00 00         [ 4]  667 	call multiply
      000CC2 4D               [ 1]  668 	tnz a  
      000CC3 27 12            [ 1]  669 	jreq 5$
      000CC5 CC 09 83         [ 2]  670 	jp tb_error 
      000CC8 A1 0D            [ 1]  671 3$: cp a,#DIV_IDX 
      000CCA 26 06            [ 1]  672 	jrne 4$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 95.
Hexadecimal [24-Bits]



                                    673 ; '/' operator	
      000CCC 51               [ 1]  674 	exgw x,y 
      000CCD CD 00 00         [ 4]  675 	call divide 
      000CD0 20 05            [ 2]  676 	jra 5$ 
      000CD2                        677 4$: ; '%' operator
      000CD2 51               [ 1]  678 	exgw x,y 
      000CD3 CD 00 00         [ 4]  679 	call divide  
      000CD6 51               [ 1]  680 	exgw x,y 
      000CD7                        681 5$: 
      000CD7                        682 	_i16_store N1
      000CD7 1F 01            [ 2]    1     ldw (N1,sp),x 
      000CD9 16 03            [ 2]  683 	ldw y,(YSAVE,sp) 
      000CDB 20 C3            [ 2]  684 	jra term01 
      000CDD                        685 term_exit:
      000CDD                        686 	_i16_fetch N1
      000CDD 1E 01            [ 2]    1     ldw x,(N1,sp)
      000CDF                        687 	_drop VSIZE 
      000CDF 5B 05            [ 2]    1     addw sp,#VSIZE 
      000CE1 81               [ 4]  688 	ret 
                                    689 
                                    690 ;-------------------------------
                                    691 ;  expr ::= term [['+'|'-'] term]*
                                    692 ;  result range {-16777215..16777215}
                                    693 ;  output:
                                    694 ;     X   expression value     
                                    695 ;-------------------------------
                           000001   696 	N1=1 ;left operand 
                           000003   697 	YSAVE=N1+INT_SIZE ;   
                           000005   698 	OP=YSAVE+ADR_SIZE ; 1
                           000005   699 	VSIZE=INT_SIZE+ADR_SIZE+1
      000CE2                        700 expression:
      000CE2                        701 	_vars VSIZE 
      000CE2 52 05            [ 2]    1     sub sp,#VSIZE 
                                    702 ; first term 	
      000CE4 CD 0C 99         [ 4]  703 	call term
      000CE7                        704 	_i16_store N1 
      000CE7 1F 01            [ 2]    1     ldw (N1,sp),x 
      000CE9                        705 1$:	; operator '+'|'-'
      000CE9                        706 	_next_token
      000CE9                          1         _get_char 
      000CE9 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000CEB 90 5C            [ 1]    2         incw y      ; 1 cy 
      000CED 6B 05            [ 1]  707 	ld (OP,sp),a 
      000CEF A1 0B            [ 1]  708 	cp a,#ADD_IDX 
      000CF1 27 08            [ 1]  709 	jreq 2$
      000CF3 A1 0C            [ 1]  710 	cp a,#SUB_IDX 
      000CF5 27 04            [ 1]  711 	jreq 2$ 
      000CF7                        712 	_unget_token 
      000CF7 90 5A            [ 2]    1         decw y
      000CF9 20 1E            [ 2]  713 	jra 9$ 
      000CFB                        714 2$: ; second term 
      000CFB CD 0C 99         [ 4]  715 	call term
      000CFE 17 03            [ 2]  716 	ldw (YSAVE,sp),y 
      000D00 51               [ 1]  717 	exgw x,y 
      000D01                        718 	_i16_fetch N1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 96.
Hexadecimal [24-Bits]



      000D01 1E 01            [ 2]    1     ldw x,(N1,sp)
      000D03 17 01            [ 2]  719 	ldw (N1,sp),y ; right operand   
      000D05 7B 05            [ 1]  720 	ld a,(OP,sp)
      000D07 A1 0B            [ 1]  721 	cp a,#ADD_IDX 
      000D09 26 05            [ 1]  722 	jrne 4$
                                    723 ; '+' operator
      000D0B 72 FB 01         [ 2]  724 	ADDW X,(N1,SP)
      000D0E 20 03            [ 2]  725 	jra 5$ 
      000D10                        726 4$:	; '-' operator 
      000D10 72 F0 01         [ 2]  727 	SUBW X,(N1,SP)
      000D13                        728 5$:
      000D13                        729 	_i16_store N1
      000D13 1F 01            [ 2]    1     ldw (N1,sp),x 
      000D15 16 03            [ 2]  730 	ldw y,(YSAVE,sp)
      000D17 20 D0            [ 2]  731 	jra 1$
      000D19                        732 9$:
      000D19                        733 	_i16_fetch N1 
      000D19 1E 01            [ 2]    1     ldw x,(N1,sp)
      000D1B                        734 	_drop VSIZE 
      000D1B 5B 05            [ 2]    1     addw sp,#VSIZE 
      000D1D 81               [ 4]  735 	ret 
                                    736 
                                    737 ;---------------------------------------------
                                    738 ; rel ::= expr [rel_op expr]
                                    739 ; rel_op ::=  '=','<','>','>=','<=','<>','><'
                                    740 ;  relation return  integer , zero is false 
                                    741 ;  output:
                                    742 ;	 X		relation result   
                                    743 ;---------------------------------------------
                                    744   ; local variables
                           000001   745 	N1=1 ; left expression 
                           000003   746 	YSAVE=N1+INT_SIZE   
                           000005   747 	REL_OP=YSAVE+ADR_SIZE  ;  
                           000005   748 	VSIZE=INT_SIZE+ADR_SIZE+1 ; bytes  
      000D1E                        749 relation: 
      000D1E                        750 	_vars VSIZE
      000D1E 52 05            [ 2]    1     sub sp,#VSIZE 
      000D20 CD 0C E2         [ 4]  751 	call expression
      000D23                        752 	_i16_store N1 
      000D23 1F 01            [ 2]    1     ldw (N1,sp),x 
                                    753 ; expect rel_op or leave 
      000D25                        754 	_next_token 
      000D25                          1         _get_char 
      000D25 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000D27 90 5C            [ 1]    2         incw y      ; 1 cy 
      000D29 6B 05            [ 1]  755 	ld (REL_OP,sp),a 
      000D2B A1 10            [ 1]  756 	cp a,#REL_LE_IDX
      000D2D 2B 04            [ 1]  757 	jrmi 1$
      000D2F A1 15            [ 1]  758 	cp a,#OP_REL_LAST 
      000D31 23 04            [ 2]  759 	jrule 2$ 
      000D33                        760 1$:	_unget_token 
      000D33 90 5A            [ 2]    1         decw y
      000D35 20 3C            [ 2]  761 	jra 9$ 
      000D37                        762 2$:	; expect another expression
      000D37 CD 0C E2         [ 4]  763 	call expression
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 97.
Hexadecimal [24-Bits]



      000D3A 17 03            [ 2]  764 	ldw (YSAVE,sp),y 
      000D3C 51               [ 1]  765 	exgw x,y 
      000D3D                        766 	_i16_fetch N1
      000D3D 1E 01            [ 2]    1     ldw x,(N1,sp)
      000D3F 17 01            [ 2]  767 	ldw (N1,sp),y ; right expression  
      000D41 13 01            [ 2]  768 	cpw x,(N1,sp)
      000D43 2F 0A            [ 1]  769 	jrslt 4$
      000D45 26 14            [ 1]  770 	jrne 5$
                                    771 ; i1==i2 
      000D47 7B 05            [ 1]  772 	ld a,(REL_OP,sp)
      000D49 A1 13            [ 1]  773 	cp a,#REL_LT_IDX 
      000D4B 2A 21            [ 1]  774 	jrpl 7$ ; relation false 
      000D4D 20 1A            [ 2]  775 	jra 6$  ; relation true 
      000D4F                        776 4$: ; i1<i2
      000D4F 7B 05            [ 1]  777 	ld a,(REL_OP,sp)
      000D51 A1 13            [ 1]  778 	cp a,#REL_LT_IDX 
      000D53 27 14            [ 1]  779 	jreq 6$ ; relation true 
      000D55 A1 10            [ 1]  780 	cp a,#REL_LE_IDX 
      000D57 27 10            [ 1]  781 	jreq 6$  ; relation true
      000D59 20 0A            [ 2]  782 	jra 54$
      000D5B                        783 5$: ; i1>i2
      000D5B 7B 05            [ 1]  784 	ld a,(REL_OP,sp)
      000D5D A1 14            [ 1]  785 	cp a,#REL_GT_IDX 
      000D5F 27 08            [ 1]  786 	jreq 6$ ; relation true 
      000D61 A1 12            [ 1]  787 	cp a,#REL_GE_IDX 
      000D63 27 04            [ 1]  788 	jreq 6$ ; relation true 
      000D65                        789 54$:
      000D65 A1 15            [ 1]  790 	cp a,#REL_NE_IDX 
      000D67 26 05            [ 1]  791 	jrne 7$ ; relation false 
      000D69                        792 6$: ; TRUE  ; relation true 
      000D69 AE FF FF         [ 2]  793 	LDW X,#-1
      000D6C 20 01            [ 2]  794 	jra 8$ 
      000D6E                        795 7$:	; FALSE 
      000D6E 5F               [ 1]  796 	clrw x
      000D6F                        797 8$: 
      000D6F 16 03            [ 2]  798 	ldw y,(YSAVE,sp) 
      000D71 20 02            [ 2]  799 	jra 10$ 
      000D73                        800 9$:	
      000D73                        801 	_i16_fetch N1
      000D73 1E 01            [ 2]    1     ldw x,(N1,sp)
      000D75                        802 10$:
      000D75                        803 	_drop VSIZE
      000D75 5B 05            [ 2]    1     addw sp,#VSIZE 
      000D77 81               [ 4]  804 	ret 
                                    805 
                                    806 
                                    807 ;-------------------------------------------
                                    808 ;  AND factor:  [NOT] relation 
                                    809 ;  output:
                                    810 ;     X      boolean value 
                                    811 ;-------------------------------------------
                           000001   812 	NOT_OP=1
      000D78                        813 and_factor:
      000D78 4B 00            [ 1]  814 	push #0 
      000D7A                        815 0$:	_next_token  
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 98.
Hexadecimal [24-Bits]



      000D7A                          1         _get_char 
      000D7A 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000D7C 90 5C            [ 1]    2         incw y      ; 1 cy 
      000D7E A1 01            [ 1]  816 	cp a,#CMD_END 
      000D80 22 03            [ 1]  817 	jrugt 1$
      000D82 CC 09 81         [ 2]  818 	jp syntax_error
      000D85 A1 16            [ 1]  819 1$:	cp a,#NOT_IDX  
      000D87 26 04            [ 1]  820 	jrne 2$ 
      000D89 03 01            [ 1]  821 	cpl (NOT_OP,sp)
      000D8B 20 02            [ 2]  822 	jra 4$
      000D8D                        823 2$:
      000D8D                        824 	_unget_token 
      000D8D 90 5A            [ 2]    1         decw y
      000D8F                        825 4$:
      000D8F CD 0D 1E         [ 4]  826 	call relation
      000D92                        827 5$:	
      000D92 0D 01            [ 1]  828 	tnz (NOT_OP,sp)
      000D94 27 01            [ 1]  829 	jreq 8$
      000D96 53               [ 2]  830 	cplw x  
      000D97                        831 8$:
      000D97                        832 	_drop 1  
      000D97 5B 01            [ 2]    1     addw sp,#1 
      000D99 81               [ 4]  833     ret 
                                    834 
                                    835 
                                    836 ;--------------------------------------------
                                    837 ;  AND operator as priority over OR||XOR 
                                    838 ;  format: and_factor [AND and_factor]*
                                    839 ;          
                                    840 ;  output:
                                    841 ;    X      boolean value  
                                    842 ;--------------------------------------------
                           000001   843 	B1=1 
                           000002   844 	VSIZE=INT_SIZE 
      000D9A                        845 and_cond:
      000D9A                        846 	_vars VSIZE 
      000D9A 52 02            [ 2]    1     sub sp,#VSIZE 
      000D9C CD 0D 78         [ 4]  847 	call and_factor
      000D9F                        848 	_i16_store B1 
      000D9F 1F 01            [ 2]    1     ldw (B1,sp),x 
      000DA1                        849 1$: _next_token 
      000DA1                          1         _get_char 
      000DA1 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000DA3 90 5C            [ 1]    2         incw y      ; 1 cy 
      000DA5 A1 17            [ 1]  850 	cp a,#AND_IDX  
      000DA7 27 04            [ 1]  851 	jreq 3$  
      000DA9                        852 	_unget_token 
      000DA9 90 5A            [ 2]    1         decw y
      000DAB 20 0E            [ 2]  853 	jra 9$ 
      000DAD CD 0D 78         [ 4]  854 3$:	call and_factor  
      000DB0 02               [ 1]  855 	rlwa x 
      000DB1 14 01            [ 1]  856 	and a,(B1,sp)
      000DB3 02               [ 1]  857 	rlwa x 
      000DB4 14 02            [ 1]  858 	and a, (B1+1,sp)
      000DB6 02               [ 1]  859 	rlwa x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 99.
Hexadecimal [24-Bits]



      000DB7                        860 	_i16_store B1 
      000DB7 1F 01            [ 2]    1     ldw (B1,sp),x 
      000DB9 20 E6            [ 2]  861 	jra 1$  
      000DBB                        862 9$:	
      000DBB                        863 	_i16_fetch B1 
      000DBB 1E 01            [ 2]    1     ldw x,(B1,sp)
      000DBD                        864 	_drop VSIZE 
      000DBD 5B 02            [ 2]    1     addw sp,#VSIZE 
      000DBF 81               [ 4]  865 	ret 	 
                                    866 
                                    867 ;--------------------------------------------
                                    868 ; condition for IF and UNTIL 
                                    869 ; operators: OR
                                    870 ; format:  and_cond [ OP and_cond ]* 
                                    871 ; output:
                                    872 ;    stack   value 
                                    873 ;--------------------------------------------
                           000001   874 	B1=1 ; left bool 
                           000003   875 	OP=B1+INT_SIZE ; 1 bytes 
                           000003   876 	VSIZE=INT_SIZE+1
      000DC0                        877 condition:
      000DC0                        878 	_vars VSIZE 
      000DC0 52 03            [ 2]    1     sub sp,#VSIZE 
      000DC2 CD 0D 9A         [ 4]  879 	call and_cond
      000DC5                        880 	_i16_store B1
      000DC5 1F 01            [ 2]    1     ldw (B1,sp),x 
      000DC7                        881 1$:	_next_token 
      000DC7                          1         _get_char 
      000DC7 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000DC9 90 5C            [ 1]    2         incw y      ; 1 cy 
      000DCB A1 18            [ 1]  882 	cp a,#OR_IDX  
      000DCD 27 04            [ 1]  883 	jreq 2$
      000DCF                        884 	_unget_token 
      000DCF 90 5A            [ 2]    1         decw y
      000DD1 20 1B            [ 2]  885 	jra 9$ 
      000DD3 6B 03            [ 1]  886 2$:	ld (OP,sp),a ; boolean operator  
      000DD5 CD 0D 9A         [ 4]  887 	call and_cond
      000DD8 7B 03            [ 1]  888 	ld a,(OP,sp)
      000DDA                        889 4$: ; B1 = B1 OR X   
      000DDA 02               [ 1]  890 	rlwa x 
      000DDB 1A 01            [ 1]  891 	or a,(B1,SP)
      000DDD 02               [ 1]  892 	rlwa x 
      000DDE 1A 02            [ 1]  893 	or a,(B1+1,SP) 
      000DE0 02               [ 1]  894 	rlwa x 
      000DE1 20 07            [ 2]  895 	jra 6$  
      000DE3                        896 5$: ; B1 = B1 XOR X 
      000DE3 02               [ 1]  897 	RLWA X 
      000DE4 18 01            [ 1]  898 	XOR A,(B1,SP)
      000DE6 02               [ 1]  899 	RLWA X 
      000DE7 18 02            [ 1]  900 	XOR A,(B1+1,SP)
      000DE9 02               [ 1]  901 	RLWA X 
      000DEA                        902 6$: 
      000DEA                        903 	_i16_store B1 
      000DEA 1F 01            [ 2]    1     ldw (B1,sp),x 
      000DEC 20 D9            [ 2]  904 	jra 1$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 100.
Hexadecimal [24-Bits]



      000DEE                        905 9$:	 
      000DEE                        906 	_i16_fetch B1 ; result in X 
      000DEE 1E 01            [ 2]    1     ldw x,(B1,sp)
      000DF0                        907 	_drop VSIZE
      000DF0 5B 03            [ 2]    1     addw sp,#VSIZE 
      000DF2 81               [ 4]  908 	ret 
                                    909 
                                    910 ;-----------------------------
                                    911 ; BASIC: LET var=expr 
                                    912 ; variable assignement 
                                    913 ; output:
                                    914 ;-----------------------------
                           000001   915 	VAR_ADR=1  ; 2 bytes 
                           000003   916 	VALUE=VAR_ADR+2 ;INT_SIZE 
                           000004   917 	VSIZE=2*INT_SIZE 
      000DF3                        918 kword_let::
      000DF3                        919 	_vars VSIZE 
      000DF3 52 04            [ 2]    1     sub sp,#VSIZE 
      000DF5                        920 	_next_token ; VAR_IDX || STR_VAR_IDX 
      000DF5                          1         _get_char 
      000DF5 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000DF7 90 5C            [ 1]    2         incw y      ; 1 cy 
      000DF9 A1 09            [ 1]  921 	cp a,#VAR_IDX
      000DFB 27 09            [ 1]  922 	jreq let_int_var
      000DFD A1 0A            [ 1]  923 	cp a,#STR_VAR_IDX 
      000DFF 27 25            [ 1]  924 	jreq let_string
      000E01 CC 09 81         [ 2]  925 	jp syntax_error
      000E04                        926 kword_let2: 	
      000E04                        927 	_vars VSIZE 
      000E04 52 04            [ 2]    1     sub sp,#VSIZE 
      000E06                        928 let_int_var:
      000E06 CD 0F 84         [ 4]  929 	call get_var_adr  
      000E09 CD 0F E3         [ 4]  930 	call get_array_adr
      000E0C 1F 01            [ 2]  931 	ldw (VAR_ADR,sp),x 
      000E0E A6 11            [ 1]  932 	ld a,#REL_EQU_IDX 
      000E10 CD 0B DA         [ 4]  933 	call expect 
                                    934 ; var assignment 
      000E13 CD 0D C0         [ 4]  935 	call condition
      000E16                        936 	_i16_store VALUE
      000E16 1F 03            [ 2]    1     ldw (VALUE,sp),x 
      000E18 1E 01            [ 2]  937 	ldw x,(VAR_ADR,sp) 
      000E1A 7B 03            [ 1]  938 	ld a,(VALUE,sp)
      000E1C F7               [ 1]  939 	ld (x),a 
      000E1D 7B 04            [ 1]  940 	ld a,(VALUE+1,sp)
      000E1F E7 01            [ 1]  941 	ld (1,x),a 
      000E21                        942 9$: _drop VSIZE 	
      000E21 5B 04            [ 2]    1     addw sp,#VSIZE 
      000E23                        943 	_next  
      000E23 CC 0A EA         [ 2]    1         jp interp_loop 
                                    944 
                                    945 
                                    946 ;-----------------------
                                    947 ; BASIC: LET l$="string" 
                                    948 ;        ||  l$="string"
                                    949 ;------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 101.
Hexadecimal [24-Bits]



                           000001   950 	TEMP=1 ; temporary storage 
                           000003   951 	DEST_SIZE=TEMP+2 
                           000005   952 	DEST_ADR=DEST_SIZE+2  
                           000007   953 	DEST_LEN=DEST_ADR+2 
                           000009   954 	SRC_ADR=DEST_LEN+2 
                           00000B   955 	SIZE=SRC_ADR+2 
                           00000C   956 	VSIZE2=SIZE+1
      000E26                        957 let_string:
      000E26                        958 	_drop VSIZE
      000E26 5B 04            [ 2]    1     addw sp,#VSIZE 
      000E28                        959 let_string2:	 
      000E28                        960 	_vars VSIZE2 
      000E28 52 0C            [ 2]    1     sub sp,#VSIZE2 
      000E2A 0F 0B            [ 1]  961 	clr (SIZE,sp)
      000E2C 0F 03            [ 1]  962 	clr (DEST_SIZE,sp)
      000E2E 0F 07            [ 1]  963 	clr (DEST_LEN,sp)
      000E30 CD 0F 84         [ 4]  964 	call get_var_adr 
      000E33 1F 01            [ 2]  965 	ldw (TEMP,sp),x 
      000E35 EE 02            [ 2]  966 	ldw x,(2,x)
      000E37 F6               [ 1]  967 	ld a,(x) ; DIM size 
      000E38 5C               [ 1]  968 	incw x 
      000E39 1F 05            [ 2]  969 	ldw (DEST_ADR,sp),x 
      000E3B 6B 04            [ 1]  970 	ld (DEST_SIZE+1,sp),a 
      000E3D CD 00 00         [ 4]  971 	call strlen
      000E40 4C               [ 1]  972 	inc a  
      000E41 6B 08            [ 1]  973 	ld (DEST_LEN+1,sp),a 
      000E43 90 F6            [ 1]  974 	ld a,(y)
      000E45 A1 04            [ 1]  975 	cp a,#LPAREN_IDX 
      000E47 26 14            [ 1]  976 	jrne 3$ 
      000E49 CD 0C E2         [ 4]  977 	call expression 
      000E4C 13 07            [ 2]  978 	cpw x,(DEST_LEN,sp)
      000E4E 23 05            [ 2]  979 	jrule 2$
      000E50 A6 0E            [ 1]  980 	ld a,#ERR_STR_OVFL
      000E52 CC 09 83         [ 2]  981 	jp tb_error 
      000E55                        982 2$:  
      000E55 5A               [ 2]  983 	decw x 
      000E56 1F 01            [ 2]  984 	ldw (TEMP,sp),x 
      000E58 72 FB 05         [ 2]  985 	addw x,(DEST_ADR,sp)
      000E5B 1F 05            [ 2]  986 	ldw (DEST_ADR,sp),x
      000E5D                        987 3$: ; space left in string space 
      000E5D 1E 03            [ 2]  988 	ldw x,(DEST_SIZE,sp)
      000E5F 72 F0 01         [ 2]  989 	subw x,(TEMP,sp)
      000E62 1F 03            [ 2]  990 	ldw (DEST_SIZE,sp),x 
                                    991 ; left side of '=' evaluated 
                                    992 ; expect '=' 
      000E64 A6 11            [ 1]  993 	ld a,#REL_EQU_IDX 
      000E66 CD 0B DA         [ 4]  994 	call expect 
                                    995 ; evaluate right side 
                                    996 ; it may be:
                                    997 ;    string expression 
                                    998 ;    CHR$(expr) 
      000E69                        999 	_next_token 
      000E69                          1         _get_char 
      000E69 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      000E6B 90 5C            [ 1]    2         incw y      ; 1 cy 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 102.
Hexadecimal [24-Bits]



      000E6D A1 06            [ 1] 1000 	cp a,#QUOTE_IDX
      000E6F 26 1E            [ 1] 1001 	jrne 4$
      000E71 93               [ 1] 1002 	ldw x,y
      000E72 1F 09            [ 2] 1003 	ldw (SRC_ADR,sp),x  
      000E74 CD 00 00         [ 4] 1004 	call strlen  ; copy count 
      000E77 6B 0C            [ 1] 1005 	ld (SIZE+1,sp),a
      000E79 72 F9 0B         [ 2] 1006 	addw y,(SIZE,sp)
      000E7C 90 5C            [ 1] 1007 	incw y 
      000E7E 1E 03            [ 2] 1008 	ldw x,(DEST_SIZE,sp)
      000E80 13 0B            [ 2] 1009 	cpw x,(SIZE,sp) 
      000E82 24 05            [ 1] 1010 	jruge 1$ 
      000E84 A6 0E            [ 1] 1011 0$:	ld a,#ERR_STR_OVFL 
      000E86 CC 09 83         [ 2] 1012 	jp tb_error 
      000E89                       1013 1$: 
      000E89 1E 0B            [ 2] 1014 	ldw x,(SIZE,sp) 
      000E8B                       1015 	_strxz acc16 
      000E8B BF 00                    1     .byte 0xbf,acc16 
      000E8D 20 33            [ 2] 1016 	jra 5$ 
      000E8F                       1017 4$: 
                                   1018 	; VAR$ expression 
      000E8F A1 0A            [ 1] 1019 	cp a,#STR_VAR_IDX
      000E91 26 14            [ 1] 1020 	jrne 42$  
      000E93 CD 0F 84         [ 4] 1021 	call get_var_adr 
      000E96 CD 0E D6         [ 4] 1022 	call get_string_slice
      000E99 1F 09            [ 2] 1023 	ldw (SRC_ADR,sp),x   
      000E9B                       1024 	_clrz acc16 
      000E9B 3F 00                    1     .byte 0x3f, acc16 
      000E9D                       1025 	_straz acc8 
      000E9D B7 00                    1     .byte 0xb7,acc8 
      000E9F 6B 0C            [ 1] 1026 	ld (SIZE+1,sp),a 
      000EA1 11 04            [ 1] 1027 	cp a,(DEST_SIZE+1,sp)
      000EA3 22 DF            [ 1] 1028 	jrugt 0$
      000EA5 20 1B            [ 2] 1029 	jra 5$ 
      000EA7 A1 2E            [ 1] 1030 42$: cp a,#CHAR_IDX 
      000EA9 27 03            [ 1] 1031 	jreq 44$ 
      000EAB CC 09 81         [ 2] 1032 	jp syntax_error 
      000EAE                       1033 44$: _call_code 
      000EAE                          1         _code_addr  ; 6 cy  
      000EAE 5F               [ 1]    1         clrw x   ; 1 cy 
      000EAF 97               [ 1]    2         ld xl,a  ; 1 cy 
      000EB0 58               [ 2]    3         sllw x   ; 2 cy 
      000EB1 DE 00 00         [ 2]    4         ldw x,(code_addr,x) ; 2 cy 
      000EB4 FD               [ 4]    2         call (x)    ; 4 cy 
      000EB5 9F               [ 1] 1034 	ld a,xl 
      000EB6 A4 7F            [ 1] 1035 	and a,#127 
      000EB8 1E 05            [ 2] 1036 	ldw x,(DEST_ADR,sp)
      000EBA 7D               [ 1] 1037 	tnz (x)
      000EBB 26 02            [ 1] 1038 	jrne 46$ 
      000EBD 6F 01            [ 1] 1039 	clr (1,x)
      000EBF                       1040 46$:	
      000EBF F7               [ 1] 1041 	ld (x),a 
      000EC0 20 0F            [ 2] 1042 	jra 9$  
      000EC2                       1043 5$:
      000EC2 1E 05            [ 2] 1044 	ldw x,(DEST_ADR,sp) 
      000EC4 17 01            [ 2] 1045 	ldw (TEMP,sp),y ; save basic pc   
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 103.
Hexadecimal [24-Bits]



      000EC6 16 09            [ 2] 1046 	ldw y,(SRC_ADR,sp)
      000EC8 CD 00 00         [ 4] 1047 	call move 
      000ECB 72 FB 0B         [ 2] 1048 	addw x,(SIZE,sp)
      000ECE 7F               [ 1] 1049 	clr (x)
      000ECF                       1050 6$: 
      000ECF 16 01            [ 2] 1051 	ldw y,(TEMP,sp) ; restore basic pc 
      000ED1                       1052 9$:	_drop VSIZE2 
      000ED1 5B 0C            [ 2]    1     addw sp,#VSIZE2 
      000ED3                       1053 	_next 
      000ED3 CC 0A EA         [ 2]    1         jp interp_loop 
                                   1054 
                                   1055 ;----------------------
                                   1056 ; extract a slice 
                                   1057 ; from string variable
                                   1058 ; str(val1[,val2]) 
                                   1059 ; or complete string 
                                   1060 ; if no indices 
                                   1061 ; input:
                                   1062 ;   X     var_adr
                                   1063 ;   Y     point to (expr,expr)
                                   1064 ;   ptr16 destination
                                   1065 ; ouput:
                                   1066 ;   A    slice length 
                                   1067 ;   X    slice address   
                                   1068 ;----------------------
                           000001  1069 	VAL2=1 
                           000003  1070 	VAL1=VAL2+INT_SIZE 
                           000005  1071 	CHAR_ARRAY=VAL1+INT_SIZE 
                           000007  1072 	RES_LEN=CHAR_ARRAY+INT_SIZE  
                           000009  1073 	YTEMP=RES_LEN+INT_SIZE 
                           000008  1074 	VSIZE=4*INT_SIZE 
      000ED6                       1075 get_string_slice:
      000ED6                       1076 	_vars VSIZE
      000ED6 52 08            [ 2]    1     sub sp,#VSIZE 
      000ED8 0F 07            [ 1] 1077 	clr (RES_LEN,sp)
      000EDA EE 02            [ 2] 1078 	ldw x,(2,x) ; char array 
      000EDC 1F 05            [ 2] 1079 	ldw (CHAR_ARRAY,sp),x 
      000EDE F6               [ 1] 1080 	ld a,(x)
      000EDF 6B 08            [ 1] 1081 	ld (RES_LEN+1,sp),a ; reserved space  
                                   1082 ; default slice to entire string 
      000EE1 0F 03            [ 1] 1083 	clr (VAL1,sp)
      000EE3 A6 01            [ 1] 1084 	ld a,#1 
      000EE5 6B 04            [ 1] 1085 	ld (VAL1+1,sp),a
      000EE7 0F 01            [ 1] 1086 	clr (VAL2,sp)
      000EE9 5C               [ 1] 1087 	incw x 
      000EEA CD 00 00         [ 4] 1088 	call strlen
      000EED 6B 02            [ 1] 1089 	ld (VAL2+1,sp),a 
      000EEF 90 F6            [ 1] 1090 	ld a,(y)
      000EF1 A1 04            [ 1] 1091 	cp a,#LPAREN_IDX 
      000EF3 27 02            [ 1] 1092 	jreq 1$
      000EF5 20 32            [ 2] 1093 	jra 4$  
      000EF7                       1094 1$:  
      000EF7 90 5C            [ 1] 1095 	incw y 
      000EF9 CD 0C E2         [ 4] 1096 	call expression
      000EFC A3 00 01         [ 2] 1097 	cpw x,#1 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 104.
Hexadecimal [24-Bits]



      000EFF 2A 05            [ 1] 1098 	jrpl 2$ 
      000F01 A6 0E            [ 1] 1099 0$:	ld a,#ERR_STR_OVFL 
      000F03 CC 09 83         [ 2] 1100 	jp tb_error 
      000F06 13 01            [ 2] 1101 2$:	cpw x,(VAL2,sp)
      000F08 22 F7            [ 1] 1102 	jrugt 0$
      000F0A 1F 03            [ 2] 1103 	ldw (VAL1,sp),x 
      000F0C 90 F6            [ 1] 1104 	ld a,(y)
      000F0E A1 05            [ 1] 1105 	cp a,#RPAREN_IDX 
      000F10 26 04            [ 1] 1106 	jrne 3$
      000F12 90 5C            [ 1] 1107 	incw y 
      000F14 20 13            [ 2] 1108 	jra 4$
      000F16                       1109 3$: 
      000F16 A6 02            [ 1] 1110 	ld a,#COMMA_IDX 
      000F18 CD 0B DA         [ 4] 1111 	call expect 
      000F1B CD 0C E2         [ 4] 1112 	call expression 
      000F1E 13 01            [ 2] 1113 	cpw x,(VAL2,sp)
      000F20 22 DF            [ 1] 1114 	jrugt 0$ 
      000F22 1F 01            [ 2] 1115 	ldw (VAL2,sp),x
      000F24 A6 05            [ 1] 1116 	ld a,#RPAREN_IDX 
      000F26 CD 0B DA         [ 4] 1117 	call expect 
      000F29                       1118 4$: ; length and slice address 
      000F29 1E 01            [ 2] 1119 	ldw x,(VAL2,sp)
      000F2B 72 F0 03         [ 2] 1120 	subw x,(VAL1,sp)
      000F2E 5C               [ 1] 1121 	incw x 
      000F2F 9F               [ 1] 1122 	ld a,xl ; slice length 
      000F30 1E 05            [ 2] 1123 	ldw x,(CHAR_ARRAY,sp)
      000F32 72 FB 03         [ 2] 1124 	addw x,(VAL1,sp)
      000F35                       1125 	_drop VSIZE 
      000F35 5B 08            [ 2]    1     addw sp,#VSIZE 
      000F37 81               [ 4] 1126 	ret 
                                   1127 
                                   1128 
                                   1129 ;-----------------------
                                   1130 ; allocate data space 
                                   1131 ; on heap 
                                   1132 ; reserve to more bytes 
                                   1133 ; than required 
                                   1134 ; input: 
                                   1135 ;    X     size 
                                   1136 ; output:
                                   1137 ;    X     addr 
                                   1138 ;------------------------
      000F38                       1139 heap_alloc:
      000F38 1C 00 02         [ 2] 1140 	addw x,#2 
      000F3B 89               [ 2] 1141 	pushw x 
      000F3C CE 00 41         [ 2] 1142 	ldw x,heap_free 
      000F3F 72 B0 00 3F      [ 2] 1143 	subw x,dvar_end 
      000F43 13 01            [ 2] 1144 	cpw x,(1,sp)
      000F45 24 05            [ 1] 1145 	jruge 1$
      000F47 A6 0A            [ 1] 1146 	ld a,#ERR_MEM_FULL 
      000F49 CC 09 83         [ 2] 1147 	jp tb_error 
      000F4C CE 00 41         [ 2] 1148 1$: ldw x,heap_free 
      000F4F 72 F0 01         [ 2] 1149 	subw x,(1,sp)
      000F52                       1150 	_strxz heap_free 
      000F52 BF 41                    1     .byte 0xbf,heap_free 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 105.
Hexadecimal [24-Bits]



      000F54                       1151 	_drop 2 
      000F54 5B 02            [ 2]    1     addw sp,#2 
      000F56 81               [ 4] 1152 	ret 
                                   1153 
                                   1154 ;---------------------------
                                   1155 ; create scalar variable 
                                   1156 ; and initialize to 0.
                                   1157 ; abort program if mem full 
                                   1158 ; input:
                                   1159 ;   x    var_name 
                                   1160 ; output:
                                   1161 ;   x    var_addr 
                                   1162 ;-----------------------------
                           000001  1163 	VNAME=1 
                           000002  1164 	VSIZE=2 
      000F57                       1165 create_var:
      000F57                       1166 	_vars VSIZE 
      000F57 52 02            [ 2]    1     sub sp,#VSIZE 
      000F59 1F 01            [ 2] 1167 	ldw (VNAME,sp),x 
      000F5B CE 00 41         [ 2] 1168 	ldw x,heap_free 
      000F5E 72 B0 00 3F      [ 2] 1169 	subw x,dvar_end 
      000F62 A3 00 04         [ 2] 1170 	cpw x,#4 
      000F65 24 05            [ 1] 1171 	jruge 1$ 
      000F67 A6 0A            [ 1] 1172 	ld a,#ERR_MEM_FULL
      000F69 CC 09 83         [ 2] 1173 	jp tb_error 
      000F6C                       1174 1$: 
      000F6C CE 00 3F         [ 2] 1175 	ldw x,dvar_end 
      000F6F 7B 01            [ 1] 1176 	ld a,(VNAME,sp)
      000F71 F7               [ 1] 1177 	ld (x),a 
      000F72 7B 02            [ 1] 1178 	ld a,(VNAME+1,sp)
      000F74 E7 01            [ 1] 1179 	ld (1,x),a 
      000F76 6F 02            [ 1] 1180 	clr (2,x)
      000F78 6F 03            [ 1] 1181 	clr (3,x)
      000F7A 89               [ 2] 1182 	pushw x 
      000F7B 1C 00 04         [ 2] 1183 	addw x,#4 
      000F7E                       1184 	_strxz dvar_end 
      000F7E BF 3F                    1     .byte 0xbf,dvar_end 
      000F80 85               [ 2] 1185 	popw x ; var address 
      000F81                       1186 	_drop VSIZE  
      000F81 5B 02            [ 2]    1     addw sp,#VSIZE 
      000F83 81               [ 4] 1187 	ret 
                                   1188 
                                   1189 ;------------------------
                                   1190 ; last token was VAR_IDX 
                                   1191 ; next is VAR_NAME 
                                   1192 ; extract name
                                   1193 ; search var 
                                   1194 ; return data field address 
                                   1195 ; input:
                                   1196 ;   Y      *var_name 
                                   1197 ; output:
                                   1198 ;   y       Y+2 
                                   1199 ;   X       var address
                                   1200 ; ------------------------
                           000001  1201 	F_ARRAY=1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 106.
Hexadecimal [24-Bits]



                           000002  1202 	VNAME=2 
                           000003  1203 	VSIZE=3 
      000F84                       1204 get_var_adr:
      000F84                       1205 	_vars VSIZE
      000F84 52 03            [ 2]    1     sub sp,#VSIZE 
      000F86 0F 01            [ 1] 1206 	clr (F_ARRAY,sp)
      000F88                       1207 	_get_word 
      000F88                          1         _get_addr
      000F88 93               [ 1]    1         ldw x,y     ; 1 cy 
      000F89 FE               [ 2]    2         ldw x,(x)   ; 2 cy 
      000F8A 72 A9 00 02      [ 2]    3         addw y,#2   ; 2 cy 
      000F8E 1F 02            [ 2] 1208 	ldw (VNAME,sp),x 
      000F90 90 F6            [ 1] 1209 	ld a,(y) 
      000F92 A1 04            [ 1] 1210 	cp a,#LPAREN_IDX 
      000F94 26 08            [ 1] 1211 	jrne 1$ 
      000F96 03 01            [ 1] 1212 	cpl (F_ARRAY,sp)
      000F98 9E               [ 1] 1213 	ld  a,xh 
      000F99 AA 80            [ 1] 1214 	or a,#128 
      000F9B 95               [ 1] 1215 	ld xh,a 
      000F9C 6B 02            [ 1] 1216 	ld (VNAME,sp),a 
      000F9E                       1217 1$: 
      000F9E CD 10 26         [ 4] 1218 	call search_var
      000FA1 5D               [ 2] 1219 	tnzw x 
      000FA2 26 1B            [ 1] 1220 	jrne 9$ ; found 
                                   1221 ; not found, if scalar create it 
      000FA4 0D 01            [ 1] 1222 	tnz (F_ARRAY,sp)
      000FA6 27 03            [ 1] 1223 	jreq 2$ 
                                   1224 ; this array doesn't exist
                                   1225 ; check for var(1) form 
      000FA8 CD 0F C2         [ 4] 1226 	call check_for_idx_1
      000FAB                       1227 2$:	 	
      000FAB 7B 03            [ 1] 1228 	ld a,(VNAME+1,sp)
      000FAD A1 24            [ 1] 1229 	cp a,#'$ 
      000FAF 26 05            [ 1] 1230 	jrne 8$
      000FB1 A6 0C            [ 1] 1231 	ld a,#ERR_DIM 
      000FB3 CC 09 83         [ 2] 1232 	jp tb_error
      000FB6                       1233 8$:	
      000FB6 1E 02            [ 2] 1234 	ldw x,(VNAME,sp)
                                   1235 ; it's not an array 
      000FB8 9E               [ 1] 1236 	ld a,xh 
      000FB9 A4 7F            [ 1] 1237 	and a,#127 
      000FBB 95               [ 1] 1238 	ld xh,a 
      000FBC CD 0F 57         [ 4] 1239 	call create_var	
      000FBF                       1240 9$:
      000FBF                       1241 	_drop VSIZE 
      000FBF 5B 03            [ 2]    1     addw sp,#VSIZE 
      000FC1 81               [ 4] 1242 	ret 
                                   1243 
                                   1244 ;-------------------------
                                   1245 ; a scalar variable can be 
                                   1246 ; addressed as var(1)
                                   1247 ; check for it 
                                   1248 ; fail if not that form 
                                   1249 ; input: 
                                   1250 ;   X     var address 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 107.
Hexadecimal [24-Bits]



                                   1251 ;   Y     *next token after varname
                                   1252 ;-------------------------
      000FC2                       1253 check_for_idx_1: 
      000FC2 1C 00 02         [ 2] 1254 	addw x,#2 ; 
      000FC5 89               [ 2] 1255 	pushw x ; save value  
      000FC6 90 F6            [ 1] 1256 	ld a,(y)
      000FC8 A1 04            [ 1] 1257 	cp a,#LPAREN_IDX 
      000FCA 26 15            [ 1] 1258 	jrne 3$ 
      000FCC CD 0B E8         [ 4] 1259 	call func_args 
      000FCF A1 01            [ 1] 1260 	cp a,#1 
      000FD1 27 03            [ 1] 1261 	jreq 2$
      000FD3 CC 09 81         [ 2] 1262 1$:	jp syntax_error  
      000FD6                       1263 2$:
      000FD6                       1264 	_i16_pop 
      000FD6 85               [ 2]    1     popw x 
      000FD7 A3 00 01         [ 2] 1265 	cpw x,#1 
      000FDA 27 05            [ 1] 1266 	jreq 3$
      000FDC A6 0D            [ 1] 1267 	ld a,#ERR_RANGE  
      000FDE CD 09 83         [ 4] 1268 	call tb_error  
      000FE1                       1269 3$:
      000FE1 85               [ 2] 1270 	popw x 
      000FE2 81               [ 4] 1271     ret 
                                   1272 
                                   1273 
                                   1274 ;--------------------------
                                   1275 ; get array element address
                                   1276 ; input:
                                   1277 ;   X     var addr  
                                   1278 ; output:
                                   1279 ;    X     element address 
                                   1280 ;---------------------------
                           000001  1281 	IDX=1 
                           000003  1282 	SIZE_FIELD=IDX+INT_SIZE 
                           000004  1283 	VSIZE=2*INT_SIZE 
      000FE3                       1284 get_array_adr:
      000FE3                       1285 	_vars VSIZE
      000FE3 52 04            [ 2]    1     sub sp,#VSIZE 
      000FE5 7D               [ 1] 1286 	tnz (x)
      000FE6 2B 05            [ 1] 1287 	jrmi 10$ 
                                   1288 ; scalar data field follow name
                                   1289 ; check for 'var(1)' format 	
      000FE8 CD 0F C2         [ 4] 1290 	call check_for_idx_1
      000FEB 20 31            [ 2] 1291 	jra 9$ 
      000FED                       1292 10$:	 
      000FED EE 02            [ 2] 1293 	ldw x,(2,x) ; array data address 
      000FEF 1F 03            [ 2] 1294 	ldw (SIZE_FIELD,sp),x ; array size field 
      000FF1 90 F6            [ 1] 1295 	ld a,(y)
      000FF3 A1 04            [ 1] 1296 	cp a,#LPAREN_IDX  
      000FF5 27 05            [ 1] 1297 	jreq 0$ 
      000FF7 1C 00 02         [ 2] 1298 	addw x,#2 
      000FFA 20 22            [ 2] 1299 	jra 9$ 
      000FFC                       1300 0$:
      000FFC CD 0B E8         [ 4] 1301 	call func_args 
      000FFF A1 01            [ 1] 1302 	cp a,#1 
      001001 27 03            [ 1] 1303 	jreq 1$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 108.
Hexadecimal [24-Bits]



      001003 CC 09 81         [ 2] 1304 	jp syntax_error 
      001006                       1305 1$: _i16_pop 
      001006 85               [ 2]    1     popw x 
      001007 5D               [ 2] 1306 	tnzw x 
      001008 27 09            [ 1] 1307 	jreq 2$ 
      00100A 1F 01            [ 2] 1308 	ldw (IDX,sp),x 
      00100C 1E 03            [ 2] 1309 	ldw x,(SIZE_FIELD,sp)
      00100E FE               [ 2] 1310 	ldw x,(x) ; array size 
      00100F 13 01            [ 2] 1311 	cpw x,(IDX,sp)
      001011 2A 05            [ 1] 1312 	jrpl 3$ 
      001013                       1313 2$: 
      001013 A6 0D            [ 1] 1314 	ld a,#ERR_RANGE 
      001015 CC 09 83         [ 2] 1315 	jp tb_error 
      001018                       1316 3$: 
      001018 1E 01            [ 2] 1317 	ldw x,(IDX,sp) 
      00101A 58               [ 2] 1318 	sllw x ; 2*IDX  
      00101B 72 FB 03         [ 2] 1319 	addw x,(SIZE_FIELD,sp)
      00101E                       1320 9$:
      00101E                       1321 	_drop VSIZE 
      00101E 5B 04            [ 2]    1     addw sp,#VSIZE 
      001020 81               [ 4] 1322 	ret 
                                   1323 
                                   1324 ;-----------------------
                                   1325 ; get string reserved 
                                   1326 ; space 
                                   1327 ; input:
                                   1328 ;   X     string data pointer 
                                   1329 ; output:
                                   1330 ;   X      space 
                                   1331 ;-----------------------------
      001021                       1332 get_string_space:
      001021 FE               [ 2] 1333 	ldw x,(x) ; data address 
      001022 F6               [ 1] 1334 	ld a,(x) ; space size 
      001023 5F               [ 1] 1335 	clrw x
      001024 97               [ 1] 1336 	ld xl,a 
      001025 81               [ 4] 1337 	ret 
                                   1338 
                                   1339 ;--------------------------
                                   1340 ; search dim var_name 
                                   1341 ; format of record 
                                   1342 ;  field | size 
                                   1343 ;------------------- 
                                   1344 ;  name | {2} byte, for array bit 15 of name is set
                                   1345 ;  data:  
                                   1346 ;  	integer | INT_SIZE 
                                   1347 ;  	str   | len(str)+1, counted string 
                                   1348 ;  	array | size=2 byte, data=size*INT_SIZE   
                                   1349 ;  
                                   1350 ; input:
                                   1351 ;    X     name
                                   1352 ; output:
                                   1353 ;    X     address|0
                                   1354 ; use:
                                   1355 ;   A,Y, acc16 
                                   1356 ;-------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 109.
Hexadecimal [24-Bits]



                           000001  1357 	VAR_NAME=1 ; target name pointer 
                                   1358 ;	WLKPTR=VAR_NAME+2   ; walking pointer in RAM 
                           000003  1359 	SKIP=VAR_NAME+2
                           000004  1360 	VSIZE=SKIP+1  
      001026                       1361 search_var:
      001026 90 89            [ 2] 1362 	pushw y 
      001028                       1363 	_vars VSIZE
      001028 52 04            [ 2]    1     sub sp,#VSIZE 
                                   1364 ; reset bit 7 
      00102A 9E               [ 1] 1365 	ld a,xh 
      00102B A4 7F            [ 1] 1366 	and a,#127
      00102D 95               [ 1] 1367     ld xh,a 
      00102E 1F 01            [ 2] 1368 	ldw (VAR_NAME,sp),x
      001030 90 CE 00 3D      [ 2] 1369 	ldw y,dvar_bgn
      001034                       1370 1$:	
      001034 90 C3 00 3F      [ 2] 1371 	cpw y, dvar_end
      001038 2A 12            [ 1] 1372 	jrpl 7$ ; no match found 
      00103A 93               [ 1] 1373 	ldw x,y 
      00103B FE               [ 2] 1374 	ldw x,(x)
                                   1375 ; reset bit 7 
      00103C 9E               [ 1] 1376 	ld a,xh 
      00103D A4 7F            [ 1] 1377 	and a,#127
      00103F 95               [ 1] 1378     ld xh,a 
      001040 13 01            [ 2] 1379 	cpw x,(VAR_NAME,sp)
      001042 27 0A            [ 1] 1380 	jreq 8$ ; match  
                                   1381 ; skip this one 	
      001044 72 A9 00 04      [ 2] 1382 	addw y,#4 
      001048 20 EA            [ 2] 1383 	jra 1$ 
      00104A 90 F6            [ 1] 1384 	ld a,(y)
      00104C                       1385 7$: ; no match found 
      00104C 90 5F            [ 1] 1386 	clrw y 
      00104E                       1387 8$: ; match found 
      00104E 93               [ 1] 1388 	ldw x,y  ; variable address 
      00104F                       1389 9$:	_DROP VSIZE
      00104F 5B 04            [ 2]    1     addw sp,#VSIZE 
      001051 90 85            [ 2] 1390 	popw y 
      001053 81               [ 4] 1391 	ret 
                                   1392 
                                   1393 ;---------------------------------
                                   1394 ; BASIC: DIM var_name(expr) [,var_name(expr)]* 
                                   1395 ; create named variables at end 
                                   1396 ; of BASIC program. 
                                   1397 ; value are not initialized 
                                   1398 ; bit 7 of first character of name 
                                   1399 ; is set for string and array variables 
                                   1400 ;---------------------------------
                           000001  1401 	HEAP_ADR=1 
                           000003  1402 	DIM_SIZE=HEAP_ADR+ADR_SIZE 
                           000005  1403 	VAR_NAME=DIM_SIZE+INT_SIZE
                           000007  1404 	VAR_ADR=VAR_NAME+NAME_SIZE  
                           000009  1405 	VAR_TYPE=VAR_ADR+ADR_SIZE 
                           000009  1406 	VSIZE=4*INT_SIZE+1 
      001054                       1407 kword_dim:
      001054                       1408 	_vars VSIZE
      001054 52 09            [ 2]    1     sub sp,#VSIZE 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 110.
Hexadecimal [24-Bits]



      001056                       1409 dim_next: 
      001056                       1410 	_next_token
      001056                          1         _get_char 
      001056 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      001058 90 5C            [ 1]    2         incw y      ; 1 cy 
      00105A 6B 09            [ 1] 1411 	ld (VAR_TYPE,sp),a 
      00105C 93               [ 1] 1412 	ldw x,y 
      00105D 72 A9 00 02      [ 2] 1413 	addw y,#2 
      001061 FE               [ 2] 1414 	ldw x,(x) ; var name 
                                   1415 ; set bit 7 for string or array 
      001062 9E               [ 1] 1416 	ld a,xh 
      001063 AA 80            [ 1] 1417 	or a,#128 
      001065 95               [ 1] 1418 	ld xh,a 
      001066 1F 05            [ 2] 1419 	ldw (VAR_NAME,sp),x 
      001068 CD 10 26         [ 4] 1420 	call search_var  
      00106B 5D               [ 2] 1421 	tnzw x 
      00106C 27 0F            [ 1] 1422 	jreq 1$ ; doesn't exist 
                                   1423 ; if string or integer array 
                                   1424 ; abort with error 
      00106E 1F 07            [ 2] 1425 	ldw (VAR_ADR,sp),x
      001070 7D               [ 1] 1426 	tnz (x)
      001071 2A 05            [ 1] 1427 	jrpl 0$  ; it is a scalar will be transformed in array 
      001073 A6 0C            [ 1] 1428 	ld a,#ERR_DIM ; string or array already exist 
      001075 CC 09 83         [ 2] 1429 	jp tb_error
      001078 AA 80            [ 1] 1430 0$: or a,#128 ; make it array  
      00107A F7               [ 1] 1431 	ld (x),a 
      00107B 20 07            [ 2] 1432 	jra 2$ 	
      00107D                       1433 1$:
      00107D 1E 05            [ 2] 1434 	ldw x,(VAR_NAME,sp)
      00107F CD 0F 57         [ 4] 1435 	call create_var
      001082 1F 07            [ 2] 1436 	ldw (VAR_ADR,sp),x  
      001084                       1437 2$: 
      001084 CD 0B E8         [ 4] 1438 	call func_args 
      001087 A1 01            [ 1] 1439 	cp a,#1
      001089 27 03            [ 1] 1440 	jreq 21$
      00108B CC 09 81         [ 2] 1441 	jp syntax_error 
      00108E                       1442 21$: _i16_pop 
      00108E 85               [ 2]    1     popw x 
      00108F 1F 03            [ 2] 1443 	ldw (DIM_SIZE,sp),x 
      001091 A3 00 01         [ 2] 1444 	cpw x,#1 
      001094 2A 05            [ 1] 1445 	jrpl 4$ 
      001096                       1446 3$:
      001096 A6 0D            [ 1] 1447 	ld a,#ERR_RANGE ; array or string must be 1 or more  
      001098 CC 09 83         [ 2] 1448 	jp tb_error 
      00109B 7B 09            [ 1] 1449 4$: ld a,(VAR_TYPE,sp)
      00109D A1 09            [ 1] 1450 	cp a,#VAR_IDX 
      00109F 27 1E            [ 1] 1451 	jreq 5$ 
      0010A1 A3 01 00         [ 2] 1452 	cpw x,#256 
      0010A4 2B 0C            [ 1] 1453 	jrmi 42$ ; string too big
                                   1454 ; remove created var 
      0010A6                       1455 	_ldxz dvar_end 
      0010A6 BE 3F                    1     .byte 0xbe,dvar_end 
      0010A8 1D 00 04         [ 2] 1456 	subw x,#4 
      0010AB                       1457 	_strxz dvar_end 
      0010AB BF 3F                    1     .byte 0xbf,dvar_end 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 111.
Hexadecimal [24-Bits]



      0010AD A6 03            [ 1] 1458 	ld a,#ERR_GT255
      0010AF CC 09 83         [ 2] 1459 	jp tb_error
      0010B2                       1460 42$:
      0010B2 CD 0F 38         [ 4] 1461 	call heap_alloc 
      0010B5 1F 01            [ 2] 1462 	ldw (HEAP_ADR,sp),x 
                                   1463 ; put size in high byte 
                                   1464 ; 0 in low byte  
      0010B7 7B 04            [ 1] 1465 	ld a,(DIM_SIZE+1,sp)
      0010B9 6B 03            [ 1] 1466 	ld (DIM_SIZE,sp),a  
      0010BB 0F 04            [ 1] 1467 	clr (DIM_SIZE+1,sp)
      0010BD 20 06            [ 2] 1468 	jra 7$ 
      0010BF                       1469 5$: ; integer array 
      0010BF 58               [ 2] 1470 	sllw x  
      0010C0 CD 0F 38         [ 4] 1471 	call heap_alloc 
      0010C3 1F 01            [ 2] 1472 	ldw (HEAP_ADR,sp),x 
      0010C5                       1473 7$: 	
                                   1474 ; initialize size field 
      0010C5 7B 03            [ 1] 1475 	ld a,(DIM_SIZE,sp)
      0010C7 F7               [ 1] 1476 	ld (x),a
      0010C8 7B 04            [ 1] 1477 	ld a,(DIM_SIZE+1,sp) 
      0010CA E7 01            [ 1] 1478 	ld (1,x),a 
      0010CC                       1479 8$: ; initialize pointer in variable 
      0010CC 1E 07            [ 2] 1480 	ldw x,(VAR_ADR,sp)
      0010CE 7B 01            [ 1] 1481 	ld a,(HEAP_ADR,sp)
      0010D0 E7 02            [ 1] 1482 	ld (2,x),a 
      0010D2 7B 02            [ 1] 1483 	ld a,(HEAP_ADR+1,sp)
      0010D4 E7 03            [ 1] 1484 	ld (3,x),a 
      0010D6                       1485 	_next_token 
      0010D6                          1         _get_char 
      0010D6 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      0010D8 90 5C            [ 1]    2         incw y      ; 1 cy 
      0010DA A1 02            [ 1] 1486 	cp a,#COMMA_IDX 
      0010DC 26 03            [ 1] 1487 	jrne 9$
      0010DE CC 10 56         [ 2] 1488 	jp dim_next 
      0010E1                       1489 9$: 
      0010E1                       1490 	_unget_token 	
      0010E1 90 5A            [ 2]    1         decw y
      0010E3                       1491 	_drop VSIZE 
      0010E3 5B 09            [ 2]    1     addw sp,#VSIZE 
      0010E5                       1492 	_next 
      0010E5 CC 0A EA         [ 2]    1         jp interp_loop 
                                   1493 
                                   1494 
                                   1495 ;;;;;;;;;;;;;;;;;;;;;;;;;;
                                   1496 ; return program size 
                                   1497 ;;;;;;;;;;;;;;;;;;;;;;;;;;
      0010E8                       1498 prog_size:
      0010E8                       1499 	_ldxz progend
      0010E8 BE 3B                    1     .byte 0xbe,progend 
      0010EA 72 B0 00 37      [ 2] 1500 	subw x,lomem 
      0010EE 81               [ 4] 1501 	ret 
                                   1502 
                                   1503 ;----------------------------
                                   1504 ; print program information 
                                   1505 ;---------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 112.
Hexadecimal [24-Bits]



      0010EF                       1506 program_info: 
      0010EF 3B 00 00         [ 1] 1507 	push base 
      0010F2 AE 11 32         [ 2] 1508 	ldw x,#PROG_ADDR 
      0010F5 CD 00 00         [ 4] 1509 	call puts 
      0010F8                       1510 	_ldxz lomem 
      0010F8 BE 37                    1     .byte 0xbe,lomem 
      0010FA 35 10 00 00      [ 1] 1511 	mov base,#16 
      0010FE CD 00 00         [ 4] 1512 	call print_int
      001101 35 0A 00 00      [ 1] 1513 	mov base,#10  
      001105 AE 11 44         [ 2] 1514 	ldw x,#PROG_SIZE
      001108 CD 00 00         [ 4] 1515 	call puts 
      00110B CD 10 E8         [ 4] 1516 	call prog_size 
      00110E CD 00 00         [ 4] 1517 	call print_int 
      001111 AE 11 55         [ 2] 1518 	ldw x,#STR_BYTES 
      001114 CD 00 00         [ 4] 1519 	call puts
      001117                       1520 	_ldxz lomem
      001117 BE 37                    1     .byte 0xbe,lomem 
      001119 A3 1F 80         [ 2] 1521 	cpw x,#app 
      00111C 25 05            [ 1] 1522 	jrult 2$
      00111E AE 11 5C         [ 2] 1523 	ldw x,#FLASH_MEM 
      001121 20 03            [ 2] 1524 	jra 3$
      001123 AE 11 6D         [ 2] 1525 2$: ldw x,#RAM_MEM 	 
      001126 CD 00 00         [ 4] 1526 3$:	call puts 
      001129 A6 0D            [ 1] 1527 	ld a,#CR 
      00112B CD 00 00         [ 4] 1528 	call putc
      00112E 32 00 00         [ 1] 1529 	pop base 
      001131 81               [ 4] 1530 	ret 
                                   1531 
      001132 70 72 6F 67 72 61 6D  1532 PROG_ADDR: .asciz "program address: "
             20 61 64 64 72 65 73
             73 3A 20 00
      001144 2C 20 70 72 6F 67 72  1533 PROG_SIZE: .asciz ", program size: "
             61 6D 20 73 69 7A 65
             3A 20 00
      001155 20 62 79 74 65 73 00  1534 STR_BYTES: .asciz " bytes" 
      00115C 20 69 6E 20 46 4C 41  1535 FLASH_MEM: .asciz " in FLASH memory" 
             53 48 20 6D 65 6D 6F
             72 79 00
      00116D 20 69 6E 20 52 41 4D  1536 RAM_MEM:   .asciz " in RAM memory" 
             20 6D 65 6D 6F 72 79
             00
                                   1537 
                                   1538 
                                   1539 ;----------------------------
                                   1540 ; BASIC: LIST [[start][-end]]
                                   1541 ; list program lines 
                                   1542 ; form start to end 
                                   1543 ; if empty argument list then 
                                   1544 ; list all.
                                   1545 ;----------------------------
                           000001  1546 	FIRST=1
                           000003  1547 	LAST=3 
                           000005  1548 	LN_PTR=5
                           000006  1549 	VSIZE=6
      00117C                       1550 cmd_list:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 113.
Hexadecimal [24-Bits]



      00117C CD 10 E8         [ 4] 1551 	call prog_size 
      00117F 22 03            [ 1] 1552 	jrugt 1$
      001181 CC 0A B5         [ 2] 1553 	jp cmd_line 
      001184                       1554 1$:
      001184                       1555 	 _vars VSIZE
      001184 52 06            [ 2]    1     sub sp,#VSIZE 
      001186                       1556 	_ldxz lomem 
      001186 BE 37                    1     .byte 0xbe,lomem 
      001188 1F 05            [ 2] 1557 	ldw (LN_PTR,sp),x 
      00118A FE               [ 2] 1558 	ldw x,(x) 
      00118B 1F 01            [ 2] 1559 	ldw (FIRST,sp),x ; list from first line 
      00118D AE 7F FF         [ 2] 1560 	ldw x,#MAX_LINENO ; biggest line number 
      001190 1F 03            [ 2] 1561 	ldw (LAST,sp),x 
      001192                       1562 	_next_token
      001192                          1         _get_char 
      001192 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      001194 90 5C            [ 1]    2         incw y      ; 1 cy 
      001196 4D               [ 1] 1563 	tnz a 
      001197 27 2B            [ 1] 1564 	jreq print_listing 
      001199 A1 0C            [ 1] 1565 	cp a,#SUB_IDX 
      00119B 27 22            [ 1] 1566 	jreq list_to
      00119D 90 5A            [ 2] 1567 	decw y    
      00119F CD 0B 3E         [ 4] 1568 	call expect_integer 
      0011A2 1F 01            [ 2] 1569 	ldw (FIRST,sp),x	
      0011A4                       1570 	_next_token
      0011A4                          1         _get_char 
      0011A4 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      0011A6 90 5C            [ 1]    2         incw y      ; 1 cy 
      0011A8 4D               [ 1] 1571 	tnz a 
      0011A9 26 04            [ 1] 1572 	jrne 2$ 
      0011AB 1F 03            [ 2] 1573 	ldw (LAST,sp),x  
      0011AD 20 15            [ 2] 1574 	jra  print_listing 
      0011AF                       1575 2$: 
      0011AF A1 0C            [ 1] 1576 	cp a,#SUB_IDX  
      0011B1 27 03            [ 1] 1577 	jreq 3$ 
      0011B3 CC 09 81         [ 2] 1578 	jp syntax_error
      0011B6                       1579 3$: _next_token 
      0011B6                          1         _get_char 
      0011B6 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      0011B8 90 5C            [ 1]    2         incw y      ; 1 cy 
      0011BA 4D               [ 1] 1580 	tnz a 
      0011BB 27 07            [ 1] 1581 	jreq print_listing
      0011BD 90 5A            [ 2] 1582 	decw y	 
      0011BF                       1583 list_to: ; listing will stop at this line
      0011BF CD 0B 3E         [ 4] 1584     call expect_integer 
      0011C2 1F 03            [ 2] 1585 	ldw (LAST,sp),x
      0011C4                       1586 print_listing:
                                   1587 ; skip lines smaller than FIRST 
      0011C4 16 05            [ 2] 1588 	ldw y,(LN_PTR,sp)
      0011C6                       1589 	 _clrz acc16 
      0011C6 3F 00                    1     .byte 0x3f, acc16 
      0011C8 93               [ 1] 1590 1$:	ldw x,y 
      0011C9 FE               [ 2] 1591 	ldw x,(x)
      0011CA 13 01            [ 2] 1592 	cpw x,(FIRST,sp)
      0011CC 2A 11            [ 1] 1593 	jrpl 2$
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 114.
Hexadecimal [24-Bits]



      0011CE 90 E6 02         [ 1] 1594 	ld a,(2,y)
      0011D1                       1595 	_straz acc8
      0011D1 B7 00                    1     .byte 0xb7,acc8 
      0011D3 72 B9 00 00      [ 2] 1596 	addw y,acc16
      0011D7 90 C3 00 3B      [ 2] 1597 	cpw y,progend 
      0011DB 2A 28            [ 1] 1598 	jrpl list_exit 
      0011DD 20 E9            [ 2] 1599 	jra 1$
      0011DF 17 05            [ 2] 1600 2$: ldw (LN_PTR,sp),y 	
      0011E1                       1601 list_loop:
      0011E1 1E 05            [ 2] 1602 	ldw x,(LN_PTR,sp)
      0011E3 CF 00 33         [ 2] 1603 	ldw line.addr,x 
      0011E6 E6 02            [ 1] 1604 	ld a,(2,x) 
      0011E8 A0 03            [ 1] 1605 	sub a,#LINE_HEADER_SIZE
      0011EA CD 12 0D         [ 4] 1606 	call prt_basic_line
      0011ED 1E 05            [ 2] 1607 	ldw x,(LN_PTR,sp)
      0011EF E6 02            [ 1] 1608 	ld a,(2,x)
      0011F1                       1609 	_straz acc8
      0011F1 B7 00                    1     .byte 0xb7,acc8 
      0011F3                       1610 	_clrz acc16 
      0011F3 3F 00                    1     .byte 0x3f, acc16 
      0011F5 72 BB 00 00      [ 2] 1611 	addw x,acc16
      0011F9 C3 00 3B         [ 2] 1612 	cpw x,progend 
      0011FC 2A 07            [ 1] 1613 	jrpl list_exit
      0011FE 1F 05            [ 2] 1614 	ldw (LN_PTR,sp),x
      001200 FE               [ 2] 1615 	ldw x,(x)
      001201 13 03            [ 2] 1616 	cpw x,(LAST,sp)  
      001203 2D DC            [ 1] 1617 	jrsle list_loop
      001205                       1618 list_exit:
      001205                       1619 	_drop VSIZE 
      001205 5B 06            [ 2]    1     addw sp,#VSIZE 
      001207 CD 10 EF         [ 4] 1620 	call program_info
      00120A CC 0A B5         [ 2] 1621 	jp cmd_line 
                                   1622 
                                   1623 ;---------------------------------
                                   1624 ; decompile line from token list
                                   1625 ; and print it. 
                                   1626 ; input:
                                   1627 ;   A       stop at this position 
                                   1628 ;   X 		pointer at line
                                   1629 ; output:
                                   1630 ;   none 
                                   1631 ;----------------------------------	
      00120D                       1632 prt_basic_line::
      00120D                       1633 	_straz count 
      00120D B7 32                    1     .byte 0xb7,count 
      00120F 1C 00 03         [ 2] 1634 	addw x,#LINE_HEADER_SIZE  
      001212 CF 00 35         [ 2] 1635 	ldw basicptr,x
      001215 90 93            [ 1] 1636     ldw y,x 
      001217 CD 05 F1         [ 4] 1637 	call decompile
                                   1638 ;call new_line 
      00121A 81               [ 4] 1639 	ret 
                                   1640 
                                   1641 ;---------------------------------
                                   1642 ; BASIC: PRINT|? arg_list 
                                   1643 ; print values from argument list
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 115.
Hexadecimal [24-Bits]



                                   1644 ;----------------------------------
                           000001  1645 	SEMICOL=1
                           000001  1646 	VSIZE=1
      00121B                       1647 cmd_print:
      00121B                       1648 	_vars VSIZE 
      00121B 52 01            [ 2]    1     sub sp,#VSIZE 
      00121D                       1649 reset_semicol:
      00121D 0F 01            [ 1] 1650 	clr (SEMICOL,sp)
      00121F                       1651 prt_loop:
      00121F                       1652 	_next_token	
      00121F                          1         _get_char 
      00121F 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      001221 90 5C            [ 1]    2         incw y      ; 1 cy 
      001223 A1 01            [ 1] 1653 	cp a,#CMD_END 
      001225 22 04            [ 1] 1654 	jrugt 0$
      001227                       1655 	_unget_token
      001227 90 5A            [ 2]    1         decw y
      001229 20 57            [ 2] 1656 	jra 8$
      00122B                       1657 0$:	
      00122B A1 06            [ 1] 1658 	cp a,#QUOTE_IDX
      00122D 27 12            [ 1] 1659 	jreq 1$
      00122F A1 0A            [ 1] 1660 	cp a,#STR_VAR_IDX 
      001231 27 16            [ 1] 1661 	jreq 2$ 
      001233 A1 03            [ 1] 1662 	cp a,#SCOL_IDX  
      001235 27 28            [ 1] 1663 	jreq 4$
      001237 A1 02            [ 1] 1664 	cp a,#COMMA_IDX
      001239 27 28            [ 1] 1665 	jreq 5$	
      00123B A1 2E            [ 1] 1666 	cp a,#CHAR_IDX 
      00123D 27 2B            [ 1] 1667 	jreq 6$
      00123F 20 36            [ 2] 1668 	jra 7$ 
      001241                       1669 1$:	; print string 
      001241 93               [ 1] 1670 	ldw x,y 
      001242 CD 00 00         [ 4] 1671 	call puts
      001245 90 93            [ 1] 1672 	ldw y,x  
      001247 20 D4            [ 2] 1673 	jra reset_semicol
      001249                       1674 2$:	; print string variable  
      001249 CD 0F 84         [ 4] 1675 	call get_var_adr 
      00124C CD 0E D6         [ 4] 1676 	call get_string_slice 
      00124F 4D               [ 1] 1677 	tnz a 
      001250 27 0B            [ 1] 1678 	jreq 22$   
      001252 88               [ 1] 1679 	push a
      001253                       1680 21$: 
      001253 F6               [ 1] 1681 	ld a,(x)
      001254 5C               [ 1] 1682 	incw x 
      001255 CD 00 00         [ 4] 1683 	call putc
      001258 0A 01            [ 1] 1684 	dec (1,sp)
      00125A 26 F7            [ 1] 1685 	jrne 21$ 
      00125C 84               [ 1] 1686 	pop a  
      00125D                       1687 22$:
      00125D 20 BE            [ 2] 1688 	jra reset_semicol 
      00125F                       1689 4$: ; set semi-colon  state 
      00125F 03 01            [ 1] 1690 	cpl (SEMICOL,sp)
      001261 20 BC            [ 2] 1691 	jra prt_loop 
      001263                       1692 5$: ; skip to next terminal tabulation
                                   1693      ; terminal TAB are 8 colons 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 116.
Hexadecimal [24-Bits]



      001263 A6 09            [ 1] 1694      ld a,#9 
      001265 CD 00 00         [ 4] 1695 	 call putc 
      001268 20 B3            [ 2] 1696 	 jra reset_semicol
      00126A                       1697 6$: ; appelle la foncton CHAR()
      00126A                       1698 	_call_code 
      00126A                          1         _code_addr  ; 6 cy  
      00126A 5F               [ 1]    1         clrw x   ; 1 cy 
      00126B 97               [ 1]    2         ld xl,a  ; 1 cy 
      00126C 58               [ 2]    3         sllw x   ; 2 cy 
      00126D DE 00 00         [ 2]    4         ldw x,(code_addr,x) ; 2 cy 
      001270 FD               [ 4]    2         call (x)    ; 4 cy 
      001271 01               [ 1] 1699 	rrwa x 
      001272 CD 00 00         [ 4] 1700 	call putc 
      001275 20 A6            [ 2] 1701 	jra reset_semicol	 	    
      001277                       1702 7$:	
      001277                       1703 	_unget_token 
      001277 90 5A            [ 2]    1         decw y
      001279 CD 0D C0         [ 4] 1704 	call condition
      00127C CD 00 00         [ 4] 1705 	call print_int
      00127F CC 12 1D         [ 2] 1706 	jp reset_semicol 
      001282                       1707 8$:
      001282 0D 01            [ 1] 1708 	tnz (SEMICOL,sp)
      001284 26 05            [ 1] 1709 	jrne 9$
      001286 A6 0D            [ 1] 1710 	ld a,#CR 
      001288 CD 00 00         [ 4] 1711     call putc 
      00128B                       1712 9$:	
      00128B                       1713 	_drop VSIZE 
      00128B 5B 01            [ 2]    1     addw sp,#VSIZE 
      00128D                       1714 	_next
      00128D CC 0A EA         [ 2]    1         jp interp_loop 
                                   1715 
                                   1716 ;----------------------
                                   1717 ; 'save_context' and
                                   1718 ; 'rest_context' must be 
                                   1719 ; called at the same 
                                   1720 ; call stack depth 
                                   1721 ; i.e. SP must have the 
                                   1722 ; same value at  
                                   1723 ; entry point of both 
                                   1724 ; routine. 
                                   1725 ;---------------------
                           000004  1726 	CTXT_SIZE=4 ; size of saved data 
                                   1727 ;--------------------
                                   1728 ; save current BASIC
                                   1729 ; interpreter context 
                                   1730 ; on stack 
                                   1731 ;--------------------
      001290                       1732 	_argofs 0 
                           000002     1     ARG_OFS=2+0 
      001290                       1733 	_arg LNADR 1 
                           000003     1     LNADR=ARG_OFS+1 
      001290                       1734 	_arg BPTR 3
                           000005     1     BPTR=ARG_OFS+3 
      001290                       1735 save_context:
      001290 17 05            [ 2] 1736 	ldw (BPTR,sp),y 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 117.
Hexadecimal [24-Bits]



      001292                       1737 	_ldxz line.addr
      001292 BE 33                    1     .byte 0xbe,line.addr 
      001294 1F 03            [ 2] 1738 	ldw (LNADR,sp),x 
      001296 81               [ 4] 1739 	ret
                                   1740 
                                   1741 ;-----------------------
                                   1742 ; restore previously saved 
                                   1743 ; BASIC interpreter context 
                                   1744 ; from stack 
                                   1745 ;-------------------------
      001297                       1746 rest_context:
      001297 1E 03            [ 2] 1747 	ldw x,(LNADR,sp)
      001299 CF 00 33         [ 2] 1748 	ldw line.addr,x 
      00129C 16 05            [ 2] 1749 	ldw y,(BPTR,sp)
      00129E 81               [ 4] 1750 	ret
                                   1751 
                                   1752 
                                   1753 ;-----------------------
                                   1754 ; ask user to retype 
                                   1755 ; input value 
                                   1756 ;----------------------
      00129F                       1757 retype:
      00129F CD 00 00         [ 4] 1758 	call new_line
      0012A2 AE 09 2E         [ 2] 1759 	ldw x,#err_retype 
      0012A5 CD 00 00         [ 4] 1760 	call puts 
      0012A8 CD 00 00         [ 4] 1761 	call new_line 
      0012AB 81               [ 4] 1762 	ret 
                                   1763 
                                   1764 ;--------------------------
                                   1765 ; readline from terminal 
                                   1766 ; and parse it in pad 
                                   1767 ;-------------------------
      0012AC                       1768 input_prompt:
      0012AC A6 3F            [ 1] 1769 	ld a,#'? 
      0012AE CD 00 00         [ 4] 1770 	call putc 
      0012B1 81               [ 4] 1771 	ret 
                                   1772 
                                   1773 ;-----------------------
                                   1774 ; print variable name 
                                   1775 ; input:
                                   1776 ;    X    var name 
                                   1777 ; use:
                                   1778 ;   A 
                                   1779 ;-----------------------
      0012B2                       1780 print_var_name:
      0012B2 9E               [ 1] 1781 	ld a,xh 
      0012B3 A4 7F            [ 1] 1782 	and a,#127 
      0012B5 CD 00 00         [ 4] 1783 	call uart_putc 
      0012B8 9F               [ 1] 1784 	ld a,xl 
      0012B9 A4 7F            [ 1] 1785 	and a,#127 
      0012BB CD 00 00         [ 4] 1786 	call uart_putc 
      0012BE 81               [ 4] 1787 	ret  
                                   1788 
                                   1789 ;--------------------------
                                   1790 ; input integer to variable 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 118.
Hexadecimal [24-Bits]



                                   1791 ; input:
                                   1792 ;   X     var name 
                                   1793 ; output:
                                   1794 ;   X      value 
                                   1795 ;----------------------------
                           000001  1796 	N=1
                           000003  1797 	DIGIT=N+INT_SIZE 
                           000005  1798 	SIGN=DIGIT+INT_SIZE
                           000006  1799 	COUNT=SIGN+1 
                           000006  1800  	VSIZE=COUNT  
      0012BF                       1801 input_integer:
      0012BF                       1802 	_vars VSIZE 
      0012BF 52 06            [ 2]    1     sub sp,#VSIZE 
      0012C1 0F 03            [ 1] 1803 	clr (DIGIT,sp)
      0012C3 CD 12 B2         [ 4] 1804 	call print_var_name 
      0012C6 CD 12 AC         [ 4] 1805 	call input_prompt  
      0012C9 5F               [ 1] 1806 	clrw x 
      0012CA 1F 01            [ 2] 1807 	ldw (N,sp),x 
      0012CC 1F 05            [ 2] 1808 	ldw (SIGN,sp),x
      0012CE 35 0A 00 00      [ 1] 1809 	mov base,#10
      0012D2 CD 00 00         [ 4] 1810 	call getc 
      0012D5 A1 2D            [ 1] 1811 	cp a,#'- 
      0012D7 26 04            [ 1] 1812 	jrne 1$ 
      0012D9 03 05            [ 1] 1813 	cpl (SIGN,sp)
      0012DB 20 08            [ 2] 1814 	jra 2$ 
      0012DD A1 24            [ 1] 1815 1$: cp a,#'$ 
      0012DF 26 07            [ 1] 1816 	jrne 3$ 
      0012E1 35 10 00 00      [ 1] 1817 	mov base,#16  
      0012E5 CD 00 00         [ 4] 1818 2$: call getc
      0012E8 A1 08            [ 1] 1819 3$: cp a,#BS 
      0012EA 26 12            [ 1] 1820 	jrne 4$ 
      0012EC 0D 06            [ 1] 1821 	tnz (COUNT,sp)
      0012EE 27 F5            [ 1] 1822 	jreq 2$ 
      0012F0 CD 00 00         [ 4] 1823 	call bksp 
      0012F3 1E 01            [ 2] 1824 	ldw x,(N,sp)
      0012F5                       1825 	_ldaz base 
      0012F5 B6 00                    1     .byte 0xb6,base 
      0012F7 62               [ 2] 1826 	div x,a 
      0012F8 1F 01            [ 2] 1827 	ldw (N,sp),x
      0012FA 0A 06            [ 1] 1828 	dec (COUNT,sp)
      0012FC 20 E7            [ 2] 1829 	jra 2$  
      0012FE                       1830 4$:	
      0012FE CD 00 00         [ 4] 1831 	call uart_putc 
      001301 A1 0D            [ 1] 1832 	cp a,#CR 
      001303 27 17            [ 1] 1833 	jreq 7$ 
      001305 CD 0B 50         [ 4] 1834 	call char_to_digit 
      001308 24 1A            [ 1] 1835 	jrnc 9$
      00130A 0C 06            [ 1] 1836 	inc (COUNT,sp)
      00130C 6B 04            [ 1] 1837 	ld (DIGIT+1,sp),a 
      00130E 1E 01            [ 2] 1838 	ldw x,(N,sp)
      001310                       1839 	_ldaz base 
      001310 B6 00                    1     .byte 0xb6,base 
      001312 CD 00 00         [ 4] 1840 	call umul16_8
      001315 72 FB 03         [ 2] 1841 	addw x,(DIGIT,sp)
      001318 1F 01            [ 2] 1842 	ldw (N,sp),x
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 119.
Hexadecimal [24-Bits]



      00131A 20 C9            [ 2] 1843 	jra 2$  	
      00131C 1E 01            [ 2] 1844 7$: ldw x,(N,sp)
      00131E 0D 05            [ 1] 1845 	tnz (SIGN,sp)
      001320 27 01            [ 1] 1846 	jreq 8$ 
      001322 50               [ 2] 1847 	negw x 
      001323                       1848 8$: 
      001323 99               [ 1] 1849 	scf ; success 	
      001324                       1850 9$:	
      001324                       1851 	_drop VSIZE 
      001324 5B 06            [ 2]    1     addw sp,#VSIZE 
      001326 81               [ 4] 1852 	ret 
                                   1853 
                                   1854 ;---------------------------------------
                                   1855 ; input value for string variable 
                                   1856 ; accumulate all character up to CR 
                                   1857 ; input:
                                   1858 ;   X     var name  
                                   1859 ; output:
                                   1860 ;   X     *tib 
                                   1861 ;-------------------------------------- 
      001327                       1862 input_string:
      001327 CD 12 B2         [ 4] 1863 	call print_var_name 
      00132A CD 12 AC         [ 4] 1864 	call input_prompt 
      00132D 4F               [ 1] 1865 	clr a 
      00132E CD 00 00         [ 4] 1866 	call readln 
      001331 AE 00 00         [ 2] 1867 	ldw x,#tib 
      001334 81               [ 4] 1868 	ret 
                                   1869 
                                   1870 ;------------------------------------------
                                   1871 ; BASIC: INPUT [string],var[,var]
                                   1872 ; input value in variables 
                                   1873 ; [string] optionally can be used as prompt 
                                   1874 ;-----------------------------------------
                           000001  1875 	BPTR=1
                           000003  1876 	VAR_VALUE=BPTR+2
                           000005  1877 	VAR_ADR =VAR_VALUE+2
                           000006  1878 	VSIZE=3*INT_SIZE  
      001335                       1879 cmd_input:
      001335 72 00 00 43 05   [ 2] 1880 	btjt flags,#FRUN,1$ 
      00133A A6 11            [ 1] 1881 	ld a,#ERR_PROG_ONLY
      00133C CC 09 83         [ 2] 1882 	jp tb_error 
      00133F                       1883 1$: 
      00133F                       1884 	_vars VSIZE 
      00133F 52 06            [ 2]    1     sub sp,#VSIZE 
      001341 90 F6            [ 1] 1885 	ld a,(y) 
      001343 A1 06            [ 1] 1886 	cp a,#QUOTE_IDX 
      001345 26 16            [ 1] 1887 	jrne 2$ 
      001347 90 5C            [ 1] 1888 	incw y 
      001349 93               [ 1] 1889 	ldw x,y  
      00134A CD 00 00         [ 4] 1890 	call puts 
      00134D 90 93            [ 1] 1891 	ldw y,x 
      00134F CD 00 00         [ 4] 1892 	call new_line
      001352                       1893 	_next_token 
      001352                          1         _get_char 
      001352 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 120.
Hexadecimal [24-Bits]



      001354 90 5C            [ 1]    2         incw y      ; 1 cy 
      001356 A1 02            [ 1] 1894 	cp a,#COMMA_IDX 
      001358 27 03            [ 1] 1895 	jreq 2$  
      00135A CC 09 81         [ 2] 1896 	jp syntax_error 
      00135D                       1897 2$:
      00135D                       1898 	_next_token
      00135D                          1         _get_char 
      00135D 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      00135F 90 5C            [ 1]    2         incw y      ; 1 cy 
      001361 A1 02            [ 1] 1899 	cp a,#CMD_END+1  
      001363 2B 5C            [ 1] 1900 	jrmi input_exit  
      001365 A1 09            [ 1] 1901     cp a,#VAR_IDX
      001367 27 07            [ 1] 1902 	jreq 4$
      001369 A1 0A            [ 1] 1903 	cp a,#STR_VAR_IDX 
      00136B 27 2E            [ 1] 1904 	jreq 8$ 
      00136D CC 09 81         [ 2] 1905 	jp syntax_error 
      001370                       1906 4$: 
      001370 93               [ 1] 1907 	ldw x,y 
      001371 FE               [ 2] 1908 	ldw x,(x)
      001372 1F 05            [ 2] 1909 	ldw (VAR_ADR,sp),x ; var name 
      001374 1E 05            [ 2] 1910 5$:	ldw x,(VAR_ADR,sp) 
      001376 CD 12 BF         [ 4] 1911 	call input_integer 
      001379 25 05            [ 1] 1912 	jrc 6$ 
      00137B CD 12 9F         [ 4] 1913 	call retype 
      00137E 20 F4            [ 2] 1914 	jra 5$ 	  
      001380                       1915 6$: 
      001380 1F 03            [ 2] 1916 	ldw (VAR_VALUE,sp),x 
      001382 CD 0F 84         [ 4] 1917 	call get_var_adr 
      001385 CD 0F E3         [ 4] 1918 	call get_array_adr 
      001388 7B 03            [ 1] 1919 	ld a,(VAR_VALUE,sp)
      00138A F7               [ 1] 1920 	ld (x),a 
      00138B 7B 04            [ 1] 1921 	ld a,(VAR_VALUE+1,sp)
      00138D E7 01            [ 1] 1922 	ld (1,x),a 
      00138F                       1923 7$: 
      00138F                       1924 	_next_token 
      00138F                          1         _get_char 
      00138F 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      001391 90 5C            [ 1]    2         incw y      ; 1 cy 
      001393 A1 02            [ 1] 1925 	cp a,#COMMA_IDX 
      001395 27 C6            [ 1] 1926 	jreq 2$
      001397                       1927 	_unget_token   
      001397 90 5A            [ 2]    1         decw y
      001399 20 26            [ 2] 1928 	jra input_exit ; all variables done
      00139B                       1929 8$: ;input string 
      00139B 93               [ 1] 1930 	ldw x,y
      00139C FE               [ 2] 1931 	ldw x,(x)
      00139D 1F 05            [ 2] 1932 	ldw (VAR_ADR,sp),x ; save var name 
      00139F CD 13 27         [ 4] 1933 	call input_string  
      0013A2 CD 0F 84         [ 4] 1934 	call get_var_adr 
      0013A5 1F 05            [ 2] 1935 	ldw (VAR_ADR,sp),x ; needed later 
      0013A7 CD 0E D6         [ 4] 1936 	call get_string_slice 
      0013AA 17 01            [ 2] 1937 	ldw (BPTR,sp),y  
      0013AC 90 AE 00 00      [ 2] 1938 	ldw y,#tib
      0013B0 CD 00 00         [ 4] 1939 	call strcpy 
      0013B3 AE 00 00         [ 2] 1940 	ldw x,#tib 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 121.
Hexadecimal [24-Bits]



      0013B6 CD 00 00         [ 4] 1941 	call strlen 
      0013B9 1E 05            [ 2] 1942 	ldw x,(VAR_ADR,sp)
      0013BB FE               [ 2] 1943 	ldw x,(x)
      0013BC F7               [ 1] 1944 	ld (x),a 
      0013BD 16 01            [ 2] 1945 	ldw y,(BPTR,sp)
      0013BF 20 CE            [ 2] 1946 	jra 7$   	 
      0013C1                       1947 input_exit:
      0013C1                       1948 	_drop VSIZE 
      0013C1 5B 06            [ 2]    1     addw sp,#VSIZE 
      0013C3                       1949 	_next  
      0013C3 CC 0A EA         [ 2]    1         jp interp_loop 
                                   1950 
                                   1951 ;---------------------
                                   1952 ;BASIC: KEY
                                   1953 ; wait for a character 
                                   1954 ; received from STDIN 
                                   1955 ; input:
                                   1956 ;	none 
                                   1957 ; output:
                                   1958 ;	x  character 
                                   1959 ;---------------------
      0013C6                       1960 func_key:
      0013C6 5F               [ 1] 1961 	clrw x 
      0013C7 CD 00 00         [ 4] 1962 	call qgetc 
      0013CA 27 04            [ 1] 1963 	jreq 9$ 
      0013CC CD 00 00         [ 4] 1964 	call getc 
      0013CF 02               [ 1] 1965 	rlwa x  
      0013D0                       1966 9$:
      0013D0 81               [ 4] 1967 	ret 
                                   1968 
                                   1969 ;--------------------
                                   1970 ; BASIC: POKE addr,byte
                                   1971 ; put a byte at addr 
                                   1972 ;--------------------
                           000001  1973 	VALUE=1
                           000003  1974 	POK_ADR=VALUE+INT_SIZE 
      0013D1                       1975 cmd_poke:
      0013D1 CD 0B F3         [ 4] 1976 	call arg_list 
      0013D4 A1 02            [ 1] 1977 	cp a,#2
      0013D6 27 03            [ 1] 1978 	jreq 1$
      0013D8 CC 09 81         [ 2] 1979 	jp syntax_error
      0013DB                       1980 1$:	
      0013DB                       1981 	_i16_fetch POK_ADR ; address   
      0013DB 1E 03            [ 2]    1     ldw x,(POK_ADR,sp)
      0013DD 7B 02            [ 1] 1982 	ld a,(VALUE+1,sp) 
      0013DF F7               [ 1] 1983 	ld (x),a 
      0013E0                       1984 	_drop 2*INT_SIZE 
      0013E0 5B 04            [ 2]    1     addw sp,#2*INT_SIZE 
      0013E2                       1985 	_next 
      0013E2 CC 0A EA         [ 2]    1         jp interp_loop 
                                   1986 
                                   1987 ;-----------------------
                                   1988 ; BASIC: PEEK(addr)
                                   1989 ; get the byte at addr 
                                   1990 ; input:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 122.
Hexadecimal [24-Bits]



                                   1991 ;	none 
                                   1992 ; output:
                                   1993 ;	X 		value 
                                   1994 ;-----------------------
      0013E5                       1995 func_peek:
      0013E5 CD 0B E8         [ 4] 1996 	call func_args
      0013E8 A1 01            [ 1] 1997 	cp a,#1 
      0013EA 27 03            [ 1] 1998 	jreq 1$
      0013EC CC 09 81         [ 2] 1999 	jp syntax_error
      0013EF                       2000 1$: _i16_pop ; address  
      0013EF 85               [ 2]    1     popw x 
      0013F0 F6               [ 1] 2001 	ld a,(x)
      0013F1 5F               [ 1] 2002 	clrw x 
      0013F2 97               [ 1] 2003 	ld xl,a 
      0013F3 81               [ 4] 2004 	ret 
                                   2005 
                                   2006 ;---------------------------
                                   2007 ; BASIC IF expr : instructions
                                   2008 ; evaluate expr and if true 
                                   2009 ; execute instructions on same line. 
                                   2010 ;----------------------------
      0013F4                       2011 kword_if: 
      0013F4 90 F6            [ 1] 2012 	ld a,(y)
      0013F6 A1 0A            [ 1] 2013 	cp a,#STR_VAR_IDX 
      0013F8 27 1E            [ 1] 2014 	jreq if_string 
      0013FA A1 06            [ 1] 2015 	cp a,#QUOTE_IDX
      0013FC 27 1A            [ 1] 2016 	jreq if_string 
      0013FE CD 0D C0         [ 4] 2017 	call condition
      001401 5D               [ 2] 2018 	tnzw x 
      001402 26 03            [ 1] 2019 	jrne 1$ 
      001404 CC 0A F5         [ 2] 2020 	jp kword_remark 
      001407 A6 21            [ 1] 2021 1$: ld a,#THEN_IDX 
      001409 CD 0B DA         [ 4] 2022 	call expect 
      00140C                       2023 cond_accepted: 
      00140C 90 F6            [ 1] 2024 	ld a,(y)
      00140E A1 08            [ 1] 2025 	cp a,#LITW_IDX 
      001410 26 03            [ 1] 2026 	jrne 2$ 
      001412 CC 15 84         [ 2] 2027 	jp kword_goto
      001415                       2028 2$:	_next  
      001415 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2029 ;-------------------------
                                   2030 ; if string condition 
                                   2031 ;--------------------------
                           000001  2032 	STR1=1 
                           000003  2033 	STR1_LEN=STR1+2
                           000005  2034 	STR2=STR1_LEN+2
                           000007  2035 	STR2_LEN=STR2+2 
                           000009  2036 	OP_REL=STR2_LEN+2 
                           00000A  2037 	YSAVE=OP_REL+1
                           00000B  2038 	VSIZE=YSAVE+1
      001418                       2039 if_string: 
      001418                       2040 	_vars VSIZE
      001418 52 0B            [ 2]    1     sub sp,#VSIZE 
      00141A 0F 03            [ 1] 2041 	clr (STR1_LEN,sp)
      00141C 0F 07            [ 1] 2042 	clr (STR2_LEN,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 123.
Hexadecimal [24-Bits]



      00141E 90 5C            [ 1] 2043 	incw y
      001420 A1 06            [ 1] 2044 	cp a,#QUOTE_IDX
      001422 26 10            [ 1] 2045 	jrne 1$ 
      001424 17 01            [ 2] 2046 	ldw (STR1,sp),y 
      001426 93               [ 1] 2047 	ldw x,y 
      001427 CD 00 00         [ 4] 2048 	call strlen 
      00142A 6B 04            [ 1] 2049 	ld (STR1_LEN+1,sp),a
      00142C 72 FB 03         [ 2] 2050 	addw x,(STR1_LEN,sp)
      00142F 5C               [ 1] 2051 	incw x 
      001430 90 93            [ 1] 2052 	ldw y,x  
      001432 20 0A            [ 2] 2053 	jra 2$ 
      001434                       2054 1$:	  
      001434 CD 0F 84         [ 4] 2055 	call get_var_adr 
      001437 CD 0E D6         [ 4] 2056 	call get_string_slice 	
      00143A 1F 01            [ 2] 2057 	ldw (STR1,sp),x 
      00143C 6B 04            [ 1] 2058 	ld (STR1_LEN+1,sp),a 
      00143E 90 F6            [ 1] 2059 2$: ld a,(y)
      001440 A1 10            [ 1] 2060 	cp a,#REL_LE_IDX 
      001442 2B 04            [ 1] 2061 	jrmi 3$ 
      001444 A1 15            [ 1] 2062 	cp a,#OP_REL_LAST 
      001446 23 03            [ 2] 2063 	jrule 4$
      001448                       2064 3$:	
      001448 CC 09 81         [ 2] 2065 	jp syntax_error 
      00144B                       2066 4$: 
      00144B 6B 09            [ 1] 2067 	ld (OP_REL,sp),a 
      00144D 90 5C            [ 1] 2068 	incw y 
                                   2069 ;expect second string 	
      00144F                       2070 	_next_token 
      00144F                          1         _get_char 
      00144F 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      001451 90 5C            [ 1]    2         incw y      ; 1 cy 
      001453 A1 06            [ 1] 2071 	cp a,#QUOTE_IDX
      001455 26 10            [ 1] 2072 	jrne 5$ 
      001457 17 05            [ 2] 2073 	ldw (STR2,sp),y 
      001459 93               [ 1] 2074 	ldw x,y 
      00145A CD 00 00         [ 4] 2075 	call strlen 
      00145D 6B 08            [ 1] 2076 	ld (STR2_LEN+1,sp),a 
      00145F 72 FB 07         [ 2] 2077 	addw x,(STR2_LEN,sp)
      001462 5C               [ 1] 2078 	incw x 
      001463 90 93            [ 1] 2079 	ldw y,x 
      001465 20 0E            [ 2] 2080 	jra 54$
      001467 A1 0A            [ 1] 2081 5$: cp a,#STR_VAR_IDX
      001469 26 DD            [ 1] 2082 	jrne 3$
      00146B CD 0F 84         [ 4] 2083 	call get_var_adr 
      00146E CD 0E D6         [ 4] 2084 	call get_string_slice 
      001471 1F 05            [ 2] 2085 	ldw (STR2,sp),x 
      001473 6B 08            [ 1] 2086 	ld (STR2_LEN+1,sp),a
      001475                       2087 54$:
      001475 A6 21            [ 1] 2088 	ld a,#THEN_IDX 
      001477 CD 0B DA         [ 4] 2089 	call expect
                                   2090 ; compare strings 
      00147A 17 0A            [ 2] 2091 	ldw (YSAVE,sp),y 
      00147C 1E 01            [ 2] 2092 	ldw x,(STR1,sp)
      00147E 16 05            [ 2] 2093 	ldw y,(STR2,sp)
      001480                       2094 6$:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 124.
Hexadecimal [24-Bits]



      001480 0D 04            [ 1] 2095 	tnz (STR1_LEN+1,sp) 
      001482 27 12            [ 1] 2096 	jreq 7$ 
      001484 0D 08            [ 1] 2097 	tnz (STR2_LEN+1,sp)
      001486 27 0E            [ 1] 2098 	jreq 7$ 
      001488 F6               [ 1] 2099 	ld a,(x)
      001489 90 F1            [ 1] 2100 	cp a,(y)
      00148B 26 0D            [ 1] 2101 	jrne 8$ 
      00148D 5C               [ 1] 2102 	incw x 
      00148E 90 5C            [ 1] 2103 	incw y 
      001490 0A 04            [ 1] 2104 	dec (STR1_LEN+1,sp)
      001492 0A 08            [ 1] 2105 	dec (STR2_LEN+1,sp)
      001494 20 EA            [ 2] 2106 	jra 6$ 
      001496                       2107 7$: ; string end  
      001496 7B 04            [ 1] 2108 	ld a,(STR1_LEN+1,sp)
      001498 11 08            [ 1] 2109 	cp a,(STR2_LEN+1,sp)
      00149A                       2110 8$: ; no match  
      00149A 2B 0C            [ 1] 2111 	jrmi 9$ 
      00149C 26 16            [ 1] 2112 	jrne 10$ 
                                   2113 ; STR1 == STR2  
      00149E 7B 09            [ 1] 2114 	ld a,(OP_REL,sp)
      0014A0 A1 11            [ 1] 2115 	cp a,#REL_EQU_IDX 
      0014A2 27 1A            [ 1] 2116 	jreq 11$ 
      0014A4 2B 18            [ 1] 2117 	jrmi 11$ 
      0014A6 20 26            [ 2] 2118 	jra 13$ 
      0014A8                       2119 9$: ; STR1 < STR2 
      0014A8 7B 09            [ 1] 2120 	ld a,(OP_REL,sp)
      0014AA A1 13            [ 1] 2121 	cp a,#REL_LT_IDX 
      0014AC 27 10            [ 1] 2122 	jreq 11$
      0014AE A1 10            [ 1] 2123 	cp a,#REL_LE_IDX  
      0014B0 27 0C            [ 1] 2124 	jreq 11$
      0014B2 20 1A            [ 2] 2125 	jra 13$  
      0014B4                       2126 10$: ; STR1 > STR2 
      0014B4 7B 09            [ 1] 2127 	ld a,(OP_REL,sp)
      0014B6 A1 14            [ 1] 2128 	cp a,#REL_GT_IDX 
      0014B8 27 04            [ 1] 2129 	jreq 11$ 
      0014BA A1 12            [ 1] 2130 	cp a,#REL_GE_IDX 
      0014BC 26 10            [ 1] 2131 	jrne 13$ 
      0014BE                       2132 11$: ; accepted
      0014BE 16 0A            [ 2] 2133 	ldw y,(YSAVE,sp)
      0014C0                       2134 	_drop VSIZE 
      0014C0 5B 0B            [ 2]    1     addw sp,#VSIZE 
      0014C2 90 F6            [ 1] 2135 	ld a,(y)
      0014C4 A1 08            [ 1] 2136 	cp a,#LITW_IDX 
      0014C6 26 03            [ 1] 2137 	jrne 12$
      0014C8 CC 15 84         [ 2] 2138 	jp kword_goto 
      0014CB                       2139 12$: _next 
      0014CB CC 0A EA         [ 2]    1         jp interp_loop 
      0014CE                       2140 13$: ; rejected 
      0014CE 16 0A            [ 2] 2141 	ldw y,(YSAVE,sp)
      0014D0                       2142 	_drop VSIZE
      0014D0 5B 0B            [ 2]    1     addw sp,#VSIZE 
      0014D2 CC 0A F5         [ 2] 2143 	jp kword_remark  
      0014D5                       2144 	_next 
      0014D5 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2145 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 125.
Hexadecimal [24-Bits]



                                   2146 
                                   2147 ;------------------------
                                   2148 ; BASIC: FOR var=expr 
                                   2149 ; set variable to expression 
                                   2150 ; leave variable address 
                                   2151 ; on stack and set
                                   2152 ; FLOOP bit in 'flags'
                                   2153 ;-----------------
                           000001  2154 	FSTEP=1  ; variable increment int16
                           000003  2155 	LIMIT=FSTEP+INT_SIZE ; loop limit, int16  
                           000005  2156 	CVAR=LIMIT+INT_SIZE   ; control variable data field 
                           000007  2157 	LN_ADDR=CVAR+2   ;  line.addr saved
                           000009  2158 	BPTR=LN_ADDR+2 ; basicptr saved
                           00000A  2159 	VSIZE=BPTR+1  
      0014D8                       2160 kword_for: ; { -- var_addr }
      0014D8                       2161 	_vars VSIZE
      0014D8 52 0A            [ 2]    1     sub sp,#VSIZE 
      0014DA                       2162 	_ldaz for_nest 
      0014DA B6 48                    1     .byte 0xb6,for_nest 
      0014DC A1 08            [ 1] 2163 	cp a,#8 
      0014DE 2B 05            [ 1] 2164 	jrmi 1$ 
      0014E0 A6 08            [ 1] 2165 	ld a,#ERR_FORS
      0014E2 CC 09 83         [ 2] 2166 	jp tb_error 
      0014E5 4C               [ 1] 2167 1$: inc a 
      0014E6                       2168 	_straz for_nest 
      0014E6 B7 48                    1     .byte 0xb7,for_nest 
      0014E8 AE 00 01         [ 2] 2169 	ldw x,#1 
      0014EB 1F 01            [ 2] 2170 	ldw (FSTEP,sp),x  
      0014ED A6 09            [ 1] 2171 	ld a,#VAR_IDX 
      0014EF CD 0B DA         [ 4] 2172 	call expect 
      0014F2 CD 0F 84         [ 4] 2173 	call get_var_adr
      0014F5 1C 00 02         [ 2] 2174 	addw x,#2 
      0014F8 1F 05            [ 2] 2175 	ldw (CVAR,sp),x  ; control variable 
      0014FA                       2176 	_strxz ptr16 
      0014FA BF 00                    1     .byte 0xbf,ptr16 
      0014FC A6 11            [ 1] 2177 	ld a,#REL_EQU_IDX 
      0014FE CD 0B DA         [ 4] 2178 	call expect 
      001501 CD 0C E2         [ 4] 2179 	call expression
      001504 72 CF 00 00      [ 5] 2180 	ldw [ptr16],x
      001508 A6 27            [ 1] 2181 	ld a,#TO_IDX 
      00150A CD 0B DA         [ 4] 2182 	call expect 
                                   2183 ;-----------------------------------
                                   2184 ; BASIC: TO expr 
                                   2185 ; second part of FOR loop initilization
                                   2186 ; leave limit on stack and set 
                                   2187 ; FTO bit in 'flags'
                                   2188 ;-----------------------------------
      00150D                       2189 kword_to: ; { var_addr -- var_addr limit step }
      00150D CD 0C E2         [ 4] 2190     call expression   
      001510                       2191 2$:
      001510 1F 03            [ 2] 2192 	ldw (LIMIT,sp),x
      001512                       2193 	_next_token 
      001512                          1         _get_char 
      001512 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      001514 90 5C            [ 1]    2         incw y      ; 1 cy 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 126.
Hexadecimal [24-Bits]



      001516 A1 24            [ 1] 2194 	cp a,#STEP_IDX 
      001518 27 04            [ 1] 2195 	jreq kword_step
      00151A                       2196 	_unget_token
      00151A 90 5A            [ 2]    1         decw y
      00151C 20 05            [ 2] 2197 	jra store_loop_addr 
                                   2198 
                                   2199 ;----------------------------------
                                   2200 ; BASIC: STEP expr 
                                   2201 ; optional third par of FOR loop
                                   2202 ; initialization. 	
                                   2203 ;------------------------------------
      00151E                       2204 kword_step: ; {var limit -- var limit step}
      00151E CD 0C E2         [ 4] 2205     call expression 
      001521                       2206 2$:	
      001521 1F 01            [ 2] 2207 	ldw (FSTEP,sp),x ; step
                                   2208 ; leave loop back entry point on stack 
      001523                       2209 store_loop_addr:
      001523 17 09            [ 2] 2210 	ldw (BPTR,sp),y 
      001525                       2211 	_ldxz line.addr 
      001525 BE 33                    1     .byte 0xbe,line.addr 
      001527 1F 07            [ 2] 2212 	ldw (LN_ADDR,sp),x   
      001529                       2213 	_next 
      001529 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2214 
                                   2215 ;--------------------------------
                                   2216 ; BASIC: NEXT var 
                                   2217 ; FOR loop control 
                                   2218 ; increment variable with step 
                                   2219 ; and compare with limit 
                                   2220 ; loop if threshold not crossed.
                                   2221 ; else stack. 
                                   2222 ;--------------------------------
                           000002  2223 	OFS=2 ; offset added by pushw y 
      00152C                       2224 kword_next: ; {var limit step retl1 -- [var limit step ] }
                                   2225 ; skip over variable name 
      00152C                       2226 	_tnz for_nest 
      00152C 3D 48                    1     .byte 0x3d,for_nest 
      00152E 26 05            [ 1] 2227 	jrne 1$ 
      001530 A6 06            [ 1] 2228 	ld a,#ERR_BAD_NEXT 
      001532 CC 09 83         [ 2] 2229 	jp tb_error
      001535                       2230 1$:
      001535 72 A9 00 03      [ 2] 2231 	addw y,#3 ; ignore variable token 
      001539 1E 05            [ 2] 2232 	ldw x,(CVAR,sp)
      00153B                       2233 	_strxz ptr16 
      00153B BF 00                    1     .byte 0xbf,ptr16 
                                   2234 	; increment variable 
      00153D FE               [ 2] 2235 	ldw x,(x)  ; get var value 
      00153E 72 FB 01         [ 2] 2236 	addw x,(FSTEP,sp) ; var+step 
      001541 72 CF 00 00      [ 5] 2237 	ldw [ptr16],x 
      001545 72 F0 03         [ 2] 2238 	subw x,(LIMIT,sp) 
      001548                       2239 	_strxz acc16 
      001548 BF 00                    1     .byte 0xbf,acc16 
      00154A 27 06            [ 1] 2240 	jreq loop_back
      00154C                       2241 	_ldaz acc16 
      00154C B6 00                    1     .byte 0xb6,acc16 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 127.
Hexadecimal [24-Bits]



      00154E 18 01            [ 1] 2242 	xor a,(FSTEP,sp)
      001550 2A 0A            [ 1] 2243 	jrpl loop_done 
      001552                       2244 loop_back:
      001552 16 09            [ 2] 2245 	ldw y,(BPTR,sp)
      001554 1E 07            [ 2] 2246 	ldw x,(LN_ADDR,sp)
      001556 CF 00 33         [ 2] 2247 	ldw line.addr,x 
      001559                       2248 1$:	_next 
      001559 CC 0A EA         [ 2]    1         jp interp_loop 
      00155C                       2249 loop_done:
      00155C                       2250 	_decz for_nest 
      00155C 3A 48                    1     .byte 0x3a,for_nest 
                                   2251 	; remove loop data from stack  
      00155E                       2252 	_drop VSIZE 
      00155E 5B 0A            [ 2]    1     addw sp,#VSIZE 
      001560                       2253 	_next 
      001560 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2254 
                                   2255 ;----------------------------
                                   2256 ; called by goto/gosub
                                   2257 ; to get target line number 
                                   2258 ; output:
                                   2259 ;    x    line address 
                                   2260 ;---------------------------
      001563                       2261 get_target_line:
      001563 CD 0C E2         [ 4] 2262 	call expression 
      001566                       2263 target01: 
      001566 4F               [ 1] 2264 	clr a 
      001567 72 01 00 43 0C   [ 2] 2265 	btjf flags,#FRUN,2$ 
      00156C 72 C3 00 33      [ 4] 2266 0$:	cpw x,[line.addr] 
      001570 25 06            [ 1] 2267 	jrult 2$ ; search from lomem 
      001572 22 03            [ 1] 2268 	jrugt 1$
      001574 CE 00 33         [ 2] 2269 	ldw x,line.addr
      001577 43               [ 1] 2270 1$:	cpl a  ; search from this line#
      001578                       2271 2$: 	
      001578 CD 00 9C         [ 4] 2272 	call search_lineno 
      00157B 4D               [ 1] 2273 	tnz a ; 0 if not found  
      00157C 26 05            [ 1] 2274 	jrne 3$ 
      00157E A6 04            [ 1] 2275 	ld a,#ERR_BAD_BRANCH  
      001580 CC 09 83         [ 2] 2276 	jp tb_error 
      001583                       2277 3$:
      001583 81               [ 4] 2278 	ret 
                                   2279 
                                   2280 ;------------------------
                                   2281 ; BASIC: GOTO line# 
                                   2282 ; jump to line# 
                                   2283 ; here cstack is 2 call deep from interpreter 
                                   2284 ;------------------------
      001584                       2285 kword_goto:
      001584                       2286 kword_goto_1:
      001584 CD 15 63         [ 4] 2287 	call get_target_line
      001587 72 00 00 43 04   [ 2] 2288 	btjt flags,#FRUN,1$
                                   2289 ; goto line# from command line 
      00158C 72 10 00 43      [ 1] 2290 	bset flags,#FRUN 
      001590                       2291 1$:
      001590                       2292 jp_to_target:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 128.
Hexadecimal [24-Bits]



      001590 CF 00 33         [ 2] 2293 	ldw line.addr,x 
      001593 1C 00 03         [ 2] 2294 	addw x,#LINE_HEADER_SIZE
      001596 90 93            [ 1] 2295 	ldw y,x   
      001598 72 0F 00 43 03   [ 2] 2296 	btjf flags,#FTRACE,9$ 
      00159D CD 0B 24         [ 4] 2297 	call prt_line_no 
      0015A0                       2298 9$:	_next
      0015A0 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2299 
                                   2300 
                                   2301 ;--------------------
                                   2302 ; BASIC: GOSUB line#
                                   2303 ; basic subroutine call
                                   2304 ; actual line# and basicptr 
                                   2305 ; are saved on stack
                                   2306 ;--------------------
                           000001  2307 	RET_BPTR=1 ; basicptr return point 
                           000003  2308 	RET_LN_ADDR=3  ; line.addr return point 
                           000004  2309 	VSIZE=4 
      0015A3                       2310 kword_gosub:
      0015A3                       2311 kword_gosub_1:
      0015A3                       2312 	_ldaz gosub_nest 
      0015A3 B6 49                    1     .byte 0xb6,gosub_nest 
      0015A5 A1 08            [ 1] 2313 	cp a,#8 
      0015A7 2B 05            [ 1] 2314 	jrmi 1$
      0015A9 A6 07            [ 1] 2315 	ld a,#ERR_GOSUBS
      0015AB CC 09 83         [ 2] 2316 	jp tb_error 
      0015AE 4C               [ 1] 2317 1$: inc a
      0015AF                       2318 	_straz gosub_nest 
      0015AF B7 49                    1     .byte 0xb7,gosub_nest 
      0015B1 CD 15 63         [ 4] 2319 	call get_target_line 
      0015B4 CF 00 00         [ 2] 2320 	ldw ptr16,x ; target line address 
      0015B7                       2321 kword_gosub_2: 
      0015B7                       2322 	_vars VSIZE  
      0015B7 52 04            [ 2]    1     sub sp,#VSIZE 
                                   2323 ; save BASIC subroutine return point.   
      0015B9 17 01            [ 2] 2324 	ldw (RET_BPTR,sp),y 
      0015BB                       2325 	_ldxz line.addr 
      0015BB BE 33                    1     .byte 0xbe,line.addr 
      0015BD 1F 03            [ 2] 2326 	ldw (RET_LN_ADDR,sp),x
      0015BF                       2327 	_ldxz ptr16  
      0015BF BE 00                    1     .byte 0xbe,ptr16 
      0015C1 20 CD            [ 2] 2328 	jra jp_to_target
                                   2329 
                                   2330 ;------------------------
                                   2331 ; BASIC: RETURN 
                                   2332 ; exit from BASIC subroutine 
                                   2333 ;------------------------
      0015C3                       2334 kword_return:
      0015C3 72 5D 00 49      [ 1] 2335 	tnz gosub_nest 
      0015C7 26 05            [ 1] 2336 	jrne 1$ 
      0015C9 A6 05            [ 1] 2337 	ld a,#ERR_BAD_RETURN 
      0015CB CC 09 83         [ 2] 2338 	jp tb_error 
      0015CE                       2339 1$:
      0015CE                       2340 	_decz gosub_nest
      0015CE 3A 49                    1     .byte 0x3a,gosub_nest 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 129.
Hexadecimal [24-Bits]



      0015D0 16 01            [ 2] 2341 	ldw y,(RET_BPTR,sp) 
      0015D2 1E 03            [ 2] 2342 	ldw x,(RET_LN_ADDR,sp)
      0015D4 CF 00 33         [ 2] 2343 	ldw line.addr,x 
      0015D7                       2344 	_drop VSIZE 
      0015D7 5B 04            [ 2]    1     addw sp,#VSIZE 
      0015D9                       2345 	_next 
      0015D9 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2346 
                                   2347 ;----------------------------------
                                   2348 ; BASIC: RUN [line#]
                                   2349 ; run BASIC program in RAM
                                   2350 ;----------------------------------- 
      0015DC                       2351 cmd_run: 
      0015DC 72 01 00 43 03   [ 2] 2352 	btjf flags,#FRUN,1$  
      0015E1                       2353 	_next ; already running 
      0015E1 CC 0A EA         [ 2]    1         jp interp_loop 
      0015E4                       2354 1$: 
      0015E4 90 F6            [ 1] 2355 	ld a,(y)
      0015E6 A1 06            [ 1] 2356 	cp a,#QUOTE_IDX
      0015E8 27 33            [ 1] 2357 	jreq 10$
      0015EA CE 00 3B         [ 2] 2358 	ldw x,progend 
      0015ED C3 00 37         [ 2] 2359 	cpw x,lomem 
      0015F0 27 28            [ 1] 2360 	jreq 9$
      0015F2 CD 1A 0A         [ 4] 2361 	call clear_state 
      0015F5 AE 17 FF         [ 2] 2362 	ldw x,#STACK_EMPTY
      0015F8 94               [ 1] 2363 	ldw sp,x 
      0015F9 CD 0B F3         [ 4] 2364 	call arg_list 
      0015FC 4D               [ 1] 2365 	tnz  a 
      0015FD 27 0D            [ 1] 2366 	jreq 2$
      0015FF                       2367 	_i16_pop
      0015FF 85               [ 2]    1     popw x 
      001600 4F               [ 1] 2368 	clr a  
      001601 CD 00 9C         [ 4] 2369 	call search_lineno 
      001604 4D               [ 1] 2370 	tnz a
      001605 26 08            [ 1] 2371 	jrne 3$ 
      001607 A6 0D            [ 1] 2372 	ld a,#ERR_RANGE 
      001609 CC 09 83         [ 2] 2373 	jp tb_error 
      00160C                       2374 2$:
      00160C CE 00 37         [ 2] 2375 	ldw x,lomem 
      00160F                       2376 3$:
      00160F                       2377 	_strxz line.addr 
      00160F BF 33                    1     .byte 0xbf,line.addr 
      001611 1C 00 03         [ 2] 2378 	addw x,#LINE_HEADER_SIZE
      001614 90 93            [ 1] 2379 	ldw y,x 
      001616 72 10 00 43      [ 1] 2380 	bset flags,#FRUN 
      00161A                       2381 9$:
      00161A                       2382 	_next 
      00161A CC 0A EA         [ 2]    1         jp interp_loop 
                                   2383 ;------------------------
                                   2384 ; load and run file
                                   2385 ;------------------------
      00161D                       2386 10$:
      00161D 90 5C            [ 1] 2387 	incw y 
      00161F CD 17 C2         [ 4] 2388 	call basic_load_file
      001622 CE 00 3B         [ 2] 2389 	ldw x,progend 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 130.
Hexadecimal [24-Bits]



      001625 C3 00 37         [ 2] 2390 	cpw x,lomem 
      001628 22 E2            [ 1] 2391 	jrugt 2$ 
      00162A                       2392 	_next 
      00162A CC 0A EA         [ 2]    1         jp interp_loop 
                                   2393 
                                   2394 ;----------------------
                                   2395 ; BASIC: END
                                   2396 ; end running program
                                   2397 ;---------------------- 
                           000001  2398 	CHAIN_LN=1 
                           000003  2399 	CHAIN_BP=3
                           000005  2400 	CHAIN_TXTBGN=5
                           000007  2401 	CHAIN_TXTEND=7
                           000008  2402 	CHAIN_CNTX_SIZE=8  
      00162D                       2403 kword_end: 
      00162D                       2404 8$: ; clean stack 
      00162D AE 17 FF         [ 2] 2405 	ldw x,#STACK_EMPTY
      001630 94               [ 1] 2406 	ldw sp,x 
      001631                       2407 	_rst_pending 
      001631 AE 00 5C         [ 2]    1     ldw x,#pending_stack+PENDING_STACK_SIZE
      001634                          2     _strxz psp 
      001634 BF 4A                    1     .byte 0xbf,psp 
      001636 CC 0A B2         [ 2] 2408 	jp warm_start
                                   2409 
                                   2410 ;-----------------------
                                   2411 ; BASIC: TONE expr1,expr2
                                   2412 ; use TIMER2 channel 1
                                   2413 ; to produce a tone 
                                   2414 ; arguments:
                                   2415 ;    expr1   frequency 
                                   2416 ;    expr2   duration msec.
                                   2417 ;---------------------------
                           000001  2418 	DURATION=1 
                           000003  2419 	FREQ=DURATION+INT_SIZE
                           000005  2420 	YSAVE=FREQ+INT_SIZE 
                           000006  2421 	VSIZE=2*INT_SIZE+2    
      001639                       2422 cmd_tone:
      001639 90 89            [ 2] 2423 	pushw y
      00163B CD 0B F3         [ 4] 2424 	call arg_list 
      00163E A1 02            [ 1] 2425 	cp a,#2 
      001640 27 03            [ 1] 2426 	jreq 0$ 
      001642 CC 09 81         [ 2] 2427 	jp syntax_error
      001645                       2428 0$:  
      001645 17 05            [ 2] 2429 	ldw (YSAVE,sp),y 
      001647                       2430 	_i16_fetch  FREQ 
      001647 1E 03            [ 2]    1     ldw x,(FREQ,sp)
      001649 90 93            [ 1] 2431 	ldw y,x 
      00164B                       2432 	_i16_fetch  DURATION 
      00164B 1E 01            [ 2]    1     ldw x,(DURATION,sp)
      00164D CD 00 00         [ 4] 2433 	call tone  
      001650 16 05            [ 2] 2434 	ldw y,(YSAVE,sp)
      001652                       2435 	_drop VSIZE 
      001652 5B 06            [ 2]    1     addw sp,#VSIZE 
      001654                       2436 	_next 
      001654 CC 0A EA         [ 2]    1         jp interp_loop 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 131.
Hexadecimal [24-Bits]



                                   2437 
                                   2438 
                                   2439 ;-----------------------
                                   2440 ; BASIC: STOP
                                   2441 ; stop progam execution  
                                   2442 ; without resetting pointers 
                                   2443 ; the program is resumed
                                   2444 ; with RUN 
                                   2445 ;-------------------------
      001657                       2446 kword_stop:
      001657 72 00 00 43 03   [ 2] 2447 	btjt flags,#FRUN,2$
      00165C                       2448 	_next 
      00165C CC 0A EA         [ 2]    1         jp interp_loop 
      00165F                       2449 2$:	 
                                   2450 ; create space on cstack to save context 
      00165F AE 16 81         [ 2] 2451 	ldw x,#stop_msg 
      001662 CD 00 00         [ 4] 2452 	call puts 
      001665                       2453 	_ldxz line.addr
      001665 BE 33                    1     .byte 0xbe,line.addr 
      001667 FE               [ 2] 2454 	ldw x,(x)
      001668 CD 00 00         [ 4] 2455 	call print_int 
      00166B AE 16 90         [ 2] 2456 	ldw x,#con_msg 
      00166E CD 00 00         [ 4] 2457 	call puts 
      001671                       2458 	_vars CTXT_SIZE ; context size 
      001671 52 04            [ 2]    1     sub sp,#CTXT_SIZE 
      001673 CD 12 90         [ 4] 2459 	call save_context 
      001676 72 11 00 43      [ 1] 2460 	bres flags,#FRUN 
      00167A 72 18 00 43      [ 1] 2461 	bset flags,#FSTOP
      00167E CC 0A B5         [ 2] 2462 	jp cmd_line  
                                   2463 
      001681 0A 53 54 4F 50 20 61  2464 stop_msg: .asciz "\nSTOP at line "
             74 20 6C 69 6E 65 20
             00
      001690 2C 20 43 4F 4E 20 74  2465 con_msg: .asciz ", CON to resume.\n"
             6F 20 72 65 73 75 6D
             65 2E 0A 00
                                   2466 
                                   2467 ;--------------------------------------
                                   2468 ; BASIC: CON 
                                   2469 ; continue execution after a STOP 
                                   2470 ;--------------------------------------
      0016A2                       2471 kword_con:
      0016A2 72 08 00 43 03   [ 2] 2472 	btjt flags,#FSTOP,1$ 
      0016A7                       2473 	_next 
      0016A7 CC 0A EA         [ 2]    1         jp interp_loop 
      0016AA                       2474 1$:
      0016AA CD 12 97         [ 4] 2475 	call rest_context 
      0016AD                       2476 	_drop CTXT_SIZE
      0016AD 5B 04            [ 2]    1     addw sp,#CTXT_SIZE 
      0016AF 72 19 00 43      [ 1] 2477 	bres flags,#FSTOP 
      0016B3 72 10 00 43      [ 1] 2478 	bset flags,#FRUN 
      0016B7 CC 0A EA         [ 2] 2479 	jp interp_loop
                                   2480 
                                   2481 ;-----------------------
                                   2482 ; BASIC: SCR (NEW)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 132.
Hexadecimal [24-Bits]



                                   2483 ; from command line only 
                                   2484 ; free program memory
                                   2485 ; and clear variables 
                                   2486 ;------------------------
      0016BA                       2487 cmd_scr: 
      0016BA                       2488 cmd_new: 
      0016BA 72 00 00 43 03   [ 2] 2489 0$:	btjt flags,#FRUN,9$
      0016BF CD 0A 3F         [ 4] 2490 	call reset_basic 
      0016C2                       2491 9$:	_next 
      0016C2 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2492 
                                   2493 ;-----------------------------------
                                   2494 ; BASIC: ERASE "name" || \F  
                                   2495 ;  options:
                                   2496 ;   "name"    erase that program only  
                                   2497 ;     \F    erase all spi eeprom  
                                   2498 ;-----------------------------------
                           000001  2499 	LIMIT=1  ; 24 bits address 
                           000003  2500 	VSIZE = 3 
      0016C5                       2501 cmd_erase:
      0016C5 72 01 00 43 03   [ 2] 2502 	btjf flags,#FRUN,0$
      0016CA                       2503 	_next 
      0016CA CC 0A EA         [ 2]    1         jp interp_loop 
      0016CD                       2504 0$:
      0016CD                       2505 	_clrz farptr
      0016CD 3F 00                    1     .byte 0x3f, farptr 
      0016CF 5F               [ 1] 2506 	clrw x 
      0016D0                       2507 	_strxz ptr16  
      0016D0 BF 00                    1     .byte 0xbf,ptr16 
      0016D2                       2508 	_next_token
      0016D2                          1         _get_char 
      0016D2 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      0016D4 90 5C            [ 1]    2         incw y      ; 1 cy 
      0016D6 A1 06            [ 1] 2509 	cp a,#QUOTE_IDX 
      0016D8 26 12            [ 1] 2510 	jrne not_file
      0016DA                       2511 erase_program: 
      0016DA 93               [ 1] 2512 	ldw x,y
      0016DB CD 0B 31         [ 4] 2513 	call skip_string  
      0016DE CD 06 D9         [ 4] 2514 	call search_file
      0016E1 4D               [ 1] 2515 	tnz a 
      0016E2 27 03            [ 1] 2516 	jreq 9$  ; not found 
      0016E4                       2517 8$:	
      0016E4 CD 07 05         [ 4] 2518 	call erase_file  
      0016E7                       2519 9$:	
      0016E7 90 7F            [ 1] 2520 	clr (y)
      0016E9                       2521 	_next 
      0016E9 CC 0A EA         [ 2]    1         jp interp_loop 
      0016EC                       2522 not_file: 
      0016EC A1 07            [ 1] 2523 	cp a,#LITC_IDX 
      0016EE 27 03            [ 1] 2524 	jreq 0$ 
      0016F0 CC 09 81         [ 2] 2525 	jp syntax_error	
      0016F3                       2526 0$: _get_char 
      0016F3 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      0016F5 90 5C            [ 1]    2         incw y      ; 1 cy 
      0016F7 A4 DF            [ 1] 2527 	and a,#0XDF 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 133.
Hexadecimal [24-Bits]



      0016F9 A1 46            [ 1] 2528 1$: cp a,#'F 
      0016FB 27 03            [ 1] 2529 	jreq 2$
      0016FD CC 09 81         [ 2] 2530 	jp syntax_error 
      001700                       2531 2$: 
      001700 CD 00 00         [ 4] 2532 	call eeprom_erase_chip 
      001703                       2533 	_next 
      001703 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2534 	
                                   2535 ;---------------------------------------
                                   2536 ; BASIC: SAVE "name" 
                                   2537 ; save program to spi eeprom 
                                   2538 ; if file already exist, replace it.
                                   2539 ;--------------------------------------
      001706                       2540 cmd_save:
      001706 72 01 00 43 03   [ 2] 2541 	btjf flags,#FRUN,0$
      00170B                       2542 	_next 
      00170B CC 0A EA         [ 2]    1         jp interp_loop 
      00170E                       2543 0$:
      00170E CE 00 3B         [ 2] 2544 	ldw x,progend  
      001711 72 B0 00 37      [ 2] 2545 	subw x,lomem 
      001715 27 36            [ 1] 2546 	jreq 6$ 
      001717                       2547 	_next_token 
      001717                          1         _get_char 
      001717 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      001719 90 5C            [ 1]    2         incw y      ; 1 cy 
      00171B A1 06            [ 1] 2548 	cp a,#QUOTE_IDX
      00171D 27 03            [ 1] 2549 	jreq 1$ 
      00171F CC 09 81         [ 2] 2550 	jp syntax_error 
      001722 93               [ 1] 2551 1$: ldw x,y 
      001723 CD 0B 31         [ 4] 2552 	call skip_string 
      001726 89               [ 2] 2553 	pushw x 
      001727 CD 06 D9         [ 4] 2554 	call search_file 
      00172A 4D               [ 1] 2555 	tnz a 
      00172B 27 08            [ 1] 2556 	jreq 2$
      00172D AE 17 61         [ 2] 2557 	ldw x,#file_exist 
      001730 CD 00 00         [ 4] 2558 	call puts 
      001733 20 27            [ 2] 2559 	jra 9$ 
      001735                       2560 2$:
      001735 CD 07 F5         [ 4] 2561 	call search_free
      001738 4D               [ 1] 2562 	tnz a 
      001739 26 0C            [ 1] 2563 	jrne 4$ 
      00173B CE 00 3B         [ 2] 2564 	ldw x,progend 
      00173E 72 B0 00 37      [ 2] 2565 	subw x,lomem 
      001742 CD 07 13         [ 4] 2566 	call reclaim_space 
      001745 27 0E            [ 1] 2567 	jreq 8$ 
      001747                       2568 4$: 
      001747 85               [ 2] 2569 	popw x 
      001748 CD 07 8C         [ 4] 2570 	call save_file
      00174B 20 0F            [ 2] 2571 	jra 9$ 
      00174D                       2572 6$: 
      00174D AE 17 72         [ 2] 2573 	ldw x,#no_prog  
      001750 CD 00 00         [ 4] 2574 	call puts 
      001753 20 07            [ 2] 2575 	jra 9$ 
      001755                       2576 8$: 
      001755 85               [ 2] 2577 	popw x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 134.
Hexadecimal [24-Bits]



      001756 AE 17 86         [ 2] 2578 	ldw x,#no_space 
      001759 CD 00 00         [ 4] 2579 	call puts 
      00175C                       2580 9$:
      00175C 90 7F            [ 1] 2581 	clr (y)
      00175E                       2582 	_next 
      00175E CC 0A EA         [ 2]    1         jp interp_loop 
                                   2583 
      001761 44 75 70 6C 69 63 61  2584 file_exist: .asciz "Duplicate name.\n"
             74 65 20 6E 61 6D 65
             2E 0A 00
      001772 4E 6F 20 70 72 6F 67  2585 no_prog: .asciz "No program in RAM.\n"
             72 61 6D 20 69 6E 20
             52 41 4D 2E 0A 00
      001786 46 69 6C 65 20 73 79  2586 no_space: .asciz "File system full.\n" 
             73 74 65 6D 20 66 75
             6C 6C 2E 0A 00
                                   2587 
                                   2588 ;-----------------------
                                   2589 ;BASIC: LOAD "fname"
                                   2590 ; load file in RAM 
                                   2591 ;-----------------------
      001799                       2592 cmd_load: 
      001799 72 01 00 43 03   [ 2] 2593 	btjf flags,#FRUN,0$
      00179E                       2594 	_next 
      00179E CC 0A EA         [ 2]    1         jp interp_loop 
      0017A1                       2595 0$:
      0017A1                       2596 	_next_token 
      0017A1                          1         _get_char 
      0017A1 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      0017A3 90 5C            [ 1]    2         incw y      ; 1 cy 
      0017A5 A1 06            [ 1] 2597 	cp a,#QUOTE_IDX
      0017A7 27 03            [ 1] 2598 	jreq 1$ 
      0017A9 CC 09 81         [ 2] 2599 	jp syntax_error
      0017AC                       2600 1$:
      0017AC CD 17 C2         [ 4] 2601 	call basic_load_file 
      0017AF                       2602 	_next  
      0017AF CC 0A EA         [ 2]    1         jp interp_loop 
                                   2603 
      0017B2 66 69 6C 65 20 6E 6F  2604 not_a_file: .asciz "file not found\n"
             74 20 66 6F 75 6E 64
             0A 00
                                   2605 
                                   2606 ;--------------------------
                                   2607 ; common factor 
                                   2608 ; for LOAD and RUN "file"
                                   2609 ;-------------------------
      0017C2                       2610 basic_load_file:
      0017C2 93               [ 1] 2611 	ldw x,y 
      0017C3 CD 0B 31         [ 4] 2612 	call skip_string 
      0017C6 CD 06 D9         [ 4] 2613 	call search_file
      0017C9 4D               [ 1] 2614 	tnz a 
      0017CA 26 08            [ 1] 2615 	jrne 2$ ; file found   
      0017CC AE 17 B2         [ 2] 2616 	ldw x,#not_a_file 
      0017CF CD 00 00         [ 4] 2617 	call puts 
      0017D2 20 06            [ 2] 2618 	jra 9$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 135.
Hexadecimal [24-Bits]



      0017D4                       2619 2$: 
      0017D4 CD 0A 3F         [ 4] 2620 	call reset_basic 
      0017D7 CD 07 63         [ 4] 2621 	call load_file
      0017DA                       2622 9$: 
      0017DA 90 7F            [ 1] 2623 	clr (y)
      0017DC 81               [ 4] 2624 	ret 
                                   2625 
                                   2626 
                                   2627 
                                   2628 ;---------------------
                                   2629 ; BASIC: DIR 
                                   2630 ; list programs saved 
                                   2631 ; in flash 
                                   2632 ;--------------------
                           000001  2633 	FCNT=1
      0017DD                       2634 cmd_dir:
      0017DD 72 01 00 43 03   [ 2] 2635 	btjf flags,#FRUN,0$
      0017E2                       2636 	_next 
      0017E2 CC 0A EA         [ 2]    1         jp interp_loop 
      0017E5                       2637 0$:
      0017E5 4B 00            [ 1] 2638 	push #0
      0017E7 4B 00            [ 1] 2639 	push #0 
      0017E9 CD 08 36         [ 4] 2640 	call first_file 
      0017EC                       2641 1$:	 
      0017EC 4D               [ 1] 2642 	tnz a 
      0017ED 27 36            [ 1] 2643 	jreq 9$ 
      0017EF 1E 01            [ 2] 2644 	ldw x,(FCNT,sp)
      0017F1 5C               [ 1] 2645 	incw x 
      0017F2 1F 01            [ 2] 2646 	ldw (FCNT,sp),x
      0017F4 AE 00 60         [ 2] 2647 	ldw x,#file_header+FILE_NAME_FIELD
      0017F7 89               [ 2] 2648 	pushw x 
      0017F8 CD 00 00         [ 4] 2649 	call puts
      0017FB 85               [ 2] 2650 	popw x 
      0017FC CD 00 00         [ 4] 2651 	call strlen
      0017FF 88               [ 1] 2652 	push a 
      001800 4B 00            [ 1] 2653 	push #0
      001802 AE 00 0C         [ 2] 2654 	ldw x,#FNAME_MAX_LEN 
      001805 72 F0 01         [ 2] 2655 	subw x,(1,sp) 
      001808 CD 00 00         [ 4] 2656 	call spaces 
      00180B                       2657 	_drop 2  
      00180B 5B 02            [ 2]    1     addw sp,#2 
      00180D AE 00 5E         [ 2] 2658 	ldw x,#file_header+FILE_SIZE_FIELD
      001810 FE               [ 2] 2659 	ldw x,(x)
      001811 CD 00 00         [ 4] 2660 	call print_int
      001814 AE 18 37         [ 2] 2661 	ldw x,#file_size 
      001817 CD 00 00         [ 4] 2662 	call puts 
      00181A AE 00 5C         [ 2] 2663 	ldw x,#file_header 
      00181D CD 08 7D         [ 4] 2664 	call skip_to_next 
      001820 CD 08 3B         [ 4] 2665 	call next_file 
      001823 20 C7            [ 2] 2666 	jra 1$  
      001825                       2667 9$:
      001825 CD 00 00         [ 4] 2668 	call new_line
      001828 85               [ 2] 2669 	popw x 	
      001829 CD 00 00         [ 4] 2670 	call print_int
      00182C AE 18 3E         [ 2] 2671 	ldw x,#files_count 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 136.
Hexadecimal [24-Bits]



      00182F CD 00 00         [ 4] 2672 	call puts 
      001832 90 7F            [ 1] 2673 	clr (y)
      001834                       2674 	_next 
      001834 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2675 
      001837 62 79 74 65 73 0A 00  2676 file_size: .asciz "bytes\n"
      00183E 66 69 6C 65 73 00     2677 files_count: .asciz "files"
                                   2678 
                                   2679 
                                   2680 
                                   2681 
                                   2682 ;------------------------------
                                   2683 ; BASIC: BYE 
                                   2684 ; exit BASIC and back to monitor  
                                   2685 ;------------------------------
      001844                       2686 cmd_bye:
      001844 72 00 00 43 09   [ 2] 2687 	btjt flags,#FRUN,9$ 
      001849 72 0D 52 40 FB   [ 2] 2688 	btjf UART_SR,#UART_SR_TC,.
      00184E                       2689 	_swreset
      00184E 35 80 50 D1      [ 1]    1     mov WWDG_CR,#0X80
      001852                       2690 9$: _next 
      001852 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2691 
                                   2692 ;-------------------------------
                                   2693 ; BASIC: SLEEP expr 
                                   2694 ; suspend execution for n msec.
                                   2695 ; input:
                                   2696 ;	none
                                   2697 ; output:
                                   2698 ;	none 
                                   2699 ;------------------------------
      001855                       2700 cmd_sleep:
      001855 CD 0C E2         [ 4] 2701 	call expression
      001858 72 11 00 00      [ 1] 2702 	bres sys_flags,#FSYS_TIMER 
      00185C CF 00 00         [ 2] 2703 	ldw timer,x
      00185F 8F               [10] 2704 1$:	wfi 
      001860 CE 00 00         [ 2] 2705 	ldw x,timer 
      001863 26 FA            [ 1] 2706 	jrne 1$
      001865                       2707 	_next 
      001865 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2708 
                                   2709 ;------------------------------
                                   2710 ; BASIC: TICKS
                                   2711 ; return msec ticks counter value 
                                   2712 ; input:
                                   2713 ; 	none 
                                   2714 ; output:
                                   2715 ;	X 	msec since reset 
                                   2716 ;-------------------------------
      001868                       2717 func_ticks:
      001868                       2718 	_ldxz ticks 
      001868 BE 00                    1     .byte 0xbe,ticks 
      00186A 81               [ 4] 2719 	ret
                                   2720 
                                   2721 ;---------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 137.
Hexadecimal [24-Bits]



                                   2722 ; BASIC: CHR$(expr)
                                   2723 ; return ascci character 
                                   2724 ;---------------------------------
      00186B                       2725 func_char:
      00186B A6 04            [ 1] 2726 	ld a,#LPAREN_IDX 
      00186D CD 0B DA         [ 4] 2727 	call expect 
      001870 CD 0C E2         [ 4] 2728 	call expression 
      001873 9F               [ 1] 2729 	ld a,xl 
      001874 5F               [ 1] 2730 	clrw x  
      001875 97               [ 1] 2731 	ld xl,a 
      001876 A6 05            [ 1] 2732 	ld a,#RPAREN_IDX 
      001878 CD 0B DA         [ 4] 2733 	call expect 
      00187B 81               [ 4] 2734 	ret 
                                   2735 
                                   2736 
                                   2737 ;------------------------------
                                   2738 ; BASIC: ABS(expr)
                                   2739 ; return absolute value of expr.
                                   2740 ; input:
                                   2741 ;   none
                                   2742 ; output:
                                   2743 ;   X   positive int16 
                                   2744 ;-------------------------------
      00187C                       2745 func_abs:
      00187C CD 0B E8         [ 4] 2746 	call func_args 
      00187F A1 01            [ 1] 2747 	cp a,#1 
      001881 27 03            [ 1] 2748 	jreq 0$ 
      001883 CC 09 81         [ 2] 2749 	jp syntax_error
      001886                       2750 0$: 
      001886                       2751 	_i16_pop
      001886 85               [ 2]    1     popw x 
      001887 5D               [ 2] 2752 	tnzw x 
      001888 2A 01            [ 1] 2753 	jrpl 1$  
      00188A 50               [ 2] 2754 	negw x 
      00188B 81               [ 4] 2755 1$:	ret 
                                   2756 
                                   2757 ;---------------------------------
                                   2758 ; BASIC: RND(n)
                                   2759 ; return integer [0..n-1] 
                                   2760 ; ref: https://en.wikipedia.org/wiki/Xorshift
                                   2761 ;
                                   2762 ; 	x ^= x << 13;
                                   2763 ;	x ^= x >> 17;
                                   2764 ;	x ^= x << 5;
                                   2765 ;
                                   2766 ;---------------------------------
      00188C                       2767 func_random:
      00188C CD 0B E8         [ 4] 2768 	call func_args 
      00188F A1 01            [ 1] 2769 	cp a,#1
      001891 27 03            [ 1] 2770 	jreq 1$
      001893 CC 09 81         [ 2] 2771 	jp syntax_error
      001896                       2772 1$:
      001896 CD 00 00         [ 4] 2773 	call prng 
      001899 90 89            [ 2] 2774 	pushw y 
      00189B 16 03            [ 2] 2775 	ldw y,(3,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 138.
Hexadecimal [24-Bits]



      00189D 65               [ 2] 2776 	divw x,y 
      00189E 51               [ 1] 2777 	exgw x,y 
      00189F 90 85            [ 2] 2778 	popw y 
      0018A1                       2779 	_drop 2 
      0018A1 5B 02            [ 2]    1     addw sp,#2 
      0018A3 81               [ 4] 2780 	ret 
                                   2781 
                                   2782 ;---------------------------------
                                   2783 ; BASIC: RANDOMIZE expr 
                                   2784 ; intialize PRGN seed with expr 
                                   2785 ; or with ticks variable value 
                                   2786 ; if expr==0
                                   2787 ;---------------------------------
      0018A4                       2788 cmd_randomize:
      0018A4 CD 0C E2         [ 4] 2789 	call expression 
      0018A7 CD 00 00         [ 4] 2790 	call set_seed 
      0018AA                       2791 	_next 
      0018AA CC 0A EA         [ 2]    1         jp interp_loop 
                                   2792 
                                   2793 ;------------------------------
                                   2794 ; BASIC: SGN(expr)
                                   2795 ;    return -1 < 0 
                                   2796 ;    return 0 == 0
                                   2797 ;    return 1 > 0 
                                   2798 ;-------------------------------
      0018AD                       2799 func_sign:
      0018AD CD 0B E8         [ 4] 2800 	call func_args 
      0018B0 A1 01            [ 1] 2801 	cp a,#1 
      0018B2 27 03            [ 1] 2802 	jreq 0$ 
      0018B4 CC 09 81         [ 2] 2803 	jp syntax_error
      0018B7                       2804 0$:
      0018B7                       2805 	_i16_pop  
      0018B7 85               [ 2]    1     popw x 
      0018B8 5D               [ 2] 2806 	tnzw x 
      0018B9 27 09            [ 1] 2807 	jreq 9$
      0018BB 2B 04            [ 1] 2808 	jrmi 4$
      0018BD AE 00 01         [ 2] 2809 	ldw x,#1
      0018C0 81               [ 4] 2810 	ret
      0018C1 AE FF FF         [ 2] 2811 4$: ldw x,#-1    
      0018C4 81               [ 4] 2812 9$:	ret 
                                   2813 
                                   2814 ;-----------------------------
                                   2815 ; BASIC: LEN(var$||quoted string)
                                   2816 ;  return length of string 
                                   2817 ;----------------------------
      0018C5                       2818 func_len:
      0018C5 A6 04            [ 1] 2819 	ld a,#LPAREN_IDX 
      0018C7 CD 0B DA         [ 4] 2820 	call expect 
      0018CA                       2821 	_next_token 
      0018CA                          1         _get_char 
      0018CA 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
      0018CC 90 5C            [ 1]    2         incw y      ; 1 cy 
      0018CE A1 06            [ 1] 2822 	cp a,#QUOTE_IDX
      0018D0 26 10            [ 1] 2823 	jrne 2$ 
      0018D2 93               [ 1] 2824 	ldw x,y 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 139.
Hexadecimal [24-Bits]



      0018D3 CD 00 00         [ 4] 2825 	call strlen
      0018D6 88               [ 1] 2826 	push a 
      0018D7 4B 00            [ 1] 2827 	push #0 
      0018D9 72 F9 01         [ 2] 2828 	addw y,(1,sp)
      0018DC 90 5C            [ 1] 2829 	incw y 
      0018DE                       2830 	_drop 2 
      0018DE 5B 02            [ 2]    1     addw sp,#2 
      0018E0 20 10            [ 2] 2831 	jra 9$ 
      0018E2                       2832 2$:
      0018E2 A1 0A            [ 1] 2833 	cp a,#STR_VAR_IDX 
      0018E4 27 03            [ 1] 2834 	jreq 3$ 
      0018E6 CC 09 81         [ 2] 2835 	jp syntax_error
      0018E9                       2836 3$:
      0018E9 CD 0F 84         [ 4] 2837 	call get_var_adr  
      0018EC EE 02            [ 2] 2838 	ldw x,(2,x) 
      0018EE 5C               [ 1] 2839 	incw x 
      0018EF CD 00 00         [ 4] 2840 	call strlen
      0018F2                       2841 9$:
      0018F2 5F               [ 1] 2842 	clrw x 
      0018F3 97               [ 1] 2843 	ld xl,a 
      0018F4 A6 05            [ 1] 2844 	ld a,#RPAREN_IDX
      0018F6 CD 0B DA         [ 4] 2845 	call expect 
      0018F9 81               [ 4] 2846 	ret 
                                   2847 
                           000001  2848 .if 1
                                   2849 ;---------------------------------
                                   2850 ; BASIC: WORDS [\C]
                                   2851 ; affiche la listes des mots 
                                   2852 ; réservés ainsi que le nombre
                                   2853 ; de mots.
                                   2854 ; si l'option \C est présente 
                                   2855 ; affiche la valeur tokenizé des 
                                   2856 ; mots réservés 
                                   2857 ;---------------------------------
                           000001  2858 	COL_CNT=1 ; column counter 
                           000002  2859 	WCNT=COL_CNT+1 ; count words printed 
                           000003  2860 	SHOW_CODE=WCNT+1 ; display token code
                           000004  2861 	YSAVE=SHOW_CODE+1
                           000006  2862 	XSAVE=YSAVE+2 
                           000007  2863 	VSIZE=XSAVE+1  	
      0018FA                       2864 cmd_words:
      0018FA                       2865 	_vars VSIZE 
      0018FA 52 07            [ 2]    1     sub sp,#VSIZE 
      0018FC 0F 01            [ 1] 2866 	clr (COL_CNT,sp) 
      0018FE 0F 02            [ 1] 2867 	clr (WCNT,sp)
      001900 0F 03            [ 1] 2868 	clr (SHOW_CODE,sp)
      001902                       2869 	_clrz acc16 
      001902 3F 00                    1     .byte 0x3f, acc16 
      001904 17 04            [ 2] 2870 	ldw (YSAVE,sp),y 
      001906 90 F6            [ 1] 2871 	ld a,(y)
      001908 A1 07            [ 1] 2872 	cp a,#LITC_IDX 
      00190A 26 17            [ 1] 2873 	jrne 1$ 
      00190C 90 5C            [ 1] 2874 	incw y 
      00190E                       2875 	_get_char 
      00190E 90 F6            [ 1]    1         ld a,(y)    ; 1 cy 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 140.
Hexadecimal [24-Bits]



      001910 90 5C            [ 1]    2         incw y      ; 1 cy 
      001912 A1 43            [ 1] 2876 	cp a,#'C 
      001914 27 03            [ 1] 2877 	jreq 0$ 
      001916 CC 09 81         [ 2] 2878 	jp syntax_error 
      001919                       2879 0$: 
      001919 17 04            [ 2] 2880 	ldw (YSAVE,sp),y 
      00191B 03 03            [ 1] 2881 	cpl (SHOW_CODE,sp)
      00191D 90 AE 1F 13      [ 2] 2882 	ldw y,#all_words+2 ; special char. bytecode 
      001921 20 04            [ 2] 2883 	jra 2$
      001923                       2884 1$: 
      001923 90 AE 1E 96      [ 2] 2885 	ldw y,#kword_dict+2 ; show only reserved words 
      001927                       2886 2$:
      001927 93               [ 1] 2887 	ldw x,y
      001928 F6               [ 1] 2888 	ld a,(x) ; word length 
      001929 5C               [ 1] 2889 	incw x ; *word   	
      00192A 0D 03            [ 1] 2890 	tnz (SHOW_CODE,sp)
      00192C 27 17            [ 1] 2891 	jreq 3$
      00192E 1F 06            [ 2] 2892 	ldw (XSAVE,sp),x 
      001930 4C               [ 1] 2893 	inc a 
      001931                       2894 	_straz acc8 	 	
      001931 B7 00                    1     .byte 0xb7,acc8 
      001933 72 BB 00 00      [ 2] 2895 	addw x,acc16 
      001937 A6 24            [ 1] 2896 	ld a,#'$
      001939 CD 00 00         [ 4] 2897 	call uart_putc 
      00193C F6               [ 1] 2898 	ld a,(x)
      00193D CD 00 00         [ 4] 2899 	call print_hex
      001940 CD 00 00         [ 4] 2900 	call space
      001943 1E 06            [ 2] 2901 	ldw x,(XSAVE,sp)   
      001945                       2902 3$:
      001945 CD 00 00         [ 4] 2903 	call puts
      001948 0C 02            [ 1] 2904 	inc (WCNT,sp)
      00194A 0C 01            [ 1] 2905 	inc (COL_CNT,sp)
      00194C 7B 01            [ 1] 2906 	ld a,(COL_CNT,sp)
      00194E A1 04            [ 1] 2907 	cp a,#4 
      001950 27 07            [ 1] 2908 	jreq 5$ 
      001952 4E               [ 1] 2909 	swap a 
      001953 4C               [ 1] 2910 	inc a 
      001954 CD 00 00         [ 4] 2911 	call cursor_column
      001957 20 05            [ 2] 2912 	jra  6$  
      001959                       2913 5$: 
      001959 CD 00 00         [ 4] 2914 	call new_line   
      00195C 0F 01            [ 1] 2915 	clr (COL_CNT,sp) 
      00195E                       2916 6$:	
      00195E 72 A2 00 02      [ 2] 2917 	subw y,#2 
      001962 90 FE            [ 2] 2918 	ldw y,(y)
      001964 26 C1            [ 1] 2919 	jrne 2$ 
      001966 A6 0D            [ 1] 2920 	ld a,#CR 
      001968 CD 00 00         [ 4] 2921 	call uart_putc  
      00196B 5F               [ 1] 2922 	clrw x 
      00196C 7B 02            [ 1] 2923 	ld a,(WCNT,sp)
      00196E 97               [ 1] 2924 	ld xl,a 
      00196F CD 00 00         [ 4] 2925 	call print_int 
      001972 AE 19 7F         [ 2] 2926 	ldw x,#words_count_msg
      001975 CD 00 00         [ 4] 2927 	call puts 
      001978 16 04            [ 2] 2928 	ldw y,(YSAVE,sp)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 141.
Hexadecimal [24-Bits]



      00197A                       2929 	_drop VSIZE 
      00197A 5B 07            [ 2]    1     addw sp,#VSIZE 
      00197C                       2930 	_next 
      00197C CC 0A EA         [ 2]    1         jp interp_loop 
      00197F 20 77 6F 72 64 73 20  2931 words_count_msg: .asciz " words in dictionary\n"
             69 6E 20 64 69 63 74
             69 6F 6E 61 72 79 0A
             00
                                   2932 .endif 
                                   2933 
                                   2934 ;-----------------------------
                                   2935 ; BASIC: TIMER expr 
                                   2936 ; initialize count down timer 
                                   2937 ;-----------------------------
      001995                       2938 cmd_set_timer:
      001995 CD 0B F3         [ 4] 2939 	call arg_list
      001998 A1 01            [ 1] 2940 	cp a,#1 
      00199A 27 03            [ 1] 2941 	jreq 1$
      00199C CC 09 81         [ 2] 2942 	jp syntax_error
      00199F                       2943 1$: 
      00199F                       2944 	_i16_pop  
      00199F 85               [ 2]    1     popw x 
      0019A0 72 11 00 00      [ 1] 2945 	bres sys_flags,#FSYS_TIMER  
      0019A4 CF 00 00         [ 2] 2946 	ldw timer,x
      0019A7                       2947 	_next 
      0019A7 CC 0A EA         [ 2]    1         jp interp_loop 
                                   2948 
                                   2949 ;------------------------------
                                   2950 ; BASIC: TIMEOUT 
                                   2951 ; return state of timer 
                                   2952 ; output:
                                   2953 ;   A:X     0 not timeout 
                                   2954 ;   A:X     -1 timeout 
                                   2955 ;------------------------------
      0019AA                       2956 func_timeout:
      0019AA 4F               [ 1] 2957 	clr a 
      0019AB 5F               [ 1] 2958 	clrw x 
      0019AC 72 01 00 00 02   [ 2] 2959 	btjf sys_flags,#FSYS_TIMER,1$ 
      0019B1 43               [ 1] 2960 	cpl a 
      0019B2 53               [ 2] 2961 	cplw x 
      0019B3 81               [ 4] 2962 1$:	ret 
                                   2963  	
                           000000  2964 .if 0
                                   2965 ;---------------------------
                                   2966 ; BASIC: DATA 
                                   2967 ; when the interpreter find 
                                   2968 ; a DATA line it skip over 
                                   2969 ;---------------------------
                                   2970 kword_data:
                                   2971 	jp kword_remark
                                   2972 
                                   2973 ;------------------------------
                                   2974 ; check if line is data line 
                                   2975 ; if so set data_pointers 
                                   2976 ; and return true 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 142.
Hexadecimal [24-Bits]



                                   2977 ; else move X to next line 
                                   2978 ; and return false 
                                   2979 ; input:
                                   2980 ;    X     line addr 
                                   2981 ; outpu:
                                   2982 ;    A     0 not data 
                                   2983 ;          1 data pointers set 
                                   2984 ;    X     updated to next line addr 
                                   2985 ;          if not data line 
                                   2986 ;--------------------------------
                                   2987 is_data_line:
                                   2988 	ld a,(LINE_HEADER_SIZE,x)
                                   2989 	cp a,#DATA_IDX 
                                   2990 	jrne 1$
                                   2991 	_strxz data_line 
                                   2992 	addw x,#FIRST_DATA_ITEM
                                   2993 	_strxz data_ptr  
                                   2994 	ld a,#1 
                                   2995 	ret 
                                   2996 1$: clr acc16 
                                   2997 	ld a,(2,x)
                                   2998 	ld acc8,a 
                                   2999 	addw x,acc16
                                   3000 	clr a 
                                   3001 	ret  
                                   3002 
                                   3003 ;---------------------------------
                                   3004 ; BASIC: RESTORE [line#]
                                   3005 ; set data_ptr to first data line
                                   3006 ; if no DATA found pointer set to
                                   3007 ; zero.
                                   3008 ; if a line# is given as argument 
                                   3009 ; a data line with that number 
                                   3010 ; is searched and the data pointer 
                                   3011 ; is set to it. If there is no 
                                   3012 ; data line with that number 
                                   3013 ; the program is interrupted. 
                                   3014 ;---------------------------------
                                   3015 cmd_restore:
                                   3016 	clrw x 
                                   3017 	ldw data_line,x 
                                   3018 	ldw data_ptr,x 
                                   3019 	_next_token 
                                   3020 	cp a,#CMD_END 
                                   3021 	jrugt 0$ 
                                   3022 	_unget_token 
                                   3023 	_ldxz lomem 
                                   3024 	jra 4$ 
                                   3025 0$:	cp a,#LITW_IDX
                                   3026 	jreq 2$
                                   3027 1$: jp syntax_error 	 
                                   3028 2$:	_get_word 
                                   3029 	call search_lineno  
                                   3030 	tnz a  
                                   3031 	jreq data_error 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 143.
Hexadecimal [24-Bits]



                                   3032 	call is_data_line
                                   3033 	tnz a 
                                   3034 	jrne 9$ 
                                   3035 	jreq data_error
                                   3036 4$:
                                   3037 ; search first DATA line 	
                                   3038 5$:	
                                   3039 	cpw x,himem
                                   3040 	jruge data_error 
                                   3041 	call is_data_line 
                                   3042 	tnz a 
                                   3043 	jreq 5$ 
                                   3044 9$:	_next  
                                   3045 
                                   3046 data_error:	
                                   3047     ld a,#ERR_NO_DATA 
                                   3048 	jp tb_error 
                                   3049 
                                   3050 
                                   3051 ;---------------------------------
                                   3052 ; BASIC: READ 
                                   3053 ; return next data item | data error
                                   3054 ; output:
                                   3055 ;    A:X int24  
                                   3056 ;---------------------------------
                                   3057 func_read_data:
                                   3058 read01:	
                                   3059 	ldw x,data_ptr
                                   3060 	ld a,(x)
                                   3061 	incw x 
                                   3062 	tnz a 
                                   3063 	jreq 4$ ; end of line
                                   3064 	cp a,#REM_IDX
                                   3065 	jreq 4$  
                                   3066 	cp a,#COMMA_IDX 
                                   3067 	jrne 1$ 
                                   3068 	ld a,(x)
                                   3069 	incw x 
                                   3070 1$:
                                   3071 .if 0
                                   3072 	cp a,#LIT_IDX 
                                   3073 	jreq 2$
                                   3074 .endif
                                   3075 	cp a,#LITW_IDX 
                                   3076 	jreq 14$
                                   3077 	jra data_error 
                                   3078 14$: ; word 
                                   3079 	clr a 
                                   3080 	_strxz data_ptr 	
                                   3081 	ldw x,(x)
                                   3082 .if 0	
                                   3083 	jra 24$
                                   3084 2$:	; int24  
                                   3085 	ld a,(x)
                                   3086 	incw x 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 144.
Hexadecimal [24-Bits]



                                   3087 	_strxz data_ptr 
                                   3088 	ldw x,(x)
                                   3089 24$:
                                   3090 .endif 
                                   3091 	pushw x 
                                   3092 	_ldxz data_ptr 
                                   3093 	addw x,#2 
                                   3094 	_strxz data_ptr
                                   3095 	popw x 
                                   3096 3$:
                                   3097 	ret 
                                   3098 4$: ; check if next line is DATA  
                                   3099 	_ldxz data_line
                                   3100 	ld a,(2,x)
                                   3101 	ld acc8,a
                                   3102 	clr acc16  
                                   3103 	addw x,acc16 
                                   3104 	call is_data_line 
                                   3105 	tnz a 
                                   3106 	jrne read01  
                                   3107 	jra data_error 
                                   3108 
                                   3109 ;-------------------------------
                                   3110 ; BASIC: CHAIN label
                                   3111 ; Execute another program like it 
                                   3112 ; is a sub-routine. When the 
                                   3113 ; called program terminate 
                                   3114 ; execution continue at caller 
                                   3115 ; after CHAIN command. 
                                   3116 ; if a line# is given, the 
                                   3117 ; chained program start execution 
                                   3118 ; at this line#.
                                   3119 ;---------------------------------
                                   3120 	CHAIN_ADDR=1 
                                   3121 	CHAIN_LNADR=3
                                   3122 	CHAIN_BP=5
                                   3123 	CHAIN_TXTBGN=7 
                                   3124 	CHAIN_TXTEND=9 
                                   3125 	VSIZE=10
                                   3126 	DISCARD=2
                                   3127 cmd_chain:
                                   3128 	_vars VSIZE 
                                   3129 	clr (CHAIN_LN,sp) 
                                   3130 	clr (CHAIN_LN+1,sp)  
                                   3131 	ld a,#LABEL_IDX 
                                   3132 	call expect 
                                   3133 	pushw y 
                                   3134 	call skip_label
                                   3135 	popw x 
                                   3136 	incw x
                                   3137 	call search_file 
                                   3138 	tnzw x  
                                   3139 	jrne 1$ 
                                   3140 0$:	ld a,#ERR_BAD_VALUE
                                   3141 	jp tb_error 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 145.
Hexadecimal [24-Bits]



                                   3142 1$: addw x,#FILE_HEADER_SIZE 
                                   3143 	ldw (CHAIN_ADDR,sp), x ; program addr 
                                   3144 ; save chain context 
                                   3145 	_ldxz line.addr 
                                   3146 	ldw (CHAIN_LNADR,sp),x 
                                   3147 	ldw (CHAIN_BP,sp),y
                                   3148 	_ldxz lomem 
                                   3149 	ldw (CHAIN_TXTBGN,sp),x
                                   3150 	_ldxz himem 
                                   3151 	ldw (CHAIN_TXTEND,sp),x  
                                   3152 ; set chained program context 	
                                   3153 	ldw x,(CHAIN_ADDR,sp)
                                   3154 	ldw line.addr,x 
                                   3155 	ldw lomem,x 
                                   3156 	subw x,#2
                                   3157 	ldw x,(x)
                                   3158 	addw x,(CHAIN_ADDR,sp)
                                   3159 	ldw himem,x  
                                   3160 	ldw y,(CHAIN_ADDR,sp)
                                   3161 	addw y,#LINE_HEADER_SIZE 
                                   3162     _incz chain_level
                                   3163 	_drop DISCARD
                                   3164 	_next 
                                   3165 
                                   3166 
                                   3167 ;-----------------------------
                                   3168 ; BASIC TRACE 0|1 
                                   3169 ; disable|enable line# trace 
                                   3170 ;-----------------------------
                                   3171 cmd_trace:
                                   3172 	_next_token
                                   3173 	cp a,#LITW_IDX
                                   3174 	jreq 1$ 
                                   3175 	jp syntax_error 
                                   3176 1$: _get_word 
                                   3177     tnzw x 
                                   3178 	jrne 2$ 
                                   3179 	bres flags,#FTRACE 
                                   3180 	_next 
                                   3181 2$: bset flags,#FTRACE 
                                   3182 	_next 
                                   3183 
                                   3184 .endif 
                                   3185 
                                   3186 ;-------------------------
                                   3187 ; BASIC: TAB expr 
                                   3188 ;  print spaces 
                                   3189 ;------------------------
      0019B4                       3190 cmd_tab:
      0019B4 CD 0C E2         [ 4] 3191 	call expression  
      0019B7 4F               [ 1] 3192 	clr a 
      0019B8 95               [ 1] 3193 	ld xh,a
      0019B9 CD 00 00         [ 4] 3194 	call spaces 
      0019BC                       3195 	_next 
      0019BC CC 0A EA         [ 2]    1         jp interp_loop 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 146.
Hexadecimal [24-Bits]



                                   3196 
                                   3197 ;---------------------
                                   3198 ; BASIC: CALL expr1 [,func_arg] 
                                   3199 ; execute a function written 
                                   3200 ; in binary code.
                                   3201 ; input:
                                   3202 ;   expr1	routine address
                                   3203 ;   expr2   optional argument passed in X  
                                   3204 ; output:
                                   3205 ;    none 
                                   3206 ;---------------------
                           000001  3207 	FN_ARG=1
                           000003  3208 	FN_ADR=3
      0019BF                       3209 cmd_call::
      0019BF CD 0B F3         [ 4] 3210 	call arg_list 
      0019C2 A1 01            [ 1] 3211 	cp a,#1
      0019C4 27 15            [ 1] 3212 	jreq 1$
      0019C6 A1 02            [ 1] 3213 	cp a,#2
      0019C8 27 03            [ 1] 3214 	jreq 0$ 
      0019CA CC 09 81         [ 2] 3215 	jp syntax_error 
      0019CD                       3216 0$: 
      0019CD                       3217 	_i16_fetch FN_ADR  
      0019CD 1E 03            [ 2]    1     ldw x,(FN_ADR,sp)
      0019CF                       3218 	_strxz ptr16 
      0019CF BF 00                    1     .byte 0xbf,ptr16 
      0019D1                       3219 	_i16_pop 
      0019D1 85               [ 2]    1     popw x 
      0019D2                       3220 	_drop 2 
      0019D2 5B 02            [ 2]    1     addw sp,#2 
      0019D4 72 CD 00 00      [ 6] 3221 	call [ptr16]
      0019D8                       3222 	_next 
      0019D8 CC 0A EA         [ 2]    1         jp interp_loop 
      0019DB                       3223 1$: _i16_pop 	
      0019DB 85               [ 2]    1     popw x 
      0019DC FD               [ 4] 3224 	call (x)
      0019DD                       3225 	_next 
      0019DD CC 0A EA         [ 2]    1         jp interp_loop 
                                   3226 
                                   3227 ;------------------------
                                   3228 ; BASIC:AUTO expr1, expr2 
                                   3229 ; enable auto line numbering
                                   3230 ;  expr1   start line number 
                                   3231 ;  expr2   line# increment 
                                   3232 ;-----------------------------
      0019E0                       3233 cmd_auto:
      0019E0 72 00 00 43 22   [ 2] 3234 	btjt flags,#FRUN,9$ 
      0019E5 AE 00 0A         [ 2] 3235 	ldw x,#10 
      0019E8                       3236 	_strxz auto_step 
      0019E8 BF 46                    1     .byte 0xbf,auto_step 
      0019EA                       3237 	_strxz auto_line 
      0019EA BF 44                    1     .byte 0xbf,auto_line 
      0019EC CD 0B F3         [ 4] 3238 	call arg_list 
      0019EF 4D               [ 1] 3239 	tnz a 
      0019F0 27 11            [ 1] 3240 	jreq 8$ 
      0019F2 A1 01            [ 1] 3241 	cp a,#1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 147.
Hexadecimal [24-Bits]



      0019F4 27 0A            [ 1] 3242 	jreq 1$
      0019F6 A1 02            [ 1] 3243 	cp a,#2
      0019F8 27 03            [ 1] 3244 	jreq 0$ 
      0019FA CC 09 81         [ 2] 3245 	jp syntax_error 
      0019FD                       3246 0$: 
      0019FD                       3247 	_i16_pop 
      0019FD 85               [ 2]    1     popw x 
      0019FE                       3248 	_strxz auto_step 
      0019FE BF 46                    1     .byte 0xbf,auto_step 
      001A00                       3249 1$:	
      001A00                       3250 	 _i16_pop 
      001A00 85               [ 2]    1     popw x 
      001A01                       3251 	_strxz auto_line
      001A01 BF 44                    1     .byte 0xbf,auto_line 
      001A03                       3252 8$:
      001A03 72 1C 00 43      [ 1] 3253 	bset flags,#FAUTO
      001A07                       3254 9$: 
      001A07                       3255 	_next 
      001A07 CC 0A EA         [ 2]    1         jp interp_loop 
                                   3256 
                                   3257 
      001A0A                       3258 clear_state:
      001A0A                       3259 	_ldxz dvar_bgn
      001A0A BE 3D                    1     .byte 0xbe,dvar_bgn 
      001A0C                       3260 	_strxz dvar_end 
      001A0C BF 3F                    1     .byte 0xbf,dvar_end 
      001A0E CE 00 39         [ 2] 3261 	ldw x,himem  
      001A11                       3262 	_strxz heap_free  
      001A11 BF 41                    1     .byte 0xbf,heap_free 
      001A13                       3263 	_rst_pending 
      001A13 AE 00 5C         [ 2]    1     ldw x,#pending_stack+PENDING_STACK_SIZE
      001A16                          2     _strxz psp 
      001A16 BF 4A                    1     .byte 0xbf,psp 
      001A18                       3264 	_clrz gosub_nest 
      001A18 3F 49                    1     .byte 0x3f, gosub_nest 
      001A1A                       3265 	_clrz for_nest
      001A1A 3F 48                    1     .byte 0x3f, for_nest 
      001A1C 81               [ 4] 3266 	ret 
                                   3267 
                                   3268 ;---------------------------
                                   3269 ; BASIC: CLR 
                                   3270 ; reset stacks 
                                   3271 ; clear all variables
                                   3272 ;----------------------------
      001A1D                       3273 cmd_clear:
      001A1D 72 00 00 43 07   [ 2] 3274 	btjt flags,#FRUN,9$
      001A22 AE 17 FF         [ 2] 3275 	ldw x,#STACK_EMPTY
      001A25 94               [ 1] 3276 	ldw sp,x 
      001A26 CD 1A 0A         [ 4] 3277 	call clear_state  
      001A29                       3278 9$: 
      001A29                       3279 	_next 
      001A29 CC 0A EA         [ 2]    1         jp interp_loop 
                                   3280 
                                   3281 ;----------------------------
                                   3282 ; BASIC: DEL val1,val2 	
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 148.
Hexadecimal [24-Bits]



                                   3283 ;  delete all programs lines 
                                   3284 ;  from val1 to val2 
                                   3285 ;----------------------------
                           000001  3286 	START_ADR=1
                           000003  3287 	END_ADR=START_ADR+ADR_SIZE 
                           000005  3288 	DEL_SIZE=END_ADR+ADR_SIZE 
                           000007  3289 	YSAVE=DEL_SIZE+INT_SIZE 
                           000008  3290 	VSIZE=4*INT_SIZE  
      001A2C                       3291 cmd_del:
      001A2C 72 01 00 43 03   [ 2] 3292 	btjf flags,#FRUN,0$
      001A31                       3293 	_next 
      001A31 CC 0A EA         [ 2]    1         jp interp_loop 
      001A34                       3294 0$:
      001A34                       3295 	_vars VSIZE
      001A34 52 08            [ 2]    1     sub sp,#VSIZE 
      001A36 5F               [ 1] 3296 	clrw x  
      001A37 1F 03            [ 2] 3297 	ldw (END_ADR,sp),x  
      001A39 CD 0B F3         [ 4] 3298 	call arg_list 
      001A3C A1 02            [ 1] 3299 	cp a,#2 
      001A3E 27 07            [ 1] 3300 	jreq 1$ 
      001A40 A1 01            [ 1] 3301 	cp a,#1
      001A42 27 17            [ 1] 3302 	jreq 2$ 
      001A44 CC 09 81         [ 2] 3303 	jp syntax_error 
      001A47                       3304 1$:	; range delete 
      001A47                       3305 	_i16_pop ; val2   
      001A47 85               [ 2]    1     popw x 
      001A48 4F               [ 1] 3306 	clr a 
      001A49 CD 00 9C         [ 4] 3307 	call search_lineno 
      001A4C 4D               [ 1] 3308 	tnz a ; 0 not found 
      001A4D 27 49            [ 1] 3309 	jreq not_a_line 
                                   3310 ; this last line to be deleted 
                                   3311 ; skip at end of it 
      001A4F                       3312 	_strxz acc16 	
      001A4F BF 00                    1     .byte 0xbf,acc16 
      001A51 E6 02            [ 1] 3313 	ld a,(2,x) ; line length 
      001A53 5F               [ 1] 3314 	clrw x 
      001A54 97               [ 1] 3315 	ld xl,a 
      001A55 72 BB 00 00      [ 2] 3316 	addw x,acc16 
      001A59 1F 05            [ 2] 3317 	ldw (END_ADR+INT_SIZE,sp),x
      001A5B                       3318 2$: 
      001A5B                       3319 	_i16_pop ; val1 
      001A5B 85               [ 2]    1     popw x 
      001A5C 4F               [ 1] 3320 	clr a 
      001A5D CD 00 9C         [ 4] 3321 	call search_lineno 
      001A60 4D               [ 1] 3322 	tnz a 
      001A61 27 35            [ 1] 3323 	jreq not_a_line 
      001A63 1F 01            [ 2] 3324 	ldw (START_ADR,sp),x 
      001A65 1E 03            [ 2] 3325 	ldw x,(END_ADR,sp)
      001A67 26 0B            [ 1] 3326 	jrne 4$ 
                                   3327 ; END_ADR not set there was no val2 
                                   3328 ; skip end of this line for END_ADR 
      001A69 1E 01            [ 2] 3329 	ldw x,(START_ADR,sp)
      001A6B E6 02            [ 1] 3330 	ld a,(2,x)
      001A6D 5F               [ 1] 3331 	clrw x 
      001A6E 97               [ 1] 3332 	ld xl,a 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 149.
Hexadecimal [24-Bits]



      001A6F 72 FB 01         [ 2] 3333 	addw x,(START_ADR,sp)
      001A72 1F 03            [ 2] 3334 	ldw (END_ADR,sp),x 
      001A74                       3335 4$: 
      001A74 72 F0 01         [ 2] 3336 	subw x,(START_ADR,sp)
      001A77 1F 05            [ 2] 3337 	ldw (DEL_SIZE,sp),x 
      001A79 CE 00 3B         [ 2] 3338 	ldw x,progend 
      001A7C 72 F0 03         [ 2] 3339 	subw x,(END_ADR,sp)
      001A7F                       3340 	_strxz acc16 
      001A7F BF 00                    1     .byte 0xbf,acc16 
      001A81 1E 01            [ 2] 3341 	ldw x,(START_ADR,sp)
      001A83 17 07            [ 2] 3342 	ldw (YSAVE,sp),y 
      001A85 16 03            [ 2] 3343 	ldw y,(END_ADR,sp)
      001A87 CD 00 00         [ 4] 3344 	call move 
      001A8A                       3345 	_ldxz progend 
      001A8A BE 3B                    1     .byte 0xbe,progend 
      001A8C 72 F0 05         [ 2] 3346 	subw x,(DEL_SIZE,sp)
      001A8F                       3347 	_strxz progend 
      001A8F BF 3B                    1     .byte 0xbf,progend 
      001A91 16 07            [ 2] 3348 	ldw y,(YSAVE,sp)
      001A93                       3349 	_drop VSIZE
      001A93 5B 08            [ 2]    1     addw sp,#VSIZE 
      001A95                       3350 	_next 
      001A95 CC 0A EA         [ 2]    1         jp interp_loop 
      001A98                       3351 not_a_line:
      001A98 A6 0D            [ 1] 3352 	ld a,#ERR_RANGE 
      001A9A CC 09 83         [ 2] 3353 	jp tb_error 
                                   3354 
                                   3355 
                                   3356 ;-----------------------------
                                   3357 ; BASIC: HIMEM = expr 
                                   3358 ; set end memory address of
                                   3359 ; BASIC program space.
                                   3360 ;------------------------------
      001A9D                       3361 cmd_himem:
      001A9D 72 01 00 43 03   [ 2] 3362 	btjf flags,#FRUN,1$
      001AA2                       3363 	_next 
      001AA2 CC 0A EA         [ 2]    1         jp interp_loop 
      001AA5 A6 11            [ 1] 3364 1$: ld a,#REL_EQU_IDX 
      001AA7 CD 0B DA         [ 4] 3365 	call expect 
      001AAA CD 0C E2         [ 4] 3366 	call expression 
      001AAD C3 00 37         [ 2] 3367 	cpw x,lomem  
      001AB0 23 35            [ 2] 3368 	jrule bad_value 
      001AB2 A3 00 00         [ 2] 3369 	cpw x,#tib  
      001AB5 24 30            [ 1] 3370 	jruge bad_value  
      001AB7                       3371 	_strxz himem
      001AB7 BF 39                    1     .byte 0xbf,himem 
      001AB9 20 1F            [ 2] 3372 	jra clear_prog_space  
      001ABB                       3373 	_next 
      001ABB CC 0A EA         [ 2]    1         jp interp_loop 
                                   3374 ;--------------------------------
                                   3375 ; BASIC: LOWMEM = expr 
                                   3376 ; set start memory address of 
                                   3377 ; BASIC program space. 	
                                   3378 ;---------------------------------
      001ABE                       3379 cmd_lomem:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 150.
Hexadecimal [24-Bits]



      001ABE 72 01 00 43 03   [ 2] 3380 	btjf flags,#FRUN,1$
      001AC3                       3381 	_next
      001AC3 CC 0A EA         [ 2]    1         jp interp_loop 
      001AC6 A6 11            [ 1] 3382 1$: ld a,#REL_EQU_IDX 
      001AC8 CD 0B DA         [ 4] 3383 	call expect 
      001ACB CD 0C E2         [ 4] 3384 	call expression 
      001ACE A3 01 00         [ 2] 3385 	cpw x,#free_ram 
      001AD1 25 14            [ 1] 3386 	jrult bad_value 
      001AD3 C3 00 39         [ 2] 3387 	cpw x,himem  
      001AD6 24 0F            [ 1] 3388 	jruge bad_value 
      001AD8                       3389 	_strxz lomem
      001AD8 BF 37                    1     .byte 0xbf,lomem 
      001ADA                       3390 clear_prog_space: 
      001ADA CD 1A 0A         [ 4] 3391 	call clear_state 
      001ADD                       3392 	_ldxz lomem 
      001ADD BE 37                    1     .byte 0xbe,lomem 
      001ADF                       3393 	_strxz progend 
      001ADF BF 3B                    1     .byte 0xbf,progend 
      001AE1 CD 1A EC         [ 4] 3394 	call free 
      001AE4                       3395 	_next 
      001AE4 CC 0A EA         [ 2]    1         jp interp_loop 
      001AE7                       3396 bad_value:
      001AE7 A6 0D            [ 1] 3397 	ld a,#ERR_RANGE 
      001AE9 CC 09 83         [ 2] 3398 	jp tb_error 
                                   3399 
      001AEC                       3400 free: 
      001AEC CE 00 39         [ 2] 3401 	ldw x,himem 
      001AEF 72 B0 00 37      [ 2] 3402 	subw x,lomem 
      001AF3 CD 00 00         [ 4] 3403 	call print_int  
      001AF6 AE 1A FD         [ 2] 3404 	ldw x,#bytes_free   
      001AF9 CD 00 00         [ 4] 3405 	call puts 
      001AFC 81               [ 4] 3406 	ret 
      001AFD 62 79 74 65 73 20 66  3407 bytes_free: .asciz "bytes free" 
             72 65 65 00
                                   3408 
                                   3409 ;-----------------------------
                                   3410 ; BASIC: CLS 
                                   3411 ; send clear screen command 
                                   3412 ; to terminal 
                                   3413 ;-----------------------------
      001B08                       3414 cmd_cls:
      001B08 CD 00 00         [ 4] 3415 	call clr_screen
      001B0B 72 11 00 00      [ 1] 3416 	bres sys_flags,#FSYS_TIMER 
      001B0F AE 00 04         [ 2] 3417 	ldw x,#4 ; give time to terminal
      001B12                       3418 	_strxz timer  
      001B12 BF 00                    1     .byte 0xbf,timer 
      001B14 72 01 00 00 FB   [ 2] 3419 	btjf sys_flags,#FSYS_TIMER,.
      001B19                       3420 	_next 
      001B19 CC 0A EA         [ 2]    1         jp interp_loop 
                                   3421 
                                   3422 ;-----------------------------
                                   3423 ; BASIC: LOCATE line, column 
                                   3424 ; set terminal cursor position
                                   3425 ;------------------------------
                           000001  3426 	COL=1 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 151.
Hexadecimal [24-Bits]



                           000003  3427 	LN=COL+INT_SIZE 
      001B1C                       3428 cmd_locate:
      001B1C CD 0B F3         [ 4] 3429 	call arg_list 
      001B1F A1 02            [ 1] 3430 	cp a,#2 
      001B21 27 03            [ 1] 3431 	jreq 1$ 
      001B23 CC 09 81         [ 2] 3432 	jp syntax_error 
      001B26                       3433 1$: 
      001B26                       3434 	_i16_fetch LN
      001B26 1E 03            [ 2]    1     ldw x,(LN,sp)
      001B28 9F               [ 1] 3435 	ld a,xl 
      001B29                       3436 	_i16_fetch COL 
      001B29 1E 01            [ 2]    1     ldw x,(COL,sp)
      001B2B 95               [ 1] 3437 	ld xh,a 
      001B2C CD 00 00         [ 4] 3438 	call set_cursor_pos
      001B2F                       3439 	_drop 2*INT_SIZE 
      001B2F 5B 04            [ 2]    1     addw sp,#2*INT_SIZE 
      001B31                       3440 	_next  
      001B31 CC 0A EA         [ 2]    1         jp interp_loop 
                                   3441 
                                   3442 ;-----------------------------
                                   3443 ; BASIC CHAT(line,column) 
                                   3444 ; get CHaracter AT line,column 
                                   3445 ; from terminal 
                                   3446 ; output:
                                   3447 ;   X     character 
                                   3448 ;------------------------------
                           000001  3449 	COL=1 
                           000003  3450 	LN=COL+INT_SIZE 
      001B34                       3451 func_chat:
      001B34 CD 0B E8         [ 4] 3452 	call func_args 
      001B37 A1 02            [ 1] 3453 	cp a,#2 
      001B39 27 03            [ 1] 3454 	jreq 1$ 
      001B3B CC 09 81         [ 2] 3455 	jp syntax_error 
      001B3E                       3456 1$:
      001B3E CD 00 00         [ 4] 3457 	call save_cursor_pos 
      001B41                       3458 	_i16_fetch LN 
      001B41 1E 03            [ 2]    1     ldw x,(LN,sp)
      001B43 9F               [ 1] 3459 	ld a,xl 
      001B44                       3460 	_i16_fetch COL 
      001B44 1E 01            [ 2]    1     ldw x,(COL,sp)
      001B46 95               [ 1] 3461 	ld xh,a 
      001B47 CD 00 00         [ 4] 3462 	call set_cursor_pos 
      001B4A CD 00 00         [ 4] 3463 	call get_char_at 
      001B4D 5F               [ 1] 3464 	clrw x 
      001B4E 97               [ 1] 3465 	ld xl,a 
      001B4F                       3466 	_i16_store COL 
      001B4F 1F 01            [ 2]    1     ldw (COL,sp),x 
      001B51 CD 00 00         [ 4] 3467 	call restore_cursor_pos
      001B54                       3468 	_i16_fetch COL 
      001B54 1E 01            [ 2]    1     ldw x,(COL,sp)
      001B56                       3469 	_drop 2*INT_SIZE 
      001B56 5B 04            [ 2]    1     addw sp,#2*INT_SIZE 
      001B58 81               [ 4] 3470 	ret 
                                   3471 
                                   3472 ;----------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 152.
Hexadecimal [24-Bits]



                                   3473 ; BASIC: CPOS 
                                   3474 ; get terminal cursor position 
                                   3475 ;  line=CPOS/256 
                                   3476 ;  column=CPOS AND 255 
                                   3477 ;-----------------------------
      001B59                       3478 func_cpos:
      001B59 CD 00 00         [ 4] 3479 	call cursor_pos  
      001B5C 81               [ 4] 3480 	ret 
                                   3481 
                                   3482 ;------------------------------
                                   3483 ; BASIC: RENUM [expr1, epxr2]  
                                   3484 ; renumber program lines 
                                   3485 ; starting at expr1 step expr2 
                                   3486 ;------------------------------
                           000001  3487 	STEP=1
                           000003  3488 	START=STEP+2 
                           000004  3489 	VSIZE=START+1
      001B5D                       3490 cmd_renum:
      001B5D 72 00 00 43 2A   [ 2] 3491 	btjt flags,#FRUN,9$
      001B62 CD 0B F3         [ 4] 3492 	call arg_list 
      001B65 4D               [ 1] 3493 	tnz a 
      001B66 26 07            [ 1] 3494 	jrne 1$
      001B68 AE 00 0A         [ 2] 3495 	ldw x,#10 
      001B6B 89               [ 2] 3496 	pushw x 
      001B6C 89               [ 2] 3497 	pushw x 
      001B6D 20 11            [ 2] 3498 	jra 4$
      001B6F A1 01            [ 1] 3499 1$: cp a,#1 
      001B71 26 06            [ 1] 3500 	jrne 2$ 
      001B73 AE 00 0A         [ 2] 3501 	ldw x,#10 
      001B76 89               [ 2] 3502 	pushw x 
      001B77 20 07            [ 2] 3503 	jra 4$ 
      001B79 A1 02            [ 1] 3504 2$:	cp a,#2 
      001B7B 27 03            [ 1] 3505 	jreq 4$
      001B7D CC 09 81         [ 2] 3506 	jp syntax_error 
      001B80                       3507 4$:
      001B80 CD 1B 91         [ 4] 3508 	call line_to_addr
      001B83 90 85            [ 2] 3509 	popw y
      001B85 85               [ 2] 3510 	popw x 
      001B86 CD 1B F5         [ 4] 3511 	call renumber ; x=START,Y=STEP 
      001B89 CD 1B C8         [ 4] 3512 	call addr_to_line  
      001B8C 90 7F            [ 1] 3513 9$:	clr (y)
      001B8E                       3514 	_next 
      001B8E CC 0A EA         [ 2]    1         jp interp_loop 
                                   3515 
                                   3516 ;--------------------------
                                   3517 ; replace GOTO|GOSUB|THEN 
                                   3518 ; line#
                                   3519 ; by line address|0x8000
                                   3520 ;--------------------------
      001B91                       3521 line_to_addr:
      001B91 90 CE 00 37      [ 2] 3522 	ldw y,lomem 
      001B95                       3523 0$:	_stryz line.addr 
      001B95 90 BF 33                 1     .byte 0x90,0xbf,line.addr 
      001B98 72 A9 00 03      [ 2] 3524 	addw y,#LINE_HEADER_SIZE
      001B9C CD 1C 15         [ 4] 3525 1$:	call scan_for_branch 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 153.
Hexadecimal [24-Bits]



      001B9F 5D               [ 2] 3526 	tnzw x 
      001BA0 27 0A            [ 1] 3527 	jreq 4$ 
      001BA2 FE               [ 2] 3528 	ldw x,(x) ; line # 
      001BA3 CD 1B B5         [ 4] 3529 	call line_by_addr
      001BA6 72 A9 00 02      [ 2] 3530 	addw y,#2 
      001BAA 20 F0            [ 2] 3531 	jra 1$ 
      001BAC                       3532 4$: ; at end of line 
      001BAC 90 5C            [ 1] 3533 	incw y 
      001BAE 90 C3 00 3B      [ 2] 3534 	cpw y,progend 
      001BB2 2B E1            [ 1] 3535 	jrmi 0$ 
      001BB4                       3536 9$:
      001BB4 81               [ 4] 3537 	ret 
                                   3538 
                                   3539 ;-------------------------
                                   3540 ; replace line number 
                                   3541 ; by line address|0x8000
                                   3542 ; input:
                                   3543 ;   X    line number 
                                   3544 ;   Y    plug address 
                                   3545 ;--------------------------
      001BB5                       3546 line_by_addr:
      001BB5 4F               [ 1] 3547 	clr a 
      001BB6 CD 00 9C         [ 4] 3548 	call search_lineno
      001BB9 4D               [ 1] 3549 	tnz a 
      001BBA 26 05            [ 1] 3550 	jrne 2$ 
      001BBC A6 04            [ 1] 3551 	ld a,#ERR_BAD_BRANCH
      001BBE CC 09 83         [ 2] 3552 	jp tb_error 
      001BC1 9E               [ 1] 3553 2$: ld a,xh 
      001BC2 AA 80            [ 1] 3554 	or a,#0x80 
      001BC4 95               [ 1] 3555 	ld xh,a 
      001BC5 90 FF            [ 2] 3556 	ldw (y),x 
      001BC7 81               [ 4] 3557 	ret 
                                   3558 
                                   3559 
                                   3560 ;---------------------------
                                   3561 ; replace target line address 
                                   3562 ; by line number 
                                   3563 ;---------------------------
      001BC8                       3564 addr_to_line:
      001BC8 90 CE 00 37      [ 2] 3565 	ldw y,lomem 
      001BCC                       3566 0$: _stryz line.addr 
      001BCC 90 BF 33                 1     .byte 0x90,0xbf,line.addr 
      001BCF 72 A9 00 03      [ 2] 3567 	addw y,#LINE_HEADER_SIZE
      001BD3 CD 1C 15         [ 4] 3568 1$: call scan_for_branch
      001BD6 5D               [ 2] 3569 	tnzw x 
      001BD7 27 13            [ 1] 3570 	jreq 4$ 
      001BD9 FE               [ 2] 3571 	ldw x,(x) ; ln_addr|0x8000
      001BDA 9E               [ 1] 3572 	ld a,xh 
      001BDB A4 7F            [ 1] 3573 	and a,#0x7f 
      001BDD 95               [ 1] 3574 	ld xh,a ; x=line addr 
      001BDE F6               [ 1] 3575 	ld a,(x)
      001BDF 90 F7            [ 1] 3576 	ld (y),a 
      001BE1 E6 01            [ 1] 3577 	ld a,(1,x)
      001BE3 90 E7 01         [ 1] 3578 	ld (1,y),a 
      001BE6 72 A9 00 02      [ 2] 3579 	addw y,#2 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 154.
Hexadecimal [24-Bits]



      001BEA 20 E7            [ 2] 3580 	jra 1$ 
      001BEC                       3581 4$: ; at end of line 
      001BEC 90 5C            [ 1] 3582 	incw y 
      001BEE 90 C3 00 3B      [ 2] 3583 	cpw y,progend 
      001BF2 2B D8            [ 1] 3584 	jrmi 0$ 
      001BF4 81               [ 4] 3585 9$:	ret 
                                   3586 
                                   3587 ;------------------------
                                   3588 ; renumber program lines 
                                   3589 ; input:
                                   3590 ;   x   start line 
                                   3591 ;   y   step 
                                   3592 ;-------------------------
                           000001  3593 	LN_LEN=1
                           000003  3594 	STEP=LN_LEN+2
                           000004  3595 	VSIZE=STEP+1  
      001BF5                       3596 renumber:
      001BF5                       3597 	_vars VSIZE 
      001BF5 52 04            [ 2]    1     sub sp,#VSIZE 
      001BF7 0F 01            [ 1] 3598 	clr (LN_LEN,sp)
      001BF9 17 03            [ 2] 3599 	ldw (STEP,sp),y
      001BFB 90 CE 00 37      [ 2] 3600 	ldw y,lomem 
      001BFF 90 FF            [ 2] 3601 1$:	ldw (y),x ; first line 
      001C01 72 FB 03         [ 2] 3602 	addw x,(STEP,sp)
      001C04 90 E6 02         [ 1] 3603 	ld a,(2,y)
      001C07 6B 02            [ 1] 3604 	ld (LN_LEN+1,sp),a 
      001C09 72 F9 01         [ 2] 3605 	addw y,(LN_LEN,sp)
      001C0C 90 C3 00 3B      [ 2] 3606 	cpw y,progend 
      001C10 2B ED            [ 1] 3607 	jrmi 1$ 
      001C12                       3608 9$:	_drop VSIZE 
      001C12 5B 04            [ 2]    1     addw sp,#VSIZE 
      001C14 81               [ 4] 3609 	ret 
                                   3610 
                                   3611 ;-------------------------
                                   3612 ; scan line for 
                                   3613 ; GOTO|GOSUB|THEN ln# 
                                   3614 ; input:
                                   3615 ;    Y   basic pointer 
                                   3616 ; output:
                                   3617 ;    X   0 | addr GO...
                                   3618 ;-------------------------
      001C15                       3619 scan_for_branch:
      001C15 5F               [ 1] 3620 	clrw x 
      001C16 90 F6            [ 1] 3621 0$:	ld a,(y)
      001C18 A1 00            [ 1] 3622 	cp a,#EOL_IDX 
      001C1A 27 62            [ 1] 3623 	jreq 9$ 
      001C1C A1 1F            [ 1] 3624 	cp a,#GOTO_IDX
      001C1E 27 59            [ 1] 3625 	jreq 8$ 
      001C20 A1 1D            [ 1] 3626 	cp a,#GOSUB_IDX 
      001C22 27 55            [ 1] 3627 	jreq 8$ 
      001C24 A1 21            [ 1] 3628 	cp a,#THEN_IDX
      001C26 26 0B            [ 1] 3629 	jrne 1$ 
      001C28 90 E6 01         [ 1] 3630 	ld a,(1,y)
      001C2B A1 08            [ 1] 3631 	cp a,#LITW_IDX
      001C2D 27 4A            [ 1] 3632 	jreq 8$ 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 155.
Hexadecimal [24-Bits]



      001C2F 90 5C            [ 1] 3633 	incw y 
      001C31 20 E3            [ 2] 3634 	jra 0$ 
      001C33 A1 07            [ 1] 3635 1$: cp a,#DELIM_LAST+1
      001C35 2A 04            [ 1] 3636 	jrpl 2$ 
      001C37 90 5C            [ 1] 3637 	incw y 
      001C39 20 DB            [ 2] 3638 	jra 0$ 
      001C3B A1 07            [ 1] 3639 2$: cp a,#LITC_IDX 
      001C3D 26 06            [ 1] 3640 	jrne 3$ 
      001C3F 72 A9 00 02      [ 2] 3641 	addw y,#2 
      001C43 20 D1            [ 2] 3642 	jra 0$ 
      001C45 A1 0B            [ 1] 3643 3$: cp a,#SYMB_LAST+1
      001C47 2A 06            [ 1] 3644 	jrpl 4$ 
      001C49 72 A9 00 03      [ 2] 3645 	addw y,#3 
      001C4D 20 C7            [ 2] 3646 	jra 0$ 
      001C4F A1 19            [ 1] 3647 4$: cp a,#BOOL_OP_LAST+1 
      001C51 2A 04            [ 1] 3648 	jrpl 5$ 
      001C53 90 5C            [ 1] 3649 	incw y 
      001C55 20 BF            [ 2] 3650 	jra 0$ 
      001C57 A1 06            [ 1] 3651 5$: cp a,#QUOTE_IDX 
      001C59 26 05            [ 1] 3652 	jrne 6$
      001C5B CD 0B 31         [ 4] 3653 	call skip_string 
      001C5E 20 B6            [ 2] 3654 	jra 0$ 
      001C60 A1 23            [ 1] 3655 6$: cp a,#REM_IDX 
      001C62 26 11            [ 1] 3656 	jrne 7$ 
      001C64 CE 00 33         [ 2] 3657 	ldw x, line.addr  
      001C67 E6 02            [ 1] 3658 	ld a,(2,x)
      001C69 5F               [ 1] 3659 	clrw x 
      001C6A 97               [ 1] 3660 	ld xl,a 
      001C6B 72 BB 00 33      [ 2] 3661 	addw x,line.addr 
      001C6F 5A               [ 2] 3662 	decw x 
      001C70 90 93            [ 1] 3663 	ldw y,x 
      001C72 5F               [ 1] 3664 	clrw x 
      001C73 20 09            [ 2] 3665 	jra 9$ 
      001C75 90 5C            [ 1] 3666 7$:	incw y 
      001C77 20 9D            [ 2] 3667 	jra 0$ 
      001C79 72 A9 00 02      [ 2] 3668 8$: addw y,#2 
      001C7D 93               [ 1] 3669 	ldw x,y ; skip 2 op_codes 
      001C7E 81               [ 4] 3670 9$:	ret 
                                   3671 
                                   3672 ;----------------------------
                                   3673 ; BASIC: DO 
                                   3674 ; introtude DO...UNTIL condition 
                                   3675 ; loop 
                                   3676 ;------------------------------
                           000001  3677 	LN_ADR=1
                           000003  3678 	BPTR=LN_ADR+2 
      001C7F                       3679 kword_do:
      001C7F 90 89            [ 2] 3680 	pushw y 
      001C81                       3681 	_ldxz line.addr 
      001C81 BE 33                    1     .byte 0xbe,line.addr 
      001C83 89               [ 2] 3682 	pushw x 
      001C84                       3683 	_next 
      001C84 CC 0A EA         [ 2]    1         jp interp_loop 
                                   3684 
                                   3685 ;----------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 156.
Hexadecimal [24-Bits]



                                   3686 ; BASIC: UNTIL condition 
                                   3687 ; control loop of DO..UNTIL 
                                   3688 ;----------------------------------
      001C87                       3689 kword_until:
      001C87 CD 0D C0         [ 4] 3690 	call condition 
      001C8A 5D               [ 2] 3691 	tnzw x 
      001C8B 26 09            [ 1] 3692 	jrne 8$ 
      001C8D 1E 01            [ 2] 3693 	ldw x,(LN_ADR,sp)
      001C8F                       3694 	_strxz line.addr 
      001C8F BF 33                    1     .byte 0xbf,line.addr 
      001C91 16 03            [ 2] 3695 	ldw y,(BPTR,sp)
      001C93                       3696 	_next 
      001C93 CC 0A EA         [ 2]    1         jp interp_loop 
      001C96                       3697 8$:	_drop 4 
      001C96 5B 04            [ 2]    1     addw sp,#4 
      001C98                       3698 	_next 
      001C98 CC 0A EA         [ 2]    1         jp interp_loop 
                                   3699 
                                   3700 ;------------------------------
                                   3701 ;      dictionary 
                                   3702 ; format:
                                   3703 ;   link:   2 bytes 
                                   3704 ;   name_length+flags:  1 byte, bits 0:3 lenght,4:8 kw type   
                                   3705 ;   cmd_name: 16 byte max 
                                   3706 ;   code_addr: 2 bytes 
                                   3707 ;------------------------------
                                   3708 	.macro _dict_entry len,name,token_id 
                                   3709 	.word LINK  ; point to next name field 
                                   3710 	LINK=.  ; name field 
                                   3711 	.byte len  ; name length 
                                   3712 	.asciz name  ; name 
                                   3713 	.byte token_id   ; TOK_IDX 
                                   3714 	.endm 
                                   3715 
                           000000  3716 	LINK=0
                                   3717 ; respect alphabetic order for BASIC names from Z-A
                                   3718 ; this sort order is for a cleaner WORDS cmd output. 	
      001C9B                       3719 dict_end:
      001C9B                       3720 	_dict_entry,5,"WORDS",WORDS_IDX 
      001C9B 00 00                    1 	.word LINK  ; point to next name field 
                           001C9D     2 	LINK=.  ; name field 
      001C9D 05                       3 	.byte 5  ; name length 
      001C9E 57 4F 52 44 53 00        4 	.asciz "WORDS"  ; name 
      001CA4 41                       5 	.byte WORDS_IDX   ; TOK_IDX 
      001CA5                       3721 	_dict_entry,5,"UNTIL",UNTIL_IDX 
      001CA5 1C 9D                    1 	.word LINK  ; point to next name field 
                           001CA7     2 	LINK=.  ; name field 
      001CA7 05                       3 	.byte 5  ; name length 
      001CA8 55 4E 54 49 4C 00        4 	.asciz "UNTIL"  ; name 
      001CAE 4C                       5 	.byte UNTIL_IDX   ; TOK_IDX 
      001CAF                       3722 	_dict_entry,4,"TONE",TONE_IDX 
      001CAF 1C A7                    1 	.word LINK  ; point to next name field 
                           001CB1     2 	LINK=.  ; name field 
      001CB1 04                       3 	.byte 4  ; name length 
      001CB2 54 4F 4E 45 00           4 	.asciz "TONE"  ; name 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 157.
Hexadecimal [24-Bits]



      001CB7 33                       5 	.byte TONE_IDX   ; TOK_IDX 
      001CB8                       3723 	_dict_entry,2,"TO",TO_IDX
      001CB8 1C B1                    1 	.word LINK  ; point to next name field 
                           001CBA     2 	LINK=.  ; name field 
      001CBA 02                       3 	.byte 2  ; name length 
      001CBB 54 4F 00                 4 	.asciz "TO"  ; name 
      001CBE 27                       5 	.byte TO_IDX   ; TOK_IDX 
      001CBF                       3724 	_dict_entry,5,"TICKS",TICKS_IDX 
      001CBF 1C BA                    1 	.word LINK  ; point to next name field 
                           001CC1     2 	LINK=.  ; name field 
      001CC1 05                       3 	.byte 5  ; name length 
      001CC2 54 49 43 4B 53 00        4 	.asciz "TICKS"  ; name 
      001CC8 2D                       5 	.byte TICKS_IDX   ; TOK_IDX 
      001CC9                       3725 	_dict_entry,4,"THEN",THEN_IDX 
      001CC9 1C C1                    1 	.word LINK  ; point to next name field 
                           001CCB     2 	LINK=.  ; name field 
      001CCB 04                       3 	.byte 4  ; name length 
      001CCC 54 48 45 4E 00           4 	.asciz "THEN"  ; name 
      001CD1 21                       5 	.byte THEN_IDX   ; TOK_IDX 
      001CD2                       3726 	_dict_entry,3,"TAB",TAB_IDX 
      001CD2 1C CB                    1 	.word LINK  ; point to next name field 
                           001CD4     2 	LINK=.  ; name field 
      001CD4 03                       3 	.byte 3  ; name length 
      001CD5 54 41 42 00              4 	.asciz "TAB"  ; name 
      001CD9 34                       5 	.byte TAB_IDX   ; TOK_IDX 
      001CDA                       3727 	_dict_entry,4,"STOP",STOP_IDX
      001CDA 1C D4                    1 	.word LINK  ; point to next name field 
                           001CDC     2 	LINK=.  ; name field 
      001CDC 04                       3 	.byte 4  ; name length 
      001CDD 53 54 4F 50 00           4 	.asciz "STOP"  ; name 
      001CE2 25                       5 	.byte STOP_IDX   ; TOK_IDX 
      001CE3                       3728 	_dict_entry,4,"STEP",STEP_IDX
      001CE3 1C DC                    1 	.word LINK  ; point to next name field 
                           001CE5     2 	LINK=.  ; name field 
      001CE5 04                       3 	.byte 4  ; name length 
      001CE6 53 54 45 50 00           4 	.asciz "STEP"  ; name 
      001CEB 24                       5 	.byte STEP_IDX   ; TOK_IDX 
      001CEC                       3729 	_dict_entry,5,"SLEEP",SLEEP_IDX 
      001CEC 1C E5                    1 	.word LINK  ; point to next name field 
                           001CEE     2 	LINK=.  ; name field 
      001CEE 05                       3 	.byte 5  ; name length 
      001CEF 53 4C 45 45 50 00        4 	.asciz "SLEEP"  ; name 
      001CF5 32                       5 	.byte SLEEP_IDX   ; TOK_IDX 
      001CF6                       3730 	_dict_entry,3,"SGN",SGN_IDX
      001CF6 1C EE                    1 	.word LINK  ; point to next name field 
                           001CF8     2 	LINK=.  ; name field 
      001CF8 03                       3 	.byte 3  ; name length 
      001CF9 53 47 4E 00              4 	.asciz "SGN"  ; name 
      001CFD 2B                       5 	.byte SGN_IDX   ; TOK_IDX 
      001CFE                       3731 	_dict_entry,3,"SCR",NEW_IDX
      001CFE 1C F8                    1 	.word LINK  ; point to next name field 
                           001D00     2 	LINK=.  ; name field 
      001D00 03                       3 	.byte 3  ; name length 
      001D01 53 43 52 00              4 	.asciz "SCR"  ; name 
      001D05 3C                       5 	.byte NEW_IDX   ; TOK_IDX 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 158.
Hexadecimal [24-Bits]



      001D06                       3732 	_dict_entry,4,"SAVE",SAVE_IDX 
      001D06 1D 00                    1 	.word LINK  ; point to next name field 
                           001D08     2 	LINK=.  ; name field 
      001D08 04                       3 	.byte 4  ; name length 
      001D09 53 41 56 45 00           4 	.asciz "SAVE"  ; name 
      001D0E 43                       5 	.byte SAVE_IDX   ; TOK_IDX 
      001D0F                       3733 	_dict_entry 3,"RUN",RUN_IDX
      001D0F 1D 08                    1 	.word LINK  ; point to next name field 
                           001D11     2 	LINK=.  ; name field 
      001D11 03                       3 	.byte 3  ; name length 
      001D12 52 55 4E 00              4 	.asciz "RUN"  ; name 
      001D16 40                       5 	.byte RUN_IDX   ; TOK_IDX 
      001D17                       3734 	_dict_entry,3,"RND",RND_IDX
      001D17 1D 11                    1 	.word LINK  ; point to next name field 
                           001D19     2 	LINK=.  ; name field 
      001D19 03                       3 	.byte 3  ; name length 
      001D1A 52 4E 44 00              4 	.asciz "RND"  ; name 
      001D1E 2A                       5 	.byte RND_IDX   ; TOK_IDX 
      001D1F                       3735 	_dict_entry,9,"RANDOMIZE",RNDMIZE_IDX 
      001D1F 1D 19                    1 	.word LINK  ; point to next name field 
                           001D21     2 	LINK=.  ; name field 
      001D21 09                       3 	.byte 9  ; name length 
      001D22 52 41 4E 44 4F 4D 49     4 	.asciz "RANDOMIZE"  ; name 
             5A 45 00
      001D2C 47                       5 	.byte RNDMIZE_IDX   ; TOK_IDX 
      001D2D                       3736 	_dict_entry,6,"RETURN",RET_IDX
      001D2D 1D 21                    1 	.word LINK  ; point to next name field 
                           001D2F     2 	LINK=.  ; name field 
      001D2F 06                       3 	.byte 6  ; name length 
      001D30 52 45 54 55 52 4E 00     4 	.asciz "RETURN"  ; name 
      001D37 1E                       5 	.byte RET_IDX   ; TOK_IDX 
      001D38                       3737 	_dict_entry,5,"RENUM",RENUM_IDX 
      001D38 1D 2F                    1 	.word LINK  ; point to next name field 
                           001D3A     2 	LINK=.  ; name field 
      001D3A 05                       3 	.byte 5  ; name length 
      001D3B 52 45 4E 55 4D 00        4 	.asciz "RENUM"  ; name 
      001D41 4A                       5 	.byte RENUM_IDX   ; TOK_IDX 
      001D42                       3738 	_dict_entry 3,"REM",REM_IDX
      001D42 1D 3A                    1 	.word LINK  ; point to next name field 
                           001D44     2 	LINK=.  ; name field 
      001D44 03                       3 	.byte 3  ; name length 
      001D45 52 45 4D 00              4 	.asciz "REM"  ; name 
      001D49 23                       5 	.byte REM_IDX   ; TOK_IDX 
      001D4A                       3739 	_dict_entry 5,"PRINT",PRINT_IDX 
      001D4A 1D 44                    1 	.word LINK  ; point to next name field 
                           001D4C     2 	LINK=.  ; name field 
      001D4C 05                       3 	.byte 5  ; name length 
      001D4D 50 52 49 4E 54 00        4 	.asciz "PRINT"  ; name 
      001D53 3F                       5 	.byte PRINT_IDX   ; TOK_IDX 
      001D54                       3740 	_dict_entry,4,"POKE",POKE_IDX 
      001D54 1D 4C                    1 	.word LINK  ; point to next name field 
                           001D56     2 	LINK=.  ; name field 
      001D56 04                       3 	.byte 4  ; name length 
      001D57 50 4F 4B 45 00           4 	.asciz "POKE"  ; name 
      001D5C 3E                       5 	.byte POKE_IDX   ; TOK_IDX 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 159.
Hexadecimal [24-Bits]



      001D5D                       3741 	_dict_entry,4,"PEEK",PEEK_IDX 
      001D5D 1D 56                    1 	.word LINK  ; point to next name field 
                           001D5F     2 	LINK=.  ; name field 
      001D5F 04                       3 	.byte 4  ; name length 
      001D60 50 45 45 4B 00           4 	.asciz "PEEK"  ; name 
      001D65 29                       5 	.byte PEEK_IDX   ; TOK_IDX 
      001D66                       3742 	_dict_entry,2,"OR",OR_IDX  
      001D66 1D 5F                    1 	.word LINK  ; point to next name field 
                           001D68     2 	LINK=.  ; name field 
      001D68 02                       3 	.byte 2  ; name length 
      001D69 4F 52 00                 4 	.asciz "OR"  ; name 
      001D6C 18                       5 	.byte OR_IDX   ; TOK_IDX 
      001D6D                       3743 	_dict_entry,3,"NOT",NOT_IDX
      001D6D 1D 68                    1 	.word LINK  ; point to next name field 
                           001D6F     2 	LINK=.  ; name field 
      001D6F 03                       3 	.byte 3  ; name length 
      001D70 4E 4F 54 00              4 	.asciz "NOT"  ; name 
      001D74 16                       5 	.byte NOT_IDX   ; TOK_IDX 
      001D75                       3744 	_dict_entry,3,"NEW",NEW_IDX
      001D75 1D 6F                    1 	.word LINK  ; point to next name field 
                           001D77     2 	LINK=.  ; name field 
      001D77 03                       3 	.byte 3  ; name length 
      001D78 4E 45 57 00              4 	.asciz "NEW"  ; name 
      001D7C 3C                       5 	.byte NEW_IDX   ; TOK_IDX 
      001D7D                       3745 	_dict_entry,4,"NEXT",NEXT_IDX 
      001D7D 1D 77                    1 	.word LINK  ; point to next name field 
                           001D7F     2 	LINK=.  ; name field 
      001D7F 04                       3 	.byte 4  ; name length 
      001D80 4E 45 58 54 00           4 	.asciz "NEXT"  ; name 
      001D85 1C                       5 	.byte NEXT_IDX   ; TOK_IDX 
      001D86                       3746 	_dict_entry,6,"MULDIV",MULDIV_IDX 
      001D86 1D 7F                    1 	.word LINK  ; point to next name field 
                           001D88     2 	LINK=.  ; name field 
      001D88 06                       3 	.byte 6  ; name length 
      001D89 4D 55 4C 44 49 56 00     4 	.asciz "MULDIV"  ; name 
      001D90 4D                       5 	.byte MULDIV_IDX   ; TOK_IDX 
      001D91                       3747 	_dict_entry,3,"MOD",MOD_IDX 
      001D91 1D 88                    1 	.word LINK  ; point to next name field 
                           001D93     2 	LINK=.  ; name field 
      001D93 03                       3 	.byte 3  ; name length 
      001D94 4D 4F 44 00              4 	.asciz "MOD"  ; name 
      001D98 0E                       5 	.byte MOD_IDX   ; TOK_IDX 
      001D99                       3748 	_dict_entry,5,"LOMEM",LOMEM_IDX 
      001D99 1D 93                    1 	.word LINK  ; point to next name field 
                           001D9B     2 	LINK=.  ; name field 
      001D9B 05                       3 	.byte 5  ; name length 
      001D9C 4C 4F 4D 45 4D 00        4 	.asciz "LOMEM"  ; name 
      001DA2 37                       5 	.byte LOMEM_IDX   ; TOK_IDX 
      001DA3                       3749 	_dict_entry,6,"LOCATE",LOCATE_IDX 
      001DA3 1D 9B                    1 	.word LINK  ; point to next name field 
                           001DA5     2 	LINK=.  ; name field 
      001DA5 06                       3 	.byte 6  ; name length 
      001DA6 4C 4F 43 41 54 45 00     4 	.asciz "LOCATE"  ; name 
      001DAD 49                       5 	.byte LOCATE_IDX   ; TOK_IDX 
      001DAE                       3750 	_dict_entry,4,"LOAD",LOAD_IDX 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 160.
Hexadecimal [24-Bits]



      001DAE 1D A5                    1 	.word LINK  ; point to next name field 
                           001DB0     2 	LINK=.  ; name field 
      001DB0 04                       3 	.byte 4  ; name length 
      001DB1 4C 4F 41 44 00           4 	.asciz "LOAD"  ; name 
      001DB6 44                       5 	.byte LOAD_IDX   ; TOK_IDX 
      001DB7                       3751 	_dict_entry 4,"LIST",LIST_IDX
      001DB7 1D B0                    1 	.word LINK  ; point to next name field 
                           001DB9     2 	LINK=.  ; name field 
      001DB9 04                       3 	.byte 4  ; name length 
      001DBA 4C 49 53 54 00           4 	.asciz "LIST"  ; name 
      001DBF 3B                       5 	.byte LIST_IDX   ; TOK_IDX 
      001DC0                       3752 	_dict_entry 3,"LET",LET_IDX
      001DC0 1D B9                    1 	.word LINK  ; point to next name field 
                           001DC2     2 	LINK=.  ; name field 
      001DC2 03                       3 	.byte 3  ; name length 
      001DC3 4C 45 54 00              4 	.asciz "LET"  ; name 
      001DC7 22                       5 	.byte LET_IDX   ; TOK_IDX 
      001DC8                       3753 	_dict_entry 3,"LEN",LEN_IDX  
      001DC8 1D C2                    1 	.word LINK  ; point to next name field 
                           001DCA     2 	LINK=.  ; name field 
      001DCA 03                       3 	.byte 3  ; name length 
      001DCB 4C 45 4E 00              4 	.asciz "LEN"  ; name 
      001DCF 2C                       5 	.byte LEN_IDX   ; TOK_IDX 
      001DD0                       3754 	_dict_entry,3,"KEY",KEY_IDX 
      001DD0 1D CA                    1 	.word LINK  ; point to next name field 
                           001DD2     2 	LINK=.  ; name field 
      001DD2 03                       3 	.byte 3  ; name length 
      001DD3 4B 45 59 00              4 	.asciz "KEY"  ; name 
      001DD7 2F                       5 	.byte KEY_IDX   ; TOK_IDX 
      001DD8                       3755 	_dict_entry,5,"INPUT",INPUT_IDX 
      001DD8 1D D2                    1 	.word LINK  ; point to next name field 
                           001DDA     2 	LINK=.  ; name field 
      001DDA 05                       3 	.byte 5  ; name length 
      001DDB 49 4E 50 55 54 00        4 	.asciz "INPUT"  ; name 
      001DE1 3A                       5 	.byte INPUT_IDX   ; TOK_IDX 
      001DE2                       3756 	_dict_entry,2,"IF",IF_IDX 
      001DE2 1D DA                    1 	.word LINK  ; point to next name field 
                           001DE4     2 	LINK=.  ; name field 
      001DE4 02                       3 	.byte 2  ; name length 
      001DE5 49 46 00                 4 	.asciz "IF"  ; name 
      001DE8 20                       5 	.byte IF_IDX   ; TOK_IDX 
      001DE9                       3757 	_dict_entry,5,"HIMEM",HIMEM_IDX 
      001DE9 1D E4                    1 	.word LINK  ; point to next name field 
                           001DEB     2 	LINK=.  ; name field 
      001DEB 05                       3 	.byte 5  ; name length 
      001DEC 48 49 4D 45 4D 00        4 	.asciz "HIMEM"  ; name 
      001DF2 36                       5 	.byte HIMEM_IDX   ; TOK_IDX 
      001DF3                       3758 	_dict_entry,4,"GOTO",GOTO_IDX  
      001DF3 1D EB                    1 	.word LINK  ; point to next name field 
                           001DF5     2 	LINK=.  ; name field 
      001DF5 04                       3 	.byte 4  ; name length 
      001DF6 47 4F 54 4F 00           4 	.asciz "GOTO"  ; name 
      001DFB 1F                       5 	.byte GOTO_IDX   ; TOK_IDX 
      001DFC                       3759 	_dict_entry,5,"GOSUB",GOSUB_IDX 
      001DFC 1D F5                    1 	.word LINK  ; point to next name field 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 161.
Hexadecimal [24-Bits]



                           001DFE     2 	LINK=.  ; name field 
      001DFE 05                       3 	.byte 5  ; name length 
      001DFF 47 4F 53 55 42 00        4 	.asciz "GOSUB"  ; name 
      001E05 1D                       5 	.byte GOSUB_IDX   ; TOK_IDX 
      001E06                       3760 	_dict_entry,5,"ERASE",ERASE_IDX 
      001E06 1D FE                    1 	.word LINK  ; point to next name field 
                           001E08     2 	LINK=.  ; name field 
      001E08 05                       3 	.byte 5  ; name length 
      001E09 45 52 41 53 45 00        4 	.asciz "ERASE"  ; name 
      001E0F 46                       5 	.byte ERASE_IDX   ; TOK_IDX 
      001E10                       3761 	_dict_entry,3,"FOR",FOR_IDX 
      001E10 1E 08                    1 	.word LINK  ; point to next name field 
                           001E12     2 	LINK=.  ; name field 
      001E12 03                       3 	.byte 3  ; name length 
      001E13 46 4F 52 00              4 	.asciz "FOR"  ; name 
      001E17 1B                       5 	.byte FOR_IDX   ; TOK_IDX 
      001E18                       3762 	_dict_entry,3,"END",END_IDX
      001E18 1E 12                    1 	.word LINK  ; point to next name field 
                           001E1A     2 	LINK=.  ; name field 
      001E1A 03                       3 	.byte 3  ; name length 
      001E1B 45 4E 44 00              4 	.asciz "END"  ; name 
      001E1F 1A                       5 	.byte END_IDX   ; TOK_IDX 
      001E20                       3763 	_dict_entry,2,"DO",DO_IDX 
      001E20 1E 1A                    1 	.word LINK  ; point to next name field 
                           001E22     2 	LINK=.  ; name field 
      001E22 02                       3 	.byte 2  ; name length 
      001E23 44 4F 00                 4 	.asciz "DO"  ; name 
      001E26 4B                       5 	.byte DO_IDX   ; TOK_IDX 
      001E27                       3764 	_dict_entry,3,"DIR",DIR_IDX  
      001E27 1E 22                    1 	.word LINK  ; point to next name field 
                           001E29     2 	LINK=.  ; name field 
      001E29 03                       3 	.byte 3  ; name length 
      001E2A 44 49 52 00              4 	.asciz "DIR"  ; name 
      001E2E 45                       5 	.byte DIR_IDX   ; TOK_IDX 
      001E2F                       3765 	_dict_entry,3,"DIM",DIM_IDX 
      001E2F 1E 29                    1 	.word LINK  ; point to next name field 
                           001E31     2 	LINK=.  ; name field 
      001E31 03                       3 	.byte 3  ; name length 
      001E32 44 49 4D 00              4 	.asciz "DIM"  ; name 
      001E36 19                       5 	.byte DIM_IDX   ; TOK_IDX 
      001E37                       3766 	_dict_entry,3,"DEL",DEL_IDX 
      001E37 1E 31                    1 	.word LINK  ; point to next name field 
                           001E39     2 	LINK=.  ; name field 
      001E39 03                       3 	.byte 3  ; name length 
      001E3A 44 45 4C 00              4 	.asciz "DEL"  ; name 
      001E3E 38                       5 	.byte DEL_IDX   ; TOK_IDX 
      001E3F                       3767 	_dict_entry,4,"CPOS",CPOS_IDX 
      001E3F 1E 39                    1 	.word LINK  ; point to next name field 
                           001E41     2 	LINK=.  ; name field 
      001E41 04                       3 	.byte 4  ; name length 
      001E42 43 50 4F 53 00           4 	.asciz "CPOS"  ; name 
      001E47 31                       5 	.byte CPOS_IDX   ; TOK_IDX 
      001E48                       3768 	_dict_entry,3,"CON",CON_IDX 
      001E48 1E 41                    1 	.word LINK  ; point to next name field 
                           001E4A     2 	LINK=.  ; name field 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 162.
Hexadecimal [24-Bits]



      001E4A 03                       3 	.byte 3  ; name length 
      001E4B 43 4F 4E 00              4 	.asciz "CON"  ; name 
      001E4F 26                       5 	.byte CON_IDX   ; TOK_IDX 
      001E50                       3769 	_dict_entry,3,"CLS",CLS_IDX 
      001E50 1E 4A                    1 	.word LINK  ; point to next name field 
                           001E52     2 	LINK=.  ; name field 
      001E52 03                       3 	.byte 3  ; name length 
      001E53 43 4C 53 00              4 	.asciz "CLS"  ; name 
      001E57 48                       5 	.byte CLS_IDX   ; TOK_IDX 
      001E58                       3770 	_dict_entry,3,"CLR",CLR_IDX 
      001E58 1E 52                    1 	.word LINK  ; point to next name field 
                           001E5A     2 	LINK=.  ; name field 
      001E5A 03                       3 	.byte 3  ; name length 
      001E5B 43 4C 52 00              4 	.asciz "CLR"  ; name 
      001E5F 39                       5 	.byte CLR_IDX   ; TOK_IDX 
      001E60                       3771 	_dict_entry,4,"CHR$",CHAR_IDX  
      001E60 1E 5A                    1 	.word LINK  ; point to next name field 
                           001E62     2 	LINK=.  ; name field 
      001E62 04                       3 	.byte 4  ; name length 
      001E63 43 48 52 24 00           4 	.asciz "CHR$"  ; name 
      001E68 2E                       5 	.byte CHAR_IDX   ; TOK_IDX 
      001E69                       3772 	_dict_entry,4,"CHAT",CHAT_IDX 
      001E69 1E 62                    1 	.word LINK  ; point to next name field 
                           001E6B     2 	LINK=.  ; name field 
      001E6B 04                       3 	.byte 4  ; name length 
      001E6C 43 48 41 54 00           4 	.asciz "CHAT"  ; name 
      001E71 30                       5 	.byte CHAT_IDX   ; TOK_IDX 
      001E72                       3773 	_dict_entry,4,"CALL",CALL_IDX
      001E72 1E 6B                    1 	.word LINK  ; point to next name field 
                           001E74     2 	LINK=.  ; name field 
      001E74 04                       3 	.byte 4  ; name length 
      001E75 43 41 4C 4C 00           4 	.asciz "CALL"  ; name 
      001E7A 3D                       5 	.byte CALL_IDX   ; TOK_IDX 
      001E7B                       3774 	_dict_entry,3,"BYE",BYE_IDX
      001E7B 1E 74                    1 	.word LINK  ; point to next name field 
                           001E7D     2 	LINK=.  ; name field 
      001E7D 03                       3 	.byte 3  ; name length 
      001E7E 42 59 45 00              4 	.asciz "BYE"  ; name 
      001E82 42                       5 	.byte BYE_IDX   ; TOK_IDX 
      001E83                       3775 	_dict_entry,4,"AUTO",AUTO_IDX 
      001E83 1E 7D                    1 	.word LINK  ; point to next name field 
                           001E85     2 	LINK=.  ; name field 
      001E85 04                       3 	.byte 4  ; name length 
      001E86 41 55 54 4F 00           4 	.asciz "AUTO"  ; name 
      001E8B 35                       5 	.byte AUTO_IDX   ; TOK_IDX 
      001E8C                       3776 	_dict_entry,3,"AND",AND_IDX  
      001E8C 1E 85                    1 	.word LINK  ; point to next name field 
                           001E8E     2 	LINK=.  ; name field 
      001E8E 03                       3 	.byte 3  ; name length 
      001E8F 41 4E 44 00              4 	.asciz "AND"  ; name 
      001E93 17                       5 	.byte AND_IDX   ; TOK_IDX 
      001E94                       3777 kword_dict::
      001E94                       3778 	_dict_entry,3,"ABS",ABS_IDX 
      001E94 1E 8E                    1 	.word LINK  ; point to next name field 
                           001E96     2 	LINK=.  ; name field 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 163.
Hexadecimal [24-Bits]



      001E96 03                       3 	.byte 3  ; name length 
      001E97 41 42 53 00              4 	.asciz "ABS"  ; name 
      001E9B 28                       5 	.byte ABS_IDX   ; TOK_IDX 
                                   3779 ; the following are not searched
                                   3780 ; by compiler
      001E9C                       3781 	_dict_entry,1,"'",REM_IDX 
      001E9C 1E 96                    1 	.word LINK  ; point to next name field 
                           001E9E     2 	LINK=.  ; name field 
      001E9E 01                       3 	.byte 1  ; name length 
      001E9F 27 00                    4 	.asciz "'"  ; name 
      001EA1 23                       5 	.byte REM_IDX   ; TOK_IDX 
      001EA2                       3782 	_dict_entry,1,"?",PRINT_IDX 
      001EA2 1E 9E                    1 	.word LINK  ; point to next name field 
                           001EA4     2 	LINK=.  ; name field 
      001EA4 01                       3 	.byte 1  ; name length 
      001EA5 3F 00                    4 	.asciz "?"  ; name 
      001EA7 3F                       5 	.byte PRINT_IDX   ; TOK_IDX 
      001EA8                       3783 	_dict_entry,1,"#",REL_NE_IDX 
      001EA8 1E A4                    1 	.word LINK  ; point to next name field 
                           001EAA     2 	LINK=.  ; name field 
      001EAA 01                       3 	.byte 1  ; name length 
      001EAB 23 00                    4 	.asciz "#"  ; name 
      001EAD 15                       5 	.byte REL_NE_IDX   ; TOK_IDX 
      001EAE                       3784 	_dict_entry,2,"<>",REL_NE_IDX
      001EAE 1E AA                    1 	.word LINK  ; point to next name field 
                           001EB0     2 	LINK=.  ; name field 
      001EB0 02                       3 	.byte 2  ; name length 
      001EB1 3C 3E 00                 4 	.asciz "<>"  ; name 
      001EB4 15                       5 	.byte REL_NE_IDX   ; TOK_IDX 
      001EB5                       3785 	_dict_entry,1,">",REL_GT_IDX
      001EB5 1E B0                    1 	.word LINK  ; point to next name field 
                           001EB7     2 	LINK=.  ; name field 
      001EB7 01                       3 	.byte 1  ; name length 
      001EB8 3E 00                    4 	.asciz ">"  ; name 
      001EBA 14                       5 	.byte REL_GT_IDX   ; TOK_IDX 
      001EBB                       3786 	_dict_entry,1,"<",REL_LT_IDX
      001EBB 1E B7                    1 	.word LINK  ; point to next name field 
                           001EBD     2 	LINK=.  ; name field 
      001EBD 01                       3 	.byte 1  ; name length 
      001EBE 3C 00                    4 	.asciz "<"  ; name 
      001EC0 13                       5 	.byte REL_LT_IDX   ; TOK_IDX 
      001EC1                       3787 	_dict_entry,2,">=",REL_GE_IDX
      001EC1 1E BD                    1 	.word LINK  ; point to next name field 
                           001EC3     2 	LINK=.  ; name field 
      001EC3 02                       3 	.byte 2  ; name length 
      001EC4 3E 3D 00                 4 	.asciz ">="  ; name 
      001EC7 12                       5 	.byte REL_GE_IDX   ; TOK_IDX 
      001EC8                       3788 	_dict_entry,1,"=",REL_EQU_IDX 
      001EC8 1E C3                    1 	.word LINK  ; point to next name field 
                           001ECA     2 	LINK=.  ; name field 
      001ECA 01                       3 	.byte 1  ; name length 
      001ECB 3D 00                    4 	.asciz "="  ; name 
      001ECD 11                       5 	.byte REL_EQU_IDX   ; TOK_IDX 
      001ECE                       3789 	_dict_entry,2,"<=",REL_LE_IDX 
      001ECE 1E CA                    1 	.word LINK  ; point to next name field 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 164.
Hexadecimal [24-Bits]



                           001ED0     2 	LINK=.  ; name field 
      001ED0 02                       3 	.byte 2  ; name length 
      001ED1 3C 3D 00                 4 	.asciz "<="  ; name 
      001ED4 10                       5 	.byte REL_LE_IDX   ; TOK_IDX 
      001ED5                       3790 	_dict_entry,1,"*",MULT_IDX 
      001ED5 1E D0                    1 	.word LINK  ; point to next name field 
                           001ED7     2 	LINK=.  ; name field 
      001ED7 01                       3 	.byte 1  ; name length 
      001ED8 2A 00                    4 	.asciz "*"  ; name 
      001EDA 0F                       5 	.byte MULT_IDX   ; TOK_IDX 
      001EDB                       3791 	_dict_entry,1,"%",MOD_IDX 
      001EDB 1E D7                    1 	.word LINK  ; point to next name field 
                           001EDD     2 	LINK=.  ; name field 
      001EDD 01                       3 	.byte 1  ; name length 
      001EDE 25 00                    4 	.asciz "%"  ; name 
      001EE0 0E                       5 	.byte MOD_IDX   ; TOK_IDX 
      001EE1                       3792 	_dict_entry,1,"/",DIV_IDX 
      001EE1 1E DD                    1 	.word LINK  ; point to next name field 
                           001EE3     2 	LINK=.  ; name field 
      001EE3 01                       3 	.byte 1  ; name length 
      001EE4 2F 00                    4 	.asciz "/"  ; name 
      001EE6 0D                       5 	.byte DIV_IDX   ; TOK_IDX 
      001EE7                       3793 	_dict_entry,1,"-",SUB_IDX 
      001EE7 1E E3                    1 	.word LINK  ; point to next name field 
                           001EE9     2 	LINK=.  ; name field 
      001EE9 01                       3 	.byte 1  ; name length 
      001EEA 2D 00                    4 	.asciz "-"  ; name 
      001EEC 0C                       5 	.byte SUB_IDX   ; TOK_IDX 
      001EED                       3794 	_dict_entry,1,"+",ADD_IDX
      001EED 1E E9                    1 	.word LINK  ; point to next name field 
                           001EEF     2 	LINK=.  ; name field 
      001EEF 01                       3 	.byte 1  ; name length 
      001EF0 2B 00                    4 	.asciz "+"  ; name 
      001EF2 0B                       5 	.byte ADD_IDX   ; TOK_IDX 
      001EF3                       3795 	_dict_entry,1,'"',QUOTE_IDX
      001EF3 1E EF                    1 	.word LINK  ; point to next name field 
                           001EF5     2 	LINK=.  ; name field 
      001EF5 01                       3 	.byte 1  ; name length 
      001EF6 22 00                    4 	.asciz '"'  ; name 
      001EF8 06                       5 	.byte QUOTE_IDX   ; TOK_IDX 
      001EF9                       3796 	_dict_entry,1,")",RPAREN_IDX 
      001EF9 1E F5                    1 	.word LINK  ; point to next name field 
                           001EFB     2 	LINK=.  ; name field 
      001EFB 01                       3 	.byte 1  ; name length 
      001EFC 29 00                    4 	.asciz ")"  ; name 
      001EFE 05                       5 	.byte RPAREN_IDX   ; TOK_IDX 
      001EFF                       3797 	_dict_entry,1,"(",LPAREN_IDX 
      001EFF 1E FB                    1 	.word LINK  ; point to next name field 
                           001F01     2 	LINK=.  ; name field 
      001F01 01                       3 	.byte 1  ; name length 
      001F02 28 00                    4 	.asciz "("  ; name 
      001F04 04                       5 	.byte LPAREN_IDX   ; TOK_IDX 
      001F05                       3798 	_dict_entry,1,^/";"/,SCOL_IDX
      001F05 1F 01                    1 	.word LINK  ; point to next name field 
                           001F07     2 	LINK=.  ; name field 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 165.
Hexadecimal [24-Bits]



      001F07 01                       3 	.byte 1  ; name length 
      001F08 3B 00                    4 	.asciz ";"  ; name 
      001F0A 03                       5 	.byte SCOL_IDX   ; TOK_IDX 
      001F0B                       3799 	_dict_entry,1,^/","/,COMMA_IDX 
      001F0B 1F 07                    1 	.word LINK  ; point to next name field 
                           001F0D     2 	LINK=.  ; name field 
      001F0D 01                       3 	.byte 1  ; name length 
      001F0E 2C 00                    4 	.asciz ","  ; name 
      001F10 02                       5 	.byte COMMA_IDX   ; TOK_IDX 
      001F11                       3800 all_words:
      001F11                       3801 	_dict_entry,1,":",COLON_IDX 
      001F11 1F 0D                    1 	.word LINK  ; point to next name field 
                           001F13     2 	LINK=.  ; name field 
      001F13 01                       3 	.byte 1  ; name length 
      001F14 3A 00                    4 	.asciz ":"  ; name 
      001F16 01                       5 	.byte COLON_IDX   ; TOK_IDX 
                                   3802 
      001F80                       3803 	.bndry 128 
      001F80                       3804 app: 
      001F80                       3805 app_space:
                           000000  3806 .if 0
                                   3807 ; program to test CALL command 
                                   3808 blink:
                                   3809 	_led_toggle 
                                   3810 	ldw x,#250 
                                   3811 	_strxz timer 
                                   3812 	bres sys_flags,#FSYS_TIMER 
                                   3813 1$:	
                                   3814 	wfi 
                                   3815 	btjf sys_flags,#FSYS_TIMER,1$
                                   3816 	call qgetc 
                                   3817 	jreq blink 
                                   3818 	call getc 
                                   3819 	ret 
                                   3820 .endif 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 166.
Hexadecimal [24-Bits]

Symbol Table

    .__.$$$.=  002710 L   |     .__.ABS.=  000000 G   |     .__.CPU.=  000000 L
    .__.H$L.=  000001 L   |     ABS_IDX =  000028     |     ACK     =  000006 
    ADC_CR1 =  005401     |     ADC_CR1_=  000000     |     ADC_CR1_=  000001 
    ADC_CR1_=  000004     |     ADC_CR1_=  000005     |     ADC_CR1_=  000006 
    ADC_CR2 =  005402     |     ADC_CR2_=  000003     |     ADC_CR2_=  000004 
    ADC_CR2_=  000005     |     ADC_CR2_=  000006     |     ADC_CR2_=  000001 
    ADC_CR3 =  005403     |     ADC_CR3_=  000007     |     ADC_CR3_=  000006 
    ADC_CSR =  005400     |     ADC_CSR_=  000006     |     ADC_CSR_=  000004 
    ADC_CSR_=  000000     |     ADC_CSR_=  000001     |     ADC_CSR_=  000002 
    ADC_CSR_=  000003     |     ADC_CSR_=  000007     |     ADC_CSR_=  000005 
    ADC_DRH =  005404     |     ADC_DRL =  005405     |     ADC_TDRH=  005406 
    ADC_TDRL=  005407     |     ADD_IDX =  00000B     |     ADR_SIZE=  000002 
    AFR     =  004803     |     AFR0_ADC=  000000     |     AFR1_TIM=  000001 
    AFR2_CCO=  000002     |     AFR3_TIM=  000003     |     AFR4_TIM=  000004 
    AFR5_TIM=  000005     |     AFR6_I2C=  000006     |     AFR7_BEE=  000007 
    ALIGN   =  000003     |     AND_IDX =  000017     |     APP_DATA=  000030 
    ARG1    =  000005     |     ARG2    =  000003     |     ARG3    =  000001 
    ARGN    =  000004     |     ARG_OFS =  000002     |     ARG_SIZE=  000002 
    ATTRIB  =  000002     |     AUTO_IDX=  000035     |     AWU_APR =  0050F1 
    AWU_CSR =  0050F0     |     AWU_CSR_=  000004     |     AWU_TBR =  0050F2 
    B0_MASK =  000001     |     B1      =  000001     |     B115200 =  000006 
    B19200  =  000003     |     B1_MASK =  000002     |     B230400 =  000007 
    B2400   =  000000     |     B2_MASK =  000004     |     B38400  =  000004 
    B3_MASK =  000008     |     B460800 =  000008     |     B4800   =  000001 
    B4_MASK =  000010     |     B57600  =  000005     |     B5_MASK =  000020 
    B6_MASK =  000040     |     B7_MASK =  000080     |     B921600 =  000009 
    B9600   =  000002     |     BEEP_BIT=  000004     |     BEEP_CSR=  0050F3 
    BEEP_MAS=  000010     |     BEEP_POR=  00000F     |     BELL    =  000007 
    BIT0    =  000000     |     BIT1    =  000001     |     BIT2    =  000002 
    BIT3    =  000003     |     BIT4    =  000004     |     BIT5    =  000005 
    BIT6    =  000006     |     BIT7    =  000007     |     BLOCK_SI=  000080 
    BOOL_OP_=  000018     |     BOOT_ROM=  006000     |     BOOT_ROM=  007FFF 
    BPTR    =  000003     |     BS      =  000008     |     BUFOUT  =  000003 
    BYE_IDX =  000042     |     C       =  000001     |     CALL_IDX=  00003D 
    CAN     =  000018     |     CAN_DGR =  005426     |     CAN_FPSR=  005427 
    CAN_IER =  005425     |     CAN_MCR =  005420     |     CAN_MSR =  005421 
    CAN_P0  =  005428     |     CAN_P1  =  005429     |     CAN_P2  =  00542A 
    CAN_P3  =  00542B     |     CAN_P4  =  00542C     |     CAN_P5  =  00542D 
    CAN_P6  =  00542E     |     CAN_P7  =  00542F     |     CAN_P8  =  005430 
    CAN_P9  =  005431     |     CAN_PA  =  005432     |     CAN_PB  =  005433 
    CAN_PC  =  005434     |     CAN_PD  =  005435     |     CAN_PE  =  005436 
    CAN_PF  =  005437     |     CAN_RFR =  005424     |     CAN_TPR =  005423 
    CAN_TSR =  005422     |     CC_C    =  000000     |     CC_H    =  000004 
    CC_I0   =  000003     |     CC_I1   =  000005     |     CC_N    =  000002 
    CC_V    =  000007     |     CC_Z    =  000001     |     CELL_SIZ=  000002 G
    CFG_GCR =  007F60     |     CFG_GCR_=  000001     |     CFG_GCR_=  000000 
    CHAIN_BP=  000003     |     CHAIN_CN=  000008     |     CHAIN_LN=  000001 
    CHAIN_TX=  000005     |     CHAIN_TX=  000007     |     CHAR_ARR=  000005 
    CHAR_IDX=  00002E     |     CHAT_IDX=  000030     |     CLKOPT  =  004807 
    CLKOPT_C=  000002     |     CLKOPT_E=  000003     |     CLKOPT_P=  000000 
    CLKOPT_P=  000001     |     CLK_CCOR=  0050C9     |     CLK_CKDI=  0050C6 
    CLK_CKDI=  000000     |     CLK_CKDI=  000001     |     CLK_CKDI=  000002 
    CLK_CKDI=  000003     |     CLK_CKDI=  000004     |     CLK_CMSR=  0050C3 
    CLK_CSSR=  0050C8     |     CLK_ECKR=  0050C1     |     CLK_ECKR=  000000 
    CLK_ECKR=  000001     |     CLK_HSIT=  0050CC     |     CLK_ICKR=  0050C0 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 167.
Hexadecimal [24-Bits]

Symbol Table

    CLK_ICKR=  000002     |     CLK_ICKR=  000000     |     CLK_ICKR=  000001 
    CLK_ICKR=  000003     |     CLK_ICKR=  000004     |     CLK_ICKR=  000005 
    CLK_PCKE=  0050C7     |     CLK_PCKE=  000000     |     CLK_PCKE=  000001 
    CLK_PCKE=  000007     |     CLK_PCKE=  000005     |     CLK_PCKE=  000006 
    CLK_PCKE=  000004     |     CLK_PCKE=  000002     |     CLK_PCKE=  000003 
    CLK_PCKE=  0050CA     |     CLK_PCKE=  000003     |     CLK_PCKE=  000002 
    CLK_PCKE=  000007     |     CLK_SWCR=  0050C5     |     CLK_SWCR=  000000 
    CLK_SWCR=  000001     |     CLK_SWCR=  000002     |     CLK_SWCR=  000003 
    CLK_SWIM=  0050CD     |     CLK_SWR =  0050C4     |     CLK_SWR_=  0000B4 
    CLK_SWR_=  0000E1     |     CLK_SWR_=  0000D2     |     CLR_IDX =  000039 
    CLS_IDX =  000048     |     CMD_END =  000001     |     CMD_LAST=  00004D 
    COL     =  000001     |     COLON   =  00003A     |     COLON_ID=  000001 
    COL_CNT =  000001     |     COMMA   =  00002C     |     COMMA_ID=  000002 
    CON_IDX =  000026     |     COUNT   =  000006     |     CPOS_IDX=  000031 
    CPU_A   =  007F00     |     CPU_CCR =  007F0A     |     CPU_PCE =  007F01 
    CPU_PCH =  007F02     |     CPU_PCL =  007F03     |     CPU_SPH =  007F08 
    CPU_SPL =  007F09     |     CPU_XH  =  007F04     |     CPU_XL  =  007F05 
    CPU_YH  =  007F06     |     CPU_YL  =  007F07     |     CR      =  00000D 
    CTRL_A  =  000001     |     CTRL_B  =  000002     |     CTRL_C  =  000003 
    CTRL_D  =  000004     |     CTRL_E  =  000005     |     CTRL_F  =  000006 
    CTRL_G  =  000007     |     CTRL_H  =  000008     |     CTRL_I  =  000009 
    CTRL_J  =  00000A     |     CTRL_K  =  00000B     |     CTRL_L  =  00000C 
    CTRL_M  =  00000D     |     CTRL_N  =  00000E     |     CTRL_O  =  00000F 
    CTRL_P  =  000010     |     CTRL_Q  =  000011     |     CTRL_R  =  000012 
    CTRL_S  =  000013     |     CTRL_T  =  000014     |     CTRL_U  =  000015 
    CTRL_V  =  000016     |     CTRL_W  =  000017     |     CTRL_X  =  000018 
    CTRL_Y  =  000019     |     CTRL_Z  =  00001A     |     CTXT_SIZ=  000004 
    CURR    =  000002     |     CVAR    =  000005     |     DC1     =  000011 
    DC2     =  000012     |     DC3     =  000013     |     DC4     =  000014 
    DEBUG   =  000000     |     DEBUG_BA=  007F00     |     DEBUG_EN=  007FFF 
    DELIM_LA=  000006     |     DEL_IDX =  000038     |     DEL_SIZE=  000005 
    DEST    =  000001     |     DEST_ADR=  000005     |     DEST_LEN=  000007 
    DEST_SIZ=  000003     |     DEVID_BA=  0048CD     |     DEVID_EN=  0048D8 
    DEVID_LO=  0048D2     |     DEVID_LO=  0048D3     |     DEVID_LO=  0048D4 
    DEVID_LO=  0048D5     |     DEVID_LO=  0048D6     |     DEVID_LO=  0048D7 
    DEVID_LO=  0048D8     |     DEVID_WA=  0048D1     |     DEVID_XH=  0048CE 
    DEVID_XL=  0048CD     |     DEVID_YH=  0048D0     |     DEVID_YL=  0048CF 
    DIGIT   =  000003     |     DIM_IDX =  000019     |     DIM_SIZE=  000003 
    DIR_IDX =  000045     |     DIV_IDX =  00000D     |     DLE     =  000010 
    DM_BK1RE=  007F90     |     DM_BK1RH=  007F91     |     DM_BK1RL=  007F92 
    DM_BK2RE=  007F93     |     DM_BK2RH=  007F94     |     DM_BK2RL=  007F95 
    DM_CR1  =  007F96     |     DM_CR2  =  007F97     |     DM_CSR1 =  007F98 
    DM_CSR2 =  007F99     |     DM_ENFCT=  007F9A     |     DONE    =  000003 
    DO_IDX  =  00004B     |     DURATION=  000001     |     EEPROM_B=  004000 
    EEPROM_E=  0043FF     |     EEPROM_S=  000400     |     EM      =  000019 
    END_ADR =  000003     |     END_IDX =  00001A     |     ENQ     =  000005 
    EOF     =  0000FF     |     EOL_IDX =  000000     |     EOT     =  000004 
    ERASED  =  005858     |     ERASE_ID=  000046     |     ERR_BAD_=  000004 G
    ERR_BAD_=  000006 G   |     ERR_BAD_=  000005 G   |     ERR_DIM =  00000C G
    ERR_DIV0=  000012 G   |     ERR_END =  000009 G   |     ERR_FORS=  000008 G
    ERR_GOSU=  000007 G   |     ERR_GT25=  000003 G   |     ERR_GT32=  000002 G
    ERR_IDX =  000013     |     ERR_MEM_=  00000A G   |     ERR_NONE=  000000 G
    ERR_PROG=  000011 G   |     ERR_RANG=  00000D G   |     ERR_RETY=  000010 G
    ERR_STRI=  00000F G   |     ERR_STR_=  00000E G   |     ERR_SYNT=  000001 G
    ERR_TOO_=  00000B G   |     ESC     =  00001B     |     ETB     =  000017 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 168.
Hexadecimal [24-Bits]

Symbol Table

    ETX     =  000003     |     EXTI_CR1=  0050A0     |     EXTI_CR2=  0050A1 
    FAUTO   =  000006     |     FCNT    =  000001     |     FCOMP   =  000005 
    FF      =  00000C     |     FHSE    =  7A1200     |     FHSI    =  F42400 
    FILE_DAT=  000010     |     FILE_HEA=  000010     |     FILE_NAM=  000004 
    FILE_SIG=  000000     |     FILE_SIZ=  000002     |     FIRST   =  000001 
    FIRST_CH=  000001     |     FIRST_DA=  000004     |     FLASH_BA=  008000 
    FLASH_CR=  00505A     |     FLASH_CR=  000002     |     FLASH_CR=  000000 
    FLASH_CR=  000003     |     FLASH_CR=  000001     |     FLASH_CR=  00505B 
    FLASH_CR=  000005     |     FLASH_CR=  000004     |     FLASH_CR=  000007 
    FLASH_CR=  000000     |     FLASH_CR=  000006     |     FLASH_DU=  005064 
    FLASH_DU=  0000AE     |     FLASH_DU=  000056     |     FLASH_EN=  017FFF 
    FLASH_FP=  00505D     |     FLASH_FP=  000000     |     FLASH_FP=  000001 
    FLASH_FP=  000002     |     FLASH_FP=  000003     |     FLASH_FP=  000004 
    FLASH_FP=  000005     |     FLASH_IA=  00505F     |     FLASH_IA=  000003 
    FLASH_IA=  000002     |     FLASH_IA=  000006     |     FLASH_IA=  000001 
    FLASH_IA=  000000     |   1 FLASH_ME   00115C R   |     FLASH_NC=  00505C 
    FLASH_NF=  00505E     |     FLASH_NF=  000000     |     FLASH_NF=  000001 
    FLASH_NF=  000002     |     FLASH_NF=  000003     |     FLASH_NF=  000004 
    FLASH_NF=  000005     |     FLASH_PU=  005062     |     FLASH_PU=  000056 
    FLASH_PU=  0000AE     |     FLASH_SI=  010000     |     FLASH_WS=  00480D 
    FLSI    =  01F400     |     FMSTR   =  000010     |     FNAME   =  000005 
    FNAME_MA=  00000C     |     FN_ADR  =  000003     |     FN_ARG  =  000001 
    FOPT    =  000001     |     FOR_IDX =  00001B     |     FREE_RAM=  001580 G
    FREQ    =  000003     |     FRUN    =  000000     |     FS      =  00001C 
    FSECTOR_=  000100     |     FSIZE   =  000001     |     FSLEEP  =  000003 
    FSTEP   =  000001     |     FSTOP   =  000004     |     FSYS_TIM   ****** GX
    FS_BASE =  00C000 G   |     FS_SIZE =  00C000 G   |     FTRACE  =  000007 
    FUNC_LAS=  000031     |     F_ARRAY =  000001     |     GOSUB_ID=  00001D 
    GOTO_IDX=  00001F     |     GPIO_BAS=  005000     |     GPIO_CR1=  000003 
    GPIO_CR2=  000004     |     GPIO_DDR=  000002     |     GPIO_IDR=  000001 
    GPIO_ODR=  000000     |     GPIO_SIZ=  000005     |     GS      =  00001D 
    HEAP_ADR=  000001     |     HIMEM_ID=  000036     |     HSE     =  000000 
    HSECNT  =  004809     |     HSI     =  000001     |     I2C_BASE=  005210 
    I2C_CCRH=  00521C     |     I2C_CCRH=  000080     |     I2C_CCRH=  0000C0 
    I2C_CCRH=  000080     |     I2C_CCRH=  000000     |     I2C_CCRH=  000001 
    I2C_CCRH=  000000     |     I2C_CCRH=  000006     |     I2C_CCRH=  000007 
    I2C_CCRL=  00521B     |     I2C_CCRL=  00001A     |     I2C_CCRL=  000002 
    I2C_CCRL=  00000D     |     I2C_CCRL=  000050     |     I2C_CCRL=  000090 
    I2C_CCRL=  0000A0     |     I2C_CR1 =  005210     |     I2C_CR1_=  000006 
    I2C_CR1_=  000007     |     I2C_CR1_=  000000     |     I2C_CR2 =  005211 
    I2C_CR2_=  000002     |     I2C_CR2_=  000003     |     I2C_CR2_=  000000 
    I2C_CR2_=  000001     |     I2C_CR2_=  000007     |     I2C_DR  =  005216 
    I2C_FREQ=  005212     |     I2C_ITR =  00521A     |     I2C_ITR_=  000002 
    I2C_ITR_=  000000     |     I2C_ITR_=  000001     |     I2C_OARH=  005214 
    I2C_OARH=  000001     |     I2C_OARH=  000002     |     I2C_OARH=  000006 
    I2C_OARH=  000007     |     I2C_OARL=  005213     |     I2C_OARL=  000000 
    I2C_OAR_=  000813     |     I2C_OAR_=  000009     |     I2C_PECR=  00521E 
    I2C_READ=  000001     |     I2C_SR1 =  005217     |     I2C_SR1_=  000003 
    I2C_SR1_=  000001     |     I2C_SR1_=  000002     |     I2C_SR1_=  000006 
    I2C_SR1_=  000000     |     I2C_SR1_=  000004     |     I2C_SR1_=  000007 
    I2C_SR2 =  005218     |     I2C_SR2_=  000002     |     I2C_SR2_=  000001 
    I2C_SR2_=  000000     |     I2C_SR2_=  000003     |     I2C_SR2_=  000005 
    I2C_SR3 =  005219     |     I2C_SR3_=  000001     |     I2C_SR3_=  000007 
    I2C_SR3_=  000004     |     I2C_SR3_=  000000     |     I2C_SR3_=  000002 
    I2C_TRIS=  00521D     |     I2C_TRIS=  000005     |     I2C_TRIS=  000005 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 169.
Hexadecimal [24-Bits]

Symbol Table

    I2C_TRIS=  000005     |     I2C_TRIS=  000011     |     I2C_TRIS=  000011 
    I2C_TRIS=  000011     |     I2C_WRIT=  000000     |     IDX     =  000001 
    IF_IDX  =  000020     |     INPUT_DI=  000000     |     INPUT_EI=  000001 
    INPUT_FL=  000000     |     INPUT_ID=  00003A     |     INPUT_PU=  000001 
    INT_ADC2=  000016     |     INT_AUAR=  000012     |     INT_AWU =  000001 
    INT_CAN_=  000008     |     INT_CAN_=  000009     |     INT_CLK =  000002 
    INT_EXTI=  000003     |     INT_EXTI=  000004     |     INT_EXTI=  000005 
    INT_EXTI=  000006     |     INT_EXTI=  000007     |     INT_FLAS=  000018 
    INT_I2C =  000013     |     INT_SIZE=  000002 G   |     INT_SPI =  00000A 
    INT_TIM1=  00000C     |     INT_TIM1=  00000B     |     INT_TIM2=  00000E 
    INT_TIM2=  00000D     |     INT_TIM3=  000010     |     INT_TIM3=  00000F 
    INT_TIM4=  000017     |     INT_TLI =  000000     |     INT_UART=  000011 
    INT_UART=  000015     |     INT_UART=  000014     |     INT_VECT=  008060 
    INT_VECT=  00800C     |     INT_VECT=  008028     |     INT_VECT=  00802C 
    INT_VECT=  008010     |     INT_VECT=  008014     |     INT_VECT=  008018 
    INT_VECT=  00801C     |     INT_VECT=  008020     |     INT_VECT=  008024 
    INT_VECT=  008068     |     INT_VECT=  008054     |     INT_VECT=  008000 
    INT_VECT=  008030     |     INT_VECT=  008038     |     INT_VECT=  008034 
    INT_VECT=  008040     |     INT_VECT=  00803C     |     INT_VECT=  008048 
    INT_VECT=  008044     |     INT_VECT=  008064     |     INT_VECT=  008008 
    INT_VECT=  008004     |     INT_VECT=  008050     |     INT_VECT=  00804C 
    INT_VECT=  00805C     |     INT_VECT=  008058     |     ITC_SPR1=  007F70 
    ITC_SPR2=  007F71     |     ITC_SPR3=  007F72     |     ITC_SPR4=  007F73 
    ITC_SPR5=  007F74     |     ITC_SPR6=  007F75     |     ITC_SPR7=  007F76 
    ITC_SPR8=  007F77     |     ITC_SPR_=  000001     |     ITC_SPR_=  000000 
    ITC_SPR_=  000003     |     IWDG_KEY=  000055     |     IWDG_KEY=  0000CC 
    IWDG_KEY=  0000AA     |     IWDG_KR =  0050E0     |     IWDG_PR =  0050E1 
    IWDG_RLR=  0050E2     |     KEY_IDX =  00002F     |     KWORD_LA=  000027 
    LAST    =  000003     |     LAST_BC =  000004     |     LB      =  000002 
    LED_BIT =  000005     |     LED_MASK=  000020     |     LED_PORT=  00500A 
    LEN     =  000005     |     LEN_IDX =  00002C     |     LET_IDX =  000022 
    LF      =  00000A     |     LIMIT   =  000001     |     LINENO  =  000005 
    LINE_HEA=  000003     |   1 LINK    =  001F13 R   |     LIST_IDX=  00003B 
    LITC_IDX=  000007     |     LITW_IDX=  000008     |     LIT_LAST=  000008 
    LL      =  000001     |     LLEN    =  000007     |     LN      =  000003 
    LNADR   =  000003     |     LN_ADDR =  000007     |     LN_ADR  =  000001 
    LN_LEN  =  000001     |     LN_PTR  =  000005     |     LOAD_IDX=  000044 
    LOCATE_I=  000049     |     LOMEM_ID=  000037     |     LPAREN_I=  000004 
    MAX_CODE=  001500     |     MAX_LINE=  007FFF     |     MIN_VAR_=  000080 
    MOD_IDX =  00000E     |     MULDIV_I=  00004D     |     MULOP   =  000005 
    MULT_IDX=  00000F     |     N       =  000001     |     N1      =  000001 
    NAFR    =  004804     |     NAK     =  000015     |     NAME_SIZ=  000002 
    NCLKOPT =  004808     |     NEED    =  000001     |     NEG     =  000001 
    NEW_IDX =  00003C     |     NEXT_IDX=  00001C     |     NFIELD  =  000002 
    NFLASH_W=  00480E     |     NHSECNT =  00480A     |     NLEN    =  000001 
    NLEN_MAS=  00000F     |     NONE_IDX=  0000FF     |     NOPT1   =  004802 
    NOPT2   =  004804     |     NOPT3   =  004806     |     NOPT4   =  004808 
    NOPT5   =  00480A     |     NOPT6   =  00480C     |     NOPT7   =  00480E 
    NOPTBL  =  00487F     |     NOT_IDX =  000016     |     NOT_OP  =  000001 
    NUBC    =  004802     |     NUCLEO_8=  000001     |     NUCLEO_8=  000000 
    NWDGOPT =  004806     |     NWDGOPT_=  FFFFFFFD     |     NWDGOPT_=  FFFFFFFC 
    NWDGOPT_=  FFFFFFFF     |     NWDGOPT_=  FFFFFFFE     |     OFS     =  000002 
    OFS_UART=  000002     |     OFS_UART=  000003     |     OFS_UART=  000004 
    OFS_UART=  000005     |     OFS_UART=  000006     |     OFS_UART=  000007 
    OFS_UART=  000008     |     OFS_UART=  000009     |     OFS_UART=  000001 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 170.
Hexadecimal [24-Bits]

Symbol Table

    OFS_UART=  000009     |     OFS_UART=  00000A     |     OFS_UART=  000000 
    OP      =  000003     |     OPT0    =  004800     |     OPT1    =  004801 
    OPT2    =  004803     |     OPT3    =  004805     |     OPT4    =  004807 
    OPT5    =  004809     |     OPT6    =  00480B     |     OPT7    =  00480D 
    OPTBL   =  00487E     |     OPTION_B=  004800     |     OPTION_E=  00487F 
    OPTION_S=  000080     |     OP_ARITH=  00000F     |     OP_REL  =  000009 
    OP_REL_L=  000015     |     OR_IDX  =  000018     |     OUTPUT_F=  000001 
    OUTPUT_O=  000000     |     OUTPUT_P=  000001     |     OUTPUT_S=  000000 
  1 P1BASIC    000A61 GR  |     PA      =  000000     |     PAD_SIZE=  000080 G
    PAGE0_SI=  000100 G   |     PA_BASE =  005000     |     PA_CR1  =  005003 
    PA_CR2  =  005004     |     PA_DDR  =  005002     |     PA_IDR  =  005001 
    PA_ODR  =  005000     |     PB      =  000005     |     PB_BASE =  005005 
    PB_CR1  =  005008     |     PB_CR2  =  005009     |     PB_DDR  =  005007 
    PB_IDR  =  005006     |     PB_MAJOR=  000001     |     PB_MINOR=  000000 
    PB_ODR  =  005005     |     PB_REV  =  00000F     |     PC      =  00000A 
    PC_BASE =  00500A     |     PC_CR1  =  00500D     |     PC_CR2  =  00500E 
    PC_DDR  =  00500C     |     PC_IDR  =  00500B     |     PC_ODR  =  00500A 
    PD      =  00000F     |     PD_BASE =  00500F     |     PD_CR1  =  005012 
    PD_CR2  =  005013     |     PD_DDR  =  005011     |     PD_IDR  =  005010 
    PD_ODR  =  00500F     |     PE      =  000014     |     PEEK_IDX=  000029 
    PENDING_=  000010     |     PE_BASE =  005014     |     PE_CR1  =  005017 
    PE_CR2  =  005018     |     PE_DDR  =  005016     |     PE_IDR  =  005015 
    PE_ODR  =  005014     |     PF      =  000019     |     PF_BASE =  005019 
    PF_CR1  =  00501C     |     PF_CR2  =  00501D     |     PF_DDR  =  00501B 
    PF_IDR  =  00501A     |     PF_ODR  =  005019     |     PG      =  00001E 
    PG_BASE =  00501E     |     PG_CR1  =  005021     |     PG_CR2  =  005022 
    PG_DDR  =  005020     |     PG_IDR  =  00501F     |     PG_ODR  =  00501E 
    PH      =  000023     |     PH_BASE =  005023     |     PH_CR1  =  005026 
    PH_CR2  =  005027     |     PH_DDR  =  005025     |     PH_IDR  =  005024 
    PH_ODR  =  005023     |     PI      =  000028     |     PI_BASE =  005028 
    PI_CR1  =  00502B     |     PI_CR2  =  00502C     |     PI_DDR  =  00502A 
    PI_IDR  =  005029     |     PI_ODR  =  005028     |     POKE_IDX=  00003E 
    POK_ADR =  000003     |     PREV    =  000001     |     PREV_BC =  000005 
    PRINT_ID=  00003F     |   1 PROG_ADD   001132 R   |   1 PROG_SIZ   001144 R
    PSTR    =  000001     |     QUOTE_ID=  000006     |     RAM_BASE=  000000 
    RAM_END =  0017FF     |   1 RAM_MEM    00116D R   |     RAM_SIZE=  001800 
    REL_EQU_=  000011     |     REL_GE_I=  000012     |     REL_GT_I=  000014 
    REL_LE_I=  000010     |     REL_LT_I=  000013     |     REL_NE_I=  000015 
    REL_OP  =  000005     |     REM_IDX =  000023     |     RENUM_ID=  00004A 
    RES_LEN =  000007     |     RET_BPTR=  000001     |     RET_IDX =  00001E 
    RET_LN_A=  000003     |     RNDMIZE_=  000047     |     RND_IDX =  00002A 
    ROP     =  004800     |     RPAREN_I=  000005     |     RS      =  00001E 
    RST_SR  =  0050B3     |     RUN_IDX =  000040     |     RX_QUEUE=  000008 
    SAVE_IDX=  000043     |     SCOL_IDX=  000003     |     SEMIC   =  00003B 
    SEMICOL =  000001     |     SFR_BASE=  005000     |     SFR_END =  0057FF 
    SGN_IDX =  00002B     |     SHARP   =  000023     |     SHOW_COD=  000003 
    SI      =  00000F     |     SIGN    =  000005     |     SIGNATUR=  005042 
    SIZE    =  00000B     |     SIZE_FIE=  000003     |     SKIP    =  000003 
    SLEEP_ID=  000032     |     SLEN    =  000002     |     SMALL_FI=  000003 
    SO      =  00000E     |     SOH     =  000001     |     SPACE   =  000020 
    SPI_CR1 =  005200     |     SPI_CR1_=  000003     |     SPI_CR1_=  000000 
    SPI_CR1_=  000001     |     SPI_CR1_=  000007     |     SPI_CR1_=  000002 
    SPI_CR1_=  000006     |     SPI_CR2 =  005201     |     SPI_CR2_=  000007 
    SPI_CR2_=  000006     |     SPI_CR2_=  000005     |     SPI_CR2_=  000004 
    SPI_CR2_=  000002     |     SPI_CR2_=  000000     |     SPI_CR2_=  000001 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 171.
Hexadecimal [24-Bits]

Symbol Table

    SPI_CRCP=  005205     |     SPI_DR  =  005204     |     SPI_ICR =  005202 
    SPI_RXCR=  005206     |     SPI_SR  =  005203     |     SPI_SR_B=  000007 
    SPI_SR_C=  000004     |     SPI_SR_M=  000005     |     SPI_SR_O=  000006 
    SPI_SR_R=  000000     |     SPI_SR_T=  000001     |     SPI_SR_W=  000003 
    SPI_TXCR=  005207     |     SRC     =  000003     |     SRC_ADR =  000009 
    STACK_EM=  0017FF     |     STACK_SI=  000080 G   |     START   =  000003 
    START_AD=  000001     |     STDOUT  =  000001     |     STEP    =  000003 
    STEP_IDX=  000024     |     STOP_IDX=  000025     |     STR1    =  000001 
    STR1_LEN=  000003     |     STR2    =  000005     |     STR2_LEN=  000007 
  1 STR_BYTE   001155 R   |     STR_VAR_=  00000A     |     STX     =  000002 
    SUB     =  00001A     |     SUB_IDX =  00000C     |     SWIM_CSR=  007F80 
    SYMB_LAS=  00000A     |     SYN     =  000016     |     SYS_SIZE=  004000 
    TAB     =  000009     |     TAB_IDX =  000034     |     TAB_WIDT=  000004 
    TCHAR   =  000001     |     TEMP    =  000001     |     THEN_IDX=  000021 
    TIB_SIZE=  000080 G   |     TICK    =  000027     |     TICKS_ID=  00002D 
    TIM1_ARR=  005262     |     TIM1_ARR=  005263     |     TIM1_BKR=  00526D 
    TIM1_CCE=  00525C     |     TIM1_CCE=  00525D     |     TIM1_CCM=  005258 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  005259 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  00525A 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCM=  00525B 
    TIM1_CCM=  000000     |     TIM1_CCM=  000001     |     TIM1_CCM=  000004 
    TIM1_CCM=  000005     |     TIM1_CCM=  000006     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000003     |     TIM1_CCM=  000007 
    TIM1_CCM=  000002     |     TIM1_CCM=  000004     |     TIM1_CCM=  000005 
    TIM1_CCM=  000006     |     TIM1_CCM=  000003     |     TIM1_CCR=  005265 
    TIM1_CCR=  005266     |     TIM1_CCR=  005267     |     TIM1_CCR=  005268 
    TIM1_CCR=  005269     |     TIM1_CCR=  00526A     |     TIM1_CCR=  00526B 
    TIM1_CCR=  00526C     |     TIM1_CNT=  00525E     |     TIM1_CNT=  00525F 
    TIM1_CR1=  005250     |     TIM1_CR2=  005251     |     TIM1_CR2=  000000 
    TIM1_CR2=  000002     |     TIM1_CR2=  000004     |     TIM1_CR2=  000005 
    TIM1_CR2=  000006     |     TIM1_DTR=  00526E     |     TIM1_EGR=  005257 
    TIM1_EGR=  000007     |     TIM1_EGR=  000001     |     TIM1_EGR=  000002 
    TIM1_EGR=  000003     |     TIM1_EGR=  000004     |     TIM1_EGR=  000005 
    TIM1_EGR=  000006     |     TIM1_EGR=  000000     |     TIM1_ETR=  005253 
    TIM1_ETR=  000006     |     TIM1_ETR=  000000     |     TIM1_ETR=  000001 
    TIM1_ETR=  000002     |     TIM1_ETR=  000003     |     TIM1_ETR=  000007 
    TIM1_ETR=  000004     |     TIM1_ETR=  000005     |     TIM1_IER=  005254 
    TIM1_IER=  000007     |     TIM1_IER=  000001     |     TIM1_IER=  000002 
    TIM1_IER=  000003     |     TIM1_IER=  000004     |     TIM1_IER=  000005 
    TIM1_IER=  000006     |     TIM1_IER=  000000     |     TIM1_OIS=  00526F 
    TIM1_PSC=  005260     |     TIM1_PSC=  005261     |     TIM1_RCR=  005264 
    TIM1_SMC=  005252     |     TIM1_SMC=  000007     |     TIM1_SMC=  000000 
    TIM1_SMC=  000001     |     TIM1_SMC=  000002     |     TIM1_SMC=  000004 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 172.
Hexadecimal [24-Bits]

Symbol Table

    TIM1_SMC=  000005     |     TIM1_SMC=  000006     |     TIM1_SR1=  005255 
    TIM1_SR1=  000007     |     TIM1_SR1=  000001     |     TIM1_SR1=  000002 
    TIM1_SR1=  000003     |     TIM1_SR1=  000004     |     TIM1_SR1=  000005 
    TIM1_SR1=  000006     |     TIM1_SR1=  000000     |     TIM1_SR2=  005256 
    TIM1_SR2=  000001     |     TIM1_SR2=  000002     |     TIM1_SR2=  000003 
    TIM1_SR2=  000004     |     TIM2_ARR=  00530D     |     TIM2_ARR=  00530E 
    TIM2_CCE=  005308     |     TIM2_CCE=  000000     |     TIM2_CCE=  000001 
    TIM2_CCE=  000004     |     TIM2_CCE=  000005     |     TIM2_CCE=  005309 
    TIM2_CCM=  005305     |     TIM2_CCM=  005306     |     TIM2_CCM=  005307 
    TIM2_CCM=  000000     |     TIM2_CCM=  000004     |     TIM2_CCM=  000003 
    TIM2_CCR=  00530F     |     TIM2_CCR=  005310     |     TIM2_CCR=  005311 
    TIM2_CCR=  005312     |     TIM2_CCR=  005313     |     TIM2_CCR=  005314 
    TIM2_CLK=  00F424     |     TIM2_CNT=  00530A     |     TIM2_CNT=  00530B 
    TIM2_CR1=  005300     |     TIM2_CR1=  000007     |     TIM2_CR1=  000000 
    TIM2_CR1=  000003     |     TIM2_CR1=  000001     |     TIM2_CR1=  000002 
    TIM2_EGR=  005304     |     TIM2_EGR=  000001     |     TIM2_EGR=  000002 
    TIM2_EGR=  000003     |     TIM2_EGR=  000006     |     TIM2_EGR=  000000 
    TIM2_IER=  005301     |     TIM2_PSC=  00530C     |     TIM2_SR1=  005302 
    TIM2_SR2=  005303     |     TIM3_ARR=  00532B     |     TIM3_ARR=  00532C 
    TIM3_CCE=  005327     |     TIM3_CCE=  000000     |     TIM3_CCE=  000001 
    TIM3_CCE=  000004     |     TIM3_CCE=  000005     |     TIM3_CCE=  000000 
    TIM3_CCE=  000001     |     TIM3_CCM=  005325     |     TIM3_CCM=  005326 
    TIM3_CCM=  000000     |     TIM3_CCM=  000004     |     TIM3_CCM=  000003 
    TIM3_CCR=  00532D     |     TIM3_CCR=  00532E     |     TIM3_CCR=  00532F 
    TIM3_CCR=  005330     |     TIM3_CNT=  005328     |     TIM3_CNT=  005329 
    TIM3_CR1=  005320     |     TIM3_CR1=  000007     |     TIM3_CR1=  000000 
    TIM3_CR1=  000003     |     TIM3_CR1=  000001     |     TIM3_CR1=  000002 
    TIM3_EGR=  005324     |     TIM3_IER=  005321     |     TIM3_PSC=  00532A 
    TIM3_SR1=  005322     |     TIM3_SR2=  005323     |     TIM4_ARR=  005346 
    TIM4_CNT=  005344     |     TIM4_CR1=  005340     |     TIM4_CR1=  000007 
    TIM4_CR1=  000000     |     TIM4_CR1=  000003     |     TIM4_CR1=  000001 
    TIM4_CR1=  000002     |     TIM4_EGR=  005343     |     TIM4_EGR=  000000 
    TIM4_IER=  005341     |     TIM4_IER=  000000     |     TIM4_PSC=  005345 
    TIM4_PSC=  000000     |     TIM4_PSC=  000007     |     TIM4_PSC=  000004 
    TIM4_PSC=  000001     |     TIM4_PSC=  000005     |     TIM4_PSC=  000002 
    TIM4_PSC=  000006     |     TIM4_PSC=  000003     |     TIM4_PSC=  000000 
    TIM4_PSC=  000001     |     TIM4_PSC=  000002     |     TIM4_SR =  005342 
    TIM4_SR_=  000000     |     TIM_CR1_=  000007     |     TIM_CR1_=  000000 
    TIM_CR1_=  000006     |     TIM_CR1_=  000005     |     TIM_CR1_=  000004 
    TIM_CR1_=  000003     |     TIM_CR1_=  000001     |     TIM_CR1_=  000002 
    TOKEN   =  000001     |     TOK_IDX =  00004E     |     TOK_POS =  000001 
    TONE_IDX=  000033     |     TOS     =  000001     |     TO_IDX  =  000027 
    TO_WRITE=  000001     |     TYPE_CON=  000020     |     TYPE_DVA=  000010 
    TYPE_MAS=  0000F0     |     UART    =  000002     |     UART1   =  000000 
    UART1_BA=  005230     |     UART1_BR=  005232     |     UART1_BR=  005233 
    UART1_CR=  005234     |     UART1_CR=  005235     |     UART1_CR=  005236 
    UART1_CR=  005237     |     UART1_CR=  005238     |     UART1_DR=  005231 
    UART1_GT=  005239     |     UART1_PO=  000000     |     UART1_PS=  00523A 
    UART1_RX=  000004     |     UART1_SR=  005230     |     UART1_TX=  000005 
    UART2   =  000001     |     UART3   =  000002     |     UART3_BA=  005240 
    UART3_BR=  005242     |     UART3_BR=  005243     |     UART3_CR=  005244 
    UART3_CR=  005245     |     UART3_CR=  005246     |     UART3_CR=  005247 
    UART3_CR=  005249     |     UART3_DR=  005241     |     UART3_PO=  00000F 
    UART3_RX=  000006     |     UART3_SR=  005240     |     UART3_TX=  000005 
    UART_BRR=  005242     |     UART_BRR=  005243     |     UART_CR1=  005244 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 173.
Hexadecimal [24-Bits]

Symbol Table

    UART_CR1=  000004     |     UART_CR1=  000002     |     UART_CR1=  000000 
    UART_CR1=  000001     |     UART_CR1=  000007     |     UART_CR1=  000006 
    UART_CR1=  000005     |     UART_CR1=  000003     |     UART_CR2=  005245 
    UART_CR2=  000004     |     UART_CR2=  000002     |     UART_CR2=  000005 
    UART_CR2=  000001     |     UART_CR2=  000000     |     UART_CR2=  000006 
    UART_CR2=  000003     |     UART_CR2=  000007     |     UART_CR3=  000003 
    UART_CR3=  000001     |     UART_CR3=  000002     |     UART_CR3=  000000 
    UART_CR3=  000006     |     UART_CR3=  000004     |     UART_CR3=  000005 
    UART_CR4=  000000     |     UART_CR4=  000001     |     UART_CR4=  000002 
    UART_CR4=  000003     |     UART_CR4=  000004     |     UART_CR4=  000006 
    UART_CR4=  000005     |     UART_CR5=  000003     |     UART_CR5=  000001 
    UART_CR5=  000002     |     UART_CR5=  000004     |     UART_CR5=  000005 
    UART_CR6=  000004     |     UART_CR6=  000007     |     UART_CR6=  000001 
    UART_CR6=  000002     |     UART_CR6=  000000     |     UART_CR6=  000005 
    UART_DR =  005241     |     UART_PCK=  000003     |     UART_POR=  00500D 
    UART_POR=  00500E     |     UART_POR=  00500C     |     UART_POR=  00500B 
    UART_POR=  00500A     |     UART_RX_=  000006     |     UART_SR =  005240 
    UART_SR_=  000001     |     UART_SR_=  000004     |     UART_SR_=  000002 
    UART_SR_=  000003     |     UART_SR_=  000000     |     UART_SR_=  000005 
    UART_SR_=  000006     |     UART_SR_=  000007     |     UART_TX_=  000005 
    UBC     =  004801     |     UNTIL_ID=  00004C     |     US      =  00001F 
    VAL1    =  000003     |     VAL2    =  000001     |     VALUE   =  000001 
    VAR_ADR =  000005     |     VAR_IDX =  000009     |     VAR_NAME=  000005 
    VAR_TYPE=  000009     |     VAR_VALU=  000003     |     VNAME   =  000002 
    VSIZE   =  000004     |     VSIZE2  =  00000C     |     VT      =  00000B 
    WCNT    =  000002     |     WDGOPT  =  004805     |     WDGOPT_I=  000002 
    WDGOPT_L=  000003     |     WDGOPT_W=  000000     |     WDGOPT_W=  000001 
    WIDTH   =  000001     |     WORDS_ID=  000041     |     WWDG_CR =  0050D1 
    WWDG_WR =  0050D2     |     XOFF    =  000013     |     XON     =  000011 
    XSAVE   =  000006     |     YSAVE   =  000007     |     YTEMP   =  000009 
    acc16      ****** GX  |     acc8       ****** GX  |   1 addr_to_   001BC8 R
    addr_to_   ****** GX  |   1 all_word   001F11 R   |   1 and_cond   000D9A R
  1 and_fact   000D78 R   |   1 app        001F80 R   |     app_info   ****** GX
  1 app_name   0009E0 R   |   1 app_spac   001F80 R   |   1 arg_list   000BF3 R
  1 atoi16     000B67 GR  |   3 auto_lin   000044 R   |   3 auto_ste   000046 R
  1 bad_valu   001AE7 R   |     base       ****** GX  |   1 basic_lo   0017C2 R
  3 basicptr   000035 GR  |   1 bkslsh_t   00036C R   |     bksp       ****** GX
  1 bytes_fr   001AFD R   |   1 char_to_   000B50 R   |   1 check_fo   000FC2 R
  1 check_sy   000252 R   |   1 clear_pr   001ADA R   |   1 clear_st   001A0A R
    clr_scre   ****** GX  |   1 cmd_auto   0019E0 R   |   1 cmd_bye    001844 R
  1 cmd_call   0019BF GR  |   1 cmd_clea   001A1D R   |   1 cmd_cls    001B08 R
  1 cmd_del    001A2C R   |   1 cmd_dir    0017DD R   |   1 cmd_eras   0016C5 R
  1 cmd_hime   001A9D R   |   1 cmd_inpu   001335 R   |   1 cmd_line   000AB5 R
  1 cmd_list   00117C R   |   1 cmd_load   001799 R   |   1 cmd_loca   001B1C R
  1 cmd_lome   001ABE R   |   1 cmd_new    0016BA R   |   1 cmd_poke   0013D1 R
  1 cmd_prin   00121B R   |   1 cmd_rand   0018A4 R   |   1 cmd_renu   001B5D R
  1 cmd_run    0015DC R   |   1 cmd_save   001706 R   |   1 cmd_scr    0016BA R
  1 cmd_set_   001995 R   |   1 cmd_slee   001855 R   |   1 cmd_tab    0019B4 R
  1 cmd_tone   001639 R   |   1 cmd_word   0018FA R   |   1 code_add   000000 R
  1 colon_ts   000394 R   |   1 comma_ts   00039F R   |   1 comment    0006BE R
  1 comp_msg   000962 R   |   1 compile    0004B0 GR  |   1 compile_   000218 R
  1 con_msg    001690 R   |   1 cond_acc   00140C R   |   1 conditio   000DC0 R
  1 convert_   0001E6 R   |   1 copy_com   0003E4 R   |   3 count      000032 GR
  1 create_v   000F57 R   |   1 ctrl_c_m   000A8B R   |   1 ctrl_c_s   000A98 R
    ctrl_c_v   ****** GX  |     cursor_c   ****** GX  |     cursor_p   ****** GX
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 174.
Hexadecimal [24-Bits]

Symbol Table

  1 dash_tst   0003B5 R   |   1 decomp_e   0006D0 R   |   1 decomp_l   000617 R
  1 decompil   0005F1 GR  |   1 del_line   0000CE R   |   1 dict_end   001C9B R
  1 digit_te   00034B R   |   1 dim_next   001056 R   |     div32_16   ****** GX
    divide     ****** GX  |   1 do_nothi   000AEA R   |   3 dvar_bgn   00003D GR
  3 dvar_end   00003F GR  |     eeprom_e   ****** GX  |     eeprom_r   ****** GX
    eeprom_w   ****** GX  |   1 eql_tst    00043B R   |   1 erase_fi   000705 R
  1 erase_pr   0016DA R   |   1 err_bad_   0008CD R   |   1 err_bad_   0008E3 R
  1 err_bad_   0008D8 R   |   1 err_dim    000914 R   |   1 err_div0   000947 R
  1 err_end    0008FE R   |   1 err_err    000978 R   |   1 err_gt25   0008C8 R
  1 err_gt32   0008C1 R   |   1 err_gt8_   0008F6 R   |   1 err_gt8_   0008EC R
  1 err_mem_   000902 R   |   1 err_msg_   000894 R   |   1 err_prog   00093A R
  1 err_rang   000918 R   |   1 err_rety   00092E R   |   1 err_star   000973 R
  1 err_str_   00091E R   |   1 err_stri   000927 R   |   1 err_synt   0008BA R
  1 err_too_   00090B R   |   1 error_me   0008BA R   |   1 escaped    0001FB GR
  1 expect     000BDA R   |   1 expect_i   000B3E R   |   1 expressi   000CE2 R
  1 factor     000C38 R   |     farptr     ****** GX  |   1 file_exi   001761 R
  3 file_hea   00005C R   |   1 file_siz   001837 R   |   1 files_co   00183E R
  1 first_fi   000836 R   |   3 flags      000043 GR  |   3 for_nest   000048 R
  1 free       001AEC R   |   4 free_ram   000100 R   |   1 func_abs   00187C R
  1 func_arg   000BE8 R   |   1 func_cha   00186B R   |   1 func_cha   001B34 R
  1 func_cpo   001B59 R   |   1 func_key   0013C6 R   |   1 func_len   0018C5 R
  1 func_mul   000C15 R   |   1 func_pee   0013E5 R   |   1 func_ran   00188C R
  1 func_sig   0018AD R   |   1 func_tic   001868 R   |   1 func_tim   0019AA R
  1 get_arra   000FE3 R   |     get_char   ****** GX  |   1 get_stri   000ED6 R
  1 get_stri   001021 R   |   1 get_targ   001563 R   |   1 get_var_   000F84 R
    getc       ****** GX  |   3 gosub_ne   000049 R   |   1 gt_tst     000446 R
  1 heap_all   000F38 R   |   3 heap_fre   000041 GR  |   3 himem      000039 GR
  1 if_strin   001418 R   |   3 in         000031 GR  |   3 in.w       000030 GR
  1 incr_far   000887 R   |   1 input_ex   0013C1 R   |   1 input_in   0012BF R
  1 input_pr   0012AC R   |   1 input_st   001327 R   |   1 insert_l   00013C R
  1 integer    000352 R   |   1 interp_l   000AEA R   |     is_alpha   ****** GX
    is_digit   ****** GX  |     itoa       ****** GX  |   1 jp_to_ta   001590 R
  1 kword_co   0016A2 R   |   1 kword_di   001E94 GR  |   1 kword_di   001054 R
  1 kword_do   001C7F R   |   1 kword_en   00162D R   |   1 kword_fo   0014D8 R
  1 kword_go   0015A3 R   |   1 kword_go   0015A3 R   |   1 kword_go   0015B7 R
  1 kword_go   001584 R   |   1 kword_go   001584 R   |   1 kword_if   0013F4 R
  1 kword_le   000DF3 GR  |   1 kword_le   000E04 R   |   1 kword_ne   00152C R
  1 kword_re   000AF5 GR  |   1 kword_re   0015C3 R   |   1 kword_st   00151E R
  1 kword_st   001657 R   |   1 kword_to   00150D R   |   1 kword_un   001C87 R
  1 let_int_   000E06 R   |   1 let_stri   000E26 R   |   1 let_stri   000E28 R
  3 line.add   000033 GR  |   1 line_by_   001BB5 R   |   1 line_to_   001B91 R
  1 list_exi   001205 R   |   1 list_loo   0011E1 R   |   1 list_to    0011BF R
  1 lit_word   0006A6 R   |   1 load_fil   000763 R   |   3 lomem      000037 GR
  1 loop_bac   001552 R   |   1 loop_don   00155C R   |   1 lt_tst     00046D R
    move       ****** GX  |     multiply   ****** GX  |   1 nbr_tst    000343 R
  1 need_spa   0005E1 R   |     new_line   ****** GX  |   1 next_fil   00083B R
  1 next_lin   000B02 R   |   1 no_match   000BC2 R   |   1 no_prog    001772 R
  1 no_space   001786 R   |   1 not_a_fi   0017B2 R   |   1 not_a_li   001A98 R
  1 not_file   0016EC R   |   1 open_gap   000107 R   |   1 other      000494 R
  1 other_te   00035B R   |     out        ****** GX  |     pad        ****** GX
  1 parse_in   000203 R   |   1 parse_ke   0002B0 R   |   1 parse_le   000318 R
  1 parse_qu   0001A4 R   |   1 parse_sy   000225 R   |   1 pb_copyr   0009ED R
  3 pending_   00004C R   |   1 plus_tst   00040F R   |   1 prcnt_ts   000430 R
  1 print_ap   000A10 R   |   1 print_er   0009C7 R   |     print_he   ****** GX
    print_in   ****** GX  |   1 print_li   0011C4 R   |   1 print_va   0012B2 R
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 175.
Hexadecimal [24-Bits]

Symbol Table

    prng       ****** GX  |   1 prog_siz   0010E8 R   |   3 progend    00003B GR
  1 program_   0010EF R   |   1 prt_basi   00120D GR  |   1 prt_line   000B24 R
  1 prt_loop   00121F R   |   1 prt_quot   000565 R   |   1 prt_spac   00067E R
  1 prt_var_   0005AD R   |   3 psp        00004A R   |     ptr16      ****** GX
  1 push_it    0002A9 R   |     putc       ****** GX  |     puts       ****** GX
    qgetc      ****** GX  |   1 qmark_ts   0003CB R   |   1 quoted_s   0006CA R
    readln     ****** GX  |   1 reclaim_   000713 R   |   1 relation   000D1E R
  1 renumber   001BF5 R   |   1 reset_ba   000A3F R   |   1 reset_se   00121D R
  1 rest_con   001297 R   |     restore_   ****** GX  |   1 retype     00129F R
  1 right_al   00054A GR  |   1 rparnt_t   000384 R   |   1 rt_msg     000950 R
  1 save_con   001290 R   |     save_cur   ****** GX  |   1 save_fil   00078C R
  1 scan_for   001C15 R   |   1 search_d   000BAF GR  |   1 search_e   000BD7 R
  1 search_f   0006D9 R   |   1 search_f   0007F5 R   |   1 search_l   00009C GR
  1 search_n   000BB5 R   |   1 search_v   001026 R   |     seedx      ****** GX
    seedy      ****** GX  |   1 semic_ts   0003AA R   |     set_curs   ****** GX
    set_seed   ****** GX  |   1 sharp_ts   0003C0 R   |   1 skip       000307 R
  1 skip_str   000B31 R   |   1 skip_to_   00087D R   |   1 slash_ts   000425 R
    space      ****** GX  |     spaces     ****** GX  |     spi_enab   ****** GX
    stack_fu   ****** GX  |   1 star_tst   00041A R   |   1 stop_msg   001681 R
  1 store_lo   001523 R   |   1 str_matc   000BCE R   |   1 str_tst    000331 R
    strcmp     ****** GX  |     strcpy     ****** GX  |     strlen     ****** GX
  1 symb_loo   00022C R   |   1 syntax_e   000981 GR  |     sys_flag   ****** GX
  1 target01   001566 R   |   1 tb_error   000983 GR  |   1 term       000C99 R
  1 term01     000CA0 R   |   1 term_exi   000CDD R   |     tib        ****** GX
  1 tick_tst   0003DA R   |     ticks      ****** GX  |     timer      ****** GX
    to_upper   ****** GX  |   1 tok_to_n   0005B8 R   |   1 token_ch   0004A9 R
  1 token_ex   0004AD R   |     tone       ****** GX  |     uart_put   ****** GX
    umul16_8   ****** GX  |   1 variable   00068B R   |   1 warm_ini   000A2D R
  1 warm_sta   000AB2 R   |   1 words_co   00197F R

ASxxxx Assembler V02.00 + NoICE + SDCC mods  (STMicroelectronics STM8), page 176.
Hexadecimal [24-Bits]

Area Table

   0 _CODE      size      0   flags    0
   1 CODE       size   1F80   flags    0
   2 APP_DATA   size      0   flags    8
   3 APP_DATA   size     3C   flags    8
   4 APP_DATA   size      0   flags    8

